function s(t,e){var i=this;this._settings=t,this._context=e,this._width=0,this._graph_data_vis=[],jQuery.getJSON(window.server+"json/colmag.json",function(t){i._graph_data_raw=t,$.each(i._graph_data_raw,function(t,e){i._graph_data_vis.push([parseFloat(e[0]),parseFloat(e[1])])}),i._resize(),$(window).resize(function(){i._resize()})})}function r(t,e,i){return i=i||"0",(t+="").length>=e?t:new Array(e-t.length+1).join(i)+t}function xe(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function ye(t){return"#"+(16777216+(t[2]|t[1]<<8|t[0]<<16)).toString(16).slice(1)}function we(t,e){return"rgba("+t[0]+","+t[1]+","+t[2]+","+e+")"}function Me(t,e,i){for(var s=[0,0,0],a=0;a<3;a++)s[a]=Ie((1-i)*t[a]+i*e[a]),s[a]<0&&(s[a]=0),255<s[a]&&(s[a]=255);return s}function ke(t,e){for(var i=123*Math.PI/180,s=192.85948*Math.PI/180,a=27.12825*Math.PI/180,o=Math.asin(Math.sin(e)*Math.sin(a)+Math.cos(a)*Math.cos(e)*Math.cos(t-s)),n=Math.cos(e)*Math.sin(t-s)/Math.cos(o),s=(Math.cos(a)*Math.sin(e)-Math.sin(a)*Math.cos(e)*Math.cos(t-s))/Math.cos(o),h=i-Math.atan2(n,s);o<-Math.PI;)o+=2*Math.PI;for(;o>Math.PI;)o-=2*Math.PI;for(;h<-Math.PI;)h+=2*Math.PI;for(;h>Math.PI;)h-=2*Math.PI;return[h,o]}function u(t){t=(t-be._utc_now())/86400;return 2<=t?Math.floor(t)+"&nbsp;days&nbsp;away":t<-1?Math.floor(-t)+"&nbsp;days&nbsp;ago":1<t?"1 day away":t<-1?"1 day ago":2/24<t?Math.floor(24*t)+"&nbsp;hours&nbsp;away":1/24<t?"1&nbsp;hour&nbsp;away":t<-2/24?Math.floor(24*-t)+"&nbsp;hours&nbsp;ago":t<-1/24?"1&nbsp;hour&nbsp;ago":0<t?Math.floor(24*t*60)+"&nbsp;mins&nbsp;away":Math.floor(24*-t*60)+"&nbsp;mins&nbsp;ago"}function l(t){for(var e=[],i=[],s=(this.data=t).tzOffset,a=0;a<s.length;a++)for(var o=s[a],n=0;n<o[0];n++)e.push(o[1]),i.push(o[2]);this._offset_array=e,this._name_array=i,this._start=t.start,this._step_size=t.step_size,this._len=e.length}$(function(){$(".autocomplete_object").each(function(t,e){var e=$(e),s=$(e.data("typefrom")),a=parseInt(e.data("include-constellations"));e.autocomplete({source:function(t,e){var i=0;s&&(i=s.val()),$.ajax({url:window.server+"json/objectautocomp.php",dataType:"jsonp",data:{s:t.term,cat:i,ic:a},success:function(t){e(t)}})},minLength:3,delay:500})}),$(".autocomplete_location").each(function(t,e){var e=$(e),i=$(".location_id",e),s=$(".location_txt",e),a=$(".location_form",e);s.autocomplete({source:function(t,e){$.ajax({url:window.server+"json/locationautocomp.php",dataType:"jsonp",data:{s:t.term},success:function(t){t.length<1?i.val(""):i.val(t[0].value),e(t)}})},select:function(t,e){return s.val(e.item.label),i.val(e.item.value),i.trigger("change"),a.trigger("submit"),!1},minLength:3,delay:200}),a.submit(function(){return!!i.val()||(alert("No towns match your search."),!1)})}),$(".autocomplete_location_toggle").each(function(t,e){var i=$(e),e=i.data("key"),s=!1,a=$('.autocomplete_location_popup[data-key="'+e+'"]');i.click(function(){var t;return s=s?(a.stop().hide(400),!1):(t=$(".location_txt",a),a.stop().show(400),t.focus(),!0),!1})})}),s.prototype._draw=function(){for(var t,e,i,s=-.4,a=1.8,o=9,n=-5,h=0;h<3;h++)this._settings.abs_mag>o&&(o+=2,n+=2),this._settings.abs_mag<n&&(o-=2,n-=2);this._settings.abs_mag>o&&(o+=2),this._settings.abs_mag<n&&(n-=2);function r(t,e){if(t<Math.min(s,a)||t>Math.max(s,a)||e<Math.min(o,n)||e>Math.max(o,n))return null;var i=c-45;return[45+(l-8-45)*(t-s)/2.2,i+(8-i)*(e-o)/(n-o)]}var _=$(".graphbuff",this._context)[0];_.width=this._width,_.height=this._height;var h,l=_.width,c=_.height,p=_.getContext("2d"),d=this._graph_data_vis,u=d.length;for(p.fillStyle=Ie(window.skin)?"rgba(240,240,240,0.12)":"rgba(0,0,0,0.12)",h=0;h<u;h++)(i=r(d[h][0],d[h][1]))&&(p.beginPath(),p.arc(i[0],i[1],1.5,0,2*Math.PI,!1),p.fill());for(p.fillStyle="#e08000",(i=r(this._settings["b-v"],this._settings.abs_mag))&&(p.beginPath(),p.arc(i[0],i[1],3.5,0,2*Math.PI,!1),p.fill(),(_=$(".PLcrosshair",this._context)).css("left",Math.floor(i[0]-18)+"px"),_.css("top",Math.floor(i[1]-18)+"px"),_.css("display","block")),p.lineWidth=1,p.fillStyle=Ie(window.skin)?"#aaa":"#222",p.textBaseline="middle",p.textAlign="center",p.font="14px Arial,Helvetica,sans-serif",p.beginPath(),t=s;t<=a;t+=.2)(i=r(t,o))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0],i[1]-5)),(i=r(t,n))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0],i[1]+5));for(e=o;n<=e;e+=-.5)(i=r(s,e))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0]+5,i[1])),(i=r(a,e))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0]-5,i[1]));for(t=s;t<=a;t+=.4)(i=r(t,o))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0],i[1]-10),p.stroke(),p.fillText(t.toFixed(1),i[0],i[1]+45*.33)),(i=r(t,n))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0],i[1]+10));for(e=o;n<=e;e+=-2)(i=r(s,e))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0]+10,i[1]),p.stroke(),p.fillText(e.toFixed(0),i[0]-45*.33,i[1])),(i=r(a,e))&&(p.moveTo(i[0],i[1]),p.lineTo(i[0]-10,i[1]));p.stroke(),p.strokeStyle=Ie(window.skin)?"#aaa":"#222",p.lineWidth=1.5,p.beginPath(),p.rect(45,8,c-8-45,l-45-8),p.stroke(),p.font="bold 15px Arial,Helvetica,sans-serif",i=r(.7,(o+n)/2),p.fillText("B-V color",i[0],c-13.5),p.save(),p.translate(13.5,i[1]),p.rotate(-Math.PI/2),p.fillText("Absolute Magnitude",0,0),p.restore()},s.prototype._resize=function(){this._width=this._context.width()-20,this._height=+this._width,this._draw()},$(function(){$(".color_magnitude").each(function(t,e){var i=$(e),e=new s(i.data("meta"),i);i.data("handler",e)})}),l.prototype.offset=function(t){if(t<this._start)return this._offset_array[0];t=Math.floor((t-this._start)/this._step_size);return t>this._len?this._offset_array[this._len-1]:this._offset_array[t]},l.prototype._tzName=function(t){if(t<this._start)return this._name_array[0];t=Math.floor((t-this._start)/this._step_size);return t>this._len?this._name_array[this._len-1]:this._name_array[t]};var be={};function e(t,e,i,s){var a=this;this._controls=t,this._targets=e,this._status=i,this._displays=s,$.each(this._controls,function(t,e){e[0].click(function(){a.toggle(e[1])}),e[0].css("cursor","pointer")}),$.each(this._targets,function(t,e){$(".close_button",e[0]).click(function(){a._status=!1,a._update()})})}function a(t,e){var i=this;i._settings=t,i._context=e,i._tzOffset=new l(this._settings.tzOffset),i._planetarium_el=$("#"+t.planetarium_id),i._refresh=1,i._dayoffset=0,i._radecold=[0,0];var s=$(".earth_day",i._context)[0],e=$(".earth_day_buf",i._context)[0];e.width=s.width+2,e.height=s.height+2;t=e.getContext("2d");t.drawImage(s,0,0,s.width,s.height),i._earth_day_canvas=t,i._earth_day_width=s.width,i._earth_day_height=s.height,i.earth_day=t.getImageData(0,0,i._earth_day_width,i._earth_day_height).data,s=$(".earth_night",i._context)[0],(e=$(".earth_night_buf",i._context)[0]).width=s.width+2,e.height=s.height+2,(t=e.getContext("2d")).drawImage(s,0,0,s.width,s.height),i._earth_night_canvas=t,i._earth_night_width=s.width,i._earth_night_height=s.height,i.earth_night=t.getImageData(0,0,i._earth_night_width,i._earth_night_height).data,i._earth_width=s.width,i._earth_height=s.height,$(".EISslider",i._context).slider({min:0,max:200,value:100,change:function(){i._dayoffset=$(".EISslider",i._context).slider("value")-100,i._refresh=1},slide:function(){i._dayoffset=$(".EISslider",i._context).slider("value")-100,i._refresh=1}}),this.resize(),$(window).resize(function(){i.resize()}),setInterval(function(){i._alarm()},400)}function o(t,e){var i=this;i._settings=t,i._context=e,i._refresh=!0,i._markers={},i._paths=[],i._colors=["blue","red"],i._title=["Annular eclipse","Total eclipse"],this._doKey(),i._map=null,i._paths=[],i._contours=[],t.showPaths&&jQuery.getJSON(window.server+"news/eclipses/paths_all.json",function(t){i._paths=t,i._refresh=!0,$("#year-from, #year-to",i._context).on("change",function(){i._refresh=!0})}),null!==t.contoursUrl&&jQuery.getJSON(t.contoursUrl,function(t){i._contours=t,i._refresh=!0}),setInterval(function(){i._updateAlarm()},100)}function n(t,e){var i=this;this._settings=t,this._context=e,this._width=0,this._tzOffset=new l(t.tzOffset),this._refresh=!1,this.json=null,this._time_step=200,this._total_animation_time=8e3,this._animation_counter=-1,this._update_key=0,this._url=t.url,this._resize(),$(window).resize(function(){i._resize()}),$.getJSON(this._url,function(t){i.json=t,i._refresh=!0,i._resize()}),$(".chk",this._context).change(function(){i._refresh=!0}),$(".ESslider",this._context).slider({min:0,max:200,value:0,slide:function(){$(".ecl_pause",i._context).prop("checked",!0),i._refresh=!0}}),setInterval(function(){i._refresh&&i._updateAlarm()},200)}function h(t,e){var i=this;this._settings=t,this._context=e,$("input, select",this._context).change(function(){i._write_html()}),i._write_html()}function _(t,e,i){this._x=t,this._y=e,this._z=i}function c(t,e,i,s){t*=Math.PI/180,e*=Math.PI/180;s=st(s)*Math.PI/12,i=6371e3+i;return new _(i*Math.cos(e+s)*Math.cos(t),i*Math.sin(e+s)*Math.cos(t),i*Math.sin(t))}function p(t,e,i){this._x=t,this._y=e,this._z=i}function N(t,e){return t*=Math.PI/12,e*=Math.PI/180,new p(Math.cos(t)*Math.cos(e),Math.sin(t)*Math.cos(e),Math.sin(e))}function t(t,e){this._x0=t,this._direction=e}function d(){this._m=[[1,0,0],[0,1,0],[0,0,1]]}function f(t,e,i){var s=new d,a=s._m;return a[1][1]=Math.cos(t)*Math.cos(e),a[1][0]=Math.sin(i)*Math.sin(t)*Math.cos(e)-Math.cos(i)*Math.sin(e),a[1][2]=Math.cos(i)*Math.sin(t)*Math.cos(e)+Math.sin(i)*Math.sin(e),a[0][1]=Math.cos(t)*Math.sin(e),a[0][0]=Math.sin(i)*Math.sin(t)*Math.sin(e)+Math.cos(i)*Math.cos(e),a[0][2]=Math.cos(i)*Math.sin(t)*Math.sin(e)-Math.sin(i)*Math.cos(e),a[2][1]=-Math.sin(t),a[2][0]=Math.sin(i)*Math.cos(t),a[2][2]=Math.cos(i)*Math.cos(t),s}function i(t){var e=new d;return e._m=[[1,0,0],[0,Math.sin(t),-Math.cos(t)],[0,Math.cos(t),Math.sin(t)]],e}function g(t,e,i,s){var e=new N(12*t/Math.PI,180*e/Math.PI);.999999999<(e=(e=e._rotate_xy(-i))._rotate_xz(Math.PI/2-s))._z&&(e._z=1),e._z<-.999999999&&(e._z=-1);s=Math.asin(e._z),e=Math.abs(Math.cos(s))<1e-7?0:Math.atan2(e._y/Math.cos(s),e._x/Math.cos(s));return[Math.PI/2-s,e]}function m(t,e,i,s,a){t*=Math.PI/12,e*=Math.PI/180,i*=Math.PI/12,s*=Math.PI/180,a*=Math.PI/180;i=g(t,e,i,s),s=i[0],i=i[1];if(i-=a,s>Math.PI/2)return 0;a=Math.tan(s/2),s=a*Math.cos(i);return[a*-Math.sin(i),s]}function v(t,e,i,s,a){var o=2*Math.atan(t*t+e*e),a=Math.atan2(-t,e)+a,o=Math.PI/2-o;if(o<0)return 0;o=new p(Math.cos(o)*Math.cos(a),Math.cos(o)*Math.sin(a),Math.sin(o));return o=(o=o._rotate_xz(-Math.PI/2+s))._rotate_xy(i),[12*Math.atan2(o._y,o._x)/Math.PI,180*Math.asin(o._z)/Math.PI]}function st(t){var e=40587.5+t/86400,t=(e-51545)/36525;return(280.46061837+360.98564736629*(e-51545)+387933e-9*t*t+t*t*t/3871e4)%360*12/180}function x(t,e,i){i=st(i)*Math.PI/12;return t*=Math.PI/180,e*=Math.PI/180,new p(Math.cos(e+i)*Math.cos(t),Math.sin(e+i)*Math.cos(t),Math.sin(t))._to_ra_dec()}function y(t,e,i,s){e*=Math.PI/180,s*=Math.PI/180,t*=Math.PI/12,i*=Math.PI/12;s=new p(Math.cos(i)*Math.cos(s),Math.sin(i)*Math.cos(s),Math.sin(s));return s=(s=s._rotate_xy(-t))._rotate_xz(Math.PI/2-e),180*Math.atan2(s._y,-s._x)/Math.PI}function R(t,e,i){i=-i;var s=Math.sin(t),t=Math.PI/2-e,e=(s-Math.sin(i)*Math.cos(t))/(Math.cos(i)*Math.sin(t)),s=Math.sqrt(1-Math.pow(e,2)),t=Math.atan2(s*Math.cos(i),e*Math.cos(i)*Math.cos(t)-Math.sin(i)*Math.sin(t));return isNaN(t)?-1:43200*(1-Math.abs(t/Math.PI))}function w(t){var e=(t-946684800)/31557600,i=e/100,s=.0002236174+1.35263017e-7*i,a=971719333e-13+4.14515697e-8*i,o=Math.PI/180,n=(t/86400+2440587.5-2451545)/36525,i=357.52911+35999.05029*n+1537e-7*n*n,t=280.46646+36000.76983*n+3032e-7*n*n+((1.914602-.004817*n-14e-6*n*n)*Math.sin(i*o)+(.019993-101e-6*n)*Math.sin(2*i*o)+289e-6*Math.sin(3*i*o)),i=23.43929111111111+46.815/3600*n,n=Math.atan2(Math.cos(i*o)*Math.sin(t*o),Math.cos(t*o)),o=Math.sin(i*o)*Math.sin(t*o);return[n+=(s+a*Math.sin(n)*Math.tan(o))*e,o+=a*Math.cos(n)*e]}function M(t){var e=t/86400+2440587.5,t=(e-2451545)/36525;return(280.46061837+360.98564736629*(e-2451545)+387933e-9*t*t+t*t*t/3871e4)*(Math.PI/180)}function k(t){return t*t}function b(t,e,i,s){var a=Math.sin(t)*Math.cos(e),o=Math.cos(t)*Math.cos(e),t=Math.sin(e),e=Math.sin(i)*Math.cos(s),i=Math.cos(i)*Math.cos(s),s=Math.sin(s),s=Math.sqrt(k(a-e)+k(o-i)+k(t-s));return 2*Math.asin(s/2)}function P(t,e){var s=this;this._settings=t,this._context=e,this._width=$(e).width(),this._tzOffset=new l(t.tzOffset),s._graph_data_raw=this._settings.data,s._time_points=[],s._graph_data_final=[],$.each(s._graph_data_raw,function(t,e){var i=parseFloat(e[0]);i+=s._tzOffset.offset(i),s._time_points.push(i),s._graph_data_final.push([i,parseFloat(e[1])])});var i=s._settings.dark?new Ft(.8,.8,.8,1):new Ft(.2,.2,.2,1),a=s._settings.dark?new Ft(.3,.3,.3,1):new Ft(.8,.8,.8,1),o=s._time_points.length,e=s._time_points[0],t=s._time_points[o-1],o=s._width-120,t=new Ot({plot:new Ht([new Et("plot",{plotStyle:"linespoints"},s._graph_data_final,null)],{interactiveMode:"pan",width:o,aspect:.25,axesColor:i,gridMajorColor:a,gridMinorColor:a,x1_axis:{scrollMin:e,scrollMax:t,scrollEnabled:!0,zoomEnabled:!0,min:e,max:t,dataType:"timestamp"},y1_axis:{label:this._settings.axis_label,min:this._settings.hasOwnProperty("y_min")?this._settings.y_min:null,max:this._settings.hasOwnProperty("y_max")?this._settings.y_max:null}})},{allow_export_csv:!0});$(".chart_div",s._context).css("padding-top","0"),t.renderToCanvas($(".chart_div",s._context)[0]),$(".gtype",this._context).change(function(){s._second_object_ctrl_visibility()}),s._second_object_ctrl_visibility()}function I(t,e,i,s,a){var o=this;this.element=t,this.canvas=document.createElement("canvas"),this.reset(this.element.width(),this.element.height()),this._offset_x=0,this._offset_y=0,this._hH=i,this._cH=s,this._dH=a,this._wrap_x=e,a&&t.on({dblclick:function(t){o.dblClickHandle(t)}}),s&&t.on({mousedown:function(t){o.clickHandle(t)},touchstart:function(t){t.preventDefault();t=t.originalEvent;o.clickHandle(t.touches[0])}}),i&&t.on({mousemove:function(t){o.hoverHandle(t)},touchmove:function(t){t.preventDefault();t=t.originalEvent;o.hoverHandle(t.touches[0])},mouseout:function(){o.hoverHandle(null)},touchend:function(t){t.preventDefault(),o.hoverHandle(null)},touchcancel:function(t){t.preventDefault(),o.hoverHandle(null)}})}function S(t,e){var i=this;this._settings=t,this._context=e,this._width=0,this._lock=0,this._moons=[["Io","orange"],["Europa","yellow"],["Ganymede","red"],["Callisto","blue"]],this._tzOffset=new l(t.tzOffset);t=$(".jupiter_moons",this._context)[0];this._graphics_context=new zt(t,1,1),$("select, input",e).on("change",function(){i._jm_draw()}),i._jm_resize(),$(window).resize(function(){i._jm_resize()}),$(".jm-png",e).click(function(){var t=new zt(document.createElement("canvas"),1,1);i._jm_draw(t),t._renderPNG("jupiter_moons.png")}),$(".jm-svg",e).click(function(){var t=new Rt(1,1);i._jm_draw(t),St("jupiter_moons.svg",t._render())})}function T(t){var i=this;i._parent=t,i._meta=t.data("meta"),i._latitude=i._meta.latitude,i._longitude=i._meta.longitude,i._town=i._meta.town,i._selectPanes=new gt(i._parent,[".location-use-ac",".location-use-form",".location-use-map"],[".location-select-ac",".location-select-form",".location-select-map"],".location-tabtarget",".location-select-ac"),i._el_inject=$(".location-select-forminject",t),i._el_geoloc=$(".location-by-geo",t),i._el_byip=$(".location-by-ip",t),i._el_mapcanvas=$(".map_canvas",t),i._el_latentry=$(".latentry",t),i._el_lngentry=$(".lngentry",t),i._el_tzentry=$(".tzentry",t),i._el_locguesses=$(".location-guesses",t),i._map=null,setInterval(function(){var t;null!==i._map||(t=$("#htv_map",i._context).data("handler"))&&(i._map=t._annotation,t=i._map._iconFromImageURL(window.server+"images/icon_pin.png",0,0,20,27),i.marker=i._map._addImageWithLabel(i._longitude,i._latitude,1,"Your observatory",!0,t,10,27),i._map._moveMarkerOnClick(i.marker),i._map._addListener(i.marker,"position_changed",function(t,e){i._el_latentry.val(e.toFixed(4)),i._el_lngentry.val(t.toFixed(4)),i._el_tzentry.val(Math.round(24*t/360)),$.getJSON(window.server+"embeds/locationguesses.php?&lat="+e+"&lng="+t,function(t){i._el_locguesses.html(t.body),$("a",i._el_locguesses).on("click",function(t){t=$(t.target).data("town");$.getJSON(window.server+"embeds/locationselect.php?town="+t,function(t){i._regionInputSetup(t),$(".location-use-form",i._parent).trigger("click")})})})}),i._selectPanes.paneChangeHook=function(){i._map._parent._resize()})},300),i._regionInputInit(),i._el_byip.click(function(){i._regionInputFromIP()}),i._el_geoloc.click(function(){i._regionInputFromGeo()})}function A(t){this._settings=t,this._labelBlackHalo=!1,this._labelColours={hills:"#777777",towns:"#777777",landmarks:"#777777",stations:"#777777",rivers:"119,119,119",roads:"119,119,119",railways:"119,119,119",countries:"165,185,180",halo:"rgba(0,0,0,0.5)"},this._way_types=[["countries_administrative","#show_countries","countries",1],["regions_administrative","#show_regions","countries",1]]}function z(t,e){var i=this;this._settings=t,this._context=e,this._latitude=parseFloat(t.latitude),this._longitude=parseFloat(t.longitude),this._fov=parseFloat(t.field_of_view),this._mutable=t.mutable,this._scheme_letter=t.tiling_scheme,this._displayControl=new A(t),this._width=2,this._height=2,this._visible=!0,this._labelTypesEnabled={},this._settings.hasOwnProperty("label_types")&&(this._labelTypesEnabled=this._settings.label_types),"mercator"===t.projection?(this._projector=O,this._max_field_of_view=300,this._min_field_of_view=10):(this._projector=GnomonicProjector,this._max_field_of_view=70,this._min_field_of_view=.05),this._annotation=new C(i),this._topographicData=new L(this._latitude,this._longitude,this._fov,this._width,this._height,function(t,e){i._dataUpdated(t,e)},this._projector,this._scheme_letter),this._must_label_item=t.must_label,this._labeller=new j(this,this._settings.labels,0),this._map_fore=$(".img_fore",this._context),this._map_image=$(".img_topography",this._context),this._map_fore.mousedown(function(t){i._mouseDown(t)}),this._map_fore.mouseup(function(t){i._mouseUp(t)}),this._map_fore.mousemove(function(t){i._mouseDrag(t)}),this._map_fore.mouseleave(function(){i._mouseOut(0)}),$(".refresh_ways").change(function(){i._redraw()}),i._is_pinching=!1,i._pinch_distance=0,this._map_fore.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(i._is_pinching=!1,i._mouseDown(t.touches[0])):2===t.touches.length&&(i._is_pinching=!0,i._pinch_distance=i.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),i._is_pinching||i._mouseUp(0),i._is_pinching=!1,i._mousedown=0},touchmove:function(t){t.preventDefault();var e=t.originalEvent;i._is_pinching?(t=i.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),80<Math.abs(t-i._pinch_distance)&&(i._displaywheel(e.touches[0],i._pinch_distance-t),i._pinch_distance=t)):i._mouseDrag(e.touches[0])},touchcancel:function(t){t.preventDefault(),i._is_pinching||i._mouseUp(0),i._is_pinching=!1,i._mousedown=0}}),$("#show_scalebar").change(function(){$("#show_scalebar").is(":checked")?$(".img_scalebar",i._context).fadeIn(400):$(".img_scalebar",i._context).fadeOut(400)});t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";this._map_fore.bind(t,function(t){i._displaywheel(t.originalEvent)}),$(".zoom-in",this._context).click(function(){i._displaywheel({wheelDelta:-1})}),$(".zoom-out",this._context).click(function(){i._displaywheel({wheelDelta:1})}),$(window).resize(function(){i._resize()}),i._resize()}function C(t){var s=this;this._parent=t,this._context=t._context,this._map_image=$(".img_annotation",this._context),this._custom_hover_handler=null,this._icon_index=[],this._icon_counter=0,this._removeAll(),this._map_fore=$(".img_fore",this._context),this._hoverman=new I(this._map_fore,!1,function(t,e,i){s._hoverHover(t,e,i)},function(t,e,i){s._hoverClick(t,e,i)},function(t,e,i){s._hoverDblClick(t,e,i)}),setInterval(function(){s._alarm()},100)}function j(t,e,i){var s=this;this._context=t._context,this._client=t,this._fixedLabelList=e,this._mode=i,this._maximum_distance=null,this._labelTypesEnabled={},this._client._settings.hasOwnProperty("label_types")&&(this._labelTypesEnabled=this._client._settings.label_types);e=$(".img_labels0",this._context),i=e[0];this._graphics_context_0=new zt(i,1,1),i=(e=$(".img_labels1",this._context))[0],this._graphics_context_1=new zt(i,1,1),this._map_fore=$(".img_fore",this._context),this._hoverman=new I(this._map_fore,!1,function(t,e,i){s._hoverHover(t,e,i)},!1,function(t,e,i){s._hoverDblClick(t,e,i)}),this._hovermankeys={},this._hovermannextkey=1,this._labelList={},this._fetchNewLabels=!0,this._labelBuffer=0,this._hooks={redraw:[]},$(".refresh_labels").change(function(){s._relabel(!0,!1,s._maximum_distance)}),setInterval(function(){s._updateAlarm()},250)}function D(t,i){return t.sort(function(t,e){return e[0]+1e7*(null!==i&&Ie(e[2])===Ie(i))-(t[0]+1e7*(null!==i&&Ie(t[2])===Ie(i)))}),200<t.length&&(t=t.slice(0,200)),t}function O(t,e,i,s,a,o,n,h){this._configure(t,e,i,s,a,o,n,h)}function L(t,e,i,s,a,o,n,h){var r=this;r._callback=o,r._projector_class=n,r._scheme_letter=h,r._last_item_load_time=0,r._coast_items_to_load=0,r._coast_items_loaded=0,r._json_items_to_load=0,r._json_items_loaded=0,r._refresh=!1,r._r_earth=6371e3,r._z_scale=1,r._adjust(t,e,i,s,a),r._latest_zoom_adjustment=0,r._downloads_inhibited=!1,setInterval(function(){r._updateAlarm()},40)}function F(t,e){t%=e;return t<0&&(t+=e),t}function E(t,e){var i=e.length-1;if(i<=0)throw"empty array not supported";for(var s=e[i];0<i;)s=s*t+e[--i];return s}function W(t){return(t-51545)/36525}function U(t){for(var e=W(t),i=E(e,[297.85036,445267.11148,-.0019142,1/189474])*Math.PI/180,s=E(e,[357.52772,35999.05034,-1603e-7,-1/3e5])*Math.PI/180,a=E(e,[134.96298,477198.867398,.0086972,1/5620])*Math.PI/180,o=E(e,[93.27191,483202.017538,-.0036825,1/327270])*Math.PI/180,n=E(e,[125.04452,-1934.136261,.0020708,1/45e4])*Math.PI/180,h=0,r=0,_=G.length-1;0<=_;_--){var l=G[_],c=l[0]*i+l[1]*s+l[2]*a+l[3]*o+l[4]*n,p=Math.sin(c),c=Math.cos(c);h+=p*(l[5]+l[6]*e),r+=c*(l[7]+l[8]*e)}return[1e-4*h/3600*(Math.PI/180),1e-4*r/3600*(Math.PI/180)]}function H(t){return E(.01*W(t),[84381.448/3600*(Math.PI/180),-4680.93/3600*(Math.PI/180),-1.55/3600*(Math.PI/180),1999.25/3600*(Math.PI/180),-51.38/3600*(Math.PI/180),-249.67/3600*(Math.PI/180),-39.05/3600*(Math.PI/180),7.12/3600*(Math.PI/180),27.87/3600*(Math.PI/180),5.79/3600*(Math.PI/180),2.45/3600*(Math.PI/180)])}be._monthday=[0,31,59,90,120,151,181,212,243,273,304,334,999],be._monthname=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],be._utc_now=function(){return Date.now()/1e3},be._jd_to_unix=function(t){return 86400*(t-2440587.5)},be._unix_to_jd=function(t){return t/86400+2440587.5},be._calendar_to_jd=function(t,e,i,s,a,o){var n,h=1e4*t+100*e+i;if(e<=2&&(e+=12,--t),h<=17520902)n=Math.floor(t+4716)/4-2-1179;else{if(!(17520914<=h))return 0;n=Math.floor(t/400)-Math.floor(t/100)+Math.floor(t/4)}return 365*Math.floor(t)-679004+2400000.5+n+Math.floor(30.6001*(e+1))+i+(Math.abs(s)+Math.abs(a)/60+Math.abs(o)/3600)/24},be._calendar_to_unix=function(t,e,i,s,a,o){o=be._calendar_to_jd(t,e,i,s,a,o);return be._jd_to_unix(o)},be._jd_to_calendar=function(t){var e=t+.5-Math.floor(t+.5),i=Math.floor(24*e),s=Math.floor(1440*e%60),a=86400*e%60,o=Math.floor(t+.5),e=o<2361222?Math.floor(o+1524):(n=Math.floor((o-1867216.25)/36524.25),Math.floor(o+n-Math.floor(n/4)+1525)),t=Math.floor((e-122.1)/365.25),o=Math.floor(365*t+Math.floor(t/4)),n=Math.floor((e-o)/30.6001),o=Math.floor(e-o-Math.floor(30.6001*n)),n=Math.floor(n-1-12*(14<=n?1:0));return[Math.floor(t-4715-(3<=n?1:0)),n,o,i,s,a]},be._unix_to_calendar=function(t){t=be._unix_to_jd(t);return be._jd_to_calendar(t)},be.iso8601_from_unix=function(t){t=be._unix_to_calendar(t);return t[0]+Pe(t[1])+Pe(t[2])+"T"+Pe(t[3])+":"+Pe(t[4])+":"+Pe(t[5])+"Z"},e.prototype.toggle=function(t){this._status===t?this._status=!1:this._status=t,this._update()},e.prototype._update=function(){var i=this;$.each(this._displays,function(t,e){e[0].html(e[1]===i._status?"&#171;":"&#187;")}),$.each(this._targets,function(t,e){e[0].css("display",e[1]===i._status?"block":"none")}),$.each(this._controls,function(t,e){e[1]===i._status?e[0].addClass("active"):e[0].removeClass("active")})},$(function(){var i,s,a={},o={},n={},h={};$(".dcftoggle_ctrl").each(function(t,e){e=$(e);void 0===(i=e.data("togglegroup"))&&(i="toggle"),void 0===(s=e.data("toggleitem"))&&(s="toggle"),i in a||(a[i]=[]),a[i].push([e,s]),o[i]=[],n[i]=!1,h[i]=[]}),$(".dcftoggle_target").each(function(t,e){e=$(e);void 0===(i=e.data("togglegroup"))&&(i="toggle"),void 0===(s=e.data("toggleitem"))&&(s="toggle"),o[i].push([e,s]),"none"!==e.css("display")&&(n[i]=s)}),$(".dcftoggle_disp").each(function(t,e){e=$(e);void 0===(i=e.data("togglegroup"))&&(i="toggle"),void 0===(s=e.data("toggleitem"))&&(s="toggle"),h[i].push([e,s])}),window.dcftoggles=[],$.each(a,function(t){window.dcftoggles.push(new e(a[t],o[t],n[t],h[t]))})}),a.prototype._alarm=function(){var t=this;if(!("planetarium"in t)){var e=this._planetarium_el.data("handler");if(void 0===e)return;this.planetarium=e,t._updateImage(),$("select",t.planetarium._context).on("change",function(){t._updateImage()})}e=t.planetarium;"planetPos"in e&&"matrix_inv"in e&&"earth_day"in t&&"earth_night"in t&&(e=e._pl_inv_project(e._width/2,e._height/2,0,e._width,e._height),t._radecold[0]===e[0]&&t._radecold[1]===e[1]||(t._refresh=1),t._refresh&&(this._drawEarth()||(1<t._refresh&&t._refresh--,t._refresh=0)))},a.prototype._drawEarth=function(){var t=this;if(!("planetarium"in t))return 1;var e=t.planetarium,i=.6*Math.min(e._width,e._height);250<i&&(i=250);var s=i/2,a=t.utc+t._dayoffset/400*86400;if(!("planetPos"in e))return 1;var o=e._pl_inv_project(e._width/2,e._height/2,0,e._width,e._height);t._radecold=o;var n=st(a)/12*Math.PI,h=e._objectCalc.sunPos[0],a=h.RA*Math.PI/12,h=h.Dec*Math.PI/180,r=Math.sin(a-n)*Math.cos(h),_=Math.cos(a-n)*Math.cos(h),l=-Math.sin(h),c=t.earth_day,p=t.earth_night,t=$(".earth_canvas",t._context);t.css("top",(e._height-i)/2+"px"),t.css("left",(e._full_width-i)/2+"px"),t.width(i).height(i);e=t[0];e.width=i,e.height=i;for(var t=e.getContext("2d"),e=t.getImageData(0,0,i,i),d=e.data,u=0,f=0;f<i;f++)for(var g=0;g<i;g++){var m=(g-s)/s,v=-(f-s)/s,x=m*m+v*v;if(1<=x)u+=4;else{var y=Math.sqrt(1-x),w=Math.PI+n-o[0],M=Math.PI/2-o[1],x=m,m=v*Math.cos(M)+y*Math.sin(M),y=-v*Math.sin(M)+y*Math.cos(M),M=x*Math.cos(w)-m*Math.sin(w),x=x*Math.sin(w)+m*Math.cos(w),m=y,w=Math.atan2(M,x),y=Math.asin(m);M-=r,x-=_,m-=l;for(var m=Math.acos(1-(M*M+x*x+m*m)/2),k=this._earth_width,b=this._earth_height,P=Math.floor(w/Math.PI/2*k+k/2);k<=P;)P-=k;for(var I=Math.floor(y/Math.PI*b-b/2);I<0;)I+=b;y=4*(k*I+P),m=m>Math.PI/2?p:c;d[u++]=m[y],d[u++]=m[1+y],d[u++]=m[2+y],d[u++]=255}}return t.putImageData(e,0,0),0},a.prototype._updateImage=function(){var t,e,i,s,a,o=this;"planetarium"in o&&(t=parseInt($(".day",o._context).val()),e=parseInt($(".month",o._context).val()),i=parseInt($(".year",o._context).val()),s=parseInt($(".hour",o._context).val()),a=parseInt($(".min",o._context).val()),o.utc=be._calendar_to_unix(i,e,t,s,a,0),o.utc-=o._tzOffset.offset(o.utc),this._labelDateSlide(s,a),o.planetarium.gotoUtcTime(o.utc),o._refresh=2)},a.prototype._labelDateSlide=function(t,e){for(var i,s,a=this,o=[],n=t-6;n<=t+6;n+=2){var h,r=.5+2*(n/24-(t/24+e/1440));r<0||1<r||(h=Pe((n+48)%24)+":00",o.push([r,h]))}var _=$(".EISslidescale",a._context),l=_[0];l.width=_.width(),l.height=_.height();var c=l.getContext("2d");for(c.beginPath(),i=0;i<o.length;i++)s=a.datel+4+a.datew*o[i][0],c.moveTo(s,19),c.lineTo(s,25);for(c.strokeStyle="#777",c.lineWidth=1.9,c.stroke(),c.fillStyle="#777",c.font="bold 11px Arial,Helvetica,sans-serif",c.textBaseline="middle",c.textAlign="center",i=0;i<o.length;i++)s=a.datel+4+a.datew*o[i][0],c.fillText(o[i][1],s,10)},a.prototype.resize=function(){$(".EISslidescale",this._context).width(380).height(26),$(".EISslider",this._context).css("left",20).css("top",26).width(340),this.datel=20,this.datew=340,this._updateImage()},$(window).load(function(){$(".earth_in_space").each(function(t,e){var i=$(e),e=new a(i.data("meta"),i);i.data("handler",e)})}),o.prototype._updateAlarm=function(){if(null===this._map){var t=$("#htv_map",this._context).data("handler");if(!t)return;this._map=t._annotation}this._refresh&&this._initMarkers()},o.prototype._doKey=function(){var t,e,i,s,a=this;this._settings.showPaths?$(".key_canvas",this._context).each(function(){for((i=this).width=142,i.height=51,(s=i.getContext("2d")).fillStyle="#202020",s.font="bold 14px Arial,Helvetica,sans-serif",s.textBaseline="middle",s.textAlign="left",t=0;t<=1;t++)e=a._title[t],s.fillText(e,25,22*(t+.7)),s.beginPath(),s.strokeStyle=a._colors[t],s.lineWidth=2.5,s.moveTo(5,22*(t+.7)),s.lineTo(20,22*(t+.7)),s.stroke()}):$(".key_canvas",this._context).hide()},o.prototype._initMarkers=function(){var o=this;o._map._removeAll();var n=Ie($("#year-from",this._context).val()),h=Ie($("#year-to",this._context).val());this._markers={},$.each(this._paths,function(t,e){var s,i,a;Ie(e.year)<n||Ie(e.year)>h||(s=[],$.each(e.paths,function(t,e){var i=o._colors[e[0]],e=e[1];s.push([i,e])}),i=o._map._addLabelledTrack(s,e.month,e.mean_position,""),o._map._addListener(i,"click",function(){window.open(window.server+"news.php?id="+e.event_key,"_blank")}),o._map._addListener(i,"dclick",function(){window.open(window.server+"news.php?id="+e.event_key,"_blank")}),a="<div style='text-align:center;'>"+e.event_title+"<br />"+e.month+"<br />Max duration:<br />"+(60<=e.max_duration?Ie(e.max_duration/60)+" min ":"")+Ie(e.max_duration%60)+" sec</div>",o._map._setMarkerHoverText(i,a),o._markers[t]=i)}),this._contours.hasOwnProperty("contours")&&$.each(this._contours.contours,function(t,e){var i=e[0],s="Partial eclipse"===i;o._map._addPolygon(e[1],t,i,"#ff0000",s?2:1,s?"rgba(0,0,0,0.25)":"rgba(0,0,0,0)")}),this._contours.hasOwnProperty("path")&&$.each(this._contours.path,function(t,e){for(var i=o._colors[e[0]],s=3;s<e[1].length;s+=3){var a="<div style='text-align:center;'>Duration:<br />"+(60<=e[1][s][3]?Ie(e[1][s][3]/60)+" min ":"")+Ie(e[1][s][3]%60)+" sec</div>";o._map._addLine(1e3,a,[[e[1][s-3][1],e[1][s-3][2]],[e[1][s][1],e[1][s][2]]],i)}}),o._refresh=!1},$(function(){$(".eclipse_map").each(function(t,e){var i=$(e),e=new o(i.data("meta"),i);i.data("handler",e)})}),n.prototype._updateAlarm=function(t){var e,i,s,a,o,n,h,r,_=this;if(null===this.json)return null;if(this._refresh||$(".ecl_animate",this._context).is(":checked")){if(this._refresh)this._update_key++,t=this._update_key,this._createElements(),this._animation_counter=-1;else if(t!==this._update_key)return;var l="animate";$(".ecl_pause",this._context).is(":checked")&&(l="pause"),$(".ecl_path",this._context).is(":checked")&&(l="path"),$(".ecl_static",this._context).is(":checked")&&(l="static");var c=this.json.times.length,p=this.json.times[0],d=this.json.times[c-1],u=!1,c=!0,f=(p+d)/2;if("animate"===l||"pause"===l?$(".ESslider_holder",this._context).show():$(".ESslider_holder",this._context).hide(),"animate"===l?(u=!0,this._animation_counter++,this._animation_counter>this._total_animation_time/this._time_step+1&&(this._animation_counter=0),0===this._animation_counter?(u=!1,$(".ecl_simulation",this._context).fadeIn(500)):this._animation_counter===this._total_animation_time/this._time_step+1&&($(".ecl_simulation",this._context).fadeOut(500),c=!1),f=p+this._animation_counter*(d-p)/(this._total_animation_time/this._time_step),$(".ESslider",this._context).slider("value",(f-p)/(d-p)*200)):"pause"===l&&(f=p+$(".ESslider",this._context).slider("value")*(d-p)/200),"animate"!==l&&$(".ecl_simulation",this._context).stop().show().css({opacity:1}),c){var g=this._get_frame_alignment(f),m=g.offset,v=g.p,x=g.q,y=g.zenith_pa;$(".ecl_compass",this._context).css({transform:"rotate("+Math.floor(y)+"deg)"});var w=be._unix_to_calendar(f+this._tzOffset.offset(f));$(".ecl_clock",this._context).text(Pe(w[3])+":"+Pe(w[4])+" "+this._tzOffset._tzName(f)),$(".ecl_altitude",this._context).text(Math.floor(g.alt)),$(".ecl_azimuth",this._context).text(Math.floor(g.az)),"animate"!==l&&"pause"!==l||(g.alt<0?$(".ecl_notification",this._context).empty().append("<div style='padding:80px 50px 0 50px;font-size:22px;font-weight:bold;text-align:center;color:#f44;'>Below the horizon</div>"):$(".ecl_notification",this._context).css("background","none").empty());var M,k,b=this._settings.tracks.length,P=this._settings.pathItem;for("animate"!==l&&"pause"!==l||this._display_sky_position(g,"Sun"===this._settings.tracks[0].name?"Sun":"Moon",!0),e=0;e<b;e++)e===P&&"animate"!==l&&"pause"!==l||this._display_item(e,0,m,v,x,y,f,u);if("static"===l)for(j=0;j<this.json.points;j++){this.json.mask[j]&&(R=this.json.times[j],M=Pe((w=be._unix_to_calendar(R+this._tzOffset.offset(R)))[3])+":"+Pe(w[4]),g=this._get_frame_alignment(R),this._display_sky_position(g,M,0===j),this._display_item(P,j,g.offset,g.p,g.q,g.zenith_pa,R,!1),this.json.points<10&&(r=this._project_2d(this.json.tracks[P],g.offset,g.p,g.q,-g.zenith_pa,R),k=".caption_layer"+P+"_"+j,$(k,this._context).width(200).css({left:r.left+r.width/2-100+"px",top:r.top-20+"px"}).text(M)))}if("path"===l){var I="#000";"pathColor"in this._settings&&(I=this._settings.pathColor);var S=40;"tickInterval"in this._settings&&(S=this._settings.tickInterval);for(var T=[],A=[],z=[],c=3600*Math.ceil(this.json.times[0]/3600),C=3600*Math.floor(this.json.times[this.json.points-1]/3600),R=c,j=0;R<=C;R+=90,j++){g=this._get_frame_alignment(R),O=(r=this._project_2d(this.json.tracks[P],g.offset,g.p,g.q,-g.zenith_pa,R)).left+r.width/2,L=r.top+r.width/2,T.push([O,L]);var D=(90-g.alt)/90,N=g.az/180*Math.PI,O=this._width/2-this._sky_radius*D*Math.sin(N),L=this._width/2-this._sky_radius*D*Math.cos(N);A.push([O,L])}for(R=c,j=e=0;j<T.length;R+=90*S,j+=S){var F=Pe((w=be._unix_to_calendar(R+this._tzOffset.offset(R)+1))[3])+":"+Pe(w[4]);O=T[j][0],L=T[j][1],s=0===j?(i=T[j+1][0]-T[j][0],T[j+1][1]-T[j][1]):(i=T[j][0]-T[j-1][0],T[j][1]-T[j-1][1]),n=Math.atan2(s,i),h=30,k=".caption_layer"+P+"_"+e,$(k,this._context).width(200).css({left:O-100-h*Math.cos(n+Math.PI/2)+"px",top:L-h*Math.sin(n+Math.PI/2)+"px",color:I}).text(F),O=A[j][0],L=A[j][1],o=0===j?(a=A[j+1][0]-A[j][0],A[j+1][1]-A[j][1]):(a=A[j][0]-A[j-1][0],A[j][1]-A[j-1][1]),n=Math.atan2(o,a),h=30,z.push([O-h*Math.cos(n+Math.PI/2),L-h*Math.sin(n+Math.PI/2),F]),e++}c=$(".ecl_path",this._context)[0];c.width=this._width,c.height=this._height;var E=c.getContext("2d");for(E.beginPath(),E.moveTo(T[0][0],T[0][1]),j=1;j<T.length;j++)E.lineTo(T[j][0],T[j][1]);for(E.strokeStyle=I,E.lineWidth=1.5,E.stroke(),j=0;j<T.length;j+=S)s=0===j?(i=T[j+1][0]-T[j][0],T[j+1][1]-T[j][1]):(i=T[j][0]-T[j-1][0],T[j][1]-T[j-1][1]),n=Math.atan2(s,i),h=6,E.beginPath(),E.moveTo(T[j][0]-h*Math.cos(n+Math.PI/2),T[j][1]-h*Math.sin(n+Math.PI/2)),E.lineTo(T[j][0]+h*Math.cos(n+Math.PI/2),T[j][1]+h*Math.sin(n+Math.PI/2)),E.stroke();for((c=$(".esv1",this._context)[0]).width=this._width,c.height=this._width,(E=c.getContext("2d")).beginPath(),E.moveTo(A[0][0],A[0][1]),j=1;j<T.length;j++)E.lineTo(A[j][0],A[j][1]);for(E.strokeStyle="#ff0",E.fillStyle="#ff0",E.lineWidth=1.5,E.stroke(),j=0;j<A.length;j+=4*S)o=0===j?(a=A[j+1][0]-A[j][0],A[j+1][1]-A[j][1]):(a=A[j][0]-A[j-1][0],A[j][1]-A[j-1][1]),n=Math.atan2(o,a),h=6,E.beginPath(),E.moveTo(A[j][0]-h*Math.cos(n+Math.PI/2),A[j][1]-h*Math.sin(n+Math.PI/2)),E.lineTo(A[j][0]+h*Math.cos(n+Math.PI/2),A[j][1]+h*Math.sin(n+Math.PI/2)),E.stroke();for(E.font="bold 14px Arial,Helvetica,sans-serif",E.textBaseline="middle",E.textAlign="center",j=0;j<z.length;j+=4)E.fillText(z[j][2],z[j][0],z[j][1])}}this._refresh=!1,"animate"===l&&$(".layer, .ecl_simulation",this._context).promise().done(function(){_._updateAlarm(t)})}},n.prototype._get_frame_alignment=function(t){var e=this._seek_time(t),i=e[0],s=e[1],a=e[2],o=x(this._settings.latitude,this._settings.longitude,t),n=o.ra,h=o.dec,e=this._interpolate(this.json.center,i,s,a),o=new p(e[0],e[1],e[2]),e=o._to_ra_dec(),h=y(e.ra,e.dec,n,h);$(".ecl_ncpup").is(":checked")&&(h=0);t=(st(t)/12*Math.PI+Math.PI+parseFloat(this._settings.longitude)*Math.PI/180)%(2*Math.PI),o=(o=(o=o._rotate_xy(-t))._rotate_xz(-(Math.PI/2-this._settings.latitude*Math.PI/180)))._to_ra_dec();return{zenith_pa:h,offset:i,p:s,q:a,alt:o.dec,az:(720-180*o.ra/12)%360}},n.prototype._display_item=function(t,e,i,s,a,o,n,h){n=this._project_2d(this.json.tracks[t],i,s,a,-o,n),e=".layer"+t+"_"+e;h?$(e,this._context).animate({width:n.width+"px",height:n.width+"px",left:n.left+"px",top:n.top+"px"},this._time_step,"linear"):$(e,this._context).width(n.width).height(n.width).css({left:n.left,top:n.top}),$(e,this._context).css({transform:"rotate("+Math.floor(o)+"deg)"})},n.prototype._display_sky_position=function(t,e,i){var s=$(".esv1",this._context)[0];i&&(s.width=this._width,s.height=this._width);var a=s.getContext("2d"),o=(90-t.alt)/90,s=t.az/180*Math.PI,t=this._width/2-this._sky_radius*o*Math.sin(s),s=this._width/2-this._sky_radius*o*Math.cos(s);a.fillStyle="#ff0",a.beginPath(),a.arc(t,s,4,0,2*Math.PI),a.fill(),a.font="bold 15px Arial,Helvetica,sans-serif",a.textBaseline="middle",a.textAlign="left",a.fillText(e,8+t,s),i&&(t=t<this._width/2?(a.textAlign="right",this._width-10):10,a.fillText("Sky above",t,15),a.fillText(this._settings.placename,t,34))},n.prototype._project_2d=function(t,e,i,s,a,o){var n=this.json.scale,h=this._interpolate(t,e,i,s),t=new p(h[0],h[1],h[2]);this.json.do_topocentric_correction&&(o=c(this._settings.latitude,this._settings.longitude,0,o),t=t._sub(o));i=this._interpolate(this.json.center,e,i,s),s=new p(i[0],i[1],i[2]),i=t._abs(),h=h[3],i=Math.atan2(h,i),i=2*Math.tan(i/2)*n*this._width,t=t._to_ra_dec(),s=s._to_ra_dec(),a=m(t.ra,t.dec,s.ra,s.dec,a);return{left:a[0]*n*this._width+this._width/2-i/2,top:a[1]*n*this._width+this._height/2-i/2,width:i}},n.prototype._createElements=function(){if(!("json"in this))return null;var t=$(".ecl_simulation",this._context);t.empty();var e=Math.min(.3*this._width,80);t.append('<img class="layer ecl_compass"  style="z-index:9998; width:'+e+'px; position:absolute; top:15px; left:15px;"  title="Compass" src="'+window.server+'news/eclipses/compass.png" />'),t.append('<div class="ecl_notification"  style="z-index:9999; width:'+this._width+"px; height:"+this._height+'px; position:absolute; top:0; left:0;"></div>'),t.append('<canvas class="ecl_path"  style="z-index:9999; width:'+this._width+"px; height:"+this._height+'px; position:absolute; top:0; left:0;"></canvas>');var i,s,a=this._settings.tracks.length,o=this._settings.pathItem,n="animate";for($(".ecl_path",this._context).is(":checked")&&(n="path"),$(".ecl_static",this._context).is(":checked")&&(n="static"),f=0;f<a;f++){var h=this._settings.tracks[f],r=1;for(f===o&&("path"!==n&&"static"!==n||(r=Math.max(25,this.json.points))),i=0;i<r;i++){var _,l,c,p="layer"+f+"_"+i,d=100*(f+1)-i;h.icon?(t.append('<img class="layer '+p+'" style="z-index:'+d+';" title="'+h.name+'" src="'+h.icon+'" />'),(s=$("."+p,t)).css("position","absolute").css("top","0").css("left","0").width(0)):(_=h.canvasSize,t.append('<canvas class="layer '+p+'" style="z-index:'+d+';" title="'+h.name+'" height="'+_+'" width="'+_+'"></canvas>'),(s=$("."+p,t)).css("position","absolute").css("top","0").css("left","0").width(0),(c=(l=s[0].getContext("2d")).createRadialGradient(_/2,_/2,0,_/2,_/2,_/2)).addColorStop(0,this._colour_name(h.colorCentre,1)),c.addColorStop(.96,this._colour_name(h.colorEdge,1)),c.addColorStop(1,this._colour_name(h.colorEdge,0)),l.fillStyle=c,l.fillRect(0,0,_,_)),t.append('<div class="layer caption_'+p+'"  style="position:absolute;z-index:'+(1e3+d)+';color:#0a0;font-size:13px;font-weight:bold;text-align:center"></div>')}}$(".ecl_sky_view").width(this._width).height(this._width);for(var u=[],f=0;f<4;f++){var g=$(".esv"+f,this._context)[0];g.width=this._width,g.height=this._width,u.push(g.getContext("2d"))}for(this._sky_radius=(this._width-80)/2,u[0].fillStyle="#003078",u[0].beginPath(),u[0].arc(this._width/2,this._width/2,this._sky_radius,0,2*Math.PI),u[0].fill(),u[2].fillStyle="rgba(0, 96, 48, 0.75)",u[2].beginPath(),u[2].rect(0,0,this._width,this._width),u[2].arc(this._width/2,this._width/2,this._sky_radius,0,2*Math.PI),u[2].fill("evenodd"),u[3].strokeStyle="#ccc",u[3].lineWidth=2,u[3].beginPath(),u[3].arc(this._width/2,this._width/2,this._sky_radius,0,2*Math.PI),f=0;f<8;f++)u[3].moveTo(this._width/2+this._sky_radius*Math.sin(2*f*Math.PI/8),this._width/2+this._sky_radius*Math.cos(2*f*Math.PI/8)),u[3].lineTo(this._width/2+(this._sky_radius-12)*Math.sin(2*f*Math.PI/8),this._width/2+(this._sky_radius-12)*Math.cos(2*f*Math.PI/8));u[3].stroke(),u[3].font="bold 18px Arial,Helvetica,sans-serif",u[3].fillStyle="#ccc",u[3].textBaseline="middle",u[3].textAlign="center",u[3].fillText("E",25,this._width/2),u[3].fillText("W",this._width-25,this._width/2),u[3].fillText("N",this._width/2,25),u[3].fillText("S",this._width/2,this._width-25)},n.prototype._colour_name=function(t,e){var i="rgba(";return i+=t[0],i+=",",i+=t[1],i+=",",i+=t[2],i+=",",i+=t[3]/255*e,i+=")"},n.prototype._seek_time=function(t){if(!("json"in this))return null;var e=this.json.times,i=e.length-1;if(t>=e[i])return[i-1,0,1];if(t<=e[0])return[0,1,0];for(var s=0,a=i;s<=a-2;){var o=Math.floor((s+a)/2);if(e[o]>t)a=o;else{if(!(e[o]<t)){s=o;break}s=o}}var n=Math.abs(e[s+1]-t),i=Math.abs(e[s]-t);return n+i===0&&(n=i=1),[s,n/(n+i),i/(n+i)]},n.prototype._interpolate=function(t,e,i,s){for(var a=t[e],o=t[e+1],n=a.length,h=[],r=0;r<n;r++)h.push(a[r]*i+o[r]*s);return h},n.prototype._resize=function(){this._width=Math.min(this._context.width()-20,.8*+$(window).height()),this._height=+this._width,$(".ecl_simulation",this._context).width(this._width).height(this._height).css({overflow:"hidden","z-index":"1"}),$(".layer",this._context).stop(),this._animation_counter=-1,this._refresh=!0;var t=this._width-24-16-16;if($(".ESslidescale",this._context).width(this._width-24).height(26),$(".ESslider",this._context).width(t).css("top",26).css("left",16),null!==this.json){var e,i,s=this.json.times.length,a=this.json.times[0],o=this.json.times[s-1],n=3600*Math.ceil(a/3600)+.1,h=$(".ESslidescale",this._context),s=h[0];s.width=h.width(),s.height=h.height();var r=s.getContext("2d");for(r.beginPath(),e=n;e<o;e+=3600)i=0+t*(e-a)/(o-a),r.moveTo(i,19),r.lineTo(i,25);for(r.strokeStyle="#888",r.lineWidth=1.9,r.stroke(),r.fillStyle="#888",r.font="bold 11px Arial,Helvetica,sans-serif",r.textBaseline="middle",r.textAlign="center",e=n;e<o;e+=3600){i=0+t*(e-a)/(o-a);var _=Pe(be._unix_to_calendar(e+this._tzOffset.offset(e))[3])+"h";r.fillText(_,i,10)}}},$(function(){$(".eclipse_sim").each(function(t,e){var i=$(e),e=new n(i.data("meta"),i);i.data("handler",e)})}),h.prototype._write_html=function(){var t=this._settings.url+"?"+$("form",this._context).serialize(),e=this._settings.border?"border: 1px solid #888; ":"border: none; ";$(".html_output",this._context).text('<iframe allowtransparency="yes" scrolling="no" style="'+e+"width:"+this._settings.width+"px; height:"+this._settings.height+'px; overflow: hidden;" src="'+t+'"></iframe>')},$(function(){$(".embed_tool").each(function(t,e){var i=$(e),e=new h(i.data("meta"),i);i.data("handler",e)})}),_.prototype._str=function(){return"Point("+this._x+","+this._y+","+this._z+")"},_.prototype._to_vector=function(){return new p(this._x,this._y,this._z)},_.prototype._add_vector=function(t){return new _(this._x+t._x,this._y+t._y,this._z+t._z)},_.prototype._displacement_vector_from=function(t){return new p(this._x-t._x,this._y-t._y,this._z-t._z)},_.prototype._displacement_from_origin=function(){return new p(this._x,this._y,this._z)},_.prototype._abs=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},_.prototype._to_lat_lng=function(t){for(var e=this._abs(),i=180/Math.PI,s=st(t)*Math.PI/12,t=Math.asin(this._z/e)*i,a=(Math.atan2(this._y,this._x)-s)*i,a=Math.mod(a,360);a<0;)a+=360;return{lat:t,lng:a,alt:e-6371e3}},p.prototype._to_list=function(){return[this._x,this._y,this._z]},p.prototype._str=function(){return"Vector("+this._x+","+this._y+","+this._z+")"},p.prototype._add=function(t){return new p(this._x+t._x,this._y+t._y,this._z+t._z)},p.prototype._sub=function(t){return new p(this._x-t._x,this._y-t._y,this._z-t._z)},p.prototype._mul=function(t){return new p(this._x*t,this._y*t,this._z*t)},p.prototype._abs=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},p.prototype._to_ra_dec=function(){var t=this._abs();if(0===t)return{ra:0,dec:0};var t=Math.asin(this._z/t),e=Math.atan2(this._y,this._x);for(e*=12/Math.PI,t*=180/Math.PI;e<0;)e+=24;for(;24<=e;)e-=24;return{ra:e,dec:t}},p.prototype._cross_product=function(t){return new p(this._y*t._z-this._z*t._y,this._z*t._x-this._x*t._z,this._x*t._y-this._y*t._x)},p.prototype._dot_product=function(t){return this._x*t._x+this._y*t._y+this._z*t._z},p.prototype._angle_with=function(t){t=this._dot_product(t)/this._abs()/t._abs();return 1<t&&(t=1),t<-1&&(t=-1),180*Math.acos(t)/Math.PI},p.prototype._normalise=function(){var t=this._abs();return new p(this._x/t,this._y/t,this._z/t)},t.prototype._point=function(t){return this._x0._add_vector(this._direction._mul(t))},t.prototype._find_closest_approach=function(t){var e=this._x0,i=t._x0,s=this._direction,a=t._direction,i=i._displacement_vector_from(e),e=a._dot_product(s),a=(i._dot_product(a)-i._dot_product(s)*e)/(1-pow(e,2)),i=a*e-i._dot_product(s),s=this._point(i),i=t._point(a),t=Math.abs(s._displacement_vector_from(i)),a=Math.abs(s._displacement_from_origin()._angle_with(i._displacement_from_origin()));return{self_point:s,other_point:i,distance:t,angular_distance:a}},p.prototype._rotate_xy=function(t){return new p(this._x*Math.cos(t)+this._y*-Math.sin(t),this._x*Math.sin(t)+this._y*Math.cos(t),this._z)},p.prototype._rotate_xz=function(t){return new p(this._x*Math.cos(t)+this._z*-Math.sin(t),this._y,this._x*Math.sin(t)+this._z*Math.cos(t))},p.prototype._rotate_yz=function(t){return new p(this._x,this._y*Math.cos(t)+this._z*-Math.sin(t),this._y*Math.sin(t)+this._z*Math.cos(t))},d.prototype._rotate=function(t,e){var i=Math.sin(t),s=Math.cos(t),a=Math.sin(e),o=Math.cos(e),t=[[1,0,0],[0,1,0],[0,0,1]],e=this._m;t[0][0]=s*e[0][0]+i*e[2][0],t[0][1]=s*e[0][1]+i*e[2][1],t[0][2]=s*e[0][2]+i*e[2][2],t[1][0]=-i*a*e[0][0]+o*e[1][0]+a*s*e[2][0],t[1][1]=-i*a*e[0][1]+o*e[1][1]+a*s*e[2][1],t[1][2]=-i*a*e[0][2]+o*e[1][2]+a*s*e[2][2],t[2][0]=-o*i*e[0][0]-a*e[1][0]+o*s*e[2][0],t[2][1]=-o*i*e[0][1]-a*e[1][1]+o*s*e[2][1],t[2][2]=-o*i*e[0][2]-a*e[1][2]+o*s*e[2][2];e=new d;return e._m=t,e},d.prototype._to_euler_angles=function(){var t,e,i,s,a=this._m;return 1<a[0][0]&&(a[0][0]=1),a[0][0]<-1&&(a[0][0]=-1),1<a[0][1]&&(a[0][1]=1),a[0][1]<-1&&(a[0][1]=-1),1<a[0][2]&&(a[0][2]=1),a[0][2]<-1&&(a[0][2]=-1),1<a[1][0]&&(a[1][0]=1),a[1][0]<-1&&(a[1][0]=-1),1<a[1][1]&&(a[1][1]=1),a[1][1]<-1&&(a[1][1]=-1),1<a[1][2]&&(a[1][2]=1),a[1][2]<-1&&(a[1][2]=-1),1<a[2][0]&&(a[2][0]=1),a[2][0]<-1&&(a[2][0]=-1),1<a[2][1]&&(a[2][1]=1),a[2][1]<-1&&(a[2][1]=-1),1<a[2][2]&&(a[2][2]=1),a[2][2]<-1&&(a[2][2]=-1),s=a[2][1]<1&&-1<a[2][1]?(i=-Math.asin(a[2][1]),t=Math.atan2(a[2][0]/Math.cos(i),a[2][2]/Math.cos(i)),e=i,i=Math.atan2(a[0][1]/Math.cos(i),a[1][1]/Math.cos(i)),t):(i=0,s=Math.atan2(a[1][0],a[1][2]),a[2][0]<0?(e=Math.PI/2,i+s):(e=-Math.PI/2,-i+s)),[e,i,s]},d.prototype._multiply_vector=function(t){var e=this._m;return new p(t._x*e[0][0]+t._y*e[0][1]+t._z*e[0][2],t._x*e[1][0]+t._y*e[1][1]+t._z*e[1][2],t._x*e[2][0]+t._y*e[2][1]+t._z*e[2][2])},d.prototype._rotate_m_yz=function(t){var e=this._m,i=new d,s=i._m;return s[0][0]=e[0][0],s[0][1]=e[0][1],s[0][2]=e[0][2],s[1][0]=e[1][0]*Math.cos(t)-e[2][0]*Math.sin(t),s[1][1]=e[1][1]*Math.cos(t)-e[2][1]*Math.sin(t),s[1][2]=e[1][2]*Math.cos(t)-e[2][2]*Math.sin(t),s[2][0]=e[1][0]*Math.sin(t)+e[2][0]*Math.cos(t),s[2][1]=e[1][1]*Math.sin(t)+e[2][1]*Math.cos(t),s[2][2]=e[1][2]*Math.sin(t)+e[2][2]*Math.cos(t),i},d.prototype._rotate_m_xz=function(t){var e=this._m,i=new d,s=i._m;return s[0][0]=e[0][0]*Math.cos(t)+e[2][0]*Math.sin(t),s[0][1]=e[0][1]*Math.cos(t)+e[2][1]*Math.sin(t),s[0][2]=e[0][2]*Math.cos(t)+e[2][2]*Math.sin(t),s[1][0]=e[1][0],s[1][1]=e[1][1],s[1][2]=e[1][2],s[2][0]=-e[0][0]*Math.sin(t)+e[2][0]*Math.cos(t),s[2][1]=-e[0][1]*Math.sin(t)+e[2][1]*Math.cos(t),s[2][2]=-e[0][2]*Math.sin(t)+e[2][2]*Math.cos(t),i},d.prototype._rotate_m_xy=function(t){var e=this._m,i=new d,s=i._m;return s[0][0]=e[0][0]*Math.cos(t)-e[1][0]*Math.sin(t),s[0][1]=e[0][1]*Math.cos(t)-e[1][1]*Math.sin(t),s[0][2]=e[0][2]*Math.cos(t)-e[1][2]*Math.sin(t),s[1][0]=e[0][0]*Math.sin(t)+e[1][0]*Math.cos(t),s[1][1]=e[0][1]*Math.sin(t)+e[1][1]*Math.cos(t),s[1][2]=e[0][2]*Math.sin(t)+e[1][2]*Math.cos(t),s[2][0]=e[2][0],s[2][1]=e[2][1],s[2][2]=e[2][2],i},P.prototype._second_object_ctrl_visibility=function(){var t=$(".gtype",this._context).val(),e=$(".second_object",this._context);"7"===t?e.show():e.hide()},$(function(){$(".custom_graph").each(function(t,e){var i=$(e),e=new P(i.data("meta"),i);i.data("handler",e)})}),I.prototype.reset=function(t,e){this._width=void 0===t?this.element.width():t,this._height=void 0===e?this.element.height():e,this.canvas.width=this._width,this.canvas.height=this._height;e=this.canvas.getContext("2d");e.width=this._width,e.height=this._height,e.rect(0,0,this._width,this._height),e.fillStyle="#000000",e.fill(),this.keys={}},I.prototype.hoverHandle=function(t){var e,i=0,s=[0,0];t&&(e=Ie((s=At(t,this.element))[0]+this._offset_x),t=Ie(s[1]+this._offset_y),this._wrap_x&&e>=this._width&&(e=Ie(e-this._width)),i=65536*(t=this.canvas.getContext("2d").getImageData(e,t,1,1).data)[0]+256*t[1]+t[2]),i in this.keys?this._hH(this.keys[i],s[0],s[1]):this._hH(0,s[0],s[1])},I.prototype.clickHandle=function(t){var e=At(t,this.element),i=Ie(e[0]+this._offset_x),t=Ie(e[1]+this._offset_y);this._wrap_x&&i>=this._width&&(i=Ie(i-this._width));t=this.canvas.getContext("2d").getImageData(i,t,1,1).data,t=65536*t[0]+256*t[1]+t[2];t in this.keys?this._cH(this.keys[t],e[0],e[1]):this._cH(0,e[0],e[1])},I.prototype.dblClickHandle=function(t){var e=At(t,this.element),i=Ie(e[0]+this._offset_x),t=Ie(e[1]+this._offset_y);this._wrap_x&&i>=this._width&&(i=Ie(i-this._width));t=this.canvas.getContext("2d").getImageData(i,t,1,1).data,t=65536*t[0]+256*t[1]+t[2];t in this.keys&&this._dH(this.keys[t],e[0],e[1])},I.prototype.hoverPolygon=function(t,e,i){var s=Ie(14680063*Math.random()+1048576),a="#"+s.toString(16),o=this.canvas.getContext("2d");o.beginPath(),o.moveTo(e[0][0],e[0][1]);for(var n=1;n<e.length;n++)o.lineTo(e[n][0],e[n][1]);o.closePath(),i?(o.fillStyle=a,o.fill()):(o.strokeStyle=a,o.lineWidth=12,o.stroke()),this.keys[s]=t},I.prototype.hoverCircle=function(t,e,i,s){var a=parseInt(14680063*Math.random()+1048576);col="#"+a.toString(16);var o=this.canvas.getContext("2d");o.beginPath(),o.arc(e,i,s,0,2*Math.PI),o.fillStyle=col,o.fill(),this.keys[a]=t},I.prototype.hoverLine=function(t,e,i,s,a){var o=Ie(14680063*Math.random()+1048576),n="#"+o.toString(16),h=this.canvas.getContext("2d");h.beginPath(),h.moveTo(e,i),h.lineTo(s,a),h.lineWidth=20,h.strokeStyle=n,h.stroke(),h.beginPath(),h.arc(e,i,10,0,2*Math.PI),h.arc(s,a,10,0,2*Math.PI),h.fillStyle=n,h.fill(),this.keys[o]=t},I.prototype.hoverBox=function(t,e,i,s,a){var o=Ie(14680063*Math.random()+1048576),n="#"+o.toString(16),h=this.canvas.getContext("2d");h.beginPath(),h.rect(e,i,s,a),h.fillStyle=n,h.fill(),this.keys[o]=t},S.prototype._jm_moonPos=function(t){var e=Math.PI/180,i=180/Math.PI,s=t-2451545,a=172.74+.00111588*s,o=357.529+.9856003*s,n=20.02+.0830853*s+.329*Math.sin(a*e),h=66.115+.9025179*s+.329*Math.sin(a*e),r=1.915*Math.sin(o*e)+.02*Math.sin(2*o*e),_=5.555*Math.sin(n*e)+.168*Math.sin(2*n*e),t=h+r-_,a=1.00014-.01671*Math.cos(o*e)-14e-5*Math.sin(2*o*e),h=5.20872-.25208*Math.cos(n*e)-.00611*Math.cos(2*n*e),r=Math.sqrt(h*h+a*a-2*h*a*Math.cos(t*e)),o=Math.asin(a/r*Math.sin(t*e))*i,n=163.8069+203.4058646*(s-r/173)+o-_,h=358.414+101.2916335*(s-r/173)+o-_,a=5.7176+50.234518*(s-r/173)+o-_,t=224.8092+21.48798*(s-r/173)+o-_,i=331.18+50.310482*(s-r/173),o=87.45+21.569231*(s-r/173),_=n+.473*Math.sin(2*(n-h)*e),s=h+1.065*Math.sin(2*(h-a)*e),r=a+.165*Math.sin(i*e),t=t+.843*Math.sin(o*e),n=5.9057-.0244*Math.cos(2*(n-h)*e),a=9.3966-.0882*Math.cos(2*(h-a)*e),i=14.9883-.0216*Math.cos(i*e),o=26.3627-.1939*Math.cos(o*e);return[n*Math.sin(_*e),a*Math.sin(s*e),i*Math.sin(r*e),o*Math.sin(t*e)]},S.prototype._jm_panel=function(t,e,i,s,a,o,n){for(var h=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=s+o/2,_=o/2/40,l=86400*(e-2440587.5),c=[],p=0;p<=i;p+=.02)c.push(this._jm_moonPos(e+p));var d=c.length,u=n/i/50;for(t._strokeStyle("#444444",1),t._fillStyle("#444444"),t._beginPath(),t._rect(r-_,a,2*_,n),t._fill(),t._fillStyle("#eeeeee"),t._textStyle("Arial,Helvetica,sans-serif",12,"",""),p=0;p<=i;p++){t._beginPath(),t._moveTo(s+.1*o,a+u*p*50),t._lineTo(s+.9*o,a+u*p*50),t._stroke();var f=l+86400*p,f=be._unix_to_calendar(f+this._tzOffset.offset(f)+1);t._text(s+.12*o,a+u*p*50,-1,0,!0,0===p?f[2]+" "+h[f[1]]:f[2]+"",!1,!1)}for(p=0;p<4;p++){t._strokeStyle(this._moons[p][1],1),t._beginPath();var g=c[0][p];t._moveTo(r+_*g,a);for(var m=-1<g&&g<1,v=1;v<d;v++){var x=c[v][p],y=r+_*x,w=a+u*v;x<g&&-1<x&&x<1?m=1:m?(t._moveTo(y,w),m=0):t._lineTo(y,w),g=x}t._stroke()}},S.prototype._jm_resize=function(){this._width=this._context.width()-20,this._jm_draw()},S.prototype._jm_draw=function(t){var e=this;if(e._lock)return 1;e._lock=1;var i=parseInt($(".day",e._context).val()),s=parseInt($(".month",e._context).val()),a=parseInt($(".year",e._context).val()),i=be._calendar_to_unix(a,s,i,0,0,0),i=(i-=e._tzOffset.offset(i))/86400+2440587.5;this.colwidth=this._width/3.2,this._height=Math.floor(1.2*this._width);var o=t;(o=o||this._graphics_context)._resize(e._width,e._height),o._fillStyle("#000000"),o._rect(0,0,e._width,e._height),o._fill();for(var n=0;n<4;n++){var h=20+e._width/4.7*n;o._strokeStyle(e._moons[n][1],1),o._beginPath(),o._moveTo(h,14),o._lineTo(16+h,14),o._stroke(),o._fillStyle("#eee"),o._textStyle("Arial,Helvetica,sans-serif",12,"",""),o._text(24+h,14,-1,0,!0,e._moons[n][0],!1,!1)}o._textStyle("Arial,Helvetica,sans-serif",11,"",""),o._strokeStyle("#eee",1),o._fillStyle("#eee"),o._beginPath(),o._moveTo(e._width-30,6),o._lineTo(e._width-30,22),o._lineTo(e._width-46,22),o._stroke(),o._beginPath(),o._moveTo(e._width-30,6),o._lineTo(e._width-28,9),o._lineTo(e._width-32,9),o._fill(),o._beginPath(),o._moveTo(e._width-46,22),o._lineTo(e._width-43,20),o._lineTo(e._width-43,24),o._fill(),o._text(e._width-20,12,0,0,!0,"N",!1,!1),o._text(e._width-56,22,0,0,!0,"E",!1,!1),this._jm_panel(o,i,14,0,40,e.colwidth,e._height-54),this._jm_panel(o,14+i,14,e.colwidth,40,e.colwidth,e._height-54),this._jm_panel(o,28+i,14,2*e.colwidth,40,e.colwidth,e._height-54),o._fillStyle("#a0a0a0"),o._textStyle("Arial,Helvetica,sans-serif",10,"",""),o._text(e._width-5,e._height-7,1,0,!0,"https://in-the-sky.org.",!1,!1),e._lock=0},$(function(){$(".jovian_moons").each(function(t,e){var i=$(e),e=new S(i.data("meta"),i);i.data("handler",e)})}),T.prototype._regionInputSetup=function(t){var e=this;this._el_inject.html(t.body),$(".country, .town",e._parent).on("change",function(){e._regionInputRefresh(4)}),$(".reg1",e._parent).on("change",function(){e._regionInputRefresh(2)}),$(".reg2",e._parent).on("change",function(){e._regionInputRefresh(3)})},T.prototype._regionInputInit=function(){var e=this;$.getJSON(window.server+"embeds/locationselect.php?town="+e._town,function(t){e._regionInputSetup(t)})},T.prototype._regionInputFromIP=function(){var e=this;$.getJSON(window.server+"embeds/locationselect.php?fromip=1",function(t){e._regionInputSetup(t),$(".location-use-form",e._parent).trigger("click")})},T.prototype._regionInputFromGeo=function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){$.getJSON(window.server+"embeds/locationselect.php?fromlatlng=1&lat="+t.coords.latitude+"&lng="+t.coords.longitude,function(t){e._regionInputSetup(t),$(".location-use-form",e._parent).trigger("click")})},function(t){alert("Unfortunately your position could not be automatically determined: "+t.message+". Please specify a position manually.")})},T.prototype._regionInputRefresh=function(t){var e=this,i=$(".country",e._parent),s=$(".reg1",e._parent),a=$(".reg2",e._parent),o=$(".town",e._parent);i&&s&&a&&o||e._regionInputInit();i=i.val(),s=s.val(),a=a.val(),o=o.val(),i=window.server+"embeds/locationselect.php?country="+i;1<t&&(i+="&reg1="+s),2<t&&(i+="&reg2="+a),3<t&&(i+="&town="+o),$.getJSON(i,function(t){e._regionInputSetup(t)})},$(function(){$(".location-selector").each(function(t,e){var i=$(e),e=new T(i);i.data("handler",e)})}),A.prototype._set_height_range=function(t,e){},A.prototype._fetch_colour=function(t,e){return 250===e||255===e?[160,160,255]:[150,230,150]},z.prototype._update_coordinates=function(t,e,i){(this._settings.mutable||this._settings.mutable_zoom)&&(this._settings.mutable&&(this._latitude=t,this._longitude=e),this._settings.mutable_zoom&&(this._fov=i),this._recompute())},z.prototype._redraw=function(){var c=this,t=this._map_image[0];t.width=this._width,t.height=this._height;function i(t,r,_,l){$.each(t,function(t,h){$.each([-c._topographicData._projector._x_360_deg,0,c._topographicData._projector._x_360_deg],function(t,e){var i=!1,s=null;p.beginPath();for(var a=0;a<h.length;a++){var o=r.lat_min+r.pixel_scale*(c._topographicData._tile_size-h[a][1]),n=r.lng_min+r.pixel_scale*h[a][0];o<-89.9&&(o=-89.9);n=c._topographicData._projector._project_xy_from_lat_lng(n*Math.PI/180,o*Math.PI/180,c._longitude_central,c._latitude_central,0);isFinite(n[0])&&isFinite(n[1])?(o=Ie(n[0]),n=Ie(n[1]),i&&null!==s&&(o<s-.5*c._topographicData._projector._x_360_deg?e+=c._topographicData._projector._x_360_deg:o>s+.5*c._topographicData._projector._x_360_deg&&(e-=c._topographicData._projector._x_360_deg)),s=o,i?p.lineTo(o+e,n):(p.moveTo(o+e,n),i=!0),!_&&2<h[a].length&&(i=!1)):(p.closePath(),i=!1)}l()})})}var e,s,p=t.getContext("2d");p.fillStyle="#8bbde0",p.beginPath(),p.rect(0,0,this._width,this._height),p.fill(),$.each(this._topographicData._tiles_coast,function(t,e){null!==e&&(p.fillStyle="#bccdad",i(e[0],e,1,function(){p.fill()}),p.fillStyle="#8bbde0",i(e[1],e,1,function(){p.fill()}),p.strokeStyle="#808080",p.lineWidth=1,i(e[0],e,0,function(){p.stroke()}),i(e[1],e,0,function(){p.stroke()}))});for(var a=this._displayControl._way_types,o=0;o<a.length;o++){var n=a[o],h=n[0];if(this._labelTypesEnabled.hasOwnProperty(h)?this._labelTypesEnabled[h]:$(n[1]).is(":checked")){var h=this._displayControl._labelColours[n[2]],r=this._topographicData._output_ways[n[0]];for(p.lineWidth=1,p.strokeStyle="rgb("+h+")",p.beginPath(),e=0;e<r.length;e++)for(p.moveTo(r[e][0][0],r[e][0][1]),s=1;s<r[e].length;s++)p.lineTo(r[e][s][0],r[e][s][1]);p.stroke()}}},z.prototype._project_xy_from_lat_lng=function(t,e,i,s){e=this._topographicData._projector._project_xy_from_lat_lng(parseFloat(t)*Math.PI/180,parseFloat(e)*Math.PI/180);return e?[Ie(e[0]),Ie(e[1]),null!=i&&Ie(i)===Ie(this._must_label_item),!1]:null},z.prototype._fetch_labels=function(){return{towns:D(this._topographicData._output_towns,this._must_label_item),hills:D(this._topographicData._output_hills,this._must_label_item),stations:this._topographicData._output_nodes.stations}},z.prototype._relabel=function(){this._labeller._relabel(!1,!1,!1);var t=this._fov*Math.PI/180*6371e3,e=Math.pow(10,Math.floor(Math.log(t/6)/Math.log(10))),i=Math.floor(t/6/e)*e,e=i*this._width/t,t="",t=i<1e3?Math.floor(i)+" m":i<1e6?Math.floor(i/1e3)+" km":Math.floor(i/1e6)+",000 km",i=$(".img_scalebar",this._context)[0];i.width=this._width,i.height=this._height;i=i.getContext("2d");i.font="bold 14px Arial,Helvetica,sans-serif",i.textBaseline="bottom",i.textAlign="center",i.beginPath(),i.moveTo(this._width-50,this._height-50),i.lineTo(this._width-50-e,this._height-50),i.strokeStyle="rgba(0,0,0,0.7)",i.lineWidth=3.5,i.stroke(),i.strokeStyle="#ffff00",i.lineWidth=2,i.stroke(),i.strokeStyle="rgba(0,0,0,0.7)",i.strokeText(t,this._width-50-e/2,this._height-58),i.fillStyle="#ffff00",i.fillText(t,this._width-50-e/2,this._height-58)},z.prototype._resize=function(){this._width=this._context.width()-10,this._width<50&&(this._width=50),700<this._width&&(this._width-=.05*(this._width-700)),this._width=Ie(this._width),this._height=Math.min(this._width*this._settings.max_aspect,$(window).height()-220),this._height=Math.max(this._height,200),$("canvas, .loading, .holder",this._context).width(this._width).height(this._height),$(".loading",this._context).css("padding-top",Ie(this._height/2-20)),this._recompute()},z.prototype._recompute=function(){this._topographicData._adjust(this._latitude,this._longitude,this._fov,this._width,this._height),this._relabel(),this._annotation._update=!0},z.prototype._dataUpdated=function(t){this._labeller._fetchNewLabels=!0,this._redraw()},z.prototype._mouseDown=function(t){t=At(t,this._map_fore);this._pos0=t,this._mousedown=1;t=this._topographicData._projector._project_lat_lng_from_xy(t[0],t[1]);$("#mouse_latitude").text(t[1].toFixed(3)),$("#mouse_longitude").text(t[0].toFixed(3))},z.prototype._mouseDrag=function(t){var e;this._labeller._hoverman.hoverHandle(t),0===t?e=[this._mousex,this._mousey]:(e=At(t,this._map_fore),this._mousex=e[0],this._mousey=e[1]);var i,s=90-this._fov/4*this._height/this._width;this._mutable&&this._mousedown&&(i=this._pos0[0]-e[0]+this._width/2,t=this._pos0[1]-e[1]+this._height/2,this.__shiftContext(this._map_image[0].getContext("2d"),this._width,this._height,e[0]-this._pos0[0],e[1]-this._pos0[1]),(t=this._topographicData._projector._project_lat_lng_from_xy(i,t))[1]>s&&(t[1]=s),t[1]<-s&&(t[1]=-s),180<t[0]&&(t[0]-=360),t[0]<-180&&(t[0]+=360),this._update_coordinates(t[1],t[0],this._fov),this._pos0=e)},z.prototype._mouseUp=function(t){void 0!==t&&t.hasOwnProperty("pageX")&&this._mouseDrag(t),this._mousedown=0},z.prototype._mouseOut=function(t){this._mouseUp(t)},z.prototype.__shiftContext=function(t,e,i,s,a){var o=t.getImageData(0,0,e,i);t.clearRect(0,0,e,i),t.putImageData(o,s,a)},z.prototype._displaywheel=function(t,e){var i,s;this._mutable&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1,s=Date.now(),void 0!==this._lastZoomEventTime&&s<this._lastZoomEventTime+100||(this._lastZoomEventTime=s,i=void 0!==e?e:t.deltaY||t.wheelDelta,s=this._fov,0<i?(this._fov*=1.2,this._fov>=this._max_field_of_view&&(this._fov=this._max_field_of_view)):(this._fov*=.8,this._fov<=this._min_field_of_view&&(this._fov=this._min_field_of_view)),e=s/this._fov,i=[0,0],t.hasOwnProperty("pageX")&&((i=At(t,this._map_fore))[0]=.5-i[0]/this._width,i[1]=i[1]/this._height-.5),s=i[0]*(1-e)*1.4,e=i[1]*(1-e)*1.4,this._mousedown?this._mouseDrag(t):(this._latitude+=e*this._fov*this._height/this._width,this._longitude+=s*this._fov,this._update_coordinates(this._latitude,this._longitude,this._fov))))},z.prototype.hypot=function(t,e){return Math.sqrt(t*t+e*e)},$(function(){$(".topographic_map").each(function(t,e){var i=$(e),e=new z(i.data("meta"),i);i.data("handler",e)})}),C.prototype._removeAll=function(){this._marker_list={},this._marker_counter=0,this._moveOnClick=null,this._update=!0},C.prototype._remove=function(t){this._marker_list.hasOwnProperty(t)&&delete this._marker_list[t],this._moveOnClick===t&&(this._moveOnClick=null),this._update=!0},C.prototype._moveMarkerOnClick=function(t){this._marker_list.hasOwnProperty(t)&&(this._moveOnClick=t)},C.prototype._iconFromImageURL=function(t,e,i,s,a){var o=this;this._icon_counter++;var n=this._icon_counter,h=new Image;return h.src=t,h.onload=function(){o._icon_index[n]=[h,e,i,s,a],o._update=!0},n},C.prototype._addImageWithLabel=function(t,e,i,s,a,o,n,h){return this._marker_counter++,this._marker_list[this._marker_counter]={type:"imageWithLabel",position:[t,e],"z-index":i,radius:null,title:s,hoverText:null,draggable:a,icon:o,point:[n,h],events:{}},this._update=!0,this._marker_counter},C.prototype._addCircle=function(t,e,i,s,a,o,n,h){return this._marker_counter++,this._marker_list[this._marker_counter]={type:"circle",position:[t,e],"z-index":i,radius:s,title:null,hoverText:a,draggable:!1,icon:null,strokeColor:o,lineWidth:n,fillColor:h,events:{}},this._update=!0,this._marker_counter},C.prototype._addArrow=function(t,e,i,s,a){return this._marker_counter++,this._marker_list[this._marker_counter]={type:"arrow",path:s,"z-index":i,radius:null,title:null,hoverText:null,draggable:!1,icon:null,strokeColor:a,fillColor:null,events:{}},this._update=!0,this._marker_counter},C.prototype._addLine=function(t,e,i,s){return this._marker_counter++,this._marker_list[this._marker_counter]={type:"line",path:i,"z-index":t,radius:null,title:null,hoverText:e,draggable:!1,icon:null,strokeColor:s,fillColor:null,events:{}},this._update=!0,this._marker_counter},C.prototype._addLabelledTrack=function(t,e,i,s){return this._marker_counter++,this._marker_list[this._marker_counter]={type:"track",path:t,"z-index":s,radius:null,title:e,position:i,hoverText:null,draggable:!1,icon:null,strokeColor:null,fillColor:null,events:{}},this._update=!0,this._marker_counter},C.prototype._addPolygon=function(t,e,i,s,a,o){return this._marker_counter++,this._marker_list[this._marker_counter]={type:"polygon",path:t,"z-index":e,title:null,hoverText:i,draggable:!1,icon:null,strokeColor:s,lineWidth:a,fillColor:o,position:[0,0],radius:-1,events:{}},this._update=!0,this._marker_counter},C.prototype._getMarkerPosition=function(t){return this._marker_list[t].position},C.prototype._setMarkerPosition=function(t,e,i){this._marker_list[t].position=[e,i],this._update=!0},C.prototype._setMarkerZIndex=function(t,e){this._marker_list[t]["z-index"]=e,this._update=!0},C.prototype._setMarkerPath=function(t,e){this._marker_list[t].path=e,this._update=!0},C.prototype._setMarkerTitle=function(t,e){this._marker_list[t].title=e,this._update=!0},C.prototype._setMarkerHoverText=function(t,e){this._marker_list[t].hoverText=e,this._update=!0},C.prototype._setMarkerIcon=function(t,e){this._marker_list[t].icon=e,this._update=!0},C.prototype._addListener=function(t,e,i){this._marker_list[t].events.hasOwnProperty(e)||(this._marker_list[t].events[e]=[]),this._marker_list[t].events[e].push(i),this._update=!0},C.prototype._schedule_update=function(){this._update=!0},C.prototype._alarm=function(){this._update&&(this._update=this._draw())},C.prototype._draw=function(){var C,R,j=this;if(!j._parent._visible)return!0;var t=this._map_image[0];t.width=j._parent._width,t.height=j._parent._height;var D=t.getContext("2d");this._hoverman.reset(j._parent._width,j._parent._height),D.textAlign="center",D.textBaseline="middle";var i=[];return $.each(j._marker_list,function(t,e){i.push([e["z-index"],t])}),i.sort(function(t,e){return t[0]-e[0]}),$.each(i,function(t,e){var i,s,a,o=e[1],n=j._marker_list[o];if("imageWithLabel"===n.type){if("number"!=typeof n.icon)var h=[n.icon,0,0,n.icon.width,n.icon.height];else{if(!j._icon_index.hasOwnProperty(n.icon))return null;h=j._icon_index[n.icon]}if(!(d=j._parent._topographicData._projector._project_xy_from_lat_lng(n.position[0]*Math.PI/180,n.position[1]*Math.PI/180)))return null;d=[Ie(d[0]),Ie(d[1])],D.drawImage(h[0],h[1],h[2],h[3],h[4],d[0]-n.point[0],d[1]-n.point[1],h[3],h[4]),j._hoverman.hoverBox(o,d[0]-n.point[0],d[1]-n.point[1],h[3],h[4]),n.title&&(D.font="bold 12px Arial,Helvetica,sans-serif",i=[D.measureText(n.title).width,10],D.strokeStyle="#444444",D.lineWidth=1,D.fillStyle="#e0e0e0",D.beginPath(),D.rect(d[0]-i[0]/2-4,d[1]-n.point[1]-i[1]-9,i[0]+7,i[1]+6),D.stroke(),D.fill(),D.fillStyle="#222222",D.fillText(n.title,d[0],d[1]-n.point[1]-5-i[1]/2),j._hoverman.hoverBox(o,d[0]-i[0]/2-4,d[1]-n.point[1]-i[1]-9,i[0]+7,i[1]+6))}else if("track"===n.type)for(S=0;S<n.path.length;S++){for(D.beginPath(),D.lineWidth=2,D.strokeStyle=n.path[S][0],a=!0,R=C=-1e7,s=0;s<n.path[S][1].length;s++)d=j._parent._topographicData._projector._project_xy_from_lat_lng(n.path[S][1][s][0]*Math.PI/180,n.path[S][1][s][1]*Math.PI/180),Math.abs(d[0]-C)>.7*j._parent._width&&(a=!0),a?D.moveTo(d[0],d[1]):(D.lineTo(d[0],d[1]),j._hoverman.hoverLine(o,C,R,d[0],d[1])),C=d[0],R=d[1],a=!1;D.stroke(),d=j._parent._topographicData._projector._project_xy_from_lat_lng(n.position[0]*Math.PI/180,n.position[1]*Math.PI/180),n.title&&(D.font="bold 14px Arial,Helvetica,sans-serif",i=[D.measureText(n.title).width,10],D.strokeStyle="#444444",D.lineWidth=1,D.fillStyle="#e0e0e0",D.beginPath(),D.rect(d[0]-4-i[0]/2,d[1]+-8+3,i[0]+7,i[1]+6),D.stroke(),D.fill(),D.fillStyle="#222222",D.fillText(n.title,d[0],d[1]+-8+7+i[1]/2),j._hoverman.hoverBox(o,d[0]-4-i[0]/2,d[1]+-8+3,i[0]+7,i[1]+6))}else if("arrow"===n.type||"line"===n.type){var r=[];for(D.beginPath(),D.lineWidth=2,D.strokeStyle=n.strokeColor,D.fillStyle=n.strokeColor,a=!0,R=C=-1e7,S=0;S<n.path.length;S++)d=j._parent._topographicData._projector._project_xy_from_lat_lng(n.path[S][0]*Math.PI/180,n.path[S][1]*Math.PI/180),r.push(d),Math.abs(d[0]-C)>.7*j._parent._width&&(a=!0),a?D.moveTo(d[0],d[1]):(D.lineTo(d[0],d[1]),j._hoverman.hoverLine(o,C,R,d[0],d[1])),C=d[0],R=d[1],a=!1;if(r.length<2)return null;h=Math.atan2(r[r.length-1][0]-r[r.length-2][0],r[r.length-1][1]-r[r.length-2][1]);if(D.stroke(),"arrow"!==n.type)return null;D.beginPath(),D.lineTo(r[r.length-1][0]+3*Math.sin(h),r[r.length-1][1]+3*Math.cos(h)),D.lineTo(r[r.length-1][0]+12*Math.sin(h-.84*Math.PI),r[r.length-1][1]+12*Math.cos(h-.84*Math.PI)),D.lineTo(r[r.length-1][0]+7*Math.sin(h-Math.PI),r[r.length-1][1]+7*Math.cos(h-Math.PI)),D.lineTo(r[r.length-1][0]+12*Math.sin(h+.84*Math.PI),r[r.length-1][1]+12*Math.cos(h+.84*Math.PI)),D.lineTo(r[r.length-1][0]+3*Math.sin(h),r[r.length-1][1]+3*Math.cos(h)),D.fill()}else if("circle"===n.type||"polygon"===n.type){if(r=[],"circle"===n.type)for(var _=90-n.radius,l=0;l<24.05;l+=.02){var c=new N(l,_),p=c._rotate_xz((90-n.position[1])*Math.PI/180)._rotate_xy((180+n.position[0])*Math.PI/180)._to_ra_dec(),d=j._parent._topographicData._projector._project_xy_from_lat_lng(p.ra*Math.PI/12,p.dec*Math.PI/180);r.push(d)}else for(S=0;S<n.path.length;S++)d=j._parent._topographicData._projector._project_xy_from_lat_lng(n.path[S][0]*Math.PI/180,n.path[S][1]*Math.PI/180),r.push(d);if(!(r.length<2)){D.fillStyle=n.fillColor,D.beginPath();var u=!1,f=null,g=[],m=!1,v=0;for(S=0;S<=r.length;S++){c=r[S%r.length];var x=r[(S+1)%r.length],y=c[0]<0||c[0]>j._parent._width||c[1]<0||c[1]>j._parent._height;y&&(f=c),!y&&u&&g.push([S,f]);x=Math.atan2(c[0]-j._parent._width/2,c[1]-j._parent._height/2)-Math.atan2(x[0]-j._parent._width/2,x[1]-j._parent._height/2);x<-Math.PI&&(x+=2*Math.PI),x>Math.PI&&(x-=2*Math.PI),v+=x,m|=!(u=y)}var w=[];if(0===g.length)if(m){for(D.moveTo(r[0][0],r[0][1]),S=1;S<r.length;S++)D.lineTo(r[S][0],r[S][1]);w=[r]}else(v<-Math.PI||v>Math.PI)&&(D.moveTo(0,0),D.lineTo(j._parent._width,0),D.lineTo(j._parent._width,j._parent._height),D.lineTo(0,j._parent._height),w=[[[0,0],[j._parent._width,0],[j._parent._width,j._parent._height],[0,j._parent._height]]]);else for(a=!0,s=0;s<g.length;s++){for(a?(D.moveTo(g[s][1][0],g[s][1][1]),w.push([[g[0][1][0],g[0][1][1]]]),a=!1):(D.lineTo(g[s][1][0],g[s][1][1]),w[w.length-1].push([g[0][1][0],g[0][1][1]])),y=!1,S=g[s][0];!y;S++)y=(c=r[S%r.length])[0]<0||c[0]>j._parent._width||c[1]<0||c[1]>j._parent._height,D.lineTo(c[0],c[1]),w[w.length-1].push([c[0],c[1]]);for(var M=(s+1)%g.length,k=Math.atan2(g[s][1][0]/j._parent._width-.5,g[s][1][1]/j._parent._height-.5),b=Math.atan2(c[0]/j._parent._width-.5,c[1]/j._parent._height-.5),P=Math.atan2(g[M][1][0]/j._parent._width-.5,g[M][1][1]/j._parent._height-.5);k<b;)k+=2*Math.PI;for(;P<b;)P+=2*Math.PI;for(var M=Math.ceil(b/(Math.PI/2)+.5),I=k/(Math.PI/2)+.5,$=P/(Math.PI/2)+.5,S=M;S<I&&S<$;S++){var T=(S-.5)*Math.PI/2,A=2*Math.max(j._parent._width,j._parent._height),z=j._parent._width/2+A*Math.sin(T),T=j._parent._height/2+A*Math.cos(T);D.lineTo(z,T),w[w.length-1].push([z,T])}I<$&&(a=!0)}for(D.fill(),S=0;S<w.length;S++)j._hoverman.hoverPolygon(o,w[S],!0);for(D.beginPath(),D.lineWidth=n.lineWidth,D.strokeStyle=n.strokeColor,a=!0,C=-1e7,S=0;S<=r.length;S++)d=r[S%r.length],Math.abs(d[0]-C)>.7*j._parent._width&&(a=!0),C=d[0],a?D.moveTo(d[0],d[1]):D.lineTo(d[0],d[1]),a=!1;D.stroke()}}}),!1},C.prototype._hoverHover=function(t,e,i){var s;null===this._custom_hover_handler?(s=$(".annotation-hover",this._context),this._marker_list.hasOwnProperty(t)?this._marker_list[t].hoverText&&(s.css("width","160px"),s.css("left",e-80+"px"),s.css("top",i+12+"px"),s.css("display","block"),s.html(this._marker_list[t].hoverText),this._context.css("cursor","pointer")):(s.css("display","none"),this._context.css("cursor","auto"))):this._custom_hover_handler(e,i)},C.prototype._hoverClick=function(t,e,i){var s=this._parent._topographicData._projector._project_lat_lng_from_xy(e,i);this._moveOnClick&&(this._marker_list[this._moveOnClick].position=s,this._update=!0,this._marker_list[this._moveOnClick].events.hasOwnProperty("position_changed")&&$.each(this._marker_list[this._moveOnClick].events.position_changed,function(t,e){e(s[0],s[1])})),this._marker_list.hasOwnProperty(t)&&this._marker_list[t].events.hasOwnProperty("click")&&$.each(this._marker_list[t].events.click,function(t,e){e(s[0],s[1])})},C.prototype._hoverDblClick=function(t,e,i){var s=this._parent._topographicData._projector._project_lat_lng_from_xy(e,i);this._marker_list.hasOwnProperty(t)&&this._marker_list[t].events.hasOwnProperty("dclick")&&$.each(this._marker_list[t].events.dclick,function(t,e){e(s[0],s[1])})},j.prototype._add_hook=function(t,e){this._hooks[t].push(e)},j.prototype._updateAlarm=function(){var t,e,i=this;i._fetchNewLabels&&(e=0,(t=i._fixedLabelList||this._client._fetch_labels()).hasOwnProperty("towns")&&(e+=t.towns.length),t.hasOwnProperty("hills")&&(e+=t.hills.length),t.hasOwnProperty("landmarks")&&(e+=t.landmarks.length),t.hasOwnProperty("stations")&&(e+=t.stations.length),0<e&&(i._labelList=t,i._relabel(!1,!1,this._maximum_distance),i._fetchNewLabels=!1))},j.prototype._relabel=function(t,e,i){var s=this;if(this._maximum_distance=i,s._client._visible){this._width=this._client._width,this._height=this._client._height,this._hoverman.reset(this._width,this._height),this._hovermankeys={},this._hovermannextkey=1,e||(t&&(this._labelBuffer=1-this._labelBuffer),(e=[this._graphics_context_0,this._graphics_context_1][this._labelBuffer])._resize(this._width,this._height)),e._strokeStyle(this._client._displayControl._labelColours.halo,2.5),e._textStyle("Arial,Helvetica,sans-serif",13,"bold","");for(var a=[["hill","#show_hills",!0],["town","#show_towns",!0],["landmark","#show_landmarks",!(this._boxList=[])],["station","#show_stations",!1]],o=0;o<a.length;o++){var n=a[o][0]+"s",h=a[o][0],r=this._client._displayControl._labelColours[n];if(e._fillStyle(r),(this._labelTypesEnabled.hasOwnProperty(n)?this._labelTypesEnabled[n]:$(a[o][1]).is(":checked"))&&this._labelList.hasOwnProperty(n))for(var _=this._labelList[n],l=0;l<_.length;l++){var c=_[l],p=c[5];"hills"==n&&(p=Math.max(p,c[0])),isFinite(p)||(p=0);var d,u,f,g,m,v=s._client._project_xy_from_lat_lng(c[4],c[3],c[2],c[6],p*s._client._z_scale);v&&(v[3]&&!v[2]||(m=v[4],i&&.9*i<m||(d=Ie(v[0]),u=Ie(v[1]),isNaN(d)||isNaN(u)||d<0||d>s._width||u<0||u>s._height||(p=e._textWidth(c[1]),f="<p class='head'>"+c[1]+"</p>",0<c[5]&&(f+="<p class='type'>Elevation: "+c[5].toFixed(0)+"&nbsp;m</p>"),this._client._settings.show_distances&&(f+="<p class='type'>Distance: "+(m/1e3).toFixed(1)+"&nbsp;km</p>"),0===this._mode?this._collisionDetect(d-8,u-16,d+16+p,u+16)||(e._beginPath(),e._arc(d,u,2.4,0,2*Math.PI,!1),e._stroke(),e._fill(),this._client._displayControl._labelBlackHalo&&e._text(d+8,u,-1,0,0,c[1],0,0),e._text(d+8,u,-1,0,1,c[1],0,0),g=c[2]&&a[o][2],this._hovermankeys[this._hovermannextkey]=[g?window.server_htv+h+".php?id="+c[2]:null,f],this._hoverman.hoverBox(this._hovermannextkey,d-6,u-6,p+12,12),this._hovermannextkey++):s._collisionDetect(d-16,u-8-p,d+16,u+8)||(m="— "+c[1],e._translate(d,u,-Math.PI/2),this._client._displayControl._labelBlackHalo&&e._text(0,0,-1,0,0,m,0,0),e._text(0,0,-1,0,1,m,0,0),e._unsetTranslate(),g=c[2]&&a[o][2],this._hovermankeys[this._hovermannextkey]=[g?window.server_htv+h+".php?id="+c[2]:null,f],this._hoverman.hoverBox(this._hovermannextkey,d-8,u-2-p,16,p+6),this._hovermannextkey++)))))}}for(var x,y=[["roads","#show_roads"],["rivers","#show_rivers"],["railways","#show_railways"]],o=0;o<y.length;o++){var w=y[o][0];if((this._labelTypesEnabled.hasOwnProperty(w)?this._labelTypesEnabled[w]:$(y[o][1]).is(":checked"))&&(this._labelList.hasOwnProperty("ways")&&this._labelList.ways.hasOwnProperty(w)))for(_=this._labelList.ways[w],l=0;l<_.length;l++){f="<p class='head'>"+(c=_[l])[0]+"</p>";for(var M=[],k=[],b=0;b<c[1].length;b++)(v=s._client._project_xy_from_lat_lng(c[1][b][2],c[1][b][3],-1,c[2],c[1][b][4]*s._client._z_scale))?(d=Ie(v[0]),u=Ie(v[1]),k.push([d,u])):(1<k.length&&M.push(k),k=[]);for(1<k.length&&M.push(k),this._hovermankeys[this._hovermannextkey]=[null,f],b=0;b<M.length;b++)this._hoverman.hoverPolygon(this._hovermannextkey,M[b],!1);this._hovermannextkey++}}t&&(x=$(".img_labels"+(1-this._labelBuffer),this._context),t=$(".img_labels"+this._labelBuffer,this._context),x.stop().css("z_index",2).fadeOut(400),t.stop().css("z-index",1).fadeIn(400)),$.each(s._hooks.redraw,function(t,e){e()})}},j.prototype._collisionDetect=function(t,e,i,s){for(var a=0;a<this._boxList.length;a++){var o=this._boxList[a];if(t<o[2]&&i>o[0]&&e<o[3]&&s>o[1])return!0}return this._boxList.push([t,e,i,s]),!1},j.prototype._hoverDblClick=function(t){this._client._settings.hasOwnProperty("enableClickingOnHills")&&!this._client._settings.enableClickingOnHills||!t in this._hovermankeys||("string"==typeof(t=this._hovermankeys[t][0])?window.open(t):t())},j.prototype._hoverHover=function(t,e,i){var s=$(".hover-info",this._context);0!==t&&t in this._hovermankeys?this._client._settings.hasOwnProperty("enableClickingOnHills")&&!this._client._settings.enableClickingOnHills||(s.css("width","110px"),s.css("left",e-55+"px"),s.css("top",i+12+"px"),s.css("display","block"),i="",i="string"==typeof this._hovermankeys[t][0]?'<p class="clk">Double click to see the view from here</p>':"",s.html(this._hovermankeys[t][1]+i)):s.css("display","none")},O.prototype._configure=function(t,e,i,s,a,o,n,h){this._field_of_view=t,this._lng0=s,this._lat0=a,this._position_angle=o,this._grid_size_x=e,this._grid_size_y=i,this._offset_x=n-this._grid_size_x/2,this._offset_y=h-this._grid_size_y/2,this._y0=Math.PI-Math.log(Math.tan(Math.PI/4+this._lat0/2)),this._x_min=-Math.PI*e/t+this._grid_size_x/2,this._x_max=Math.PI*e/t+this._grid_size_x/2,this._x_360_deg=2*Math.PI*e/t},O.prototype._project_xy_from_lat_lng=function(t,e){t=(t-this._lng0)*this._grid_size_x/this._field_of_view-this._offset_x,e=(Math.PI-Math.log(Math.tan(Math.PI/4+e/2))-this._y0)*this._grid_size_x/this._field_of_view-this._offset_y;return t>this._x_max&&(t-=this._x_360_deg),t<this._x_min&&(t+=this._x_360_deg),[t,e]},O.prototype._project_lat_lng_from_xy=function(t,e){t=(t+this._offset_x)*this._field_of_view/this._grid_size_x+this._lng0,e=(e+this._offset_y)*this._field_of_view/this._grid_size_x+this._y0,e=2*(Math.atan(Math.exp(Math.PI-e))-Math.PI/4);return[180*t/Math.PI,180*e/Math.PI]},L.prototype._adjust=function(t,e,i,s,a){null!==t&&(this._latitude_central=t*Math.PI/180),null!==e&&(this._longitude_central=e*Math.PI/180),null===i||(i=i*Math.PI/180)!==this._field_of_view&&(this._field_of_view=i,this._latest_zoom_adjustment=(new Date).getTime(),this._downloads_inhibited=!0),null!==s&&(this._grid_size_x=s),null!==a&&(this._grid_size_y=a),this._position_angle=0,this._projector=new this._projector_class(this._field_of_view,this._grid_size_x,this._grid_size_y,this._longitude_central,this._latitude_central,this._position_angle,0,0),this._set_tiling_scheme(this._field_of_view),this._tiles_coast={},this._tiles_json={},this._last_item_load_time=(new Date).getTime(),this._schedule_refresh()},L.prototype._schedule_refresh=function(){this._refresh=!0,this._output_nodes={stations:[]},this._output_ways={countries_administrative:[],regions_administrative:[],railways_rail:[],roads_motorway:[],roads_trunk:[],roads_primary:[],roads_tertiary:[],roads_residential:[],rivers_river:[]},this._output_towns=[],this._output_hills=[]},L.prototype._set_tiling_scheme=function(t){var e=.225*Math.PI/180,t=t/(this._grid_size_x-1);e<t&&(t=e),this._scheme_number=Math.ceil(Math.log(e/t)/Math.log(2)),this._scheme_number<1&&(this._scheme_number=1),9<this._scheme_number&&(this._scheme_number=9),$("#scheme_output").text(this._scheme_number),this._tile_size=600,this._tile_angular_size=600*e/Math.pow(2,this._scheme_number),this._longitude_tile_zero=-Math.PI,this._longitude_tile_max=Math.PI,this._latitude_tile_zero=-Math.PI/2,this._latitude_tile_max=Math.PI/2,this._projection_interpolated=new this._projector_class(this._field_of_view,this._grid_size_x,this._grid_size_y,this._longitude_central,this._latitude_central,this._position_angle,0,0)},L.prototype._fetch_tile_data=function(t){var e=this,i=[t[0]*Math.PI/180,t[1]*Math.PI/180];if(window.hasOwnProperty("htv_media_cache")||(window.htv_media_cache={}),!(i[1]<e._latitude_tile_zero||i[1]>e._latitude_tile_max)){i[0]<e._longitude_tile_zero&&(i[0]+=2*Math.PI),i[0]>e._longitude_tile_max&&(i[0]-=2*Math.PI);var s,a=Ie(Math.floor((i[0]-e._longitude_tile_zero)/e._tile_angular_size)),o=Ie(Math.floor((i[1]-e._latitude_tile_zero)/e._tile_angular_size)),n=Ie(1e5*o+a),t=a%8,i=r(t,2),t=window.server_htv_ajax[t]+"topography_tiles/tiles"+i+"/"+r(e._scheme_number,4)+"/"+r(a,4)+"/"+r(o,4)+"_"+e._scheme_letter;if(!e._tiles_json.hasOwnProperty(n)){if(e._downloads_inhibited)return;e._tiles_json[n]=null;var h=t+".json",i=function(t){window.htv_media_cache[h]=t,e._last_item_load_time=(new Date).getTime(),e._json_items_loaded++,t.x_tile=a,t.y_tile=o,t.lng_min=180*(e._longitude_tile_zero+a*e._tile_angular_size)/Math.PI,t.lat_min=180*(e._latitude_tile_zero+o*e._tile_angular_size)/Math.PI,t.pixel_scale=e._tile_angular_size/e._tile_size*180/Math.PI,e._tiles_json[n]=t,e._schedule_refresh()};window.htv_media_cache.hasOwnProperty(h)?(e._json_items_to_load++,i(window.htv_media_cache[h])):(jQuery.getJSON(h,i),e._json_items_to_load++)}e._tiles_coast.hasOwnProperty(n)||e._downloads_inhibited||(e._tiles_coast[n]=null,s=t+".coast.json",t=function(t){window.htv_media_cache[s]=t,e._last_item_load_time=(new Date).getTime(),e._coast_items_loaded++,t.x_tile=a,t.y_tile=o,t.lng_min=180*(e._longitude_tile_zero+a*e._tile_angular_size)/Math.PI,t.lat_min=180*(e._latitude_tile_zero+o*e._tile_angular_size)/Math.PI,t.pixel_scale=e._tile_angular_size/e._tile_size*180/Math.PI,e._tiles_coast[n]=t},window.htv_media_cache.hasOwnProperty(s)?(e._coast_items_to_load++,t(window.htv_media_cache[s])):(jQuery.getJSON(s,t),e._coast_items_to_load++))}},L.prototype._updateAlarm=function(){var r,_,l,c=this,t=(new Date).getTime();if(this._refresh&&!(t<c._latest_zoom_adjustment+300)){this._downloads_inhibited=!1;var e=c._coast_items_loaded===c._coast_items_to_load&&c._json_items_loaded===c._json_items_to_load;if(e||!(t<c._last_item_load_time+3e3)){for(var i=0;i<=15;i++)for(var s=0;s<=15;s++)r=this._projection_interpolated._project_lat_lng_from_xy(c._grid_size_x*s/15,c._grid_size_y*i/15),c._fetch_tile_data(r);((e=c._coast_items_loaded===c._coast_items_to_load&&c._json_items_loaded===c._json_items_to_load)||t>c._last_item_load_time+3e3)&&($.each([["towns",c._output_towns]],function(t,e){var i=e[0],a=e[1];$.each(c._tiles_json,function(t,e){null!==e&&$.each(e[i],function(t,e){_=e[2],l=e[3];var i=Ie((r=c._projector._project_xy_from_lat_lng(l*Math.PI/180,_*Math.PI/180,c._longitude_central,c._latitude_central,0))[0]),s=Ie(r[1]);i<0||i>c._grid_size_x||s<0||s>c._grid_size_y||a.push([e[4],e[1],e[0],_,l,0,c])})})}),$.each([["countries","administrative"],["regions","administrative"],["railways","rail"],["roads","motorway"],["roads","trunk"],["roads","primary"],["roads","tertiary"],["roads","residential"],["rivers","river"]],function(t,e){var h=e[0]+"_"+e[1];$.each(c._tiles_json,function(t,n){null!==n&&n[e[0]].hasOwnProperty(e[1])&&$.each(n[e[0]][e[1]],function(t,e){for(var i=[],s=1;s<e.length;s++){_=n.lat_min+n.pixel_scale*(c._tile_size-e[s][1]),l=n.lng_min+n.pixel_scale*e[s][0];var a=Ie((r=c._projector._project_xy_from_lat_lng(l*Math.PI/180,_*Math.PI/180,c._longitude_central,c._latitude_central,0))[0]),o=Ie(r[1]);a<0||a>=c._grid_size_x||o<0||o>=c._grid_size_y?0<i.length&&(c._output_ways[h].push(i),i=[]):i.push([a,o,l,_,0])}0<i.length&&c._output_ways[h].push(i)})})})),c._refresh=!1,c._callback&&c._callback(!e)}}};var G=[[0,0,0,0,1,-171996,-174.2,92025,8.9],[-2,0,0,2,2,-13187,-1.6,5736,-3.1],[0,0,0,2,2,-2274,-.2,977,-.5],[0,0,0,0,2,2062,.2,-895,.5],[0,1,0,0,0,1426,-3.4,54,-.1],[0,0,1,0,0,712,.1,-7,0],[-2,1,0,2,2,-517,1.2,224,-.6],[0,0,0,2,1,-386,-.4,200,0],[0,0,1,2,2,-301,0,129,-.1],[-2,-1,0,2,2,217,-.5,-95,.3],[-2,0,1,0,0,-158,0,0,0],[-2,0,0,2,1,129,.1,-70,0],[0,0,-1,2,2,123,0,-53,0],[2,0,0,0,0,63,0,0,0],[0,0,1,0,1,63,.1,-33,0],[2,0,-1,2,2,-59,0,26,0],[0,0,-1,0,1,-58,-.1,32,0],[0,0,1,2,1,-51,0,27,0],[-2,0,2,0,0,48,0,0,0],[0,0,-2,2,1,46,0,-24,0],[2,0,0,2,2,-38,0,16,0],[0,0,2,2,2,-31,0,13,0],[0,0,2,0,0,29,0,0,0],[-2,0,1,2,2,29,0,-12,0],[0,0,0,2,0,26,0,0,0],[-2,0,0,2,0,-22,0,0,0],[0,0,-1,2,1,21,0,-10,0],[0,2,0,0,0,17,-.1,0,0],[2,0,-1,0,1,16,0,-8,0],[-2,2,0,2,2,-16,.1,7,0],[0,1,0,0,1,-15,0,9,0],[-2,0,1,0,1,-13,0,7,0],[0,-1,0,0,1,-12,0,6,0],[0,0,2,-2,0,11,0,0,0],[2,0,-1,2,1,-10,0,5,0],[2,0,1,2,2,-8,0,3,0],[0,1,0,2,2,7,0,-3,0],[-2,1,1,0,0,-7,0,0,0],[0,-1,0,2,2,-7,0,3,0],[2,0,0,2,1,-7,0,3,0],[2,0,1,0,0,6,0,0,0],[-2,0,2,2,2,6,0,-3,0],[-2,0,1,2,1,6,0,-3,0],[2,0,-2,0,1,-6,0,3,0],[2,0,0,0,1,-6,0,3,0],[0,-1,1,0,0,5,0,0,0],[-2,-1,0,2,1,-5,0,3,0],[-2,0,0,0,1,-5,0,3,0],[0,0,2,2,1,-5,0,3,0],[-2,0,2,0,1,4,0,0,0],[-2,1,0,2,1,4,0,0,0],[0,0,1,-2,0,4,0,0,0],[-1,0,1,0,0,-4,0,0,0],[-2,1,0,0,0,-4,0,0,0],[1,0,0,0,0,-4,0,0,0],[0,0,1,2,0,3,0,0,0],[0,0,-2,2,2,-3,0,0,0],[-1,-1,1,0,0,-3,0,0,0],[0,1,1,0,0,-3,0,0,0],[0,-1,1,2,2,-3,0,0,0],[2,-1,-1,2,2,-3,0,0,0],[0,0,3,2,2,-3,0,0,0],[2,-1,0,2,2,-3,0,0,0]];function B(t,e,i){var s=Math.sin(e),a=Math.cos(e),o=Math.sin(t),e=Math.cos(t),t=Math.sin(i),i=Math.cos(i),e=Math.atan2(o*i-s/a*t,e);return e<0&&(e+=2*Math.PI),[e,Math.asin(s*i+a*t*o)]}function J(t){var e=q(t),i=U(t),t=H(t)+i[1],t=B(e[0]+i[0],e[1],t);return[t[0],t[1],e[2]]}function q(t){for(var e,i=Math.PI/180,s=W(t),a=F(E(s,[218.3164477*i,481267.88123421*i,-.0015786*i,i/538841,-i/65194e3]),2*Math.PI),o=F(E(s,[297.8501921*i,445267.1114034*i,-.0018819*i,i/545868,-i/113065e3]),2*Math.PI),n=F(E(s,[357.5291092*i,35999.0502909*i,-1535e-7*i,i/2449e4]),2*Math.PI),h=F(E(s,[134.9633964*i,477198.8675055*i,.0087414*i,i/69699,-i/14712e3]),2*Math.PI),r=F(E(s,[93.272095*i,483202.0175233*i,-.0036539*i,-i/3526e3,i/86331e4]),2*Math.PI),_=119.75*i+131.849*i*s,l=53.09*i+479264.29*i*s,t=313.45*i+481266.484*i*s,c=E(s,[1,-.002516,-74e-7]),p=c*c,d=3958*Math.sin(_)+1962*Math.sin(a-r)+318*Math.sin(l),u=0,f=-2235*Math.sin(a)+382*Math.sin(t)+175*Math.sin(_-r)+175*Math.sin(_+r)+127*Math.sin(a-h)-115*Math.sin(a+h),g=0;g<Y.length;g++){var m=o*(e=Y[g])[0]+n*e[1]+h*e[2]+r*e[3],v=Math.sin(m),m=Math.cos(m);switch(e[1]){case 0:d+=e[4]*v,u+=e[5]*m;break;case 1:case-1:d+=e[4]*v*c,u+=e[5]*m*c;break;case 2:case-2:d+=e[4]*v*p,u+=e[5]*m*p;break;default:throw"error"}}for(g=0;g<V.length;g++){var x=o*(e=V[g])[0]+n*e[1]+h*e[2]+r*e[3],x=Math.sin(x);switch(e[1]){case 0:f+=e[4]*x;break;case 1:case-1:f+=e[4]*x*c;break;case 2:case-2:f+=e[4]*x*p;break;default:throw"error"}}return[F(a,2*Math.PI)+1e-6*d*i,1e-6*f*i,385000.56+.001*u]}var Y=[[0,0,1,0,6288774,-20905355],[2,0,-1,0,1274027,-3699111],[2,0,0,0,658314,-2955968],[0,0,2,0,213618,-569925],[0,1,0,0,-185116,48888],[0,0,0,2,-114332,-3149],[2,0,-2,0,58793,246158],[2,-1,-1,0,57066,-152138],[2,0,1,0,53322,-170733],[2,-1,0,0,45758,-204586],[0,1,-1,0,-40923,-129620],[1,0,0,0,-34720,108743],[0,1,1,0,-30383,104755],[2,0,0,-2,15327,10321],[0,0,1,2,-12528,0],[0,0,1,-2,10980,79661],[4,0,-1,0,10675,-34782],[0,0,3,0,10034,-23210],[4,0,-2,0,8548,-21636],[2,1,-1,0,-7888,24208],[2,1,0,0,-6766,30824],[1,0,-1,0,-5163,-8379],[1,1,0,0,4987,-16675],[2,-1,1,0,4036,-12831],[2,0,2,0,3994,-10445],[4,0,0,0,3861,-11650],[2,0,-3,0,3665,14403],[0,1,-2,0,-2689,-7003],[2,0,-1,2,-2602,0],[2,-1,-2,0,2390,10056],[1,0,1,0,-2348,6322],[2,-2,0,0,2236,-9884],[0,1,2,0,-2120,5751],[0,2,0,0,-2069,0],[2,-2,-1,0,2048,-4950],[2,0,1,-2,-1773,4130],[2,0,0,2,-1595,0],[4,-1,-1,0,1215,-3958],[0,0,2,2,-1110,0],[3,0,-1,0,-892,3258],[2,1,1,0,-810,2616],[4,-1,-2,0,759,-1897],[0,2,-1,0,-713,-2117],[2,2,-1,0,-700,2354],[2,1,-2,0,691,0],[2,-1,0,-2,596,0],[4,0,1,0,549,-1423],[0,0,4,0,537,-1117],[4,-1,0,0,520,-1571],[1,0,-2,0,-487,-1739],[2,1,0,-2,-399,0],[0,0,2,-2,-381,-4421],[1,1,1,0,351,0],[3,0,-2,0,-340,0],[4,0,-3,0,330,0],[2,-1,2,0,327,0],[0,2,1,0,-323,1165],[1,1,-1,0,299,0],[2,0,3,0,294,0],[2,0,-1,-2,0,8752]],V=[[0,0,0,1,5128122],[0,0,1,1,280602],[0,0,1,-1,277693],[2,0,0,-1,173237],[2,0,-1,1,55413],[2,0,-1,-1,46271],[2,0,0,1,32573],[0,0,2,1,17198],[2,0,1,-1,9266],[0,0,2,-1,8822],[2,-1,0,-1,8216],[2,0,-2,-1,4324],[2,0,1,1,4200],[2,1,0,-1,-3359],[2,-1,-1,1,2463],[2,-1,0,1,2211],[2,-1,-1,-1,2065],[0,1,-1,-1,-1870],[4,0,-1,-1,1828],[0,1,0,1,-1794],[0,0,0,3,-1749],[0,1,-1,1,-1565],[1,0,0,1,-1491],[0,1,1,1,-1475],[0,1,1,-1,-1410],[0,1,0,-1,-1344],[1,0,0,-1,-1335],[0,0,3,1,1107],[4,0,0,-1,1021],[4,0,-1,1,833],[0,0,1,-3,777],[4,0,-2,1,671],[2,0,0,-3,607],[2,0,2,-1,596],[2,-1,1,-1,491],[2,0,-2,1,-451],[0,0,3,-1,439],[2,0,2,1,422],[2,0,-3,-1,421],[2,1,-1,1,-366],[2,1,0,1,-351],[4,0,0,1,331],[2,-1,1,1,315],[2,-2,0,-1,302],[0,0,1,3,-283],[2,1,1,-1,-229],[1,1,0,-1,223],[1,1,0,1,223],[0,1,-2,-1,-220],[2,1,-1,-1,-220],[1,0,1,1,-185],[2,-1,-2,-1,181],[0,1,2,1,-177],[4,0,-2,-1,176],[4,-1,-1,-1,166],[1,0,1,-1,-164],[4,0,1,-1,132],[1,0,-1,-1,-119],[4,-1,0,-1,115],[2,-2,0,1,107]];function X(t,e){var i=this;i._settings=t,i._context=e,i._commentary=[[.008,"The Sun's closest neighbors mostly lie in the southern sky: Alpha and Beta Centauri and Proxima Centauri."],[.02,"Many of the Sun's nearest neighbors are not very bright: they are faint dwarf stars."],[.1,"The brightest stars in the sky are not necessarily the closest; many are distant, incredibly luminous giant stars."],[.35,"Beyond a few tens of parsecs, fewer stars are known, simply because most stars at these distances are too faint to see."],[.8,"Red dots are open clusters - not single stars, but loose groupings of up to a few dozen recently formed stars."],[1.2,"At kiloparsec scales, we no longer show individual stars at all, but only open clusters. Each red dot represents dozens of stars."],[2,"It is very apparent that open clusters are confined to the flat disk of our galaxy, the Milky Way."],[5,"Beyond 5 kpc, dust obscures open clusters from sight. We begin to see globular clusters (purple)."],[8,"The center of the Milky Way now comes into view (Sgr A). We draw a line connecting it to the Sun."],[15,"Globular clusters are groups of millions of stars. They are spherically distributed around the center of the Milky Way."],[20,"It is probable that we have not discovered most of the globular clusters on the far side of the Galactic Center."],[30,"Globular clusters may be the devoured remains of dwarf galaxies that collided with the Milky Way long ago."],[45,"The Milky Way is surrounded by a vast empty space. There may be tenuous dwarf galaxies still to be discovered here."],[80,"The Milky Way's close dwarf companion galaxies now come into view - the Small and Large Magellanic Clouds."],[100,"NGC 2419 is an enigmatic object - a vast distant globular cluster whose distance has long been debated."],[300,"Beyond the Magellanic Clouds is another vast and empty space before we reach the Milky Way's closest neighbor galaxies."],[450,"A really very large empty space... Don't worry, we're nearly there!"],[2e3,"At last, the Andromeda (M31) and Triangulum (M33) galaxies come into view. Together with the Milky Way they form the Local Group."],[7e3,"Other galaxies and groups of galaxies now come into view - M51 and M81/M82 among them."],[1200,"Gradually it becomes apparent that the galaxies appear to form two fan-shapes, with a 'plane of avoidance'."],[16e3,"This is not physical, but it is quite impossible to observe galaxies behind the plane of the Milky Way."],[3e4,"Now the Virgo Super-cluster comes into view. This is the largest big blue mass visible below."],[5e4,"Beyond the Virgo Super-cluster lie an even more vast sea of galaxies."]],i._matrix=new d,i._showKey=1,i._showLabels=1,i._mousedown=0,i._rotmode=0,i._rotstep=0,i._zoomdir=0,i._refresh=0,i._highlight=null,i._keyVisibility=1,i._captionVisibility=1,i._scale_min=.002,i._scale_max=5e4,i._scale_steps=400,this._itemsToLoad=2,$(".information_holder .close_button").click(function(){i._highlight=null,i._refresh=!0,$(".information_holder").hide()}),jQuery.getJSON(window.server+"json/ngc3d.json",function(t){i._typeNames=t.typeNames,i._typeColR=t.typeColR,i._typeColG=t.typeColG,i._typeColB=t.typeColB,i._objs=t.objs,i._typeNum={},jQuery.each(i._typeNames,function(t){var e=i._typeNames[t],t=parseInt(t);(!i._typeNum.hasOwnProperty(e)||t<i._typeNum[e])&&(i._typeNum[e]=t)}),i._setup_2()}),jQuery.getJSON(window.server+"json/constellations.json",function(t){i._conb=t.boundaries,i._conl=t.lines.simplified,i._conp=t.name_places,i._cona=t.abbrevs,i._conn=t.names,i._setup_2()})}function Z(t,e,i){this.objList=[],this.G=6673e-14,this.solarMass=1.98892e30,this.AU=149597870691,this._ARG_NAME=0,this._ARG_OBJTYPE=1,this._ARG_A=2,this._ARG_E=3,this._ARG_I=4,this._ARG_LONGAN=5,this._ARG_ARGPERI=6,this._ARG_MA=7,this._ARG_EPOCH=8,this._ARG_AMAG=9,this._ARG_SLOPE_N=10,this._ARG_SLOPE_G=11,this._ARG_RADIUS=12,this._ARG_ALBEDO=13,this._ARG_MOVING=14,this._ARG_RA=15,this._ARG_DEC=16,this._ARG_MAG=17,this._ARG_OBJID=18,this._ARG_EPOCHPERI=19,this._ARG_A_DOT=20,this._ARG_E_DOT=21,this._ARG_I_DOT=22,this._ARG_LONGAN_DOT=23,this._ARG_ARGPERI_DOT=24,this._ARG_MA_DOT=25,this._latitude=t,this._longitude=e,this._moonpos=!1;var s=this;jQuery.getJSON(window.server+"json/moonpos.json",function(t){s._moonpos=t,i(s)})}function Q(t,e){this._settings=t,this._context=e,this.ready=0,this.setup()}function K(t,e){this._settings=t,this._context=e,this._orrery_el=$("#"+this._settings.orreryId),this.ready=0,this._ore_setup()}function tt(){var t=$("#bannerppl")[0],e=$("#bannerfull")[0],i=window.pageYOffset;t.style.bottom=.4*-i+"px",e.style.bottom=.9*-i+"px"}function et(t,e){this._settings=t,this._context=e,this._width=1,this._height=1,this.ready=0,this._selectedTime=[];var i=this;this.monthNames=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this._tzOffset=new l(this._settings.tzOffset),this.scale=160,null!==this._settings.gotoScale&&(this.scale=this._settings.gotoScale),this._smax=178,this._smin=4,"hasTrack"in this._settings&&this._settings.hasTrack&&(this.scale=100),"zoomLevel"in this._settings&&(this.scale=this._settings.zoomLevel),$(".PLslider",i._context).length&&$(".PLslider",i._context).slider({min:0,max:200,value:this.scale,change:function(){i.scale=$(".PLslider",i._context).slider("value"),i._refresh=1},slide:function(){i.scale=$(".PLslider",i._context).slider("value"),i._refresh=1}}),$(".PLTDslider",i._context).length&&$(".PLTDslider",i._context).slider({min:0,max:100,value:10,change:function(){i._refresh=1},slide:function(){i._refresh=1}});e=$(".PLbuf0",this._context)[0];this._graphics_context_1=new zt(e,this._width,this._height);e=$(".PLbuf2",this._context)[0];this._graphics_context_2=new zt(e,this._width,this._height),this._utc_planets=0,this._refreshTime=0,this._extras=[],"objId"in this&&0<this.objId&&(this._extras=[this.objId]),this._extraIcons=[],this.mousedown=0,this._mousex=-999,this._mousey=-999,this._refresh=0,this._lock=0,this._animate_time=$(".toolbar_button_ffwd",this._context).hasClass("active"),this._freeze_time=$(".toolbar_button_pause",this._context).hasClass("active"),this._itemsToLoad=4,i._stars={},i._dsos={},i._stars_tiles=[],jQuery.getJSON(window.server+"json/objects_0_00_00.json",function(t){i._stars["0_00_00"]=t.stars,i._dsos["0_00_00"]=t.dsos,i._typename=t.typeNames,i._stars_tiles=t.tiles,i._setup_2()}),jQuery.getJSON(window.server+"json/constellations.json",function(t){i._conb=t.boundaries,i._conl=t.lines,i._conp=t.name_places,i._cona=t.abbrevs,i._conn=t.names,i._setup_2()});var s=new Image;s.onload=function(){var t=document.createElement("canvas");t.width=s.width,t.height=s.height,t.getContext("2d").drawImage(s,0,0,s.width,s.height),i._milkyWay=t.getContext("2d").getImageData(0,0,s.width,s.height).data,i._milkyWay_width=s.width,i._milkyWay_height=s.height,i._setup_2()},s.src=window.server+"images/galaxymap.png",this._objectCalc=new Z(this._settings.lat,this._settings.lng,function(t){(i._objectCalc=t)._setObjList(i._extras,1,function(){i._setup_2()})})}function it(t){this._parent=t,this._target=$(".planets_div_target",t),this._settings=t.data("meta"),this._tzOffset=new l(this._settings.tzOffset)}function at(){$(".planets_div").each(function(t,e){var e=$(e),i=new it(e);e.data("handler",i),$("select",e).change(function(){i._refresh()})})}function ot(t,e){var i=this;i._settings=t,i._context=e,i._tzOffset=new l(i._settings.tzOffset);var s=i._settings,t=parseInt(s.yearmax)+1,e=parseInt(s.yearmin);$(".RSslider",i._context).slider({min:0,max:400,value:400*(parseInt(s.year)+.35-e)/(t-e),change:function(){i._refresh=1},slide:function(){i._refresh=1}}),i._tmin=be._calendar_to_unix(s.yearmin,1,1,0,0,0),i._tmax=be._calendar_to_unix(s.yearmax,1,1,0,0,0),i._frame=1,i.mousedown=0,i._refresh=0,jQuery.getJSON(window.server+"json/riseset.json",function(t){i._riseset=t,$(".RSload",i._context).css("display","none"),i._hideInstruct=1,setTimeout(function(){i._rs_hideinstruct()},5e3);t=$(".RSfore",i._context);t.mousedown(function(t){i._rs_mouseDown(t)}),t.mouseup(function(t){i._rs_mouseUp(t)}),t.mousemove(function(t){i._rs_mouseDrag(t)}),t.mouseleave(function(){i._rs_mouseUp(0)}),t.on({touchstart:function(t){t.preventDefault(),i._rs_mouseDown(t.originalEvent.touches[0])},touchend:function(t){t.preventDefault(),i._rs_mouseUp(0)},touchmove:function(t){t.preventDefault(),i._rs_mouseDrag(t.originalEvent.touches[0])},touchcancel:function(t){t.preventDefault(),i._rs_mouseUp(0)}}),$("input",i._context).on("click",function(){i._refresh=1}),$(".uselocaltime",i._context).on("click",function(){i._rs_drawGraphAxes(),i._rs_draw()}),$(".useutc",i._context).on("click",function(){i._rs_drawGraphAxes(),i._rs_draw()}),i._rs_resize(),$(window).resize(function(){i._rs_resize()}),setInterval(function(){i._rs_updateAlarm()},300)})}function nt(t,e){var i=this;i._settings=t,i._context=e,i._monthNames=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i._userlat=t.latitude,i._userlong=t.longitude,i._tzOffset=new l(t.tzOffset),i._lock=0,i._magMin=parseInt($(".mag").val())+.05,i._calc_sp=null,i._gotoSelectedTime();var s=null;t.searchByNorad&&(s=t.searchByNorad=Ie(t.searchByNorad));e=t.searchGroupId||null;i._calc_sp=new rt(t.latitude,t.longitude,100<i._magMin,!0,i._sp_time,e,s),i._initialised=!1,setInterval(function(){i._updateAlarm()},100)}function ht(t,e){var i=this;this._context=e,this._settings=t,this._tzOffset=new l(t.tzOffset);var s=t.satId,a=parseFloat(t.utc1),o=parseFloat(t.utc3);this._utc_midpoint=(a+o)/2,this._calc_sp=new rt(t.latitude,t.longitude,!0,!0,this._utc_midpoint,null,s),this._planetarium_el=$("#"+t.planetarium_id);var n=this._calc_sp;n._gotoUtc_mode1(a,1);for(var h=[],r=0;r<100;r++){var _=a+(o-a)/100*r;n._gotoUtc_mode1(_,0),n._calcPos(s)&&h.push([12*n.ra/Math.PI,180*n.dec/Math.PI,_])}this._track=h,this._refresh=!0,setInterval(function(){i._pageRefresh()},300),setInterval(function(){i._refresh=!0},1e4)}function rt(t,e,i,s,a,o,n){var h=this;this._userlat=parseFloat(t),this._userlong=parseFloat(e),this._inc_faint=i,this._inc_non_groups=s,this._filter_group=o,this._filter_noradId=n,this._spacecraft_lookup=null,this._epochUpdateHook=function(){};a=window.server+"json/satlist.php?inc_non_groups=1&epoch="+a+(h._inc_faint?"&inc_faint=1":"")+(h._filter_group?"&group="+h._filter_group:"")+(h._filter_noradId?"&id="+h._filter_noradId:"");$.ajax({async:!1,type:"GET",dataType:"json",url:a,success:function(t){h._spacecraft=t.spacecraft,h._groups=t.groups,h._subgroups=t.subgroups,h._groupMembers=t.groupMembers,h._owners=t.owners,h._sites=t.sites,h._fates=t.fates,h._parents=t.parents,h._statuses=t.statuses,h._spacecraft_lookup={},$.each(h._spacecraft,function(t,e){e[0]=Ie(e[0]),h._spacecraft_lookup[e[0]]=t}),h._noradIds=[],$.each(h._spacecraft,function(t,e){e[0]=Ie(e[0]),h._noradIds.push(e[0])}),h._names=[],$.each(t.names,function(t,e){var i=Ie(e[0]);h._spacecraft_lookup.hasOwnProperty(i)&&h._names.push([i,e[1]])})}}),this._epoch=0,this._elements_fetched=0,this._mode2_noradId=0,this._elements=[]}function _t(t,e,i,s,a,o,n,h){var r=this;r._settings=t,r._context=e,r._client=i,r._monthNames=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r._cpu_time_warning=!1,r._lock=1,r._calc=new rt(t.latitude,t.longitude,s,a,o,n,h),r._sliderTimeSteps=100,r._sliderTimeSpan=2700,r._tzOffset=new l(t.tzOffset),r._changeColSatBy(),r._satAutocompleteInit(),$(".Tslider",r._context).slider({min:-r._sliderTimeSteps,max:r._sliderTimeSteps,value:0,change:function(){r._sliderChange()},slide:function(){r._sliderChange()}}),r._image1size=30,r._image1gap=34,r._image2size=24,r._image2gap=28,r._image3size=18,r._image3gap=22,r._itemsStillToLoad=3,r._image1=new Image,r._image1.src=window.server+"images/satellite.png",r._image1.onload=function(){r._setup2()},r._image2=new Image,r._image2.src=window.server+"images/satellite2.png",r._image2.onload=function(){r._setup2()},r._image3=new Image,r._image3.src=window.server+"images/satellite3.png",r._image3.onload=function(){r._setup2()}}function lt(t,e){var i=this;i._settings=t,i._context=e,i._core=new _t(t,e,i,!0,!1,Date.now()/1e3,null,null),i._lock=0,i._highlightItem=null,this._resize(),$(window).resize(function(){i._resize()}),i.initGlobeView(),$(".mapsearch",i._context).submit(function(){i._do_search()}),$(".information_holder .close_button").click(function(){i._highlightItem=null,$(".information_holder").hide(),i._core._refresh=2}),setInterval(function(){i._core._updateAlarm()},300)}function ct(t,e){var i=this;i._settings=t,i._context=e,i._planetarium_el=$("#"+t.planetarium_id),i._core=new _t(t,e,i,!0,!1,Date.now()/1e3,null,null),i._lock=0,i._calc_is_setup=!1,setInterval(function(){i._core._updateAlarm()},300)}function pt(t,e){var i=this;i._settings=t,i._context=e,i._core=new _t(t,e,i,!0,!1,Date.now()/1e3,null,null),i._lock=0,i._highlightItem=null,i._highlightItemNames=[],this._resize(),$(window).resize(function(){i._resize()}),i._initRadarView(),$(".chk",i._context).on({click:function(){i._initRadarView(),i._core._refresh=2},change:function(){i._initRadarView(),i._core._refresh=2}}),$(".information_holder .close_button").click(function(){i._highlightItem=null,i._core._refresh=2,$(".information_holder").hide()}),setInterval(function(){i._core._updateAlarm()},300)}function dt(t,e){var i=this;i._settings=t,i._context=e,i._satelliteIcons=null,i._map=null,i._core=new _t(t,e,i,!0,!1,Date.now()/1e3,null,null),i._lock=0,i._highlightItem=null,i._highlightItemNames=[],"gotoSat"in t&&($(".mapsearchbox",i._context).val(t.gotoSat),i._do_search()),$(".mapsearch",i._context).submit(function(){i._do_search()}),$(".information_holder .close_button").click(function(){i._highlightItem=null,i._core._refresh=2,$(".information_holder").hide()}),setInterval(function(){null===i._map&&i.initWorldMap(),i._core._updateAlarm()},300)}function ut(t){var e=this;this._context=t,this.header=$(".scrolltable_thead",t),this.body=$(".scrolltable_tbody",t),this.body_cols=$("td",$($("tbody tr",this.body)[0])),this._refresh(),$(window).resize(function(){e._refresh()}),$(window).scroll(function(){e.scroll()}),this._context.scroll(function(){e.scroll_table()})}function ft(){$(".scrolltable").each(function(t,e){var i=$(e),e=new ut(i);i.data("handler",e)})}function gt(t,e,i,s,a){this._context=t,this.buttons=e,this.panes=i,this.host=s,this.len=e.length,this.paneChangeHook=function(){};for(var o=0;o<this.len;o++)$(e[o],this._context).click(this._gotoPane(this,o));this.activeCanvas=a}function mt(t){var e;this.parent=t,this.children=$(".slidingPane_item",t),this.number=this.children.length,this.current=0,this.auto=!0,setInterval((e=this,function(){e._alarm()}),8e3)}function vt(){$(".slidingPane").each(function(t,e){var e=$(e),i=new mt(e);e.data("handler",i),$(".slidingPane_prev",e).click(function(){i.prev()}),$(".slidingPane_next",e).click(function(){i.next()})})}function xt(t,e){var i=this;this._settings=t,this._context=e,this.ra_a=this.ra_c=this.ra_d=0,this.dec_a=this.dec_c=this.dec_d=0,"june"===this._settings.month?(this.ra_a=Math.PI/2,this.ra_c=.018148302,this.ra_d=-108485613e-14,this.dec_a=.40904574,this.dec_d=-600627335e-13):"september"===this._settings.month?(this.ra_a=Math.PI,this.ra_c=.015677433,this.ra_d=378886161e-14,this.dec_c=-.0067853865,this.dec_d=-170906551e-14):"december"===this._settings.month?(this.ra_a=3*Math.PI/2,this.ra_c=.019361059,this.ra_d=7.30409964e-7,this.dec_a=-.40904819,this.dec_d=68415144e-12):"march"===this._settings.month&&(this.ra_a=0,this.ra_c=.015677433,this.ra_d=378886161e-14,this.dec_c=.0068895738,this.dec_d=-211091673e-14),setInterval(function(){i._update()},100)}function yt(t,e){var s=this;this._settings=t,this._context=e,this._width=$(e).width(),this._tzOffset=new l(t.tzOffset),s._time_points=[],s._graph_data_a=[],s._graph_data_i=[],s._graph_data_e=[],$.each(t.data,function(t,e){var i=parseFloat(e.utc);i+=s._tzOffset.offset(i),s._time_points.push(i),s._graph_data_a.push([i,parseFloat(e.a)]),s._graph_data_e.push([i,parseFloat(e.e)]),s._graph_data_i.push([i,parseFloat(e.i)])});var i=s._settings.dark?new Ft(.8,.8,.8,1):new Ft(.2,.2,.2,1),a=s._settings.dark?new Ft(.3,.3,.3,1):new Ft(.8,.8,.8,1),o=s._time_points.length,n=s._time_points[0],e=s._time_points[o-1],t=s._width-120,o=-.25*t-52;new Ot({Eccentricity:new Ht([new Et("Eccentricity",{},s._graph_data_e,null)],{interactiveMode:"pan",width:t,aspect:.25,axesColor:i,gridMajorColor:a,gridMinorColor:a,origin:[0,0*o],x1_axis:{scrollMin:n,scrollMax:e,scrollEnabled:!0,zoomEnabled:!0,min:Math.max(n,e-94608e3),max:e,dataType:"timestamp"},y1_axis:{label:"Eccentricity"}}),Inclination:new Ht([new Et("Inclination",{},s._graph_data_i,null)],{width:t,aspect:.25,axesColor:i,gridMajorColor:a,gridMinorColor:a,origin:[0,o],x1_axis:{linkTo:["Eccentricity","x1"],dataType:"timestamp"},y1_axis:{label:"Inclination (°)"}}),"Mean altitude":new Ht([new Et("Mean altitude",{},s._graph_data_a,null)],{width:t,aspect:.25,axesColor:i,gridMajorColor:a,gridMinorColor:a,origin:[0,2*o],x1_axis:{linkTo:["Eccentricity","x1"],dataType:"timestamp"},y1_axis:{label:"Mean altitude (km)"}})},{}).renderToCanvas($(".chart_div",s._context)[0])}function wt(t,e){var i=this;this._settings=t,this._context=e,this._unixtime=t.utc;var s={start:0,step_size:86400,tzOffset:[[0,0,"UTC"]]};this._tzOffset_in=new l(s),this._longitude_in=parseFloat(t.longitude),this._tzOffset_out=new l(s),this._longitude_out=parseFloat(t.longitude),this._year_selected_in=0,this._year_selected_out=0,this._awaiting_input_tz=!1,this._awaiting_output_tz=!1,$(".in-town-name, .out-town-name",this._context).val(t.placename),$(".in-date select, .in-date input, .in-timestamp input",e).on("change",function(){i._new_time()}),i._new_in_system(),$(".in-system select",e).on("change",function(){i._new_in_system()}),i._new_out_system(),$(".out-system select",e).on("change",function(){i._new_out_system()}),$(".in-town-id",e).on("change",function(){i._new_in_location(i._year_selected_in,!1)}),$(".out-town-id",e).on("change",function(){i._new_out_location(i._year_selected_out)})}function Mt(t,e){var i=this;i._settings=t,i._context=e,i._tzOffset=new l(t.tzOffset),i._refresh=1,i._markerWidth=10,i._markers={},i._cities=[],i._dayoffset=0;$(".dateslide",i._context).width(380),$(".slider",i._context).css("top",26).css("left",8),i._date_margin=8,i._date_width=380,i._date_width2=364,i._colors=["pink","red","orange","yellow","#00ff00","cyan","blue","#ff00ff"],this._doKey(),$(".slider",i._context).slider({min:-60,max:60,value:0,change:function(){i._dayoffset=$(".slider",i._context).slider("value"),i._refresh=1},slide:function(){i._dayoffset=$(".slider",i._context).slider("value"),i._refresh=1}}),i._map=null,jQuery.getJSON(window.server+"json/tzmap.json",function(t){i._cities=t.cities,i._timezones=t.timezones,i._initMarkers(),$("select",i._context).on("change",function(){i._gotoSelectedTime()}),$(".goto_now",i._context).on("click",function(){i._gotoNow()}),$(".day_prev",i._context).on("click",function(){i._gotoUtcTime(i._utc_centre-2592e3)}),$(".day_next",i._context).on("click",function(){i._gotoUtcTime(i._utc_centre+2592e3)}),$(".toggle_anim",i._context).on("click",function(){i._animate=!i._animate,$(".toggle_anim",i._context).val(i._animate?"Stop":"Animate"),i._gotoUtcTime(i._utc_centre+2592e3)}),i._gotoSelectedTime(),i._animate=!1,i._animateCounter=0,setInterval(function(){i._updateAlarm()},100)})}function kt(t,e){var i=this;i._settings=t,i._context=e,i._tzOffset=new l(t.tzOffset),i._alarmCounter=0,i._sliderUpdateCountdown=100,i._refresh=!0,i._sliderTimeSteps=100,i._sliderTimeSpan=10800,i._sliderDateSteps=75,i._sliderDateSpan=86400*i._sliderDateSteps,this._utc_offset_time=0,this._utc_offset_date=0,$(".Tslider",this._context).slider({min:-i._sliderTimeSteps,max:i._sliderTimeSteps,value:0,change:function(){i._sliderChange()},slide:function(){i._sliderChange()}}),$(".Tslider2",this._context).slider({min:-i._sliderDateSteps,max:i._sliderDateSteps,value:0,change:function(){i._sliderChange()},slide:function(){i._sliderChange()}}),i._zones=[[1,0,"rgba(0,0,0,0.2)","#C0C000","Civil twilight",!1,!1],[6,0,"rgba(0,0,0,0.12)","#C0C000","Nautical twilight",!1,!1],[12,0,"rgba(0,0,0,0.12)","#C0C000","Astronomical twilight",!1,!1],[18,.35,"rgba(0,0,0,0.1)","#C0C000","Night time",!1,!1]],i._map=null,$("select",this._context).on("change",function(){i._gotoSelectedTime()}),$(".goto_now",this._context).on("click",function(){i._gotoNow()}),i._settings.displayNow?i._gotoNow():i._gotoSelectedTime(),i._sliderLabel(),setInterval(function(){i._updateAlarm()},300)}function bt(t,e){var h=this;this._settings=t,this._context=e,this._width=$(e).width(),this._tzOffset=new l(t.tzOffset),this._url=window.server+"json/weather.php?longitude="+t.longitude+"&latitude="+t.latitude,$.getJSON(this._url,function(t){var e=(h._graph_data_raw=t).init,i=parseInt(e.slice(0,4)),s=parseInt(e.slice(4,6)),a=parseInt(e.slice(6,8)),o=parseInt(e.slice(8,10));h._utc0=be._calendar_to_unix(i,s,a,o,0,0),h._utc0+=h._tzOffset.offset(h._utc0),h._time_points=[],h._data_transparency=[],h._data_seeing=[],h._data_lifted_index=[],h._data_humidity=[],h._data_temperature=[],h._data_cloud_cover=[];var n=[0,.5,.625,.875,1.125,1.375,1.75,2.25,2.5];$.each(t.dataseries,function(t,e){var i=h._utc0+3600*parseFloat(e.timepoint);h._time_points.push(i),h._data_transparency.push([i,114.2857-14.2857*parseFloat(e.transparency)]),h._data_seeing.push([i,n[parseInt(e.seeing)]]),h._data_lifted_index.push([i,parseFloat(e.lifted_index)]),h._data_humidity.push([i,5*(parseFloat(e.rh2m)+4)]),h._data_temperature.push([i,parseFloat(e.temp2m)]),h._data_cloud_cover.push([i,12.5*(parseFloat(e.cloudcover)-1)])});e=h._settings.dark?new Ft(.8,.8,.8,1):new Ft(.2,.2,.2,1),i=h._settings.dark?new Ft(.3,.3,.3,1):new Ft(.8,.8,.8,1),s=h._time_points.length,a=h._time_points[0],o=h._time_points[s-1],t=h._width-120,s=-.25*t-52;new Ot({Temperature:new Ht([new Et("Temperature",{plotStyle:"linespoints"},h._data_temperature,null)],{width:t,aspect:.25,axesColor:e,gridMajorColor:i,gridMinorColor:i,origin:[0,0*s],x1_axis:{min:a,max:o,dataType:"timestamp"},y1_axis:{label:"Temperature (°C)",ticks:{tickMin:-100,tickMax:100,tickStep:2},ticksMinor:{tickMin:-100,tickMax:100,tickStep:1}}}),Humidity:new Ht([new Et("Humidity",{plotStyle:"linespoints"},h._data_humidity,null)],{width:t,aspect:.25,axesColor:e,gridMajorColor:i,gridMinorColor:i,origin:[0,s],x1_axis:{min:a,max:o,dataType:"timestamp"},y1_axis:{label:"Humidity (%)",min:-5,max:105,ticks:{tickMin:0,tickMax:100,tickStep:20}}}),Transparency:new Ht([new Et("Transparency",{plotStyle:"linespoints"},h._data_transparency,null)],{width:t,aspect:.25,axesColor:e,gridMajorColor:i,gridMinorColor:i,origin:[0,2*s],x1_axis:{min:a,max:o,dataType:"timestamp"},y1_axis:{label:"Transparency (%)",min:-5,max:105,ticks:{tickMin:0,tickMax:100,tickStep:20}}}),Seeing:new Ht([new Et("Seeing",{plotStyle:"linespoints"},h._data_seeing,null)],{width:t,aspect:.25,axesColor:e,gridMajorColor:i,gridMinorColor:i,origin:[0,3*s],x1_axis:{min:a,max:o,dataType:"timestamp"},y1_axis:{label:"Seeing (arcsec)",min:0,max:2.5,ticks:{tickMin:0,tickMax:3,tickStep:.5}}}),Cloud_cover:new Ht([new Et("Cloud cover",{plotStyle:"linespoints"},h._data_cloud_cover,null)],{width:t,aspect:.25,axesColor:e,gridMajorColor:i,gridMinorColor:i,origin:[0,4*s],x1_axis:{min:a,max:o,dataType:"timestamp"},y1_axis:{label:"Cloud cover (%)",min:-5,max:105,ticks:{tickMin:0,tickMax:100,tickStep:20}}})},{allow_export_csv:!0}).renderToCanvas($(".chart_holder",h._context)[0])})}function Pt(t,e){var i=this;this._settings=t,this._context=e,this._tzOffset=new l(t.tzOffset),t=$(".p0_buf",this._context)[0],this._graphics_context_0=new zt(t,1,1),t=$(".p1_buf",this._context)[0],this._graphics_context_1=new zt(t,1,1),t=$(".p2_buf",this._context)[0],this._graphics_context_2=new zt(t,1,1),t=$(".p3_buf",this._context)[0],this._graphics_context_3=new zt(t,1,1),t=$(".p4_buf",this._context)[0],this._graphics_context_4=new zt(t,1,1),$.getJSON(window.server+"json/nebulalist.php",function(t){i.nebData=t,i._setup2()})}function It(t,e){this._settings=t,this._context=e,this._planetarium_el=$("#"+this._settings.planetarium_id),this._tzOffset=new l(t.tzOffset),this._setup2()}function $t(t,e){this._settings=t,this._context=e,this._tzOffset=new l(t.tzOffset),this._setup2()}function Pe(t){return t<10?"0"+t:""+t}function St(t,e){var i="text/plain";t.endsWith(".svg")&&(i="image/svg+xml"),t.endsWith(".csv")&&(i="text/csv");e=new Blob([e],{type:i});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveBlob(e,t):((i=window.document.createElement("a")).href=window.URL.createObjectURL(e),i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i))}function Tt(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(0<e)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(0<t.indexOf("Trident/")){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}i=t.indexOf("Edge/");return 0<i&&parseInt(t.substring(i+5,t.indexOf(".",i)),10)}function Ie(t){return~~t}function At(t,e){e=e.offset();return[t.pageX-e.left,t.pageY-e.top]}function zt(t,e,i){this._ca=t,this._collision_map=new Ct,this._resize(e,i)}function Ct(){this._reset()}function Rt(t,e){this._ca=document.createElement("canvas"),this._collision_map=new Ct,this._resize(t,e)}function jt(t){this.page=null,this.itemType="arrow",this.z_index=0,this.arrowType="single",this.color=new Ft(0,0,0,1),this.strokeLineWidth=1,this.origin=[0,0],this.target=[0,0],this.configure(t),this.cleanWorkspace()}function Dt(t,e,i,s){this.graph=t,this.axis_name=e,this.atZero=!1,this.enabled=i,this.visible=!0,this.linkTo=null,this.rangeReversed=!1,this.arrowType="none",this.logarithmic=!1,this.min=null,this.max=null,this.data_type="numeric",this.scrollEnabled=!1,this.scrollMin=null,this.scrollMax=null,this.scrollSpan=null,this.zoomEnabled=!1,this.mirror=!1,this.tickLabelRotation=0,this.labelRotate=0,this.ticking_allocator=null,this.label=null,this.showLabels=!0,this.ticksMinor=new Nt({}),this.ticks=new Nt({}),this.configure(s),this.cleanWorkspace()}function Nt(t){this.ticDir=null,this.tickMin=null,this.tickMax=null,this.tickStep=null,this.tickList=null,this.configure(t)}function Ot(t,e){var i=this;this.itemList=t,this.settings={},this.settings.allow_export_png=!0,this.settings.allow_export_svg=!0,this.settings.allow_export_csv=!1,this.constants={},this.constants.DEFAULT_LINEWIDTH=.566929,this.constants.DEFAULT_PS=3,this.constants.ARROW_ANGLE=45*Math.PI/180,this.constants.ARROW_CONSTRICT=.2,this.constants.ARROW_HEADSIZE=6,this.constants.AXES_LINEWIDTH=2.5,this.constants.AXES_MAJTICKLEN=8,this.constants.AXES_MINTICKLEN=4,this.constants.AXES_SEPARATION=.008,this.constants.AXES_TEXTGAP=6,this.constants.AXES_LABELGAP=34,this.constants.COLORSCALE_MARG=.003,this.constants.COLORSCALE_WIDTH=.004,this.constants.GRID_MAJLINEWIDTH=.8,this.constants.GRID_MINLINEWIDTH=.5,this.configure(e),this.styling=new Xt(this),this.page_width=1024,this.html_initialised=!1,this.workspace={},this.workspace.errorLog="",this.interactive_holder_element=null,this.interactive_canvas_element=null,this.is_pinching=!1,this.pinch_distance=0,this.mousedown=!1,this.pos_start=[0,0],this.pos_latest=[0,0],this.needs_refresh=!1,this.canvas=null,this.threeDimensionalBuffer=null,setInterval(function(){i.needs_refresh&&null!==i.interactive_holder_element&&(i.renderToCanvas(i.interactive_holder_element),i.needs_refresh=!1)},100)}function Lt(t){this.page=null,this.itemType="circle",this.z_index=0,this.strokeColor=new Ft(0,0,0,1),this.fillColor=new Ft(.6,.6,.6,1),this.strokeLineWidth=1,this.origin=[0,0],this.radius=50,this.configure(t),this.cleanWorkspace()}function Ft(t,e,i,s){this.red=t,this.green=e,this.blue=i,this.alpha=s}function Et(t,e,i,s){this.title=t,this.style=new qt(e),this.axes={1:"x1",2:"y1",3:"z1"},this.data=i,this.update_callback=s,this.cleanWorkspace()}function Wt(){}function Ut(t,e,i){this.title=t,this.styling=e,this.functions=i}function Ht(t,e){this.page=null,this.itemType="graph",this.z_index=0,this.aspect=null,this.aspectZ=1,this.axesColor=new Ft(0,0,0,1),this.gridMajorColor=new Ft(.8,.8,.8,1),this.gridMinorColor=new Ft(.8,.8,.8,1),this.textColor=new Ft(0,0,0,1),this.clip=!0,this.key=!0,this.keyColumns=null,this.keyPosition="tr",this.bar=1,this.fontSize=1,this.gridAxes=["x1","y1","z1"],this.boxFrom=null,this.boxWidth=null,this.keyOffset=[0,0],this.origin=[0,0],this.titleOffset=[0,0],this.width=null,this.viewAngleXY=60,this.viewAngleYZ=30,this.title=null,this.threeDimensional=!1,this.interactiveMode="none",this.axes={x1:new Dt(this,"x1",!0,{}),x2:new Dt(this,"x2",!1,{}),y1:new Dt(this,"y1",!0,{}),y2:new Dt(this,"y2",!1,{}),z1:new Dt(this,"z1",!0,{}),z2:new Dt(this,"z2",!1,{})},this.dataSets=t,this.annotations=[],this.configure(e),this.cleanWorkspace()}function Gt(t,e,i,s,a,o,n,h){this.page=t,this.graph=e,this.color=o,this.line_type=n,this.line_width=h,this.axis_x=i,this.axis_y=s,this.axis_z=a,this.pt_old=null,this.line_list=[],this.point_list_in_progress=[]}function Bt(t){this.itemType="text",this.z_index=0,this.text="Hello world",this.color=new Ft(0,0,0,1),this.fontSize=13,this.fontFamily="Arial,Helvetica,sans-serif",this.fontWeight="",this.fontStyle="",this.position=[0,0],this.axis_x=null,this.axis_y=null,this.axis_z=null,this.h_align="center",this.v_align="center",this.configure(t)}function Jt(t){this.itemType="arrow",this.z_index=0,this.arrowType="single",this.color=new Ft(0,0,0,1),this.strokeLineWidth=1,this.origin=[0,0],this.target=[0,0],this.axis_x=null,this.axis_y=null,this.axis_z=null,this.configure(t)}function qt(t){this.color=null,this.fillColor=new Ft(0,0,0,0),this.plotStyle="lines",this.lineType=null,this.pointType=null,this.lineWidth=2,this.pointLineWidth=1,this.pointSize=1,this.configure(t)}function Yt(t,e){this.page=t,this.graph=e}function Vt(t){this.page=null,this.itemType="rectangle",this.z_index=0,this.strokeColor=new Ft(0,0,0,1),this.fillColor=new Ft(.6,.6,.6,1),this.strokeLineWidth=1,this.origin=[0,0],this.width=50,this.height=50,this.configure(t),this.cleanWorkspace()}function Xt(t){this.page=t,this.defaultColors=this.getDefaultColors(),this.pointTypes=this.getPointTypes()}function Zt(t){this.page=null,this.itemType="text",this.z_index=0,this.text="Hello world",this.color=new Ft(0,0,0,1),this.fontSize=13,this.fontFamily="Arial,Helvetica,sans-serif",this.fontWeight="",this.fontStyle="",this.origin=[0,0],this.h_align="center",this.v_align="center",this.configure(t),this.cleanWorkspace()}function Qt(){this.reset()}function Kt(t){this.axis=t,this.max_allowed_ticks=256}function te(t){this.axis=t}function ee(t){this.axis=t,this.max_allowed_ticks=256,this.acceptable_intervals=[1,2,5,10,20,30,60,120,300,600,900,1800,3600,7200,10800,14400,21600,43200,86400,172800,259200,345600,604800]}X.prototype._setup_2=function(){var t,i=this;--this._itemsToLoad,0<this._itemsToLoad||($(".NGCload",i._context).css("display","none"),i._objs.unshift([0,0,0,17.761124*Math.PI/12,-29.00775*Math.PI/180,7.94,i._typeNum["Sgr A*"],"SgrA"]),$(".slider",i._context).slider({min:0,max:i._scale_steps,value:35,change:function(){i._changeZoomLevel()},slide:function(){i._changeZoomLevel()}}),i._changeZoomLevel(),$(".mag-limit",i._context).change(function(){i._changeZoomLevel()}),$(".background-decoration",i._context).change(function(){i._refresh=1}),t=$(".buff",i._context),i._hoverman=new I(t,!1,!1,function(t){i._hoverClick(t)},!1),i._hovermankeys={},i._hovermannextkey=1,i._hoverTextCache={},i._resize(),$(window).resize(function(){i._resize()}),$(".search_box_form").on("submit",function(){i._go_search()}),i._hideInstruct=1,setTimeout(function(){i._ngc_hideinstruct()},5e3),t.mousedown(function(t){i._mouseDown(t)}),t.mouseup(function(t){i._mouseUp(t)}),t.mousemove(function(t){i._mouseDrag(t)}),t.mouseleave(function(){i._mouseUp(0)}),i._is_pinching=!1,i._pinch_distance=0,t.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(i._is_pinching=!1,i._mouseDown(t.touches[0])):2===t.touches.length&&(i._is_pinching=!0,i._pinch_distance=i.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),i._is_pinching||i._mouseUp(0),i._is_pinching=!1,i._mousedown=0},touchmove:function(t){t.preventDefault();var e=t.originalEvent;i._is_pinching?(t=i.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),25<Math.abs(t-i._pinch_distance)&&(i._displaywheel(e.touches[0],i._pinch_distance-t),i._pinch_distance=t)):i._mouseDrag(e.touches[0])},touchcancel:function(t){t.preventDefault(),i._is_pinching||i._mouseUp(0),i._is_pinching=!1,i._mousedown=0}}),$("input",i._context).click(function(){i._changeZoomLevel(),i._drawMap(),i._updateKey()}),$(".btn-zoom-level",i._context).click(function(){$(".slider",i._context).slider("value",$(".zoom-level",i._context).val())}),$(".zoom-wide",i._context).click(function(){$(".sl",i._context).prop("checked",!1),$(".sk",i._context).prop("checked",!1)}),t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",$(".buff",i._context).bind(t,function(t){i._displaywheel(t.originalEvent)}),i._settings.initSearch&&i._go_search(),setInterval(function(){i._updateAlarm()},200))},X.prototype._changeZoomLevel=function(){var t,e,i=this,s=[],a=this._objs,o=a.length,n=this._typeNum["The Sun"],h=this._typeNum["Sgr A*"],r=0,_=0;this._brightestObj=null,this._brightestObj15=null;var l=$(".mag-limit",this._context).val(),c=$(".slider",this._context).slider("value");for(this._scale=this._scale_min*Math.exp(c/this._scale_steps*Math.log(this._scale_max/this._scale_min)),t=0;t<o;t++)if((e=a[t])[6]===n||!(e[5]>this._scale||e[5]<.03*this._scale)){var p=e[2],d=i._highlight&&i._highlight===p;if(!d){if(500<s.length)continue;if(l<30&&e[1]>l)continue}var u=e[7];u&&r++,p&&_++,d||(30<r&&(u=0),150<_&&(p=0));p=[e[5],e[3],e[4],e[6],e[5],u,t,e[0],p,e[8]];s.push(p),null===this._brightestObj&&e[6]!==h&&e[6]!==n&&(this._brightestObj=e[0]),15<s.length&&null===this._brightestObj15&&e[6]!==h&&e[6]!==n&&(this._brightestObj15=e[0])}this._absMagReference=Math.min(this._brightestObj,this._brightestObj15-3);var f,c=$(".ngc_caption",this._context);$(".sc",this._context).prop("checked")?(this._captionVisibility||c.slideDown(),this._captionVisibility=1,f="",jQuery.each(this._commentary,function(t,e){!f&&i._scale<e[0]&&(f=e[1])}),$(".ngc_caption",this._context).text(f)):(this._captionVisibility&&c.slideUp(),this._captionVisibility=0),this._objectsVisible=s,this._refresh=1},X.prototype._project=function(t,e,i){var s=this._matrix._m,a=this._radius*t/this._scale,t=a*Math.sin(e)*Math.cos(i),e=a*Math.cos(e)*Math.cos(i),i=a*Math.sin(i);return[this._ox+t*s[0][0]+e*s[0][1]+i*s[0][2],this._oy+t*s[1][0]+e*s[1][1]+i*s[1][2],t*s[2][0]+e*s[2][1]+i*s[2][2]]},X.prototype._drawMap=function(){var t,e,i,s,a=this,o=this._typeColR,n=this._typeColG,h=this._typeColB;this._hoverman.reset(),this._hovermankeys={},this._hovermannextkey=1;var r=Math.pow(10,Math.floor(Math.log(this._scale/2)/Math.log(10))),_=Math.floor(this._scale/2/r)*r,l="",l=_<1?Math.floor(1e3*_)+" pc":_<1e3?Math.floor(_)+" kpc":Math.floor(_/1e3)+" Mpc",c=$(".buf0",a._context)[0];c.width=a._width,c.height=a._height;var p=c.getContext("2d");this._ox=a._width/2,this._oy=a._height/2;var d=Math.min(56,10+.08*this._width);this._radius=(this._width-d)/2,a._showLabels=$(".sl",a._context).prop("checked"),a._showKey=$(".sk",a._context).prop("checked"),a._showGrid=Ie($(".background-decoration",a._context).val());var u=((this._height-6)/2+(this._height-d)/2)/2;p.strokeStyle="#d0d0a0",p.lineWidth=(d-6)/2,p.beginPath(),p.arc(this._ox,this._oy,u,0,2*Math.PI,!1),p.stroke(),p.strokeStyle="#404040",p.lineWidth=1,p.beginPath(),p.arc(this._ox,this._oy,(this._height-6)/2,0,2*Math.PI,!1),p.stroke(),e=this._project(this._scale,0,Math.PI/2);var f=-Math.atan2(e[0]-this._ox,e[1]-this._oy);p.strokeStyle="#808080",p.lineWidth=1,p.textBaseline="middle",p.textAlign="center";r=Math.max(8,.36*d);p.font="bold "+Ie(r)+"px Arial,Helvetica,sans-serif";for(var g=["N","","","","","","","","S","","","","","","",""],m=0;m<g.length;m++)i=-(22.5*m*Math.PI)/180+f,A=-Math.sin(i),s=Math.cos(i),p.strokeStyle="#c0c090",p.lineWidth=2,p.beginPath(),p.moveTo(this._ox+(this._height-6)/2*A,this._oy+(this._height-6)/2*s),p.lineTo(this._ox+(this._height-d)/2*A,this._oy+(this._height-d)/2*s),p.stroke(),p.save(),p.translate(this._ox+u*A,this._oy+u*s),p.rotate(i),p.strokeStyle="#00a800",p.fillStyle="#00b000",p.lineWidth=1,p.fillText(g[m],0,0),p.strokeText(g[m],0,0),p.restore();p.beginPath(),p.arc(this._ox,this._oy,this._radius,0,360),p.fillStyle="black",p.fill(),p.save(),p.clip(),a._showGrid&&(p.beginPath(),p.font="bold 11px Arial,Helvetica,sans-serif",p.fillStyle="#000060",this._drawGrid(p,0),p.lineWidth=1,p.strokeStyle="#000060",p.stroke());var v=this._objectsVisible;p.font="bold 13px Arial,Helvetica,sans-serif",p.textBaseline="middle",p.textAlign="left";var c=a._typeNum["The Sun"],x=this._typeNum.Star,y=a._typeNum["Sgr A*"],w=[c,y],M=[];for(m=0;m<v.length;m++)t=v[m],e=this._project(t[0],t[1],t[2]),M.push([e[2],e[0],e[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9]]);M.sort(function(t,e){return t[0]-e[0]});var k=null,b=M.length;for(m=0;m<b;m++){t=M[m],p.beginPath();var P=t[3],I=a._highlight&&a._highlight===t[8],S=.3*t[0]/this._radius+.85;1<S&&(S=1),S<0&&(S=0),I&&(k=[t[1],t[2]]);var T=5-.75*(t[7]-this._absMagReference);T<1&&(T=1),-1!==$.inArray(P,w)&&(T=5);var A,z=o[P],C=n[P],R=h[P];P===x&&(z=128+127*(A=(Math.min(1.8,Math.max(-.4,t[9]))+.4)/2.2),C=192-32*A,R=255-384*A),p.arc(t[1],t[2],T,0,2*Math.PI,!1),p.fillStyle="rgb("+Math.floor(z*S)+","+Math.floor(C*S)+","+Math.floor(R*S)+")",p.fill(),a._showLabels&&(I&&!t[5]?p.fillText($(".searchbox",a._context).val(),t[1]+2+T,t[2]):t[5]&&t[4]>.2*this._scale&&p.fillText(t[5],t[1]+2+T,t[2])),t[1]&&(this._hovermankeys[this._hovermannextkey]=t[8],this._hoverman.hoverBox(this._hovermannextkey,t[1]-(T+5),t[2]-(T+5),T+10,T+10),this._hovermannextkey++),P===y&&(p.strokeStyle="#eee",p.lineWidth=1,p.beginPath(),p.moveTo(t[1],t[2]),p.lineTo(a._width/2,a._height/2),p.stroke())}null===k?$(".crosshair",this._context).css("display","none"):($(".crosshair",this._context).css("display","block"),$(".crosshair",this._context).css("left",k[0]-18).css("top",k[1]-18)),a._showGrid&&(p.beginPath(),p.font="bold 12px Arial,Helvetica,sans-serif",p.fillStyle="#0040c0",this._drawGrid(p,1),p.lineWidth=1.5,p.strokeStyle="#004080",p.stroke()),p.restore(),p.beginPath();r=.85*this._width,c=this._height-15,_=this._radius*(_/this._scale);p.moveTo(r-.5*_,c),p.lineTo(r+.5*_,c),p.strokeStyle="black",p.lineWidth=2.5,p.stroke(),p.fillStyle="black",p.font="bold 14px Arial,Helvetica,sans-serif",p.textBaseline="top",p.textAlign="center",p.fillText(l,r,c-18)},X.prototype._drawGrid=function(t,e){var i,s,a,o,n,h;switch(t.textAlign="center",this._showGrid){case 1:for(o=0;o<359;o+=30)for(h=!0,n=-90;n<=90;n+=5)a=this._project(this._scale,o*Math.PI/180,n*Math.PI/180),h=0===e&&0<a[2]||1===e&&a[2]<0||(h?t.moveTo(a[0],a[1]):t.lineTo(a[0],a[1]),!1);for(n=-90;n<=90;n+=15)for(h=!0,o=0;o<362;o+=5)a=this._project(this._scale,o*Math.PI/180,n*Math.PI/180),h=0===e&&0<a[2]||1===e&&a[2]<0||(h?t.moveTo(a[0],a[1]):t.lineTo(a[0],a[1]),!1);break;case 3:for(i=0;i<this._conp.length;i++)a=this._project(this._scale,this._conp[i][1],this._conp[i][2]),0===e&&0<a[2]||1===e&&a[2]<0||t.fillText(this._conp[i][0],a[0],a[1]);case 2:for(i=0;i<this._conb.length;i++)for(h=!0,s=1;s<this._conb[i].length;s++)a=this._project(this._scale,this._conb[i][s][0],this._conb[i][s][1]),h=0===e&&0<a[2]||1===e&&a[2]<0||(h?t.moveTo(a[0],a[1]):t.lineTo(a[0],a[1]),!1)}},X.prototype._updateKey=function(){var t,e,i=this._typeNames,s=this._typeColR,a=this._typeColG,o=this._typeColB,n=$(".legend",this._context),h=n[0];h.width=130,h.height=212;var r=h.getContext("2d");if(this._showKey){this._keyVisibility||n.fadeIn(),this._keyVisibility=1,e=0,r.fillStyle="#eeeeee",r.font="bold 12px Arial,Helvetica,sans-serif",r.textBaseline="middle",r.textAlign="left";var _=Object.keys(i);_.sort(function(t,e){return Pe(t).localeCompare(Pe(e))});for(var l=[],c=_.length,p=0;p<c;p++)t=_[p],-1!==$.inArray(i[t],["The Sun","Star","Sgr A*","Galaxy","Open Cluster","Globular Cluster","Emission","Planetary Nebula","Cluster","Nebula"])&&-1===$.inArray(i[t],l)&&(l.push(i[t]),r.beginPath(),r.arc(10,18+20*e,2,0,2*Math.PI,!1),r.fillStyle="rgb("+s[t]+","+a[t]+","+o[t]+")",r.fill(),r.fillText(i[t],20,18+20*e),e+=1)}else this._keyVisibility&&n.fadeOut(),this._keyVisibility=0},X.prototype._resize=function(){var t,e;this.totalWidth=this._context.width(),this._width=Math.min($(".ngc_host",this._context).width(),$(window).height()-20),this._width<380&&(this._width=380),600<this._width&&(this._width-=.075*(this._width-600)),this._height=this._width*this._settings.aspectRatio,$(".slidescale",this._context).width(this.totalWidth-100),$(".slider",this._context).width(this.totalWidth-130),$(".buf0, .buf1",this._context).width(this._width).height(this._height),$(".buff",this._context).width(this._width).height(this._height),$(".ngc_caption",this._context).width(this._width-160),$(".NGCload",this._context).width(this._width).css("top",.45*this._height);var i=this.totalWidth-100-30,s=580<i?1:2,a=[.002,.005,.01,.02,.05,.1,.2,.5,1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4],o=$(".slidescale",self._context),n=o[0];n.width=o.width(),n.height=o.height();var h=n.getContext("2d");for(h.beginPath(),t=0;t<a.length;t+=s)e=15+i*Math.log(a[t]/this._scale_min)/Math.log(this._scale_max/this._scale_min),h.moveTo(e,40),h.lineTo(e,47);for(h.strokeStyle="#777",h.lineWidth=1.9,h.stroke(),h.fillStyle="#777",h.font="bold 11px Arial,Helvetica,sans-serif",h.textBaseline="middle",h.textAlign="center",t=0;t<a.length;t+=s){e=15+i*Math.log(a[t]/this._scale_min)/Math.log(this._scale_max/this._scale_min);var r="",_="",_=a[t]<1?(r=1e3*a[t]," pc"):a[t]<1e3?(r=a[t]," kpc"):(r=a[t]/1e3," Mpc");h.fillText(r,e,21),h.fillText(_,e,32)}this._drawMap(),this._updateKey()},X.prototype._rotate=function(t,e){this._matrix=this._matrix_._rotate(t,e),this._refresh=1},X.prototype._ngc_hideinstruct=function(){var t=this;this._hideInstruct&&(this._hideInstruct=0,$(".ngc_instruct",t._context).stop().animate({opacity:0},600,function(){$(".ngc_instruct",t._context).css("display","none")}))},X.prototype._hoverClick=function(t,e){var i,s=this;if(void 0===e){if(!t||!this._hovermankeys.hasOwnProperty(t))return;e=this._hovermankeys[t]}this._highlight=e,450<this._width&&e?($(".information_contents").html(""),$(".information_holder").show(),i=function(t){$(".information_contents").html(t)},this._hoverTextCache.hasOwnProperty(e)?(t=this._hoverTextCache[e])&&i(t):(this._hoverTextCache[e]=null,jQuery.getJSON(window.server+"json/objecthover.php?id="+e,function(t){t.hasOwnProperty("html")&&(s._hoverTextCache[e]=t.html,i(t.html))}))):$(".information_holder").hide()},X.prototype._mouseDown=function(t){var e=this,t=At(t,$(".buf0",e._context));e._matrix_=e._matrix,e.pos_=t,e._mousedown=1,$(".sr",e._context).prop("checked",!1)},X.prototype._mouseDrag=function(t){var e;this._hideInstruct&&this._ngc_hideinstruct(),this._mousedown&&(0===t?e=[this._mousex,this._mousey]:(e=At(t,$(".buf0",this._context)),this._mousex=e[0],this._mousey=e[1]),t=(e[0]-this.pos_[0])/600*Math.PI,e=(e[1]-this.pos_[1])/600*Math.PI,this._rotate(t,e))},X.prototype._mouseUp=function(t){this._mouseDrag(t),this._mousedown=0},X.prototype._displaywheel=function(t,e){t.preventDefault&&t.preventDefault(),t.returnValue=!1;var i=Date.now();void 0!==this._lastZoomEventTime&&i<this._lastZoomEventTime+100||(this._lastZoomEventTime=i,i=void 0!==e?e:t.deltaY||t.wheelDelta,t=(e=$(".slider",this._context)).slider("value"),i<0?0<t&&e.slider("value",t-1):t<400&&e.slider("value",t+1))},X.prototype._go_search=function(){for(var t=this,e=$(".searchbox",t._context).val().toUpperCase().replace(/ /g,""),i=t._objs,s=i.length,a=0;a<s;a++)if(i[a][7]&&i[a][7].toUpperCase().replace(/ /g,"")===e){this._highlight=i[a][2];var o=1.5*i[a][5],o=Math.log(o/this._scale_min)/Math.log(this._scale_max/this._scale_min)*this._scale_steps;return o<0&&(o=0),o>this._scale_steps&&(o=this._scale_steps),$(".slider",t._context).slider("value",Math.floor(o)),$(".searchbox",t._context).val(i[a][7]),void t._hoverClick(!1,i[a][2])}alert("Sorry, object '"+e+"' is not recognised")},X.prototype._updateAlarm=function(){var t,e,i=this;$(".sr",i._context).prop("checked")&&!i._mousedown&&(t=5===i._rotmode?20:65,(i._rotstep+=1)>t&&(i._rotmode=1+i._rotmode,6===i._rotmode&&(i._rotmode=0),5!==i._rotmode||$(".sz",i._context).prop("checked")||(i._rotmode=0),i._rotstep=0),i._matrix_=i._matrix,i._rotmode<5?(e=(65*i._rotmode+i._rotstep)*Math.PI/120,i._rotate(.02*Math.cos(e),.02*Math.sin(e))):(e=(t=$(".slider",i._context)).slider("value"),i._zoomdir?0<e?t.slider("value",e-1):i._zoomdir=0:e<400?t.slider("value",e+1):i._zoomdir=1)),i._refresh&&i._drawMap(),i._refresh=0},X.prototype.hypot=function(t,e){return Math.sqrt(t*t+e*e)},$(function(){$(".ngc3d").each(function(t,e){var i=$(e),e=new X(i.data("meta"),i);i.data("handler",e)})}),Z.prototype._setObjList=function(e,t,i){var s=this;void 0===t&&(t=1),void 0===i&&(i=function(){}),t=t?1:0,jQuery.getJSON(window.server+"json/orbitalelements.php?planets="+t+"&objs="+JSON.stringify(e),function(t){s.objList=e,s._elements=t.elements,s._earth=t.earth,s._sun=t.sun,i()})},Z.prototype._pow_2=function(t){return t*t},Z.prototype._pow_3=function(t){return t*t*t},Z.prototype._log10=function(t){return Math.log(t)/Math.log(10)},Z.prototype._angDist_ABC=function(t,e,i,s,a,o,n,h,r){var _=this._pow_2(t-s)+this._pow_2(e-a)+this._pow_2(i-o),o=this._pow_2(s-n)+this._pow_2(a-h)+this._pow_2(o-r),i=this._pow_2(n-t)+this._pow_2(h-e)+this._pow_2(r-i);return Math.acos((_+o-i)/(2*Math.sqrt(_)*Math.sqrt(o)))},Z.prototype._angDist_RADec=function(t,e,i,s){var a=Math.sin(t)*Math.cos(e),o=Math.cos(t)*Math.cos(e),t=Math.sin(e),e=Math.sin(i)*Math.cos(s),i=Math.cos(i)*Math.cos(s),s=Math.sin(s),s=Math.sqrt(this._pow_2(a-e)+this._pow_2(o-i)+this._pow_2(t-s));return 2*Math.asin(s/2)},Z.prototype._getTrack=function(t){var e=[],i=t.length,s=this._elements.length;this._earthPos=[],this.sunPos=[];for(var a=0;a<i;a++){var o=this._solveKeplerEquation(this._earth,t[a]);o.name="Earth";var n=this._solveKeplerEquation(this._sun,t[a],o);n.name="Sun",this._earthPos.push(o),this.sunPos.push(n);for(var h=[],r=0;r<s;r++){var _,l,c,p=this._elements[r],d=180/Math.PI,u=p[this._ARG_MOVING];u?_=this._solveKeplerEquation(this._elements[r],t[a],o):((_=[]).RA=p[this._ARG_RA],_.Dec=p[this._ARG_DEC],_.mag=p[this._ARG_MAG]),_.name=this._elements[r][this._ARG_NAME],(_.moving=u)&&(_.Dso=Math.sqrt(this._pow_2(n.x-_.x)+this._pow_2(n.y-_.y)+this._pow_2(n.z-_.z)),_.Deo=Math.sqrt(this._pow_2(o.x-_.x)+this._pow_2(o.y-_.y)+this._pow_2(o.z-_.z)),_.theta=this._angDist_ABC(o.x,o.y,o.z,_.x,_.y,_.z,n.x,n.y,n.z),_.phase=(1+Math.cos(_.theta))/2,l=180*_.theta/Math.PI,p=5*this._log10(_.Deo*_.Dso),4===_.objId?_.mag=p-.6+l/100*4.98-4.88*this._pow_2(l/100)+3.02*this._pow_3(l/100):5===_.objId?_.mag=p-4.4+l/100*.09+2.39*this._pow_2(l/100)-.65*this._pow_3(l/100):6===_.objId?_.mag=p-1.52+.016*l:8===_.objId?(u=[.0856252844139301,.0733006357177292,.9936273584560815],c=_.Deo,u=(_.x-o.x)*u[0]+(_.y-o.y)*u[1]+(_.z-o.z)*u[2],c=Math.abs(Math.PI/2-Math.acos(u/c)),_.mag=p-8.88+.044*Math.abs(l)-2.6*Math.sin(c)+1.25*this._pow_2(Math.sin(c))):(p=this._elements[r][this._ARG_SLOPE_N],_.mag=Number(this._elements[r][this._ARG_AMAG])+5*this._log10(_.Deo)+2.5*p*this._log10(_.Dso),this._elements[r][this._ARG_SLOPE_G]?(l=this._elements[r][this._ARG_SLOPE_G],c=Math.exp(-3.33*Math.pow(Math.tan(_.theta/2),.63)),p=Math.exp(-1.87*Math.pow(Math.tan(_.theta/2),1.22)),_.mag-=2.5*this._log10((1-l)*c+l*p)):_.mag-=2.5*this._log10(_.phase)),_.Ro=this._elements[r][this._ARG_RADIUS]/this.AU,_.AngSize=2*Math.atan(_.Ro/_.Deo)*d*3600,_.PhySize=_.Ro*this.AU*2,_.albedo=Number(this._elements[r][this._ARG_ALBEDO]),_.SunAngDist=d*this._angDist_ABC(_.x,_.y,_.z,o.x,o.y,o.z,n.x,n.y,n.z),_.thetaESO=d*this._angDist_ABC(o.x,o.y,o.z,n.x,n.y,n.z,_.x,_.y,_.z),_.theta*=d),h.push(_)}e.push(h)}return e},Z.prototype._log10=function(t){return Math.log(t)/Math.log(10)},Z.prototype._solveKeplerEquation=function(t,e,i){var s,a,o,n,h=e-t[this._ARG_EPOCH],r=t[this._ARG_A]+h*t[this._ARG_A_DOT],_=t[this._ARG_E]+h*t[this._ARG_E_DOT],l=(t[this._ARG_LONGAN]+h*t[this._ARG_LONGAN_DOT])*Math.PI/180,c=(t[this._ARG_I]+h*t[this._ARG_I_DOT])*Math.PI/180,p=(t[this._ARG_ARGPERI]+h*t[this._ARG_ARGPERI_DOT])*Math.PI/180;n=0===t[this._ARG_MA_DOT]?(s=this.G,a=this.solarMass,o=this.AU,S=t[this._ARG_MA]*Math.PI/180,T=Math.sqrt(s*a/Math.pow(Math.abs(t[this._ARG_A])*o,3)),(S+(e-t[this._ARG_EPOCH])*T)%(2*Math.PI)):(t[this._ARG_MA]+h*t[this._ARG_MA_DOT])*Math.PI/180;var d=0,u=[],f=t[this._ARG_OBJID];u.objId=f;var g,m,v=(23.4393-3.563e-7*(e-946728e3)/86400)*Math.PI/180,x=this._moonpos;if(x&&!i&&e>x.utstart&&e<x.utstart+x.utstep*(x.pos.length-2)){k=(e-x.utstart)/x.utstep,I=(b=Math.floor(k))+1;var y=(($=1-(P=k-b))*x.pos[b][3]+P*x.pos[I][3])/1e5,w=($*x.pos[b][4]+P*x.pos[I][4])/1e5,M=($*x.pos[b][5]+P*x.pos[I][5])/1e5;u.x=y,u.y=w,u.z=M,u.xh=y,u.yh=w*Math.cos(v)+M*Math.sin(v),u.zh=-w*Math.sin(v)+M*Math.cos(v)}else if(x&&Ie(f)===Ie(x.objId)&&i&&e>x.utstart&&e<x.utstart+x.utstep*(x.pos.length-2)){var k=(e-x.utstart)/x.utstep,b=Math.floor(k),P=k-b,I=b+1,$=1-P,S=180*st(e)/12,T=Math.PI/180,h=6371e3/this.AU,k=h*Math.cos((S+this._longitude)*T)*Math.cos(this._latitude*T),S=h*Math.sin((S+this._longitude)*T)*Math.cos(this._latitude*T),T=h*Math.sin(this._latitude*T),k=.0026*($*x.pos[b][0]+P*x.pos[I][0])/1e4+i.x-k,S=.0026*($*x.pos[b][1]+P*x.pos[I][1])/1e4+i.y-S,T=.0026*($*x.pos[b][2]+P*x.pos[I][2])/1e4+i.z-T;u.x=k,u.y=S,u.z=T,u.xh=k,u.yh=S*Math.cos(v)+T*Math.sin(v),u.zh=-S*Math.sin(v)+T*Math.cos(v)}else if(Ie(f)===Ie(x.objId)&&i){x=J(D=40587.5+e/86400);x[2]*=1e3/this.AU,y=x[2]*Math.cos(x[0])*Math.cos(x[1]),w=x[2]*Math.sin(x[0])*Math.cos(x[1]),M=x[2]*Math.sin(x[1]),u.x=y+i.x,u.y=w+i.y,u.z=M+i.z,u.xh=y,u.yh=w*Math.cos(v)+M*Math.sin(v),u.zh=-w*Math.sin(v)+M*Math.cos(v)}else if(0===r)u.x=u.y=u.z=u.xh=u.yh=u.zh=0;else{if(1.02<_){for(var A,z=Math.sqrt(s*a/Math.pow(Math.abs(t[this._ARG_A])*o,3)),C=(e-t[this._ARG_EPOCHPERI])*z,R=.5,j=C,D=0;D<50&&1e-8<R;D++)A=(C+_*(j*Math.cosh(j)-Math.sinh(j)))/(_*Math.cosh(j)-1),(R=Math.abs(A/j))<1&&(R=1/R),--R,j=A;F=2*Math.atan(Math.sqrt((_+1)/(_-1)))*Math.tanh(j/2),z=r*(1-_*_)/(1+_*Math.cos(F))}else if(_<.98){R=.5,g=n;for(var D=0;D<50&&1e-8<R;D++)m=g+(n+_*Math.sin(g)-g)/(1-_*Math.cos(g)),(R=Math.abs(m/g))<1&&(R=1/R),--R,g=m;N=r*(Math.cos(g)-_),O=r*(Math.sqrt(1-_*_)*Math.sin(g)),F=Math.atan2(O,N),z=Math.sqrt(N*N+O*O)}else var N=r*(1-_),O=.75*((e-Number(t[this._ARG_EPOCHPERI]))/86400)*.01720209895*Math.sqrt((1+_)/Math.pow(N,3)),r=Math.sqrt(1+O*O),t=Math.pow(r+O,.333333333)-Math.pow(r-O,.33333333),L=(1-_)/(1+_),r=t*t/(1+t*t),O=L*r*r,O=t*(1+L*r*(2/3+.4*t*t+(1.4+33/35*t*t+37/175*Math.pow(t,4))*O+t*t*(432/175+956/1125*t*t+84/1575*Math.pow(t,4))*O*O)),F=2*Math.atan(O),z=N*(1+O*O)/(1+O*O*L);var l=l,L=p,p=z*(Math.cos(l)*Math.cos(F+L)-Math.sin(l)*Math.sin(F+L)*Math.cos(c)),l=z*(Math.sin(l)*Math.cos(F+L)+Math.cos(l)*Math.sin(F+L)*Math.cos(c)),L=z*(Math.sin(F+L)*Math.sin(c)),c=-382394e-10*(e-946728e3)/86400*Math.PI/180,e=p*Math.cos(c)+l*Math.sin(c),c=-p*Math.sin(c)+l*Math.cos(c),L=L,E=e,W=c*Math.cos(v)-L*Math.sin(v),d=c*Math.sin(v)+L*Math.cos(v);u.x=E,u.xh=e,u.y=W,u.yh=c,u.z=d,u.zh=L}return void 0!==i&&(d=u.x-i.x,L=u.y-i.y,i=u.z-i.z,u.RA=Math.atan2(L,d),u.Dec=Math.asin(i/Math.sqrt(this._pow_2(d)+this._pow_2(L)+this._pow_2(i))),u.RA<0&&(u.RA+=2*Math.PI)),u.RA*=12/Math.PI,u.Dec*=180/Math.PI,u},Q.prototype.project=function(t,e,i,s){i*=-1;var a=this._width/2/Math.tan(Math.atan(.125)/2),o=new p(-t,i,e),t=this._matrix._multiply_vector(o);t._z+=4*s;i=t._abs();if(1<(t=t._mul(1/i))._z&&(t._z=1),t._z<-.5)return 0;e=Math.asin(t._z),o=Math.atan2(t._x,t._y),t=Math.tan((Math.PI/2-e)/2),e=t*Math.cos(o);return(i=i/s-2.8)<0&&(i=0),[t*-Math.sin(o)*a,e*a,i]},Q.prototype.angProject=function(t,e,i,s,a,o,n,h){var r;t<0&&(o=-(r=2*Math.atan(Math.sqrt((e+1)/(e-1))))+o/Math.PI*r);e=t*(1-e*e)/(1+e*Math.cos(o));return new p(-(e+h)*n*Math.sin(o+i),(e+h)*n*Math.cos(o+i),0)._rotate_xz(-s)._rotate_xy(a)._to_list()},Q.prototype.shader_G=function(t,e){return Math.exp(-Math.pow(t/e,2))},Q.prototype.shader_r=function(t){return this.shader_G(t-.5,.1)},Q.prototype.shader_ga=function(t){return this.shader_G(+t,.15)+this.shader_G(t-1,.15)},Q.prototype.shader_g=function(t){return t<.5?1-this.shader_r(t)+this.shader_ga(.5):this.shader_ga(t)},Q.prototype.shader_b=function(t){return 1-this.shader_r(t)-this.shader_ga(t)},Q.prototype.draw=function(t){if(this._lock)return 1;this._lock=1;var e=this._graphics_context;t&&(e=t),e._clear();var i,s,a,o,n,h,r,_,l,c=e._width,p=e._height,d=(600<c)+(1e3<c),u=Math.exp(this.scale/200*Math.log(this._smax/this._smin))*this._smin,f=c/2,g=p/2,m=$(".or_label",self._context).prop("checked"),v=$(".or_monlab",self._context).prop("checked"),x=$(".or_ap",self._context).prop("checked"),y=$(".or_vis",self._context).prop("checked"),w=$(".or_grid",self._context).prop("checked"),M=$(".or_sca",self._context).prop("checked"),k=[0,31,59,90,120,151,181,212,243,273,304,334,999],b=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],P=this._utc_centre+86400*this._dayoffset,t=be._unix_to_calendar(this._utc_centre);$(".or_day",self._context).val(t[2]),$(".or_month",self._context).val(t[1]),$(".or_year",self._context).val(t[0]);t=be._unix_to_calendar(P);$(".ORdate",self._context).html(t[2]+" "+b[t[1]]+" "+t[0]),this.eclpass_utm=P;var I=$(".or_dwarf",self._context).prop("checked"),S=this.objectCalc,T=[S._earth].concat(S._elements);this._planetPos=S._getTrack([P])[0];var A,z=[S._earthPos[0]].concat(this._planetPos);if(y){o=!1;for(var C=-S._earthPos[0].yh,R=S._earthPos[0].xh,j=Math.atan2(C,R),D=0;D<361;D+=3.6){for(var N=D*Math.PI/180,O=D/360,L=Math.floor(128+128*this.shader_r(O))+","+Math.floor(128+128*this.shader_g(O))+","+Math.floor(128+128*this.shader_b(O)),F=[],E=-1,W=0;W<1.21*u;W+=.6*u)E++,i=C+Math.sin(j+N)*W,s=R+Math.cos(j+N)*W,a=this.project(i,s,0,u),F.push(a),o&&E&&o[E]&&o[E-1]&&F[E]&&F[E-1]&&(e._beginPath(),e._moveTo(f+o[E][0],g+o[E][1]),e._lineTo(f+F[E][0],g+F[E][1]),e._lineTo(f+F[E-1][0],g+F[E-1][1]),e._lineTo(f+o[E-1][0],g+o[E-1][1]),e._strokeStyle("rgb("+L+")",1),e._fillStyle("rgb("+L+")"),e._fill(),e._stroke());o=F}}A=60<u?10:30<u?5:15<u?2.5:6<u?1:3<u?.5:.2;var U=Math.ceil(2*u/A)*A,H=-U;if(w){for(r=H;r<U;r+=A)for(h=0,G=H;G<U;G+=.25*A)h=(n=this.project(r,G,0,u))?(i=n[0]+f,s=n[1]+g,h&&(_=Math.pow(.5,n[2]),y&&(_=1),e._strokeStyle("rgba(0,0,250,"+_+")",1),e._beginPath(),e._moveTo(h[0],h[1]),e._lineTo(i,s),e._stroke()),[i,s]):0;for(var G=H;G<U;G+=A)for(h=0,r=H;r<U;r+=.25*A)h=(n=this.project(r,G,0,u))?(i=n[0]+f,s=n[1]+g,h&&(_=Math.pow(.5,n[2]),e._strokeStyle("rgba(0,0,250,"+_+")",1),y&&(_=1),e._beginPath(),e._moveTo(h[0],h[1]),e._lineTo(i,s),e._stroke()),[i,s]):0}e._fillStyle("#ffff00"),e._beginPath(),e._arc(f,g,6,0,2*Math.PI,!1),e._fill();var B=y?1.25:1.5;for(D=0;D<T.length;D++)if((I||1!==T[D][S._ARG_OBJTYPE])&&T[D][S._ARG_A]*(1-T[D][S._ARG_E])<1.1*u)for(J=T[D][S._ARG_A],q=T[D][S._ARG_E],Y=T[D][S._ARG_LONGAN]*Math.PI/180,V=T[D][S._ARG_I]*Math.PI/180,X=T[D][S._ARG_ARGPERI]*Math.PI/180,W=h=0;W<=360;W+=2)h=(a=this.angProject(J,q,X,V,Y,W*Math.PI/180,1,0))&&(n=this.project(a[0],a[1],a[2],u))?(i=n[0]+f,s=n[1]+g,h&&(1<(_=Math.pow(.5,n[2])*(2===T[D][S._ARG_OBJTYPE]?1.5:1))&&(_=1),y?e._strokeStyle("rgb(0,0,0)",B):T[D][S._ARG_OBJTYPE]<2?e._strokeStyle("rgba(250,250,250,"+_+")",B):e._strokeStyle("rgba(0  ,255,  0,"+_+")",B),e._beginPath(),e._moveTo(h[0],h[1]),e._lineTo(i,s),e._stroke()),[i,s]):0;if(x)for(e._textStyle("Arial,Helvetica,sans-serif",12,"bold",""),D=0;D<T.length;D++)if((I||1!==T[D][S._ARG_OBJTYPE])&&T[D][S._ARG_A]<1.1*u&&(J=T[D][S._ARG_A],q=T[D][S._ARG_E],Y=T[D][S._ARG_LONGAN]*Math.PI/180,V=T[D][S._ARG_I]*Math.PI/180,X=T[D][S._ARG_ARGPERI]*Math.PI/180,.07*u<J))for(W=0;W<=190;W+=180)(a=this.angProject(J,q,X,V,Y,W*Math.PI/180,1,0))&&(n=this.project(a[0],a[1],a[2],u))&&(i=n[0]+f,s=n[1]+g,l=Math.atan2(n[0],n[1]),_=Math.pow(.5,n[2]),y?(e._fillStyle("#000000"),e._strokeStyle("#000000",1)):(e._fillStyle("rgba(250,250,250,"+_+")"),e._strokeStyle("rgba(250,250,250,"+_+")",1)),e._beginPath(),e._moveTo(i+5*Math.sin(l),s+5*Math.cos(l)),e._lineTo(i-5*Math.sin(l),s-5*Math.cos(l)),e._stroke(),i+=12*Math.sin(l),s+=12*Math.cos(l),e._text(i,s,0,0,!0,W?"A":"P",!0,!0));if(v&&u<8){e._textStyle("Arial,Helvetica,sans-serif",14,"bold","");var v=S._earth,J=v[S._ARG_A],q=v[S._ARG_E],Y=v[S._ARG_LONGAN]*Math.PI/180,V=v[S._ARG_I]*Math.PI/180,X=v[S._ARG_ARGPERI]*Math.PI/180;for(E=0;E<12;E++)W=(k[E]-4)/365.2524*360,(a=this.angProject(J,q,X,V,Y,W*Math.PI/180,1,0))&&(n=this.project(a[0],a[1],a[2],u))&&(i=n[0]+f,s=n[1]+g,l=Math.atan2(n[0],n[1]),_=Math.pow(.5,n[2]),y?(e._fillStyle("#000000"),e._strokeStyle("#000000",1)):(e._fillStyle("rgba(250,250,250,"+_+")"),e._strokeStyle("rgba(250,250,250,"+_+")",1)),e._beginPath(),e._moveTo(i+8*Math.sin(l),s+8*Math.cos(l)),e._lineTo(i-8*Math.sin(l),s-8*Math.cos(l)),e._stroke(),i+=26*Math.sin(l),s+=20*Math.cos(l),e._text(i,s,0,0,!0,b[E+1],!0,!0))}for(e._textStyle("Arial,Helvetica,sans-serif",13,"bold",""),D=0;D<T.length;D++)if((I||1!==T[D][S._ARG_OBJTYPE])&&T[D][S._ARG_A]*(1-T[D][S._ARG_E])<1.1*u&&"Moon"!==z[D].name){var Z=-z[D].yh,Q=z[D].xh,K=z[D].zh,tt=z[D].name;if(J=Math.sqrt(Z*Z+Q*Q+K*K),!(n=this.project(Z,Q,K,u)))continue;i=n[0]+f,s=n[1]+g,1<(_=2*Math.pow(.5,n[2]))&&(_=1);Q=m&&.07*u<J;y&&Q&&(K=e._textWidth(tt),e._fillStyle("rgba(0,0,0,0.7)"),e._beginPath(),e._rect(i+8,s-14,K+12,26),e._fill()),y?e._strokeStyle("rgb(0,0,0)",1.5):e._strokeStyle("rgba(0,0,0,"+_+")",1.5),y||T[D][S._ARG_OBJTYPE]<2?e._fillStyle("rgb(250,0,250)"):e._fillStyle("rgb( 0,255,64)"),e._beginPath(),e._arc(i,s,4,0,2*Math.PI,!1),e._stroke(),e._fill(),Q&&(y||e._text(i+14,s,-1,0,!1,tt,!1,!1),e._text(i+14,s,-1,0,!0,tt,!1,!0))}if(M&&(s=-1*A,M=(r=(Math.floor(u/2/A+.8)-1)*A)-A,o=this.project(r,s,0,u),M=this.project(M,s,0,u),o&&M&&(e._strokeStyle(y?"#202020":"#c0c0c0",3),e._fillStyle(y?"#202020":"#c0c0c0"),e._textStyle("Arial,Helvetica,sans-serif",14,"",""),e._beginPath(),e._moveTo(o[0]+f,o[1]+g),e._lineTo(M[0]+f,M[1]+g),e._stroke(),e._text((o[0]+M[0])/2+f,(o[1]+M[1])/2-12+g,0,0,!0,A+" AU",!1,!0))),y){var et=[[.25,"Visible in evening"],[.5,"Behind Sun"],[.75,"Visible in morning"],[0,"Visible all night"]];for(e._beginPath(),e._rect(11,this._height-22-26*et.length,170,26*et.length+8),e._fillStyle("rgba(255,255,255,0.3)"),e._fill(),D=0;D<et.length;D++)s=this._height-22-18*(D+1)-8*D,e._beginPath(),e._rect(22,s,18,18),O=et[D][0],L=Math.floor(128+128*this.shader_r(O))+","+Math.floor(128+128*this.shader_g(O))+","+Math.floor(128+128*this.shader_b(O)),e._fillStyle("rgb("+L+")"),e._fill(),e._strokeStyle("#000000",1),e._stroke(),e._fillStyle("#000000"),e._textStyle("Arial,Helvetica,sans-serif",13,"bold",""),e._text(51,s+9,-1,0,1,et[D][1],0,0)}return 400<c&&(e._strokeStyle("#000000",1.5),e._fillStyle(y?"#000000":"#a0a0a0"),e._textStyle("Arial,Helvetica,sans-serif",12+d,"",""),y||e._text(c-4,p-4,1,-1,!1,"https://in-the-sky.org",!1,!0),e._text(c-4,p-4,1,-1,!0,"https://in-the-sky.org",!1,!0)),$(".ORdate",this._context).css("color",y?"#000000":"#888888"),this._lock=0},Q.prototype._rotate=function(t,e){t=.25*t*Math.PI/180,e=.25*e*Math.PI/180;var i=this._matrix_._rotate(t,e),t=i._to_euler_angles(),e=t[0],t=(t[1],t[2]);$(".or_orient",self._context).prop("checked")&&(i=f(e,0,t)),this._matrix=i,this._refresh=1},Q.prototype._hideInstructions=function(){var t=this;this._hideInstruct&&(this._hideInstruct=0,$(".or_instruct",t._context).stop().animate({opacity:0},600,function(){$(".or_instruct",t._context).css("display","none")}))},Q.prototype._mouseDown=function(t){t=At(t,$(".ORhost",self._context));this._matrix_=this._matrix,this.pos_=t,this.mousedown=1},Q.prototype._mouseDrag=function(t){var e;this._hideInstruct&&this._hideInstructions(),this.mousedown&&(0===t?e=[this._mousex,this._mousey]:(e=At(t,$(".ORhost",self._context)),this._mousex=e[0],this._mousey=e[1]),t=e[0]-this.pos_[0],e=e[1]-this.pos_[1],this._rotate(t,-e))},Q.prototype._mouseUp=function(t){this._mouseDrag(t),this.mousedown=0},Q.prototype._displaywheel=function(t,e){t.preventDefault&&t.preventDefault(),t.returnValue=!1;var i=Date.now();void 0!==this._lastZoomEventTime&&i<this._lastZoomEventTime+100||(this._lastZoomEventTime=i,(void 0!==e?e:t.deltaY||t.wheelDelta)<0?(this.scale-=3,this.scale<=0&&(this.scale=0)):(this.scale+=3,200<=this.scale&&(this.scale=200)),this._settings.panel&&$(".ORslider",self._context).slider("value",this.scale),this._refresh=1)},Q.prototype.moveUp=function(){this._matrix_=this._matrix,this._rotate(0,20)},Q.prototype.moveDown=function(){this._matrix_=this._matrix,this._rotate(0,-20)},Q.prototype.moveLeft=function(){this._matrix_=this._matrix,this._rotate(-20,0)},Q.prototype.moveRight=function(){this._matrix_=this._matrix,this._rotate(20,0)},Q.prototype._updateAlarm=function(){this._refresh&&(this._refresh=this.draw())},Q.prototype._labelDateSlide=function(){var t,e,i=parseInt($(".or_day",self._context).val()),s=parseInt($(".or_month",self._context).val()),a=parseInt($(".or_year",self._context).val()),o=be._calendar_to_unix(a,s,i,0,0,0);this._utc_centre=o,$(".ORslider2",self._context).slider("value",0);for(var n=[],h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=a-1;r<=a+1;r++)for(var _=0;_<12;_++){var l,c=(be._calendar_to_unix(r,_+1,1,0,0,0)-o)/86400/200+.5;c<0||1<c||(l=h[_],0===_&&(l+=" "+r),n.push([c,l]))}s=$(".ORslidescale2",self._context);if(s.length){i=s[0];i.width=s.width(),i.height=s.height();var p=i.getContext("2d");for(p.beginPath(),t=0;t<n.length;t++)e=this.ordate_margin+4+this.ordate_width2*n[t][0],p.moveTo(e,19),p.lineTo(e,25);for(p.strokeStyle="#777",p.lineWidth=1.9,p.stroke(),p.fillStyle="#777",p.font="bold 11px Arial,Helvetica,sans-serif",p.textBaseline="middle",p.textAlign="center",t=0;t<n.length;t++)e=this.ordate_margin+4+this.ordate_width2*n[t][0],p.fillText(n[t][1],e,10)}},Q.prototype._goto_faceOn=function(){this.goto_inclination(0)},Q.prototype._goto_default=function(){this.goto_inclination(60*Math.PI/180)},Q.prototype.goto_inclination=function(t){this._matrix=i(t),this._matrix_=this._matrix,this._refresh=1},Q.prototype._scaleViewToLastObject=function(){var t=this.objectCalc,e=t._elements,i=e.length,s=Math.abs(Number(e[i-1][t._ARG_A]));s<1&&(s=1),100<s&&(s=100);t=Number(e[i-1][t._ARG_E]);t<.1&&(t=.1),.9<t&&t<1.1&&(t=.9);s=2.5*(.8999<t?s*(1-t):s*(1+t)),s=Math.abs(s);1.5<t&&(s*=2),s<this._smin&&(s=this._smin),s>this._smax&&(s=this._smax);s=Math.log(s/this._smin)/Math.log(this._smax/this._smin)*200;this._goto_default(),$(".ORslider",this._context).slider("value",s).change(),this.scale=s,this._refresh=1},Q.prototype._do_search=function(){var t,e=this,i=$(".or_search",e._context);i&&(t=i.val(),jQuery.getJSON(window.server+"json/objectsearch.php",{s:t},function(t){t&&0<t.objId&&(i.value=t.name,e._extras=[t.objId],$(".or_objlink",e._context).html('Currently showing: <a href="'+window.server+"data/object.php?id="+t.objId+'"><b>'+t.name+"</b></a>."),e.objectCalc._setObjList(e._extras,1,function(){e._scaleViewToLastObject()}))}))},Q.prototype.setup=function(){var i=this;$(".ORload",i._context).css("display","none"),this.scale=30,this._smax=150,this._smin=2.5,this._settings.panel&&($(".ORslider",i._context).slider({min:0,max:200,value:this.scale,change:function(){i.scale=$(".ORslider",i._context).slider("value"),i._refresh=1},slide:function(){i.scale=$(".ORslider",i._context).slider("value"),i._refresh=1}}),$(".ORslider2",i._context).slider({min:-100,max:100,value:0,change:function(){i._dayoffset=$(".ORslider2",i._context).slider("value"),i._refresh=1},slide:function(){i._dayoffset=$(".ORslider2",i._context).slider("value"),i._refresh=1}})),this._dayoffset=0,this._refreshTime=0,this.mousedown=0,this._mousex=-999,this._mousey=-999,this._refresh=0,this._lock=0;var t=$(".ORbuf0",this._context)[0];this._graphics_context=new zt(t,1,1),this._goto_default(),this._hideInstruct=1,setTimeout(function(){i._hideInstructions()},5e3);t=$(".ORhost",i._context);t.mousedown(function(t){i._mouseDown(t)}),t.mouseup(function(t){i._mouseUp(t)}),t.mousemove(function(t){i._mouseDrag(t)}),t.mouseleave(function(){i._mouseUp(0)}),i._is_pinching=!1,i._pinch_distance=0,t.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(i._is_pinching=!1,i._mouseDown(t.touches[0])):2===t.touches.length&&(i._is_pinching=!0,i._pinch_distance=i.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),i._is_pinching||i._mouseUp(0),i._is_pinching=!1,i.mousedown=0},touchmove:function(t){t.preventDefault();var e=t.originalEvent;i._is_pinching?(t=i.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),25<Math.abs(t-i._pinch_distance)&&(i._displaywheel(e.touches[0],i._pinch_distance-t),i._pinch_distance=t)):i._mouseDrag(e.touches[0])},touchcancel:function(t){t.preventDefault(),i._is_pinching||i._mouseUp(0),i._is_pinching=!1,i.mousedown=0}}),$("input",i._context).click(function(){i._refresh=1}),$(".or_dview",i._context).click(function(){i._goto_default()}),$(".or_faceon",i._context).click(function(){i._goto_faceOn()}),$(".or_orient",i._context).click(function(){i._rotate(0,0)}),$(".or_panel_form",i._context).on("submit",function(){i._do_search()}),$(".or_day, .or_month, .or_year",i._context).on("change",function(){i._labelDateSlide(),i._refresh=1}),$(".or-png",i._context).click(function(){var t=Math.min(Math.max(Ie($(".or-export-x").val()),100),4096),e=Math.min(Math.max(Ie($(".or-export-y").val()),100),4096),e=new zt(document.createElement("canvas"),t,e);i.draw(e),e._renderPNG("solar_system.png")}),$(".or-svg",i._context).click(function(){var t=new Rt(Math.min(Math.max(Ie($(".or-export-x").val()),100),4096),Math.min(Math.max(Ie($(".or-export-y").val()),100),4096));i.draw(t),St("solar_system.svg",t._render())});t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";$(".ORhost",i._context).bind(t,function(t){i._displaywheel(t.originalEvent)}),this._extras=[],0<this._settings.ADDBODY_ID&&(this._extras=[this._settings.ADDBODY_ID],$(".or_vis",this._context).prop("checked",!1)),this.objectCalc=new Z(0,0,function(){}),this.objectCalc._setObjList(this._extras,1,function(){0<i._settings.ADDBODY_ID&&i._scaleViewToLastObject(),i.resize(),window.addEventListener("resize",function(){i.resize()}),setInterval(function(){i._updateAlarm()},300)})},Q.prototype.resize=function(){var t,e,i=this;this._width=Math.max(500,this._context.width()),700<this._width&&(this._width-=.15*(this._width-700)),this._height=Math.max(400,$(window).height()-190),this._height=Math.min(this._height,this._width*this._settings.aspectRatio),this._width=Math.min(this._width,1.7*this._height);var s=i._width-32,a=s-90-20,o=i._height/2-24;if($(".ORslidescale2",i._context).width(380).height(i._height),$(".ORslider2",i._context).width(364).css("top",26).css("left",8),$(".ORhost, .ORback, .ORbuf0, .ORfore",i._context).width(i._width).height(i._height),$(".ORload",i._context).css("top",o).width(i._width),$(".ORslidescale",i._context).width(s).height(26),$(".ORslider",i._context).width(a).css("top",26).css("left",90),i.ordate_margin=8,i.ordate_width=380,i.ordate_width2=364,this._smax=150,this._smin=2.5,this._settings.panel){var n=[140,100,70,50,40,30,20,14,10,8,6,4,3],s=$(".ORslidescale",i._context),i=s[0];i.width=s.width(),i.height=s.height();var h=i.getContext("2d");for(h.beginPath(),t=0;t<n.length;t++)e=94+a*Math.log(n[t]/this._smin)/Math.log(this._smax/this._smin),h.moveTo(e,19),h.lineTo(e,25);for(h.strokeStyle="#777",h.lineWidth=1.9,h.stroke(),h.fillStyle="#777",h.font="bold 11px Arial,Helvetica,sans-serif",h.textBaseline="middle",h.textAlign="center",h.fillText("Field of view / AU:",49,10),t=0;t<n.length;t++)e=94+a*Math.log(n[t]/this._smin)/Math.log(this._smax/this._smin),h.fillText(n[t]+"",e,10)}this._labelDateSlide(),this._graphics_context._resize(this._width,this._height)},Q.prototype.hypot=function(t,e){return Math.sqrt(t*t+e*e)},$(function(){$(".orrery").each(function(t,e){var i=$(e),e=new Q(i.data("meta"),i);i.data("handler",e)})}),K.prototype._ore_setup=function(){var e=this;this._refresh=0,this._oldDate=0,this._oldDwarf=0,this._lock=0,this._itemsToLoad=2,jQuery.getJSON(window.server+"json/objects_0_00_00.json",function(t){e._stars=t.stars,e._dsos=t.dsos,e._ore_setup_2()}),jQuery.getJSON(window.server+"json/constellations.json",function(t){e._conb=t.boundaries,e._conl=t.lines.simplified,e._conp=t.name_places,e._ore_setup_2()})},K.prototype._ore_setup_2=function(){var s=this;--this._itemsToLoad,$(".OEloadstat",this._context).html(3-this._itemsToLoad+""),0<this._itemsToLoad||($(".OEload",this._context).css("display","none"),this._hoverman=new I($(".OEhost",this._context),!1,function(t,e,i){s._ore_mousePos(t,e,i)},function(t,e,i){s._ore_mouseClk(t,e,i)},!1),this._ore_resize(),$(window).resize(function(){s._ore_resize()}),setInterval(function(){s._ore_updateAlarm()},300))},K.prototype._ore_eclipticProj=function(t,e,i,s,a){var o=Math.asin(Math.sin(e)*Math.sin(s)+Math.cos(s)*Math.cos(e)*Math.cos(a-t)),n=Math.cos(e)*Math.sin(a-t)/Math.cos(o),t=(Math.cos(s)*Math.sin(e)-Math.sin(s)*Math.cos(e)*Math.cos(a-t))/Math.cos(o);return[i+Math.atan2(n,t),o]},K.prototype._ore_project=function(t,e){for(;t<0;)t+=2*Math.PI;for(;t>2*Math.PI;)t-=2*Math.PI;return[this._width*(1-t/2/Math.PI),this._height*(30/66-180*e/Math.PI/66)]},K.prototype._ore_magRad=function(t){var e=4*this._settings.starsize*Math.min(this._width/1e3,1.25);return t<0?e:e/Math.pow(1.25,1.8*t)},K.prototype._ore_draw=function(){if(this._lock||!("orrery"in this)||!("objectCalc"in this.orrery)||!("sunPos"in this.orrery.objectCalc))return 1;var t,e,i,s,a,o,n;this._lock=1,this._oldDate=this.orrery.eclpass_utm,this._oldDwarf=$(".or_dwarf",this.orrery._context).prop("checked");var h=this._stars,r=this._conb,_=this._conl,l=$(".OEbuf0",this._context)[0];l.width=this._width,l.height=this._height;var c=l.getContext("2d");this._width=l.width,this._height=l.height,this._hoverman.reset(),c.lineWidth=this._settings.ecliwid,c.strokeStyle=this._settings.colors[0].eclicol,c.beginPath();var p=1,d=a=void 0;for(v=0;v<361;v+=2){var u,f=this._ore_eclipticProj(v*Math.PI/180,0,1.5*Math.PI,.37*Math.PI,Math.PI/2);(u=this._ore_project(f[0],f[1]))?(i=u[0],s=u[1],a=(d=(p=0<v&&(isNaN(i)||isNaN(s)||isNaN(d)||isNaN(a)||Math.sqrt(Math.pow(i-d,2)+Math.pow(s-a,2))>this._width/2)?1:(p?c.moveTo(i,s):c.lineTo(i,s),0),i),s)):p=1}for(c.stroke(),c.strokeStyle=this._settings.colors[0].conlcol,c.lineWidth=this._settings.conlwid,P=0;P<_.length;P++)(u=this._ore_project(_[P][0],_[P][1]))&&(n=this._ore_project(_[P][2],_[P][3]))&&(i=u[0],s=u[1],d=n[0],a=n[1],isNaN(i)||isNaN(s)||isNaN(d)||isNaN(a)||Math.sqrt(Math.pow(i-d,2)+Math.pow(s-a,2))>this._width/2||(c.beginPath(),c.moveTo(i,s),c.lineTo(d,a),c.stroke()));for(c.strokeStyle=this._settings.colors[0].conbcol,c.lineWidth=this._settings.conbwid,P=0;P<r.length;P++){for(var g=n=0,m=[],v=1;v<r[P].length;v++){if((u=this._ore_project(r[P][v][0],r[P][v][1]))&&n){if(i=u[0],s=u[1],d=n[0],a=n[1],isNaN(i)||isNaN(s)||isNaN(d)||isNaN(a)||Math.sqrt(Math.pow(i-d,2)+Math.pow(s-a,2))>this._width/2)continue;m.push([i,s]),c.beginPath(),c.moveTo(i,s),c.lineTo(d,a),c.stroke()}n=u,0===v&&(g=u)}this._hoverman.hoverPolygon(P+1,m,!0),i=u[0],s=u[1],d=g[0],a=g[1],isNaN(i)||isNaN(s)||isNaN(d)||isNaN(a)||Math.sqrt(Math.pow(i-d,2)+Math.pow(s-a,2))>this._width/2||(c.beginPath(),c.moveTo(i,s),c.lineTo(d,a),c.stroke())}for(c.fillStyle=this._settings.colors[0].starcol,P=0;P<h.length;P++){var x=h[P][4];if(5<x)break;(o=this._ore_project(h[P][1],h[P][2]))&&(c.beginPath(),t=o[0],e=o[1],isNaN(t)||isNaN(e)||(x=this._ore_magRad(x),c.arc(t,e,x,0,2*Math.PI,!1),c.fill()))}var y=this.orrery,w=y.objectCalc,M=[w._sun].concat(w._elements),k=[w.sunPos[0]].concat(y._planetPos);c.strokeStyle="#000000",c.lineWidth=1.5,c.font="bold 11px Arial,Helvetica,sans-serif",c.textBaseline="middle",c.textAlign="left";for(var b=0,P=(this.pl=k).length-1;0<=P;P--)if(this._oldDwarf||1!==M[P][w._ARG_OBJTYPE]){if(0===P){b=k[P].RA*Math.PI/12;var I=-1;for(v=-3*Math.PI/12;v<=3*Math.PI/12;v+=.02*Math.PI/12)c.fillStyle="rgba(0,0,196,"+.8*Math.exp(-v*v*3)+")",o=this._ore_project(b+v,u[1]),t=Math.floor(o[0]),-1===I&&(I=t+1),I<t&&(I=l.width),c.fillRect(t,0,I-t,l.height),I=t}if(!(o=this._ore_project(k[P].RA*Math.PI/12,k[P].Dec*Math.PI/180)))continue;if(t=o[0],e=o[1],isNaN(t)||isNaN(e))continue;c.fillStyle="#ff00ff",c.beginPath(),c.arc(t,e,4,0,2*Math.PI,!1),c.stroke(),c.fill(),c.strokeText(k[P].name,t+8,e),c.fillText(k[P].name,t+8,e)}c.strokeStyle="#808080",c.moveTo(0,l.height-22),c.lineTo(l.width,l.height-22),c.stroke(),c.fillStyle="rgba(0,0,0,0.7)",c.fillRect(0,l.height-22,l.width,22);y=-31*Math.PI/180;return c.fillStyle="#eee",c.font="bold 13px Arial,Helvetica,sans-serif",c.textAlign="center",o=this._ore_project(b,y),c.fillText("Daylight",o[0],l.height-11),o=this._ore_project(b+Math.PI/2,y),c.fillText("Evening Sky",o[0],l.height-11),o=this._ore_project(b+Math.PI,y),c.fillText("Opposition",o[0],l.height-11),o=this._ore_project(b+3*Math.PI/2,y),c.fillText("Morning Sky",o[0],l.height-11),this._lock=0},K.prototype._ore_mousePos=function(t,e,i){var s=$(".OEhover",this._context);0!==t?(t=this._conb[t-1][0][1],s.css("width","100px"),s.css("left",e-50+"px"),s.css("top",i+12+"px"),s.css("display","block"),s.html(t)):s.css("display","none")},K.prototype._ore_mouseClk=function(t){0!==t?(t=this._conb[t-1][0][0],window.open(window.server+"data/constellation.php?id="+t)):el.css("display","none")},K.prototype._ore_updateAlarm=function(){var t=!1;if(!("orrery"in this)){var e=this._orrery_el.data("handler");if(void 0===e)return;this.orrery=e,t=!0,this._refresh=!0}this._oldDate!==this.orrery.eclpass_utm&&(this._refresh=1),this._oldDwarf!==$(".or_dwarf",this.orrery._context).prop("checked")&&(this._refresh=1),this._refresh&&(t?this._ore_resize():this._refresh=this._ore_draw())},K.prototype._ore_resize=function(){this._width=this._context.width(),"orrery"in this&&(this._width=this.orrery._width),this._height=this._width*this._settings.aspectRatio,this._refresh=this._ore_draw()},$(function(){$(".orrery_ecliptic").each(function(t,e){var i=$(e),e=new K(i.data("meta"),i);i.data("handler",e)})}),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},window.addEventListener("scroll",function(){requestAnimationFrame(tt)},!1),et.prototype._setup_2=function(){var t,e,s=this;if(--this._itemsToLoad,$(".PLloadstat",s._context).html(3-this._itemsToLoad+""),!(0<this._itemsToLoad)){$(".PLload",s._context).css("display","none"),$(".PLhost",s._context).css("visibility","visible");var i=$(".PLfore",s._context);this._hoverman=new I(i,!1,!1,function(t){s._hoverClick(t)},!1),this._hovermankeys={},this._hovermannextkey=1,this._hoverTextCache={},this._hideInstruct=1,setTimeout(function(){s._pl_hideinstruct()},5e3);var a=function(){s._timeSliderChange()};for(this._sliderUpdateCountdown=100,this._sliderTimeSteps=100,this._sliderTimeSpan=10800,this._sliderDateSteps=75,this._sliderDateSpan=86164.0905*this._sliderDateSteps,this._utc_offset_time=0,this._utc_offset_date=0,$(".information_holder .close_info_button").click(function(){s._settings.gotoRA=s._settings.gotoDec=void 0,s._refresh=!0,$(".information_holder").hide()}),$(".slidertime",s._context).slider({min:-this._sliderTimeSteps,max:this._sliderTimeSteps,value:0,change:a,slide:a}),$(".sliderdate",s._context).slider({min:-this._sliderDateSteps,max:this._sliderDateSteps,value:0,change:a,slide:a}),$(".toolbar_button_ffwd",s._context).click(function(){$(".toolbar_button_ffwd",s._context).addClass("active"),$(".toolbar_button_play",s._context).removeClass("active"),$(".toolbar_button_pause",s._context).removeClass("active"),s._animate_time=!0,s._freeze_time=!1}),$(".toolbar_button_play",s._context).click(function(){$(".toolbar_button_ffwd",s._context).removeClass("active"),$(".toolbar_button_play",s._context).addClass("active"),$(".toolbar_button_pause",s._context).removeClass("active"),s._animate_time=!1,s._freeze_time=!1}),$(".toolbar_button_pause",s._context).click(function(){$(".toolbar_button_ffwd",s._context).removeClass("active"),$(".toolbar_button_play",s._context).removeClass("active"),$(".toolbar_button_pause",s._context).addClass("active"),s._animate_time=!1,s._freeze_time=!0}),this.ready=1,this._ncpup=!1,this.gotoCoordinates(this._settings),this._change_orientation(),$(".chkncpup, .chkfreerot, .chkorient",s._context).change(function(){s._change_orientation(),s._rotate(0,0,0)}),this.gotoCoordinates(this._settings),$(".toggle_hide_panel",s._context).click(function(){$(".toggle_hide_panel, .toggle_panel_target",s._context).hide(),$(".toggle_show_panel",s._context).show(),$(".toggle_companion",s._context).css("clear","both"),s.resize()}),$(".toggle_show_panel",s._context).click(function(){$(".toggle_hide_panel, .toggle_panel_target",s._context).show(),$(".toggle_show_panel",s._context).hide(),$(".toggle_companion",s._context).css("clear","none"),s.resize()}),$(".year, .month, .day, .hour, .min",s._context).change(function(){s._gotoSelectedTime()}),$(".pl_search",s._context).keypress(function(t){13===t.keyCode&&s._pl_search()}),$(".pl-search-btn",s._context).click(function(){s._pl_search()}),$(".pl-location-btn",s._context).click(function(){window.location=window.server+"location.php"}),$(".pl-png",s._context).click(function(){var t=Math.min(Math.max(Ie($(".pl-export-x").val()),100),4096),e=Math.min(Math.max(Ie($(".pl-export-y").val()),100),4096),i=new zt(document.createElement("canvas"),t,e),e=new zt(document.createElement("canvas"),t,e);s.draw(i,e),i._composite(e),i._renderPNG("sky_view.png")}),$(".pl-svg",s._context).click(function(){var t=Math.min(Math.max(Ie($(".pl-export-x").val()),100),4096),e=Math.min(Math.max(Ie($(".pl-export-y").val()),100),4096),i=new Rt(t,e),e=new Rt(t,e);s.draw(i,e),i._composite(e),St("sky_view.svg",i._render())}),i.mousedown(function(t){s._mouseDown(t)}),i.mouseup(function(t){s._mouseUp(t)}),i.mousemove(function(t){s._mouseDrag(t)}),i.mouseleave(function(){s._mouseUp(0)}),s._is_pinching=!1,s._pinch_distance=0,i.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(s._is_pinching=!1,s._mouseDown(t.touches[0])):2===t.touches.length&&(s._is_pinching=!0,s._pinch_distance=s.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),s._is_pinching||s._mouseUp(0),s._is_pinching=!1,s.mousedown=0},touchmove:function(t){t.preventDefault();var e=t.originalEvent;s._is_pinching?(t=s.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),25<Math.abs(t-s._pinch_distance)&&(s._displaywheel(e.touches[0],s._pinch_distance-t),s._pinch_distance=t)):s._mouseDrag(e.touches[0])},touchcancel:function(t){t.preventDefault(),s._is_pinching||s._mouseUp(0),s._is_pinching=!1,s.mousedown=0}}),e=["chkss","chkls","chksn","chkln","chksp","chklp","chkcb","chkcl","chkcn","chkragrid","chkeclipt","chkgalact","chkgalash","chkscaleb","chkaltazg","chkdaylig","chkhorizo","pl_colors","pl_stick_design"],t=this._shownRGinfo=0;t<e.length;t++)$("."+e[t],s._context).click(function(){s._refresh=1});$(".pl-colors-custom").click(function(){window.location=window.server+"starchart_config.php"}),(a=$(".PLlimitmag",s._context)).on("click",function(){s._refresh=1});i=s._settings.allsky||s._settings.domeview?0:2;"limitmag"in s._settings&&(i=s._settings.limitmag),a.val(i),s._limitmag=99,this._show_horizon=!this._settings.atlas,$(".toggle-horizon",s._context).on("click",function(){s._show_horizon=$(".toggle-horizon",s._context).is(":checked"),s._settings.atlas=!1,s._show_horizon?($(".chkhorizo",s._context).prop("checked",!0),$(".chkdaylig",s._context).prop("checked",!0),$(".chkorient",s._context).prop("checked",!0)):($(".chkhorizo",s._context).prop("checked",!1),$(".chkdaylig",s._context).prop("checked",!1),$(".chkncpup",s._context).prop("checked",!0)),s._refresh=1}),$(".chkthreedim",s._context).on("click",function(){s._refresh=1,s._shownRGinfo||(alert("Red-green glasses are needed to view the 3D star chart. Your eyes may take a moment to adapt to focusing in front of and behind the screen. Note that the illusion will not be visible if your head is tipped to either side. Try scrolling around the star chart, as the movement may help."),s._shownRGinfo=1)});i="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";this._settings.allsky||this._settings.domeview||this._settings.earth||$(".PLfore",s._context).bind(i,function(t){s._displaywheel(t.originalEvent)}),"addTrack"in this._settings&&this.computeTrack(this._settings.addTrack),this.resize(),"warning"in this._settings&&this._settings.warning&&alert(this._settings.warning),$(window).resize(function(){s.resize()}),setInterval(function(){var t=s._settings.domeview||s._settings.allsky?300:120;s._animate_time&&s.gotoUtcTime(s._utc_centre+s._utc_offset_date+s._utc_offset_time+t),s._updateAlarm()},200)}},et.prototype._updateDateSelect=function(){var i=this,s=be._unix_to_calendar(this._utc_centre+this._utc_offset_time+this._utc_offset_date+this._tzOffset.offset(this._utc_centre));$.each([["day",2],["month",1],["year",0],["hour",3],["min",4]],function(t,e){i._selectedTime.hasOwnProperty(e[0])&&i._selectedTime[e[0]]===s[e[1]]||(i._selectedTime[e[0]]=s[e[1]],$("."+e[0],i._context).val(s[e[1]]))})},et.prototype._updateSliderPosition=function(){var t=Math.floor(this._utc_offset_time/this._sliderTimeSpan*this._sliderTimeSteps+.5),e=Math.floor(this._utc_offset_date/this._sliderDateSpan*this._sliderDateSteps+.5);t<-this._sliderTimeSteps||t>this._sliderTimeSteps||e<-this._sliderDateSteps||e>this._sliderDateSteps?this.gotoUtcTime(this._utc_centre+this._utc_offset_time+this._utc_offset_date):($(".slidertime",self._context).slider("value",t),$(".sliderdate",self._context).slider("value",e))},et.prototype._updateClockDisplay=function(){var t,e,i=this.monthNames,s=be._unix_to_calendar(this.utc_drawn+this._tzOffset.offset(this.utc_drawn)),a=$(".digiclkA",this._context);a.length&&("0"===(t=(e=Pe(s[3])).slice(0,1))&&(t="X"),e='<div class="its-img its-clk'+t+'"></div><div class="its-img its-clk'+e.slice(1,2)+'"></div><div class="its-img its-clkC"></div><div class="its-img its-clk'+(e=Pe(s[4])).slice(0,1)+'"></div><div class="its-img its-clk'+e.slice(1,2)+'"></div><div class="its-clkTZ">'+this._tzOffset._tzName(this.utc_drawn)+"</div>",a.html(e)),0<(a=$(".digiclkB",this._context)).length&&a.html(s[2]+" "+i[s[1]]+" "+s[0]),e=Pe(s[3])+":"+Pe(s[4])+" "+this._tzOffset._tzName(this.utc_drawn)+" on "+s[2]+" "+i[s[1]]+" "+s[0],$(".PLtimedate",this._context).html(e)},et.prototype._gotoNow=function(){this.gotoUtcTime(be._utc_now())},et.prototype.gotoUtcTime=function(t){this._utc_offset_date=0,this._utc_offset_time=0,this._utc_centre=t,this._updateSliderPosition(),this._utc_real_time_offset=t-be._utc_now(),this._timeSliderLabel(),this._timeAutoincrement()},et.prototype._gotoSelectedTime=function(){var t=this,e=be._unix_to_calendar(this._utc_centre+this._tzOffset.offset(this._utc_centre)),i=parseInt($(".day",t._context).val()),s=parseInt($(".month",t._context).val()),a=parseInt($(".year",t._context).val()),o=parseInt($(".hour",t._context).val()),n=parseInt($(".min",t._context).val()),t=parseInt($(".sec",t._context).val());isNaN(o)&&(o=e[3]),isNaN(n)&&(n=e[4]),isNaN(t)&&(t=e[5]);t=be._calendar_to_unix(a,s,i,o,n,t);t-=this._tzOffset.offset(t),this.gotoUtcTime(t)},et.prototype._timeAutoincrement=function(){var t=this._utc_real_time_offset,e=be._utc_now()+this._utc_real_time_offset;this._utc_offset_time=e-(this._utc_centre+this._utc_offset_date),this._sliderUpdateCountdown--,this._sliderUpdateCountdown<=0&&(this._updateSliderPosition(),this._sliderUpdateCountdown=100),this._utc_real_time_offset=t,this._setDisplayedTime(e)},et.prototype.gotoCoordinates=function(t){this.ready&&(this.gotoUtcTime(parseFloat(t.gotoTime)),"gotoRA"in t&&null!==t.gotoRA?this.pl_gotoPos(parseFloat(t.gotoRA),parseFloat(t.gotoDec),1):"gotoAlt"in t&&null!==t.gotoAlt?this.pl_gotoPos(-t.gotoAzi/180*12,t.gotoAlt,0):this.pl_gotoPos(0<=t.lat?12:0,25,0),this.draw())},et.prototype._timeSliderLabel=function(){for(var t,e,i=this.monthNames,s=this._utc_centre+this._tzOffset.offset(this._utc_centre),a=[[null,this._sliderTimeSpan,this._sliderTimeSteps,".slidetime",3,1,s+this._utc_offset_date],[null,this._sliderDateSpan,this._sliderDateSteps,".slidedate",3,0,s+this._utc_offset_time]],o=0;o<a.length;o++){var n=a[o][1],h=a[o][3],r=a[o][4],_=a[o][5],l=a[o][6],c=[],h=$(h,self._context);if(h.length){for(t=-(r-1);t<=r-1;t++){var p,d,u=be._unix_to_calendar(l+t*n/r);_?(d=u[4],p=u[3],c.push([(t+r)/(2*r),Pe(p)+":"+Pe(d)])):(d=u[2],u=u[1],c.push([(t+r)/(2*r),Pe(d)+" "+i[u]]))}h[0].width=h[0].width,h[0].height=h[0].height;var f=h[0].getContext("2d");for(f.beginPath(),t=0;t<c.length;t++)e=12+274*c[t][0],f.moveTo(e,19),f.lineTo(e,25);for(f.strokeStyle="#777",f.lineWidth=1.9,f.stroke(),f.fillStyle="#777",f.font="bold 11px Arial,Helvetica,sans-serif",f.textBaseline="middle",f.textAlign="center",t=0;t<c.length;t++)e=12+274*c[t][0],f.fillText(c[t][1],e,10)}}},et.prototype._timeSliderChange=function(){var t=$(".slidertime",this._context).slider("value"),e=$(".sliderdate",this._context).slider("value");if(this._utc_offset_time=t*this._sliderTimeSpan/this._sliderTimeSteps,this._utc_offset_date=e*this._sliderDateSpan/this._sliderDateSteps,this._utc_real_time_offset=this._utc_centre+this._utc_offset_time+this._utc_offset_date-be._utc_now(),this._refresh=1,!this._timeSliderChangeLock)try{this._timeSliderChangeLock=!0,this._sliderUpdateCountdown=0,this._timeAutoincrement(),this._timeSliderLabel()}finally{this._timeSliderChangeLock=!1}},et.prototype._pl_eclipticProj=function(t,e,i,s,a){var o=Math.asin(Math.sin(e)*Math.sin(s)+Math.cos(s)*Math.cos(e)*Math.cos(a-t)),n=Math.cos(e)*Math.sin(a-t)/Math.cos(o),t=(Math.cos(s)*Math.sin(e)-Math.sin(s)*Math.cos(e)*Math.cos(a-t))/Math.cos(o);return[i+Math.atan2(n,t),o]},et.prototype._field_of_view=function(t){return Math.exp(this.scale/200*Math.log(this._smax/this._smin))*this._smin},et.prototype._pl_inv_project=function(t,e,i,s,a){var o=this._field_of_view(this.scale),o=s/2/Math.tan(o*Math.PI/180/4);t-=s/2,e-=a/2;var n,h,r,_,l,s=Math.atan2(-t,e);l=this._settings.domeview?(n=t/(r=(a-55)/2),h=e/r,r=Math.sqrt(1-n*n-h*h),this.matrix_inv._multiply_vector(new p(n,h,r))):this._settings.allsky?(_=Math.sqrt(t*t+e*e)/(a-55)*Math.PI-Math.PI/2,s+=this._allskyrot,new p(n=Math.cos(_)*-Math.sin(s),h=Math.sin(_),r=Math.cos(_)*-Math.cos(s))):(t/=o,e/=o,_=Math.sqrt(t*t+e*e),l=Math.PI/2-2*Math.atan(_),c=Math.sin(l),_=Math.sin(s)*Math.cos(l),l=Math.cos(s)*Math.cos(l),this.matrix_inv._multiply_vector(new p(_,l,c))),i||this._ncpup||(l=(l=l._rotate_yz(-(Math.PI/2-this._settings.lat)))._rotate_xz(-this._hourangle)),i&&this._ncpup&&(l=(l=l._rotate_xz(this._hourangle))._rotate_yz(Math.PI/2-this._settings.lat));var c=Math.atan2(l._x,l._z);return i&&(c=Math.PI-c),[c,Math.asin(-l._y)]},et.prototype._pl_project=function(t,e,i,s,a,o){e=new p(Math.sin(t)*Math.cos(e),-Math.sin(e),Math.cos(t)*Math.cos(e));s||this._ncpup||(e=(e=e._rotate_xz(this._hourangle))._rotate_yz(Math.PI/2-this._settings.lat)),s&&this._ncpup&&(e=(e=e._rotate_yz(-(Math.PI/2-this._settings.lat)))._rotate_xz(-this._hourangle));var n,s=0;if(this._settings.domeview)n=this._matrix._multiply_vector(e),i=(o-55)/2,r=Math.atan2(-n._x,n._y),_=this.hypot(n._x,n._y),s=n._z;else if(this._settings.allsky){if(_=Math.PI/2+Math.asin(e._y),r=Math.atan2(-e._x,-e._z)+this._allskyrot,i=(o-55)/Math.PI,_>Math.PI/2)return!1}else{1<(n=this._matrix._multiply_vector(e))._z&&(n._z=1),n._z<-1&&(n._z=-1);var h=Math.asin(n._z),r=Math.atan2(n._x,n._y),_=Math.tan((Math.PI/2-h)/2)}h=_*Math.cos(r);return[_*-Math.sin(r)*i,h*i,s]},et.prototype._setDisplayedTime=function(t){if(this._refreshTime)t=this._utc_planets,this._utc_planets=-1,this._refreshTime=0;else if(t===this._utc_planets)return;1800<Math.abs(t-this._utc_planets)&&(this._utc_planets=t,e=this._objectCalc,this.planetPos=e._getTrack([t])[0],this.planetPos=[e.sunPos[0]].concat(this.planetPos)),this._hourangle=(st(t)/12*Math.PI+this._settings.lng)%(2*Math.PI),this.utc_drawn=t;var e=12*this._hourangle/Math.PI,t=Math.floor(e).toString();t.length<2&&(t="0"+t);e=(Math.floor(60*e)%60).toString();e.length<2&&(e="0"+e),$(".disp_st",self._context).html(t+"h"+e+"m");e=Math.floor((this.utc_drawn-947182440)/2551442.9%1*2551442.9/86400);$(".disp_ma",self._context).html(e+" day"+(1<e?"s":"")),this._refresh=1},et.prototype._pl_search=function(){var t,e,i,s,a,o,n=this,h=this._conp,r=$(".pl_search",n._context),_=r.val().toLowerCase().replace(/ /g,"");if(!(_.length<1)){for(20<_.length&&(_=_.substr(0,20)),t=0;t<h.length;t++)if(_===h[t][0].toLowerCase())return e=12*h[t][1]/Math.PI,i=180*h[t][2]/Math.PI,s=h[t].length,a=h[t][s-1][1],o="json/objecthover.php?const="+a,this.pl_gotoPos(e,i,2),void this._hoverClick(null,!0,o,e,i);for(t=0;t<this._stars["0_00_00"].length;t++)if(this._stars["0_00_00"][t][0]&&_===this._stars["0_00_00"][t][0].toLowerCase())return e=12*this._stars["0_00_00"][t][1]/Math.PI,i=180*this._stars["0_00_00"][t][2]/Math.PI,a=this._stars["0_00_00"][t][7],o="json/objecthover.php?id="+a,this.pl_gotoPos(e,i,2),void this._hoverClick(null,!0,o,e,i);for(t=0;t<this._dsos["0_00_00"].length;t++)if(this._dsos["0_00_00"][t][0]&&_===this._dsos["0_00_00"][t][0].toLowerCase())return e=12*this._dsos["0_00_00"][t][1]/Math.PI,i=180*this._dsos["0_00_00"][t][2]/Math.PI,a=this._dsos["0_00_00"][t][6],o="json/objecthover.php?id="+a,this.pl_gotoPos(e,i,2),void this._hoverClick(null,!0,o,e,i);for(t=0;t<this.planetPos.length;t++)if(_===this.planetPos[t].name.toLowerCase())return e=this.planetPos[t].RA,i=this.planetPos[t].Dec,a=this.planetPos[t].objId,o="json/objecthover.php?id="+a,this.pl_gotoPos(e,i,2),void this._hoverClick(null,!0,o,e,i);20<(_=r.val()).length&&(_=_.substr(0,20)),jQuery.getJSON(window.server+"json/objectsearch.php",{cat:0,s:_},function(t){t&&0<t.objId?(r.val(t.name),Ie(t.moving)?n.pl_setExtraObjects([t.objId],!0):(e=t.RA,i=t.Decl,a=t.objId,o="json/objecthover.php?id="+a,n.pl_gotoPos(e,i,2),n._hoverClick(null,!0,o,e,i))):alert("Could not find object '"+_+"'")})}},et.prototype.pl_setExtraObjects=function(t,a){var o=this,n=o._objectCalc;o._extras=t,n._setObjList(o._extras,1,function(){var t=o._utc_planets;o.planetPos=n._getTrack([t])[0],o.planetPos=[n.sunPos[0]].concat(o.planetPos);var e,i=o.planetPos,s=i.length;a&&(e=i[s-1].RA,t=i[s-1].Dec,s="json/objecthover.php?id="+i[s-1].objId,o.pl_gotoPos(e,t,2),o._hoverClick(null,!0,s,e,t)),o._refresh=1})},et.prototype.pl_gotoPos=function(t,e,i){var s,a,o;isNaN(t)||isNaN(e)||(s=new d,2===i&&(this._settings.gotoRA=t,this._settings.gotoDec=e),this._ncpup&&i&&(t=12+t),1!==i||this._settings.noTimeChange||(Math.abs(e*Math.PI/180-this._settings.lat)>85*Math.PI/180&&$(".chkhorizo",self._context).prop("checked",!1),a=R(e*Math.PI/180,this._settings.lat,0)/3600,12<(o=Math.abs(this._hourangle/Math.PI*12%24-t))&&(o=24-o),0<a&&.9*a<o&&(o=Math.floor(t-this._hourangle/Math.PI*12%24+.5),this._hourangle=(this._hourangle+o/12*Math.PI)%(2*Math.PI),this.gotoUtcTime(this._utc_centre+23.9344696*o/24*3600))),s=i&&!this._ncpup?s._rotate_m_yz(-(Math.PI/2-this._settings.lat)):s,e=(i&&!this._ncpup?s._rotate_m_xz(this._hourangle-t*Math.PI/12):s._rotate_m_xz((12-t)*Math.PI/12))._rotate_m_yz(-e*Math.PI/180),this._matrix_=e,this.allskyrot_=0,this._rotate(0,0,0))},et.prototype._change_orientation=function(){var t=this._getInputSwitch("chkncpup",!1)||this._settings.atlas||this._settings.earth,e=this._ncpup!==t,i=[0,0];e&&(i=this._pl_inv_project(this._width/2,this._height/2,0,this._width,this._height)),this._ncpup=t,e&&(e=this._settings.noTimeChange,this._settings.noTimeChange=!0,this.pl_gotoPos(12*i[0]/Math.PI,180*i[1]/Math.PI,1),this._settings.noTimeChange=e)},et.prototype._rotate=function(t,e,i){var s=this._field_of_view(this.scale),a=this._width/2/Math.tan(s*Math.PI/180/4),o=this._matrix_._rotate(t/a,e/a),s=o._to_euler_angles(),t=s[0],e=s[1],a=s[2],s=$(".chkfreerot",this._context);0!==s.count&&s.prop("checked")||(o=f(t,e=0,a));s=(s=new d)._rotate_m_xy(e)._rotate_m_yz(t)._rotate_m_xz(a);this._matrix=o,this.matrix_inv=s,this._allskyrot=(this.allskyrot_+i)%(2*Math.PI),this._refresh=1},et.prototype._pl_updateCursorPosition=function(t){var e=this._pl_inv_project(t[0],t[1],0,this._width,this._height),i=this._pl_inv_project(t[0],t[1],1,this._width,this._height);if(this._settings.domeview&&!isFinite(e[0])||this._settings.allsky&&i[1]<0)$(".disp_ra, .disp_dec, .disp_azi, .disp_alt",self._context).html("&ndash;");else{var s=12*e[0]/Math.PI;s<0&&(s+=24);t=180*e[1]/Math.PI,e=Math.floor(s).toString();e.length<2&&(e="0"+e);s=(Math.floor(60*s)%60).toString();s.length<2&&(s="0"+s);t=Math.floor(t).toString();$(".disp_ra",self._context).html(e+"h"+s+"m"),$(".disp_dec",self._context).html(t+"&deg;");t=180*i[0]/Math.PI;t<0&&(t+=360);for(var i=180*i[1]/Math.PI,a=t.toFixed(1);a.length<5;)a="0"+a;for(var o=i.toFixed(1);o.length<4;)o="0"+o;$(".disp_azi",self._context).html(a+"&deg;"),$(".disp_alt",self._context).html(o+"&deg;")}},et.prototype._pl_hideinstruct=function(){var t=this;t._hideInstruct&&(t._hideInstruct=0,$(".PLinstruct",t._context).stop().animate({opacity:0},600,function(){$(".PLinstruct",t._context).css("display","none")}))},et.prototype._mouseDown=function(t){t=At(t,$(".PLhost",self._context));this._matrix_=this._matrix,this.allskyrot_=this._allskyrot,this.pos_=t,this.mousedown=1},et.prototype._mouseDrag=function(t){var e,i,s,a;this._hideInstruct&&this._pl_hideinstruct(),0===t?a=[this._mousex,this._mousey]:(a=At(t,$(".PLhost",self._context)),this._mousex=a[0],this._mousey=a[1]),this._pl_updateCursorPosition(a),this.mousedown&&(e=a[0]-this.pos_[0],i=a[1]-this.pos_[1],s=this._width/2,t=this._height/2,a=Math.atan2(this.pos_[0]-s,this.pos_[1]-t)-Math.atan2(a[0]-s,a[1]-t),t=1,this._settings.earth&&(t=-2),this._settings.domeview&&(e*=-1,t=2.5),e*=t,i*=t,this._rotate(-e,i,a))},et.prototype._mouseUp=function(t){this._mouseDrag(t),this.mousedown=0},et.prototype._displaywheel=function(t,e){var i;this._settings.allsky||this._settings.domeview||(t.preventDefault&&t.preventDefault(),t.returnValue=!1,i=Date.now(),void 0!==this._lastZoomEventTime&&i<this._lastZoomEventTime+100||(this._lastZoomEventTime=i,i=void 0!==e?e:t.deltaY||t.wheelDelta,e=this._field_of_view(this.scale),i<0?(this.scale-=3,this.scale<=0&&(this.scale=0)):(this.scale+=3,200<=this.scale&&(this.scale=200)),i=e/this._field_of_view(this.scale),(e=At(t,$(".PLhost",self._context)))[0]=parseInt(e[0])-this._width/2,e[1]=parseInt(e[1])-this._height/2,t=e[0]*(1-i)*1.75,i=e[1]*(1-i)*1.75,this.mousedown||(this._matrix_=this._matrix),this._rotate(-t,i,0),this._settings.panel&&$(".PLslider",self._context).slider("value",this.scale),this._refresh=1))},et.prototype._hoverClick=function(t,e,i,s,a){var o=this;if(void 0===e){if(!t||!this._hovermankeys.hasOwnProperty(t))return;t=this._hovermankeys[t];e=t[0],i=t[1],s=t[2],a=t[3]}this._settings.gotoRA=s,this._settings.gotoDec=a,$(".information_contents").html(""),$(".information_holder").show();function n(t){$(".information_contents").html(t)}e?this._hoverTextCache.hasOwnProperty(i)?(e=this._hoverTextCache[i])&&n(e):(this._hoverTextCache[i]=null,jQuery.getJSON(window.server+i,function(t){t.hasOwnProperty("html")&&(o._hoverTextCache[i]=t.html,n(t.html))})):n(i)},et.prototype._updateAlarm=function(){this._refreshTime&&this._setDisplayedTime(0),--this._alarmCounter,!this._refresh&&0<this._alarmCounter||(this._alarmCounter=20,this._freeze_time||this._timeAutoincrement(),this._refresh=this.draw())},et.prototype.circlePosition=function(t,e){this._settings.gotoRA=t,this._settings.gotoDec=e,this._refresh=1},et.prototype._magnitudeRadius_normalise=function(t){var e=Math.max(800,this._width);this._magnitudeRadius_peak=4*this._settings.starsize*(e/900)*Math.pow(50/Math.min(t,40),1.1)},et.prototype._magnitudeRadius=function(t){var e=this._magnitudeRadius_peak;return Math.min(5,e/Math.pow(1.25,2*t))},et.prototype._sep_3d=function(t,e,i){var s=.01*i,i=5*i,i=Math.log(i/s),s=Math.log(t/s);return s<0&&(s=0),i<s&&(s=i),14*e/i*(i-2*s)},et.prototype._getInputSwitch=function(t,e){if(void 0===e&&(e=!1),this._settings.hasOwnProperty(t))return this._settings[t];t=$("."+t,this._context);return 0===t.length?e:t.prop("checked")},et.prototype.resize=function(){var t,e,i,s,a,o,n=this,h=$(".planetarium",this._context).width();(this._settings.allsky||this._settings.domeview)&&(h=Math.max(500,h)),this._full_width=h,this._width=h,800<this._width&&(this._width-=.05*(this._width-800)),this._height=Math.max(500,$(window).height()-(this._settings.allsky||this._settings.domeview?-100:190)),this._height=Math.min(this._height,this._width*this._settings.aspectRatio),this._width=Math.min(this._width,1.9*this._height);var r=this._width-24-105-10;$(".PLhost",this._context).css("padding-top","0"),$(".PLhost, .PLback, .PLbuf0, .PLbuf2, .PLfore",this._context).width(this._width).height(this._height),$(".PLslidescale",this._context).width(this._width-24).height(26),$(".PLslider",this._context).width(r).css("top",26).css("left",105);var _=$(".PLinstruct",this._context);_.css("top",120).css("right",Math.floor((n._width-_.width())/2));h=11;700<this._width&&(h+=Ie((this._width-700)/100));_=$(".PLplace_div",this._context);if(_.css("font-size",h+"px"),!this._settings.allsky&&!this._settings.domeview||0<(h=(this._width-this._height)/2-10)&&_.css("padding-left",Ie(h)+"px"),$(".PLslider",n._context).length){t=[180,150,120,90,75,60,50,40,35,30,25,20,17,15,12,10,8,6,5,4],(i=(e=$(".PLslidescale",n._context))[0]).width=e.width(),i.height=e.height(),(s=i.getContext("2d")).beginPath();var l=1;for(this._width<680&&(l=2),this._width<390&&(l=3),o=0;o<t.length;o+=l)a=89+r*Math.log(t[o]/this._smin)/Math.log(this._smax/this._smin),s.moveTo(a,19),s.lineTo(a,25);for(s.strokeStyle="#888",s.lineWidth=1.9,s.stroke(),s.fillStyle="#888",s.font="bold 11px Arial,Helvetica,sans-serif",s.textBaseline="middle",s.textAlign="center",s.fillText("Field of view:",40.5,10),o=0;o<t.length;o+=l)a=89+r*Math.log(t[o]/this._smin)/Math.log(this._smax/this._smin),s.fillText(t[o]+"°",a,10)}if($(".PLTDslider",n._context).length){for(t=[[10,"Near"],[118,"Far"]],(i=(e=$(".PLTDslidescale",n._context))[0]).width=140,i.height=26,(s=i.getContext("2d")).beginPath(),o=0;o<t.length;o++)a=12+t[o][0],s.moveTo(a,19),s.lineTo(a,25);for(s.strokeStyle="#777",s.lineWidth=1.9,s.stroke(),s.fillStyle="#777",s.font="bold 10px Arial,Helvetica,sans-serif",s.textBaseline="middle",s.textAlign="center",o=0;o<t.length;o++)a=12+t[o][0],s.fillText(t[o][1],a,12)}700<this._width?($(".overlay_collapsing_panel_ctrl",this._context).css("display","none"),$(".close_button",this._context).css("display","none"),$(".dcftoggle_target",this._context).css("display","inline-block").removeClass("overlay_collapsing_panel").addClass("overlay_fixed_panel")):($(".overlay_collapsing_panel_ctrl",this._context).css("display","block"),$(".close_button",this._context).css("display","block"),$(".dcftoggle_target",this._context).css("display","none").addClass("overlay_collapsing_panel").removeClass("overlay_fixed_panel")),this._graphics_context_1._resize(this._width,this._height),this._graphics_context_2._resize(this._width,this._height),this.draw()},et.prototype.draw=function(t,e){var i=this;if(this._lock)return 1;if(this._width<10)return 1;this._lock=1;var s=this._graphics_context_1,a=this._graphics_context_2;t&&(s=t,a=e),s._clear(),a._clear();var o=s._width,n=s._height,h=0,r=0;this._settings.allsky||this._settings.domeview||(h=(400<o)+(600<o)+(800<o)+(1e3<o),r=(600<o)+(1e3<o));var _,l,c,p,d,u,f,g,m=Ie($(".pl_colors",this._context).val()),t=Ie($(".pl_stick_design",this._context).val()),v=this._cona,x=(this._conn,this._typename,this._field_of_view(this.scale)),y=o/2/Math.tan(x*Math.PI/180/4),w=1.5,M=this._conb,k=this._conl[["simplified","rey"][t]],b=this._conp,P=o/2,I=n/2;(this._settings.allsky||this._settings.domeview)&&(x=120);var S=2;"limitmag"in i._settings&&(S=i._settings.limitmag),0<(pe=$(".PLlimitmag",i._context)).length&&(S=pe.val()),this._limitmag=3.5+1.2*S,this._settings.allsky||this._settings.domeview||(this._limitmag+=5*(1-this.scale/200)),$(".PLlimitmag_val",i._context).text(this._limitmag.toFixed(1));var T=this._limitmag,e=be._unix_to_calendar(this._utc_centre+this._tzOffset.offset(this._utc_centre)),t=this._pl_inv_project(this._width/2,this._height/2,0,this._width,this._height);t[0]=(12*t[0]/Math.PI+48)%24,t[1]=180*t[1]/Math.PI,$(".planetarium_link").text("no_cookie=1&latitude="+(180*this._settings.lat/Math.PI).toFixed(2)+"&longitude="+(180*this._settings.lng/Math.PI).toFixed(2)+"&timezone="+(this._tzOffset.offset(this._utc_centre)/3600).toFixed(2)+"&year="+e[0]+"&month="+e[1]+"&day="+e[2]+"&hour="+e[3]+"&min="+e[4]+"&PLlimitmag="+S+"&zoom="+this.scale+"&ra="+t[0].toFixed(5)+"&dec="+t[1].toFixed(5));var A,z=this._getInputSwitch("chkss",!0),C=this._getInputSwitch("chkls",!1),R=this._getInputSwitch("chkcb",this._settings.constellationBoundaries),j=this._getInputSwitch("chkcl",!0),D=this._getInputSwitch("chkcn",this._settings.constellationBoundaries||this._settings.constellationNames),N=this._getInputSwitch("chksn",!1),O=this._getInputSwitch("chkln",!1),L=this._getInputSwitch("chkragrid",!1)||this._settings.alwaysShowRaDec,F=this._getInputSwitch("chkaltazg",!1),E=this._getInputSwitch("chkscaleb",!1)&&!this._settings.allsky&&!this._settings.domeview,W=this._getInputSwitch("chkeclipt",!1)||this._settings.alwaysShowEcliptic,U=this._getInputSwitch("chkgalact",!1),H=this._getInputSwitch("chkgalash",!0)&&!this._settings.domeview,G=this._getInputSwitch("chkhorizo",!0)&&!this._settings.allsky&&!this._settings.atlas&&!this._settings.earth,B=this._getInputSwitch("chkdaylig",!0)&&!this._settings.atlas&&!this._settings.domeview&&!this._settings.earth,J=this._getInputSwitch("chkthreedim",!1)&&!this._settings.allsky&&!this._settings.domeview&&!this._settings.atlas&&!this._settings.earth,q=this._getInputSwitch("chksp",!0),Y=this._getInputSwitch("chklp",!0),t=!J,V=this._settings.domeview,X=this._objectCalc,Z=Math.min(56,10+.08*o);this._updateClockDisplay(),this._updateDateSelect(),this._hoverman.reset(),this._hovermankeys={},this._hovermannextkey=1;var Q,K=0;J?(s._fillStyle("#000000"),s._beginPath(),s._rect(0,0,o,n),s._fill(),K=$(".PLTDslider",i._context).slider("value"),K=Math.exp(K/100*Math.log(1e5)),Q=[["#ff0000",s,1],["#00ff00",s,-1]],s._co.globalCompositeOperation="lighter"):(Q=[["",s,0]],s._co.globalCompositeOperation="source-over");for(var tt=Q.length,et=0;et<tt;et++){var it,st,at,ot,nt=1<Q[et][0].length,ht=Q[et][0],rt=Q[et][1],_t=Q[et][2],lt=xe(this._settings.colors[m].bgcol),ct=384<lt[0]+lt[1]+lt[2];"sunPos"in X&&(jt=0,at=X.sunPos[0].RA*Math.PI/12,ot=X.sunPos[0].Dec*Math.PI/180,it=0,st=[Math.sin(at)*Math.cos(ot),-Math.sin(ot),Math.cos(at)*Math.cos(ot)],at=[0,0,0],it=this._hourangle,at[0]=st[0]*Math.cos(it)-st[2]*Math.sin(it),at[1]=st[1],at[2]=st[0]*Math.sin(it)+st[2]*Math.cos(it),ot=[0,0,0],it=Math.PI/2-this._settings.lat,ot[0]=at[0],ot[1]=at[1]*Math.cos(it)-at[2]*Math.sin(it),ot[2]=at[1]*Math.sin(it)+at[2]*Math.cos(it),at=180*Math.asin(ot[1])/Math.PI,B&&!J&&(ot=at<0?1:at<6?.6:at<12?.4:at<18?.2:0,lt=Me(lt,xe(this._settings.colors[m].daylightcol),ot)),0<(pe=$(".digiclkC",i._context)).length&&(ft=at<0?"Daylight":at<6?"Civil<br />twilight":at<12?"Nautical<br />twilight":at<18?"Astronomical<br />twilight":"Astronomical<br />darkness",pe.html(ft)));var pt=ye(lt);if(this._sky_color=pt,!J)if(V){for(a._beginPath(),a._arc(6+P,6+I,(n-56)/2,0,2*Math.PI,!1),a._fillStyle(we(lt,.8)),a._strokeStyle(this._settings.colors[m].daylightcol,6),a._stroke(),a._fill(),a._setClip(),s._beginPath(),s._arc(6+P,6+I,(n-56)/2,0,2*Math.PI,!1),s._fillStyle(pt),s._fill(),s._setClip(),$(".PLhost",i._context).css("border","none"),a._beginPath(),a._fillStyle(this._settings.colors[m].horicol),At=0;At<361;At+=5)qt=(me=this._pl_project(Math.PI*At/180,0,y,1,o,n))[0]+P,Yt=me[1]+I,a._lineTo(qt,Yt);for(a._fill(),a._fillStyle(this._settings.colors[m].cardcol),a._textStyle("Arial,Helvetica,sans-serif",12+h,"bold",""),le=["N","NE","E","SE","S","SW","W","NW"],jt=0;jt<le.length;jt++)At=1-.25*jt,qt=.92*(me=this._pl_project(Math.PI*At,0,y,1,o,n))[0]+P,Yt=.92*me[1]+I,a._text(qt,Yt,0,0,!0,le[jt],!1,!1);var dt=this._pl_project(0,Math.PI/2,y,1,o,n),ut=[dt[1],-dt[0]],ft=5/this.hypot(ut[0],ut[1]),gt=.025;a._strokeStyle(this._settings.colors[m].cardcol,2),a._fillStyle(this._settings.colors[m].cardcol),a._beginPath(),a._moveTo(P-ft*ut[0],I-ft*ut[1]),a._lineTo(P+gt*dt[0],I+gt*dt[1]),a._lineTo(P+ft*ut[0],I+ft*ut[1]),a._moveTo(P+gt*dt[0],I+gt*dt[1]),a._lineTo(P+gt*dt[0]*2.5,I+gt*dt[1]*2.5),a._moveTo(P+gt*dt[0]*1.6-ft*ut[0],I+gt*dt[1]*1.6-ft*ut[1]),a._lineTo(P+gt*dt[0]*2,I+gt*dt[1]*2),a._lineTo(P+gt*dt[0]*1.6+ft*ut[0],I+gt*dt[1]*1.6+ft*ut[1]),a._stroke(),a._beginPath(),a._arc(P+gt*dt[0]*2.5,I+gt*dt[1]*2.5,3,0,2*Math.PI,!1),a._fill()}else this._settings.allsky?(rt._strokeStyle("#444",1),rt._fillStyle("rgba(0,0,0,0.1)"),rt._beginPath(),rt._arc(4+P,4+I,(n-6)/2,0,2*Math.PI,!1),rt._fill(),rt._fillStyle("rgba(0,0,0,0.1)"),rt._beginPath(),rt._arc(6+P,6+I,(n-6)/2,0,2*Math.PI,!1),rt._fill(),rt._fillStyle(pt),rt._beginPath(),rt._arc(P,I,(n-Z)/2,0,2*Math.PI,!1),rt._fill(),rt._setClip(),$(".PLhost",i._context).css("border","none")):(rt._fillStyle(pt),rt._beginPath(),rt._rect(0,0,o,n),rt._fill());if(H&&!J){var mt=xe(this._settings.colors[m].milkywaycol),vt=xe(pt);ct?(mt[0]-=255-vt[0],mt[1]-=255-vt[1],mt[2]-=255-vt[2]):(mt[0]+=vt[0],mt[1]+=vt[1],mt[2]+=vt[2]);var xt=Math.max(4,o/200);for(xt=Math.max(xt,n/200),xt=Math.max(xt,o/(10*x)),_=0;_<=o+1;_+=xt)for(l=0;l<=n+1;l+=xt)if(!(this._settings.allsky&&this.hypot(_-P,l-I)>(n-6)/2)){for(var yt=ke((Ht=this._pl_inv_project(_,l,0,o,n))[0],Ht[1]),wt=(.5-yt[0]/(2*Math.PI))*i._milkyWay_width,Mt=yt[1]/(2*Math.PI)*i._milkyWay_width+i._milkyWay_height/2;wt<0;)wt+=i._milkyWay_width;for(;wt>=i._milkyWay_width;)wt-=i._milkyWay_width;yt=0;0<=Mt&&Mt<i._milkyWay_height&&(Mt=4*(Ie(Mt)*i._milkyWay_width+Ie(wt)),yt=i._milkyWay[Mt]);yt=Me(vt,mt,yt/255);s._fillStyle(ye(yt)),s._beginPath(),s._arc(_,l,xt,0,2*Math.PI,!1),s._fill()}}for(var kt=[[0,this._settings.radewid,nt?ht:this._settings.colors[m].radecol,L],[1,this._settings.altawid,nt?ht:this._settings.colors[m].altacol,F]],bt=0;bt<2;bt+=1)if(kt[bt][3]){var Pt=kt[bt][0];for($.each(V?[s,a]:[rt],function(t,e){e._strokeStyle(kt[bt][2],kt[bt][1]),e._beginPath()}),g=1,jt=-80;jt<89;jt+=10)for(Tt=null,g=1,At=0;At<361;At+=2)g=(me=this._pl_project(At*Math.PI/180,jt*Math.PI/180,y,Pt,o,n))?(V&&Tt!==0<me[2]&&(g=1),Tt=0<me[2],A=V?Tt?s:a:rt,qt=me[0]+P,Yt=me[1]+I,isNaN(qt)||isNaN(Yt)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w?1:(g?A._moveTo(qt,Yt):A._lineTo(qt,Yt),0)):1;for(At=0;At<359;At+=15)for(Tt=null,g=1,jt=-89;jt<90;jt+=2)g=(me=this._pl_project(At*Math.PI/180,jt*Math.PI/180,y,Pt,o,n))?(V&&Tt!==0<me[2]&&(g=1),Tt=0<me[2],A=V?Tt?a:s:rt,qt=me[0]+P,Yt=me[1]+I,isNaN(qt)||isNaN(Yt)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w?1:(g?A._moveTo(qt,Yt):A._lineTo(qt,Yt),0)):1;$.each(V?[s,a]:[rt],function(t,e){e._stroke()})}if(U){for(Tt=null,$.each(V?[s,a]:[rt],function(t,e){e._strokeStyle(nt?ht:i._settings.colors[m].galacol,i._settings.galawid),e._beginPath()}),Tt=null,g=1,At=0;At<361;At+=2)u=this._pl_eclipticProj(At*Math.PI/180,0,1.071441712962963*Math.PI,.15071297839506173*Math.PI,123.932*Math.PI/180),g=(me=this._pl_project(u[0],u[1],y,0,o,n))?(V&&Tt!==0<me[2]&&(g=1),Tt=0<me[2],A=V?Tt?a:s:rt,qt=me[0]+P,Yt=me[1]+I,isNaN(qt)||isNaN(Yt)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w?1:(g?A._moveTo(qt,Yt):A._lineTo(qt,Yt),0)):1;$.each(V?[s,a]:[rt],function(t,e){e._stroke()})}if(W){for(Tt=null,$.each(V?[s,a]:[rt],function(t,e){e._strokeStyle(nt?ht:i._settings.colors[m].eclicol,i._settings.ecliwid),e._beginPath()}),g=1,At=0;At<361;At+=2)u=this._pl_eclipticProj(At*Math.PI/180,0,1.5*Math.PI,.37*Math.PI,Math.PI/2),g=(me=this._pl_project(u[0],u[1],y,0,o,n))?(V&&Tt!==0<me[2]&&(g=1),Tt=0<me[2],A=V?Tt?a:s:rt,qt=me[0]+P,Yt=me[1]+I,isNaN(qt)||isNaN(Yt)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w?1:(g?A._moveTo(qt,Yt):A._lineTo(qt,Yt),0)):1;$.each(V?[s,a]:[rt],function(t,e){e._stroke()})}if(j)for($.each(V?[s,a]:[rt],function(t,e){e._strokeStyle(nt?ht:i._settings.colors[m].conlcol,i._settings.conlwid)}),jt=0;jt<k.length;jt++)k[jt][4]>T||(me=this._pl_project(k[jt][0],k[jt][1],y,0,o,n))&&(d=this._pl_project(k[jt][2],k[jt][3],y,0,o,n))&&(qt=me[0]+P,Yt=me[1]+I,c=d[0]+P,p=d[1]+I,isNaN(qt)||isNaN(Yt)||isNaN(c)||isNaN(p)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w||Math.abs(d[0]/P)>w||Math.abs(d[1]/I)>w||(Tt=0<me[2],(A=V?Tt?a:s:rt)._beginPath(),A._moveTo(qt,Yt),A._lineTo(c,p),A._stroke()));if(R){for($.each(V?[s,a]:[rt],function(t,e){e._strokeStyle(nt?ht:i._settings.colors[m].conbcol,i._settings.conbwid),e._beginPath()}),jt=0;jt<M.length;jt++){for(var It=!1,$t=!0,St="Ursa Minor"===M[jt][0][1],Tt=null,At=1;At<M[jt].length;At++)if(M[jt][At][1]>87*Math.PI/180&&St)$t=!0;else{if(me=this._pl_project(M[jt][At][0],M[jt][At][1],y,0,o,n)){if(qt=me[0]+P,Yt=me[1]+I,V&&Tt!==0<me[2]&&($t=!0),Tt=0<me[2],A=V?Tt?a:s:rt,isNaN(qt)||isNaN(Yt)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w){$t=!0;continue}$t?A._moveTo(qt,Yt):A._lineTo(qt,Yt),$t=!1}0===At&&(It=[qt,Yt])}!$t&&It&&A._lineTo(It[0],It[1])}$.each(V?[s,a]:[rt],function(t,e){e._stroke()})}if("meteorRA"in this._settings&&"meteors"in this._settings&&(Ht=this._pl_project(this._settings.meteorRA/12*Math.PI,this._settings.meteorDec/180*Math.PI,y,0,o,n))&&(_=Ht[0]+P,l=Ht[1]+I,Tt=0<Ht[2],A=V?Tt?a:s:rt,!(isNaN(_)||isNaN(l)||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I)))for(it=0;it<2*Math.PI;it+=Math.PI/7)A._strokeStyle(this._settings.colors[m].meteorscol,2),A._beginPath(),A._moveTo(_+20*Math.cos(it),l+20*Math.sin(it)),A._lineTo(_+80*Math.cos(it),l+80*Math.sin(it)),A._stroke();gt=$(".PLcrosshair",i._context);if(gt.css("display","none"),!("gotoRA"in this._settings&&null!==this._settings.gotoRA)||"hidePositionMarker"in this._settings&&this._settings.hidePositionMarker||(Ht=this._pl_project(this._settings.gotoRA/12*Math.PI,this._settings.gotoDec/180*Math.PI,y,0,o,n))&&(_=Ht[0]+P,l=Ht[1]+I,isNaN(_)||isNaN(l)||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I||(gt.css("left",_-18+"px"),gt.css("top",l-18+"px"),gt.css("display","block"))),D)for(jt=0;jt<b.length;jt++){var zt,Ct=b[jt].length;if(!(b[jt][Ct-1][0]>T))for(At=1;At<Ct-1;At+=2)if((Ht=this._pl_project(b[jt][At],b[jt][At+1],y,0,o,n))&&(_=Ht[0]+P,l=Ht[1]+I,!(isNaN(_)||isNaN(l)||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I))){for(Tt=0<Ht[2],(A=V?Tt?a:s:rt)._textStyle("Arial,Helvetica,sans-serif",12+h,"bold",""),A._fillStyle(ct?"#ffffff":"#000000",2),Ft=-1;Ft<=1;Ft++)for(pe=-1;pe<=1;pe++)A._text(_+Ft,l+pe,0,0,!0,b[jt][0],!1,!1);A._fillStyle(nt?ht:this._settings.colors[m].conncol),A._text(_,l,0,0,!0,b[jt][0],!1,!0),V&&!Tt||(zt=A._textWidth(b[jt][0])+12,this._hovermankeys[this._hovermannextkey]=[!0,"json/objecthover.php?const="+b[jt][Ct-1][1],12*b[jt][At]/Math.PI,180*b[jt][At+1]/Math.PI],this._hoverman.hoverBox(this._hovermannextkey,_-zt/2,l-7,zt,14),this._hovermannextkey++);break}}if(z||N)for(var Rt=["0_00_00"],jt=1;jt<this._stars_tiles.length;jt++)if(T>this._stars_tiles[jt-1][0])for(_=0;_<=10;_++)for(l=0;l<=10;l++){Ht=this._pl_inv_project(o*_/10,n*l/10,0,o,n);var Dt=Math.floor((Ht[0]+4*Math.PI)/(2*Math.PI)%1*this._stars_tiles[jt][1]),Nt=Math.floor((Ht[1]/Math.PI+.5)*this._stars_tiles[jt][2]);Dt<0&&(Dt=0),Dt>=this._stars_tiles[jt][1]&&(Dt=this._stars_tiles[jt][1]-1),Nt<=0&&(Dt=Nt=0),Nt>=this._stars_tiles[jt][2]-1&&(Nt=this._stars_tiles[jt][2]-1,Dt=0);Nt=jt+"_"+Pe(Dt)+"_"+Pe(Nt);-1===$.inArray(Nt,Rt)&&(this._stars.hasOwnProperty(Nt)?Rt.push(Nt):function(e){i._stars[e]=[],i._dsos[e]=[],jQuery.getJSON(window.server+"json/objects_"+e+".json",function(t){i._stars[e]=t.stars,i._dsos[e]=t.dsos,i._refresh=1})}(Nt))}if(N){var Ot=this._settings.allsky||this._settings.domeview?1:2;$.each(V?[s,a]:[rt],function(t,e){e._textStyle("Arial,Helvetica,sans-serif",13+r,"",""),e._fillStyle(nt?ht:i._settings.colors[m].dso_col),e._strokeStyle(nt?ht:i._settings.colors[m].dso_col,1.5)});for(var Lt=200<P?3:2,Ft=Rt.length-1;0<=Ft;Ft--){var Et=this._dsos[Rt[Ft]];for(jt=Et.length-1;0<=jt;jt--)Et[jt][5]>T+Ot||(Ht=this._pl_project(Et[jt][1],Et[jt][2],y,0,o,n))&&(_=Ht[0]+P+(nt?this._sep_3d(Et[jt][4],_t,K):0),l=Ht[1]+I,isNaN(_)||isNaN(l)||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I||(Tt=0<Ht[2],(A=V?Tt?a:s:rt)._beginPath(),A._moveTo(_-Lt,l-Lt),A._lineTo(_+Lt,l+Lt),A._moveTo(_-Lt,l+Lt),A._lineTo(_+Lt,l-Lt),A._stroke(),O&&A._queueText(_+Lt+3,l,-1,0,!0,Et[jt][0],Et[jt][5]),V&&!Tt||(Math.floor(10*Et[jt][5]),this._hovermankeys[this._hovermannextkey]=[!0,"json/objecthover.php?id="+Et[jt][6],12*Et[jt][1]/Math.PI,180*Et[jt][2]/Math.PI],this._hoverman.hoverBox(this._hovermannextkey,_-Lt-4,l-Lt-4,38+Lt,8+Lt),this._hovermannextkey++)))}}if(z)for(this._magnitudeRadius_normalise(x),$.each(V?[s,a]:[rt],function(t,e){e._fillStyle(nt?ht:i._settings.colors[m].starcol),100<x?e._textStyle("Arial,Helvetica,sans-serif",12+r):e._textStyle("Arial,Helvetica,sans-serif",13+r)}),Ft=Rt.length-1;0<=Ft;Ft--){var Wt,Ut,Ht,Gt=this._stars[Rt[Ft]];for(jt=Gt.length-1;0<=jt;jt--){Gt[jt][4]>T||(Ht=this._pl_project(Gt[jt][1],Gt[jt][2],y,0,o,n))&&(Tt=0<Ht[2],(A=V?Tt?a:s:rt)._beginPath(),_=Ht[0]+P+(nt?this._sep_3d(Gt[jt][3],_t,K):0),l=Ht[1]+I,isNaN(_)||isNaN(l)||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I||(Wt=this._magnitudeRadius(Gt[jt][4]),A._arc(_,l,Wt,0,2*Math.PI,!1),A._fill(),f=[],Gt[jt][0]&&f.push(Gt[jt][0]),Gt[jt][5]&&f.push(Gt[jt][5]),Gt[jt][6]&&f.push(Gt[jt][6]),Ut=Math.sqrt(o/1e3),C&&Gt[jt][4]<T-2.5&&(x<250*Ut&&Gt[jt][0]||x<70*Ut&&Gt[jt][5]||x<25*Ut&&Gt[jt][6])&&A._queueText(_+Wt+4+h,l,-1,0,!0,f[0],Gt[jt][4]),V&&!Tt||(Ut=v[Gt[jt][8]],0<f.length&&Ut&&(this._hovermankeys[this._hovermannextkey]=[!0,"json/objecthover.php?id="+Gt[jt][7],12*Gt[jt][1]/Math.PI,180*Gt[jt][2]/Math.PI],this._hoverman.hoverBox(this._hovermannextkey,_-Wt/2-4,l-Wt/2-4,Wt+8,Wt+8),this._hovermannextkey++))))}}if("track"in this._settings&&this._settings.track&&this.drawTrack(rt,y,w,P,I,o,n),q&&!nt&&"planetPos"in this)for($.each(V?[s,a]:[rt],function(t,e){e._strokeStyle(pt,1.5),e._fillStyle(nt?ht:i._settings.colors[m].planetcol),e._textStyle("Arial,Helvetica,sans-serif",11+r,"bold","")}),jt=this.planetPos.length-1;0<=jt;jt--)this.planetPos[jt].mag>T+1&&S<=1&&"Moon"!==this.planetPos[jt].name||(Ht=this._pl_project(this.planetPos[jt].RA*Math.PI/12,this.planetPos[jt].Dec*Math.PI/180,y,0,o,n))&&(_=Ht[0]+P,l=Ht[1]+I,isNaN(_)||isNaN(l)||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I||(Tt=0<Ht[2],(A=V?Tt?a:s:rt)._beginPath(),A._arc(_,l,4,0,2*Math.PI,!1),A._stroke(),A._fill(),Y&&(A._text(_+8,l,-1,0,!1,this.planetPos[jt].name,!0,!0)||A._text(_+8,l,-1,0,!0,this.planetPos[jt].name,!1,!1)),V&&!Tt||(this._hovermankeys[this._hovermannextkey]=[!0,"json/objecthover.php?id="+this.planetPos[jt].objId,this.planetPos[jt].RA,this.planetPos[jt].Dec],this._hoverman.hoverBox(this._hovermannextkey,_-4-4,l-4-4,12,12),this._hovermannextkey++)));if(rt._unqueueText(),this._settings.domeview){s._unqueueText(),a._unqueueText();var Bt=[];for(At=0;At<361;At+=1){var Jt,qt=(me=this._pl_project(Math.PI*At/180,0,y,1,o,n))[0]+P,Yt=me[1]+I;me[2]<0||(Jt=me[0]*ut[0]+me[1]*ut[1],Bt.push([me[0],me[1],Jt]))}Bt.sort(function(t,e){return t[2]-e[2]}),a._beginPath(),a._moveTo(2*Bt[0][0]-5*dt[0]+P,2*Bt[0][1]-5*dt[1]+I),$.each(Bt,function(t,e){a._lineTo(e[0]+P,e[1]+I)}),At=Bt.length-1,a._lineTo(2*Bt[At][0]-5*dt[0]+P,2*Bt[At][1]-5*dt[1]+I),a._fillStyle(we(lt,.8)),a._fill(),s._unsetClip(),a._unsetClip()}if(this._settings.allsky){rt._unsetClip();var Vt=((n-6)/2+(n-Z)/2)/2;rt._strokeStyle("#d0d0a0",(Z-6)/2),rt._beginPath(),rt._arc(P,I,Vt,0,2*Math.PI,!1),rt._stroke(),rt._strokeStyle("#404040",1),rt._beginPath(),rt._arc(P,I,(n-6)/2,0,2*Math.PI,!1),rt._stroke(),rt._strokeStyle("#808080",1);lt=Math.max(8,.36*Z);rt._textStyle("Arial,Helvetica,sans-serif",Ie(lt),"bold","");var Xt=["N","","NE","","E","","SE","","S","","SW","","W","","NW",""];for(jt=0;jt<Xt.length;jt++)st=-(22.5*jt*Math.PI)/180+this._allskyrot,_=-Math.sin(st),l=Math.cos(st),rt._strokeStyle("#c0c090",2),rt._beginPath(),rt._moveTo(P+(n-6)/2*_,I+(n-6)/2*l),rt._lineTo(P+(n-Z)/2*_,I+(n-Z)/2*l),rt._stroke(),rt._translate(P+Vt*_,I+Vt*l,st),rt._strokeStyle("#00a800",1),rt._fillStyle("#00b000"),rt._text(0,0,0,0,!0,Xt[jt],!1,!1),rt._text(0,0,0,0,!1,Xt[jt],!1,!1),rt._unsetTranslate()}if(G&&!this._settings.domeview){rt._fillStyle(nt?ht:this._settings.colors[m].horicol);for(var Zt=[],Qt=0;Qt<24.05;Qt+=.05){Ht=this._pl_project(Qt*Math.PI/12,0,y,1,o,n);var Kt=isNaN(Ht[0])||isNaN(Ht[1])||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I;Zt.push([Ht[0],Ht[1],Kt])}rt._beginPath();var te,ee=!1,ie=null,se=[];for(jt=0;jt<=Zt.length;jt++)(Kt=(Ht=Zt[jt%Zt.length])[2])&&(ie=Ht),!Kt&&ee&&se.push([jt,ie]),ee=Kt;for(At=0;At<se.length;At++){for(Kt=!1,rt._moveTo(P+se[At][1][0],I+se[At][1][1]),jt=se[At][0];!Kt;jt++)Kt=(Ht=Zt[jt%Zt.length])[2],rt._lineTo(P+Ht[0],I+Ht[1]);for(var ae=Math.atan2(se[At][1][0]/P,se[At][1][1]/I),oe=Math.atan2(Ht[0]/P,Ht[1]/I);ae<oe;)oe-=2*Math.PI;var ne=Math.ceil(oe/(Math.PI/2)+.5),he=ae/(Math.PI/2)+.5;for(jt=ne;jt<he;jt++){var re=(jt-.5)*Math.PI/2,_e=2*Math.max(P,I);rt._lineTo(P+_e*Math.sin(re),I+_e*Math.cos(re))}}rt._fill(),rt._fillStyle(nt?"#000000":this._settings.colors[m].cardcol),te=400<o?(rt._textStyle("Arial,Helvetica,sans-serif",14+h,"bold",""),28):(rt._textStyle("Arial,Helvetica,sans-serif",11,"bold",""),18);var le=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];for(jt=0;jt<le.length;jt++)At=1-.125*jt,qt=(me=this._pl_project(Math.PI*At,x/o*-te*Math.PI/180,y,1,o,n))[0]+P,Yt=me[1]+I,isNaN(qt)||isNaN(Yt)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w||rt._text(qt,Yt,0,0,!0,le[jt],!1,!1)}if("newsmap_objects"in i._settings){var ce=$(".newslabels",i._context)[0],pe=i._settings.newsmap_objects;for(At=0;At<pe.length;At++){var de=pe[At];for(jt=de.length-1;0<=jt;jt--){var ue=$("#"+de[jt][3]);ue.css("opacity","0.5"),(Ht=this._pl_project(de[jt][0],de[jt][1],y,0,o,n))&&(_=Ht[0]+P,l=Ht[1]+I,isNaN(_)||isNaN(l)||Ht[0]<-P||Ht[0]>P||Ht[1]<-I||Ht[1]>I||(ue.css("opacity","1"),rt._drawImage(ce,18*jt,18*At,18,18,_-9,l-9,18,18),this._hovermankeys[this._hovermannextkey]=[!1,de[jt][2],12*de[jt][0]/Math.PI,180*de[jt][1]/Math.PI],this._hoverman.hoverBox(this._hovermannextkey,_-12,l-12,24,24),this._hovermannextkey++))}}}if(J&&E){var fe=[["100 ly",100,.15],["1 kly",1e3,.25],["10 kly",1e4,.35],["100 kly",1e5,.45],["1 Mly",1e6,.55],["10 Mly",1e7,.65],["100Mly",1e8,.75]];for(rt._textStyle("Arial,Helvetica,sans-serif",14,"bold",""),rt._fillStyle(ht),rt._strokeStyle("#000000",1.5),jt=0;jt<fe.length;jt++)_=2*fe[jt][2]*P+this._sep_3d(94605284e8*fe[jt][1]/308567758e11,_t,K),l=75,rt._text(_,l,0,0,!1,fe[jt][0],!1,!1),rt._text(_,l,0,0,!0,fe[jt][0],!1,!1)}if(E){var ge=x/4,fe=[2.5,4,5,10,15,20,30,45,60];for(jt=1;jt<fe.length&&!(fe[jt]>ge);jt++);pe=fe[jt-1]/x*o/2,rt._strokeStyle(this._settings.colors[m].scalebarcol,3),rt._fillStyle(this._settings.colors[m].scalebarcol),rt._textStyle("Arial,Helvetica,sans-serif",13+r,"",""),rt._beginPath(),rt._moveTo(.8*o-pe,28),rt._lineTo(.8*o+pe,28),rt._stroke(),rt._text(.8*o,16,0,0,!0,fe[jt-1]+"°",!1,!1)}400<o&&(rt._strokeStyle(pt,1.5),this._settings.allsky||V?(rt._fillStyle("#888888"),rt._textStyle("Arial,Helvetica,sans-serif",11+r,"",""),rt._text(o-20,n-20,1,-1,!0,"https://in-the-sky.org",!1,!0)):(rt._fillStyle(ct?"#000000":"#ffffff"),rt._textStyle("Arial,Helvetica,sans-serif",11+r,"",""),rt._text(o-4,n-4,1,-1,!1,"https://in-the-sky.org",!1,!0),rt._text(o-4,n-4,1,-1,!0,"https://in-the-sky.org",!1,!0)))}if(rt._strokeStyle("#000000",1),rt._fillStyle("#00ff40"),rt._textStyle("Arial,Helvetica,sans-serif",11,"bold",""),t&&0<this._extraIcons.length)for(jt=0;jt<this._extraIcons.length;jt++){var me,ve=this._extraIcons[jt];(me=this._pl_project(Math.PI-ve[5],ve[6],y,1,o,n))&&(qt=me[0]+P-ve[7],Yt=me[1]+I-ve[8],isNaN(qt)||isNaN(Yt)||Math.abs(me[0]/P)>w||Math.abs(me[1]/I)>w||(rt._drawImage(ve[0],ve[1],ve[2],ve[3],ve[4],qt,Yt,ve[3],ve[4]),ve[5]&&(rt._text(qt+2*ve[7]+6,Yt+ve[8],-1,0,!1,ve[9],!1,!1),rt._text(qt+2*ve[7]+6,Yt+ve[8],-1,0,!0,ve[9],!1,!1))))}return this._lock=0},et.prototype.setTrack=function(t){this._settings.track=t,this._refresh=1},et.prototype.computeTrack=function(r){var _,l,c=this,p=r[0].length;new Z(this._settings.lat,this._settings.lng,function(h){h._setObjList(r[0],0,function(){for(var t=86400*Math.floor(r[1]/86400),e=86400<(e=(r[2]-r[1])/100)?86400:43200<e?43200:21600<e?21600:10800<e?10800:3600<e?3600:1800<e?1800:900<e?900:300<e?300:60,i=[t];t<r[2];)t+=e,i.push(t);var s=i.length,a=h._getTrack(i),o=[];for(_=0;_<p;_++)o.push([]);for(l=0;l<s;l++)for(_=0;_<p;_++){var n=a[l][_];o[_].push([n.RA,n.Dec,i[l]])}c._settings.track=o,c.gotoRA=o[0][0][0],c.gotoDec=o[0][0][1],c.pl_setExtraObjects(r[0],!1),c.pl_gotoPos(c.gotoRA,c.gotoDec,1)})})},et.prototype.drawTrack=function(t,e,i,s,a,o,n){for(var h,r=[[30,30,null,null,0],[60,60,null,null,1],[120,120,null,null,1],[3600,3600,null,null,1],[7200,7200,null,null,1],[10800,10800,null,null,1],[21600,21600,null,null,1],[28800,28800,null,null,1],[43200,43200,null,null,1],[86400,86400,null,null,2],[172800,172800,null,null,2],[259200,259200,null,null,2],[345600,345600,null,null,2],[604800,86400,[1,7,15,22],null,2],[1209600,86400,[1,15],null,2],[2592e3,86400,[1],null,2],[5184e3,86400,[1],[0,2,4,6,8,10],2],[7776e3,86400,[1],[0,3,6,9],2],[10368e3,86400,[1],[0,4,8],2],[15552e3,86400,[1],[0,6],2],[31536e3,86400,[1],[0],3]],_=[],l=0;l<this._settings.track.length;l++){var c=(h=this._settings.track[l]).length,p=[],d=1;for(t._beginPath(),t._strokeStyle("#ff6000",1),w=0;w<c;w++){var u,f,g=h[w][2],m=this._pl_project(h[w][0]*Math.PI/12,h[w][1]*Math.PI/180,e,0,o,n);m?(u=m[0]+s,f=m[1]+a,d=isNaN(u)||isNaN(f)||Math.abs(m[0]/s)>i||Math.abs(m[1]/a)>i?1:(d?t._moveTo(u,f):(t._lineTo(u,f),m=p.length-1,m=this.hypot(p[m][0]-u,p[m][1]-f)/(g-p[m][2]),_.push(m)),p.push([u,f,g,d]),0)):d=1}t._stroke(),c=p.length;for(var v=1e6,x=1e6,y=this._settings.tickSpacing,w=1;w<c-1;w++){for(var M,k,b,P=0;P<r.length;P++)if(!(r[P][0]<y/_[w])){var I=p[w][2]+this._tzOffset.offset(p[w][2]),S=p[w-1][2]+this._tzOffset.offset(p[w-1][2]);if(Math.floor(I/r[P][1])===Math.floor(S/r[P][1]))break;var T=be._unix_to_calendar(Math.floor(I/r[P][1])*r[P][1]+.01);if(r[P][2]&&-1===$.inArray(T[2],r[P][2]))break;if(r[P][3]&&-1===$.inArray(T[1],r[P][3]))break}--P<0||r[P][0]<y/_[w]||(u=p[w][0],f=p[w][1],b=p[w+1][0],k=p[w+1][1],this.hypot(u-v,f-x)<40||p[w+1][3]||(v=u,x=f,b=180*(h=Math.atan2(b-u,k-f)+Math.PI/2)/Math.PI,k="",k=0===r[P][4]?Pe(Ie(T[3]))+":"+Pe(Ie(T[4]))+":"+Pe(Ie(T[5])):1===r[P][4]?Pe(Ie(T[3]))+":"+Pe(Ie(T[4])):2===r[P][4]?Pe(T[2])+" "+this.monthNames[T[1]]:Pe(T[2])+" "+this.monthNames[T[1]]+" "+T[0],b=b<-45?(M=0,1):b<45?(M=1,0):b<135?(M=0,-1):b<225?(M=-1,0):(M=0,1),t._strokeStyle("#ff6000",1),t._beginPath(),t._moveTo(u+7*Math.sin(h),f+7*Math.cos(h)),t._lineTo(u-7*Math.sin(h),f-7*Math.cos(h)),t._stroke(),t._strokeStyle(this._sky_color,2),t._fillStyle("#ff6000"),t._textStyle("Arial,Helvetica,sans-serif",12+(500<o)+(700<o),"bold",""),t._text(u+12*Math.sin(h),f+12*Math.cos(h),b,M,!1,k,!1,!1),t._text(u+12*Math.sin(h),f+12*Math.cos(h),b,M,!0,k,!1,!0)))}}},et.prototype.hypot=function(t,e){return Math.sqrt(t*t+e*e)},$(function(){$(".planetarium").each(function(t,e){var i=$(e).data("meta"),e=i.id,e=$("#"+e),i=new et(i,e);e.data("handler",i)})}),it.prototype._refresh=function(){var e=this,t=$(".day",this.parent).val(),i=$(".month",this.parent).val(),s=$(".year",this.parent).val();e._target.css("opacity",.4);var a=e._settings.planets?"planets":"dsos";$.getJSON(window.server+"embeds/whatsup_body.php?year="+s+"&month="+i+"&day="+t+"&mode="+a,function(t){e._target.html(t),e._target.css("opacity",1)})},$(at),ot.prototype._rs_time_m=function(t,e,i){var s=this._settings,a=s.longitude*Math.PI/180,o=s.latitude*Math.PI/180,n=a,h=st(t),r=[],_=this._riseset.pos[e];i*=Math.PI/180;for(var l=0,c=0,p=-2;p<3;p++){var d,u=t+3600*p*24,f=be._unix_to_calendar(u),g=be._calendar_to_unix(f[0],1,1,0,0,0),h=st(u)*Math.PI/12,f=f[0],g=Math.floor((u-g)/86400);f in _&&_[f].length>g&&(d=R((g=_[f][g])[1],o,i)/3600,r.push([p,h,g,d,u]),0===p&&Math.abs(g[1]-o)<=Math.PI/2+i&&(l=1),2===p&&Math.abs(g[1]-o)<=Math.PI/2+i&&g[1]<Math.PI/2-o-i&&g[1]>-Math.PI/2-o+i&&(c=1))}var m=[-1,-1,-1,l],v=r.length-1;for(p=0;p<v;p++)if(!((d=r[p][3])<0&&Math.abs(r[p][2][1]-o)>Math.PI/2+i)){var x=r[p][1],y=r[p+1][1];y<x&&(y+=2*Math.PI),y+=2*Math.PI;var w=r[p][2][0],M=r[p+1][2][0];for(M<w-Math.PI&&(M+=2*Math.PI),w<M-Math.PI&&(w+=2*Math.PI);w<x+n&&M<x+n;)w+=2*Math.PI,M+=2*Math.PI;for(;y+n<w&&y+n<M;)w-=2*Math.PI,M-=2*Math.PI;var k=(w-(x+n))/(y-x-M+w),b=(w-2*Math.PI-(x+n))/(y-x-M+w),P=(w+2*Math.PI-(x+n))/(y-x-M+w);(k<0||1<=k)&&(k=b),(k<0||1<=k)&&(k=P),k<0||1<=k||(k=24*(k+r[p][0])+this._tzOffset.offset(this.useLocalTime?r[p][4]:s.highlightTime)/3600,(c||0<=k)&&k<24&&(m[1]=(k+48)%24),d<0||((c||0<=k-d)&&k-d<24&&(m[0]=(k-d+48)%24),(c||0<=k+d)&&k+d<24&&(m[2]=(k+d+48)%24)))}return m},ot.prototype._rs_y=function(t,e){return t-t*(12<=e?(e-12)/24:(e+12)/24)},ot.prototype._rs_invy=function(t){return(t+this._height/2)%this._height},ot.prototype._rs_fillBack=function(t,e,i,s){for(var a=this,o=a._width,n=a._height,h=e-1;i<=h;h--){var r=o*h/365,_=0;0<=s[h][1][2]&&a._rs_y(n,s[h][1][2])<a._rs_y(n,s[h][1][0])&&(_=a._rs_y(n,s[h][1][2])),t.lineTo(r,_)}t.fill(),t.beginPath()},ot.prototype._rs_draw=function(){for(var t,e,i=this,s=i._settings,a=Math.floor(($(".RSslider",this._context).slider("value")/400*(i._tmax-i._tmin)+i._tmin)/86400),o=$(i._frame?".RSbuf0":".RSbuf1",i._context),n=o[0],h=n.width=o.width(),r=n.height=o.height(),_=n.getContext("2d"),l=[0,6,12,18],c=0;c<i.objects.length;c++)for(var p=0;p<(0===c?4:1);p++){var d=l[p],u=i.objects[c];if(!u[5]||$(u[5],this._context).prop("checked")){for(var f=[],g=0;g<365;g++){var m=86400*(a+g);f.push([m,i._rs_time_m(m,u[4],d)])}var v=1,x=0,y=1,w=0,M=0;if(0===p){for(_.fillStyle="rgba("+i.objects[c][1]*v+","+i.objects[c][2]*v+","+i.objects[c][3]*v+",0.12)",_.beginPath(),g=0;g<365;g++)0<=f[g][1][0]?(t=h*g/365,S=i._rs_y(r,f[g][1][0]),Math.abs(S-w)>.6*r&&(i._rs_fillBack(_,g,x,f),x=g,y=1),y?_.moveTo(t,S):_.lineTo(t,S),y=0,w=S):f[g][1][2]<0&&f[g][1][3]?(t=h*g/365,S=i._height,y?_.moveTo(t,S):_.lineTo(t,S),y=0,w=S):(i._rs_fillBack(_,g,x,f),x=g+1,y=1);for(i._rs_fillBack(_,g,x,f),y=1,g=0;g<365;g++)i._rs_y(r,f[g][1][2])>i._rs_y(r,f[g][1][0])?(t=h*g/365,S=i._rs_y(r,f[g][1][2]),y&&_.moveTo(t,i._height),_.lineTo(t,S),y=0,w=t):(y||(_.lineTo(w,i._height),_.fill(),_.beginPath()),y=1);y||(_.lineTo(w,i._height),_.fill(),_.beginPath())}for(y=v=1,w=0,_.lineWidth=0===p?2:.8,_.strokeStyle="rgb("+i.objects[c][1]*v+","+i.objects[c][2]*v+","+i.objects[c][3]*v+")",_.beginPath(),g=0;g<365;g++)0<=f[g][1][0]?(t=h*g/365,S=i._rs_y(r,f[g][1][0]),y&&1<g&&g<363&&(e=i._rs_y(r,f[g+1][1][1]),f[g-2][1][3]&&(e=i._rs_invy(e)),_.moveTo(t,e),w=e,y=0),!y&&Math.abs(S-w)>.6*r&&(S<r/2?(_.lineTo(t,r),_.moveTo(t,0)):(_.lineTo(t,0),_.moveTo(t,r))),y?_.moveTo(t,S):_.lineTo(t,S),y=0,M=t,w=S):(!y&&1<g&&g<363&&f[g-2][1][3]&&(S=i._rs_y(r,f[g-2][1][1]),t=M,f[g+1][1][3]&&(S=i._rs_invy(S)),Math.abs(S-w)>.6*r&&(S<r/2?(_.lineTo(t,r),_.moveTo(t,0)):(_.lineTo(t,0),_.moveTo(t,r))),_.lineTo(t,S)),y=1);for(_.stroke(),v=.5,y=1,w=0,_.strokeStyle="rgb("+i.objects[c][1]*v+","+i.objects[c][2]*v+","+i.objects[c][3]*v+")",_.beginPath(),g=0;g<365;g++)0<=f[g][1][2]?(t=h*g/365,S=i._rs_y(r,f[g][1][2]),y&&1<g&&g<363&&(e=i._rs_y(r,f[g+1][1][1]),f[g-2][1][3]&&(e=i._rs_invy(e)),_.moveTo(t,e),w=e,y=0),!y&&Math.abs(S-w)>.6*r&&(S<r/2?(_.lineTo(t,r),_.moveTo(t,0)):(_.lineTo(t,0),_.moveTo(t,r))),y?_.moveTo(t,S):_.lineTo(t,S),y=0,M=t,w=S):(!y&&1<g&&g<363&&f[g-2][1][3]&&(S=i._rs_y(r,f[g-2][1][1]),t=M,f[g+1][1][3]&&(S=i._rs_invy(S)),Math.abs(S-w)>.6*r&&(S<r/2?(_.lineTo(t,r),_.moveTo(t,0)):(_.lineTo(t,0),_.moveTo(t,r))),_.lineTo(t,S)),y=1);_.stroke()}}n=s.highlightTime,s=((n+=i._tzOffset.offset(n))/86400-a)*i._width/365;_.lineWidth=1.5,_.strokeStyle="#f0f008",_.font="11px bold Arial,Helvetica,sans-serif",_.beginPath(),_.moveTo(s,0),_.lineTo(s,i._height),_.stroke();n=n%86400*24/86400,n=i._rs_y(r,n);_.beginPath(),_.moveTo(s-7,n),_.lineTo(7+s,n),_.stroke(),_.strokeStyle="#000000",_.fillStyle="#f0f008",_.textAlign="center",_.lineWidth=1.5,_.save(),s<i._width-70?(_.translate(15+s,.1*i._height),_.rotate(-Math.PI/2)):(_.translate(s-15,.1*i._height),_.rotate(Math.PI/2)),_.strokeText("Today",0,0),_.fillText("Today",0,0),_.restore(),$(i._frame?".RSbuf0":".RSbuf1").css("visibility","visible"),$(i._frame?".RSbuf1":".RSbuf0").css("visibility","hidden"),i._frame=1-i._frame;n=$(".RSbac2",i._context),s=n[0];s.width=n.width(),s.height=n.height();var k=s.getContext("2d"),b=86400*a,P=be._unix_to_calendar(b)[0];k.font="14px Arial,Helvetica,sans-serif",k.fillStyle=0===i._settings.skin?"#080808":"#e0e0e0",k.strokeStyle="#202020",k.lineWidth=1,k.textBaseline="middle",k.textAlign="center";for(var I=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],S=P;S<P+2;S++)for(var T=1;T<=12;T++){var A=(be._calendar_to_unix(S,T,1,0,0,0)-b)/86400/365;A<0||1<A||(A=i.L+i.W*A,k.fillText(I[T],A,i.T+i.H+15),k.fillText(""+S,A,i.T+i.H+34),k.beginPath(),k.moveTo(A,i.T),k.lineTo(A,i.T+i.H),k.stroke())}},ot.prototype.rs_gotoTime=function(t){var e=this,t=(t-e._tmin)/(e._tmax+31536e3-e._tmin)*400;t<0&&(t=0),400<t&&(t=400),$(".RSslider",e._context).slider("value",t),e._refresh=1},ot.prototype._rs_drawGraphAxes=function(){var t=this;t.useLocalTime=$(".uselocaltime",t._context).prop("checked");var e=t._height,i=t._width;t.T=8,t.H=e,t.L=70,t.W=i,l=0===t._settings.skin?{text:"#080808",axes:"#202020"}:{text:"#e0e0e0",axes:"#202020"};var s=$(".RSfore",t._context),a=s[0];a.width=s.width(),a.height=s.height();var o=a.getContext("2d"),s=$(".RSback",t._context),a=s[0];a.width=s.width(),a.height=s.height();var n=a.getContext("2d");o.font="13px Arial,Helvetica,sans-serif",o.strokeStyle=l.text,o.linewidth=1,o.strokeRect(70,8,i,e),n.fillStyle="black",n.fillRect(70,8,i,e),o.fillStyle=l.text,n.strokeStyle=l.axes,o.textBaseline="middle";for(var h=t.useLocalTime?0:t._tzOffset.offset(t._settings.highlightTime),r=-24;r<49;r+=2){var _=r/24-.5+h/86400;_<0||1<_||(u=8+e*(1-_),o.textAlign="right",o.fillText(Pe((r+48)%24)+":00",62,u),o.textAlign="left",o.fillText(Pe((r+48)%24)+":00",70+i+8,u),n.beginPath(),n.moveTo(70,u+.5),n.lineTo(70+i,u+.5),n.stroke())}o.font="bold 13px Arial,Helvetica,sans-serif",o.textAlign="center",o.save(),o.translate(14,8+e/2),o.rotate(-Math.PI/2),o.fillText("Hour of day / "+(t.useLocalTime?t._settings.tzName:"UTC"),0,0),o.restore(),o.save(),o.translate(i+70+56,8+e/2),o.rotate(Math.PI/2),o.fillText("Hour of day / "+(t.useLocalTime?t._settings.tzName:"UTC"),0,0),o.restore(),o.fillStyle="#ffffee",o.textBaseline="bottom",o.textAlign="left",o.font="11px Arial,Helvetica,sans-serif",o.fillText("© Dominic Ford "+t._settings.cpyYear+". Downloaded from <in-the-sky.org>.",78,8+e-8);var a=$(".RSkey",t._context),l=a[0];l.width=a.width(),l.height=a.height();var c=l.getContext("2d"),p=t._width/4;for(c.textAlign="left",c.textBaseline="middle",c.fillStyle="#eeeeee",c.font="12px Arial,Helvetica,sans-serif",t.objects=[["Sun",240,240,240,"1",""],["Mercury",0,128,192,"4",".rs0"],["Venus",0,240,0,"5",".rs1"],["Mars",240,0,0,"6",".rs2"],["Jupiter",192,128,0,"7",".rs3"],["Saturn",192,192,0,"8",".rs4"],["Uranus",192,0,192,"9",".rs5"],["Neptune",0,0,240,"10",".rs6"]],r=0;r<t.objects.length;r+=1){var d=p*(Math.floor(r/2)+.5),u=r%2*40;c.lineWidth=2,c.strokeStyle="rgb("+ +t.objects[r][1]+","+ +t.objects[r][2]+","+ +t.objects[r][3]+")",c.fillText(t.objects[r][0]+" rises",d-30,u+10),c.beginPath(),c.moveTo(d-35,u+10.5),c.lineTo(d-55,u+10.5),c.stroke(),u+=20,c.strokeStyle="rgb("+.5*t.objects[r][1]+","+.5*t.objects[r][2]+","+.5*t.objects[r][3]+")",c.fillText(t.objects[r][0]+" sets",d-30,u+10),c.beginPath(),c.moveTo(d-35,u+10.5),c.lineTo(d-55,u+10.5),c.stroke()}t._refresh=1},ot.prototype._rs_hideinstruct=function(){var t=this;t._hideInstruct&&(t._hideInstruct=0,$(".rs_instruct",t._context).stop().animate({opacity:0},600,function(){$(".rs_instruct",t._context).css("display","none")}))},ot.prototype._rs_rotate=function(t){var e=this,t=e.scrollPos-t/((e._tmax-e._tmin)/86400)*400;t<0&&(t=0),400<t&&(t=400),$(".RSslider",e._context).slider("value",t),e._refresh=1},ot.prototype._rs_mouseDown=function(t){var e=this;e.pos_=At(t,$(".RSfore",e._context)),e.scrollPos=$(".RSslider",e._context).slider("value"),e.mousedown=1},ot.prototype._rs_mouseDrag=function(t){var e,i=this;i._hideInstruct&&i._rs_hideinstruct(),0===t?e=[i._mousex,i._mousey]:(e=At(t,$(".RSfore",i._context)),i._mousex=e[0],i._mousey=e[1]),i.mousedown&&(e=(e[0]-i.pos_[0])/i._width*365,i._rs_rotate(e))},ot.prototype._rs_mouseUp=function(t){this._rs_mouseDrag(t),this.mousedown=0},ot.prototype._rs_updateAlarm=function(){this._refresh&&this._rs_draw(),this._refresh=0},ot.prototype._rs_resize=function(){var t,e,i=this;this._width=Math.max(this._context.width()-150,200),this._height=Math.max(Math.min(this._width*this._settings.aspectRatio,550)-100,200);var s=i._width+70+70,a=i._width+50,o=i._width+10,n=i._height+50,h=n+73+50,r=n/2+123-24;$(".RSholder",i._context).width(s).height(h),$(".RSslidescale",i._context).width(a).height(26),$(".RSslider",i._context).width(o),$(".RSkey, .RSbuf0, .RSbuf1",i._context).width(i._width),$(".RSkey",i._context).height(80),$(".RSbuf0, .RSbuf1",i._context).height(i._height),$(".RSback, .RSbac2, .RSfore",i._context).width(s).height(n),$(".RSload",i._context).width(s).css("top",r);var r=i._settings,i=parseInt(r.yearmax)+1,_=parseInt(r.yearmin),l=i-_,r=$(".RSslidescale",this._context),i=r[0];i.width=r.width(),i.height=r.height();var c=i.getContext("2d"),p=(a-o)/2;for(c.beginPath(),t=0;t<=l;t+=1)e=4+p+o*(t/l),c.moveTo(e,19),c.lineTo(e,25);for(c.strokeStyle="#777",c.lineWidth=1.9,c.stroke(),c.fillStyle="#777",c.font="bold 11px Arial,Helvetica,sans-serif",c.textBaseline="middle",c.textAlign="center",t=0;t<=l;t+=1)e=4+p+o*(t/l),c.fillText(t+_+"",e,10);this._rs_drawGraphAxes(),this._rs_draw()},$(function(){$(".risesetcharts").each(function(t,e){var i=$(e),e=new ot(i.data("meta"),i);i.data("handler",e)})}),nt.prototype._angDist=function(t,e,i,s){t*=Math.PI/180,e*=Math.PI/180,i*=Math.PI/180,s*=Math.PI/180;var a=Math.sin(t)*Math.cos(e),t=Math.cos(t)*Math.cos(e),e=Math.sin(e),a=Math.sin(i)*Math.cos(s)-a,t=Math.cos(i)*Math.cos(s)-t,e=Math.sin(s)-e,e=Math.sqrt(a*a+t*t+e*e);return 2*Math.asin(e/2)*180/Math.PI},nt.prototype._updateDateSelect=function(){var t=this._sp_time+this._tzOffset.offset(this._sp_time),t=be._unix_to_calendar(t);$(".day").val(t[2]),$(".month").val(t[1]),$(".year").val(t[0])},nt.prototype._gotoNow=function(){var t=this;t._sp_time=86400*Math.floor(be._utc_now()/86400),t._sp_time-=t._tzOffset.offset(t._sp_time),t._updateDateSelect(),t._updateView()},nt.prototype._gotoSelectedTime=function(){var t=parseInt($(".day").val()),e=parseInt($(".month").val()),i=parseInt($(".year").val()),t=be._calendar_to_unix(i,e,t,0,0,0);this._magMin=parseInt($(".mag").val())+.05,t-=this._tzOffset.offset(t),this._sp_time=t,this._updateView()},nt.prototype._make_direction=function(t){return t=(t/Math.PI*180+720)%360,["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW","N"][Math.floor((t+11.25)/22.5)%16]},nt.prototype._writePassInfo=function(o,t,e,i){var n=this,h=!1,s="",a={utc:t,alt:"&ndash;",gal:0,gaz:0,dir:"&ndash;",mag:"&ndash;",ia:0,dist:0},r={1:$.extend({},a),2:$.extend({},a),3:$.extend({},a)},_={has_risen:!1,past_peak:!1};n._previous_altitude=-90;var l=n._calc_sp,c=function(t,e){l._gotoUtc_mode1(t+e,0);var i=l._calcPos(o),s=!i||n._magMin<600&&!l.objIllum||l.alt<10*Math.PI/180;!s&&(400<n._magMin||l.mag<n._magMin)&&(h=!0);var a=!_.has_risen&&!s,i=i&&l.alt<n._previous_altitude&&!_.past_peak&&!s,s=_.has_risen&&s;if(!(a||i||s))return n._previous_altitude=l.alt,!1;if(2<e)return c(t,e/2)||c(t+e/2,e/2),n._previous_altitude=l.alt,s;t={utc:t,alt:(180*l.alt/Math.PI).toFixed(0),ia:(180*l.ia/Math.PI).toFixed(0),dist:l.distance.toFixed(0),mag:l.mag.toFixed(1)+(null===l.abs_mag?"&nbsp;?":""),dir:n._make_direction(l.azi),gal:(180*l.alt/Math.PI).toFixed(2),gaz:(180*l.azi/Math.PI).toFixed(2)};return a&&$.extend(r[1],t),i&&$.extend(r[2],t),s&&$.extend(r[3],t),s&&!_.past_peak&&$.extend(r[2],t),a&&(_.has_risen=!0),i&&(_.past_peak=!0),n._previous_altitude=l.alt,s},p=24e3;!$(".incdaylight",n._context).is(":checked")&&t<e&&(p=Math.min(p,e-t));for(var d=-180;d<p&&!c(t+d,60);d+=60);if(!h)return!1;if(void 0===l._spacecraft[l._spacecraft_lookup[o]])return!1;a=l._spacecraft[l._spacecraft_lookup[o]],e=a[1],a=parseFloat(a[2]);return s+='<td><a href="'+window.server+"spacecraft.php?id="+o+'">'+e+"</a></td>",s+="<td>"+u(r[2].utc)+"</td>",s+=this._writeTimePoint(r[1],o),s+=this._writeTimePoint(r[2],o),s+=this._writeTimePoint(r[3],o),s+='<td><a href="'+window.server+"satpasseschart.php?utc1="+r[1].utc.toFixed(0)+"&utc3="+r[3].utc.toFixed(0)+"&satid="+o+'">Chart...</a></td>',[r[1].utc,r[3].utc,s,e,a,!1]},nt.prototype._writeTimePoint=function(t,e){t.utc&&"&ndash;"!==t.alt?(t.then=be._unix_to_calendar(t.utc+this._tzOffset.offset(t.utc)),t.hour=Pe(t.then[3]),t.mins=Pe(t.then[4]),t.secs=Pe(Math.floor(t.then[5])),t.tstr='<a href="'+window.server+"satmap_radar.php?utc="+t.utc.toFixed(0)+"&gotosat="+e+'">'+t.hour+":"+t.mins+":"+t.secs+"</a>"):t.tstr="Dawn";e="";return e+="<td>"+t.tstr+"</td>",e+="<td>"+t.dir+"</td>",e+="<td>"+t.alt+"&deg;</td>",e+="<td>"+t.mag+"</td>"},nt.prototype._updateView=function(){var i=this,e=i._calc_sp;if(e){var t,s,a,o,n=[],h=$(".warning_canvas",this._context),r="Estimating satellite positions on the basis of Celestrak orbital elements downloaded ";i._worker_period=0;var _=$(".sp_target");if(_.empty(),_.html("<b>Please wait...</b>"),$(".anysat").prop("checked"))t=3,2.5<i._magMin&&(t=2),4.5<i._magMin&&(t=1),s=i._sp_time,e._gotoUtc_mode1(s,1),i._worker_calc_mode=1,jQuery.each(e._elements,function(t){if(e._calcPos(t)&&!(2e3<e.altitude)){if(null===e.abs_mag){if(i._magMin<400)return;if(-1!==e._spacecraft[e._spacecraft_lookup[t]][1].indexOf("DEB"))return}n.push(t)}}),o=be._unix_to_calendar(this._calc_sp._elements_fetched+this._tzOffset.offset(this._calc_sp._elements_fetched)),a=Math.abs(this._calc_sp._elements_fetched-s),r+="on "+Pe(o[2])+" "+this._monthNames[o[1]]+" "+o[0]+". ",345600<a?(r+="Note that this is "+Math.floor(Math.abs(a/86400))+" days "+(this._calc_sp._elements_fetched<s?"before":"after")+" the displayed epoch. Some low-earth objects may be shown incorrectly.",h.removeClass("alert-info").addClass("alert-danger")):h.removeClass("alert-danger").addClass("alert-info");else if($(".groupsat").prop("checked"))t=3,s=i._sp_time,e._gotoUtc_mode1(s,1),i._worker_calc_mode=1,jQuery.each(e._groupMembers,function(t,e){jQuery.each(e,function(t,e){t===i._settings.searchGroup&&$.extend(n,e)})}),o=be._unix_to_calendar(this._calc_sp._elements_fetched+this._tzOffset.offset(this._calc_sp._elements_fetched)),a=Math.abs(this._calc_sp._elements_fetched-s),r+="on "+Pe(o[2])+" "+this._monthNames[o[1]]+" "+o[0]+". ",345600<a?(r+="Note that this is "+Math.floor(Math.abs(a/86400))+" days "+(this._calc_sp._elements_fetched<s?"before":"after")+" the displayed epoch. Some low-earth objects may be shown incorrectly.",h.removeClass("alert-info").addClass("alert-danger")):h.removeClass("alert-danger").addClass("alert-info");else{t=10,e._gotoUtc_mode1(i._sp_time,1);var l=i._searchForSat();if(!l)return;s=i._sp_time,_=i._sp_time+86400*t,e._gotoUtc_mode2_init(l,s,_),i._worker_calc_mode=2,n.push(l),_=this._calc_sp._mode2_epochs[0],l=this._calc_sp._mode2_epochs[this._calc_sp._mode2_epochs.length-1],o=be._unix_to_calendar(_+this._tzOffset.offset(_)),l=be._unix_to_calendar(l+this._tzOffset.offset(l)),this._calc_sp._mode2_epochs.length<2?r+="on "+Pe(o[2])+" "+this._monthNames[o[1]]+" "+o[0]+". ":r+="between "+Pe(o[2])+" "+this._monthNames[o[1]]+" "+o[0]+" and "+Pe(l[2])+" "+this._monthNames[l[1]]+" "+l[0]+". ",345600<(a=Math.abs(_-s))?(r+="Note that some of the predictions below may have significant inaccuracy due to changes in the orbits of low-earth objects.",h.removeClass("alert-info").addClass("alert-danger")):h.removeClass("alert-danger").addClass("alert-info")}h.html(r),$(".incdaylight",i._context).is(":checked")?$(".non-daylight",i._context).hide():$(".non-daylight",i._context).show(),i._worker_time=i._sp_time,i._worker_nids=n,i._worker_period=t,i._worker_i=0,i._worker_draughtSince="",i._worker_druaghtUpTo="",i._worker_html=""}},nt.prototype._updateAlarm=function(){var t=this,e=this._settings;if(!t._initialised){if(null===(s=t._calc_sp)._spacecraft_lookup)return;t._initialised=!0,e.searchByNorad&&-1!==$.inArray(e.searchByNorad,s._noradIds)?(x=s._spacecraft_lookup[e.searchByNorad],$(".onesat",t._context).prop("checked",!0),$(".searchbox",t._context).val(s._spacecraft[x][1])):(e.searchGroupId?$(".groupsat",t._context):$(".anysat",t._context)).prop("checked",!0),t._updateView(),t._satAutocompleteInit(),t._calc_sp._epochUpdateHook=function(){t._satAutocompleteUpdate()},$(".goto-now",t._context).on("click",function(){t._gotoNow()}),$(".searchbox",t._context).keypress(function(){$(".onesat",t._context).prop("checked",!0)}),$(".group",t._context).on("change",function(){$(".groupsat",t._context).prop("checked",!0)})}if(!(t._worker_i>=t._worker_period||t._lock)){t._lock=1;var i=t._worker_time+86400*t._worker_i,s=t._calc_sp,a=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o="";2===t._worker_calc_mode?s._gotoUtc_mode2(i+43200):s._gotoUtc_mode1(i+43200,1);for(var n=(720+(s._sun_ra-s._zen_RA-t._userlong*Math.PI/180)/Math.PI*1440/2)%1440,h=R(s._sun_dec,t._userlat*Math.PI/180,.57*Math.PI/180)/60,r=(n-h)%1440,_=(n+h)%1440;n<0;)n+=1440;for(;1440<=n;)n-=1440;for(;r<0;)r+=1440;for(;1440<=r;)r-=1440;for(;_<0;)_+=1440;for(;1440<=_;)_-=1440;for(var l=(n-(h=R(s._sun_dec,t._userlat*Math.PI/180,6*Math.PI/180)/60))%1440,c=(n+h)%1440;l<0;)l+=1440;for(;1440<=l;)l-=1440;for(;c<0;)c+=1440;for(;1440<=c;)c-=1440;var p=be._unix_to_calendar(i+t._tzOffset.offset(i)+1),d=p[2],e=p[1],h=p[0];o+='<p class="mainbar"><span class="mainbar">'+d+" "+a[e]+" "+h+'</span></p><div class="mainbarb"><div class="mainbarc"></div></div>',o+='<p class="smtext" style="padding:8px 4px;"><b>Sunrise:</b> '+Pe(Math.floor(r/60))+":"+Pe(Math.floor(r%60)),o+="; <b>Noon:</b> "+Pe(Math.floor(n/60))+":"+Pe(Math.floor(n%60)),o+="; <b>Sunset:</b> "+Pe(Math.floor(_/60))+":"+Pe(Math.floor(_%60)),o+="\n",o+='<div style="padding-bottom:15px;"><table class="stripy sattable">',o+='<thead><tr><td></td><td></td><td colspan="4">Start</td><td colspan="4">Highest</td><td colspan="4">End</td><td></td></tr>\n',o+="<tr><td>Satellite Name</td><td></td><td>Time</td><td>Dir</td><td>Alt</td><td>Mag</td>",o+="<td>Time</td><td>Dir</td><td>Alt</td><td>Mag</td><td>Time</td><td>Dir</td><td>Alt</td><td>Mag</td><td>Diagram of pass</td></tr></thead><tbody>\n";for(var u=[],f=t._worker_nids,g=f.length,m=$(".incdaylight",t._context).is(":checked"),v=0;v<g;v++){var x=f[v],y=1,w=0;m||0!==t._worker_i||(w=720);for(var M=w;M<1440;M+=y){if(!m){if(l<c&&l<M&&M<c){M=c,y=0;continue}if(c<l&&M<c){M=c,y=0;continue}if(c<l&&l<M)break}s._setCalcTime(i+60*M,0);var k=s._calcPos(x);if(!k)break;(y=85*t._angDist(k[1],k[0],t._userlong,t._userlat)/360)<.5&&(y=.5),t._magMin<600&&!s.objIllum||t._magMin<400&&s.mag>t._magMin+1||s.alt<5*Math.PI/180||(y=(k=t._writePassInfo(x,i+60*M,i+60*l,i+60*c))?(u.push(k),(k[1]-(i+60*M))/60+80):80)}}u.sort(function(t,e){return t[0]-e[0]});var b=!$(".group_starlink",t._context).is(":checked"),P=100;for(v=0;v<u.length;v++)if(!u[v][5]){for(var I=null,S=!1,T=0,A=v;A<u.length;A++)if(null!==I){if(!S||u[A][0]>T)break;u[v][4]===u[A][4]&&(I.push(u[A]),T=u[A][1]+900,u[A][5]=!0)}else I=[u[A]],S=b&&"STARLINK"===u[A][3].substr(0,8),T=u[A][1]+900,u[A][5]=!0;if(I.length<2)o+="<tr>"+I[0][2]+"</tr>";else{var z=be._unix_to_calendar(I[0][4]+this._tzOffset.offset(I[0][4]));o+="<tr class='satpasses_block_spacer bg_ff'><td colspan='15'></td></tr>",o+="<tr class='satpasses_block_header'><td colspan='15'>",o+="<div class='satlist_collapse_heading satlist_toggle_closed' data-id='"+P+"'>",o+="    <div class='satlist_collapse_toggle satlist_open satlist_active'>&#x25B6;</div>",o+="    <div class='satlist_collapse_toggle satlist_close satlist_inactive'>&#x25BC;</div>",o+="Starlink satellites launched "+z[2]+" "+be._monthname[z[1]-1]+" "+z[0]+" ",o+="&ndash; "+I.length+" satellites between ";var C=be._unix_to_calendar(I[0][0]+this._tzOffset.offset(I[0][0])),z=I.length-1,z=be._unix_to_calendar(I[z][0]+this._tzOffset.offset(I[z][0]));for(o+=Pe(C[3])+":"+Pe(C[4]),o+=" and ",o+=Pe(z[3])+":"+Pe(z[4]),o+=" (click to expand)</div></td></tr>",A=0;A<I.length;A++)o+="<tr class='satlist_inactive satlist_grouping satlist_group_"+P+"'>"+I[A][2]+"</tr>";o+="<tr class='satpasses_block_spacer bg_ff'><td colspan='15'></td></tr>",P++}}o+="</tbody></table></div>\n";p=0<u.length,h=d+" "+a[e]+" "+h;p&&0<t._worker_draughtSince.length&&(t._worker_draughtSince===t._worker_draughtUpTo?t._worker_html+='<div class="satpassesdraught">No passes on '+t._worker_draughtUpTo+".</div>\n":t._worker_html+='<div class="satpassesdraught">No passes between '+t._worker_draughtSince+" and "+t._worker_draughtUpTo+".</div>\n",t._worker_draughtSince="",t._worker_draughtUpTo=""),p||(0===t._worker_draughtSince.length&&(t._worker_draughtSince=h),t._worker_draughtUpTo=h),p&&(t._worker_html+=o);h=t._worker_html;p||(t._worker_draughtSince===t._worker_draughtUpTo?h+='<div class="satpassesdraught">No passes on '+t._worker_draughtUpTo+".</div>\n":h+='<div class="satpassesdraught">No passes between '+t._worker_draughtSince+" and "+t._worker_draughtUpTo+".</div>\n"),$(".sp_target").html(h),$(".sp_target .satlist_collapse_heading").click(function(){var t=$(this),e=!t.hasClass("satlist_toggle_open"),i=t.data("id");e?(t.addClass("satlist_toggle_open").removeClass("satlist_toggle_closed"),$(".satlist_open",t).addClass("satlist_inactive").removeClass("satlist_active"),$(".satlist_close",t).addClass("satlist_active").removeClass("satlist_inactive"),$(".sp_target .satlist_group_"+i).addClass("satlist_active").removeClass("satlist_inactive")):(t.addClass("satlist_toggle_closed").removeClass("satlist_toggle_open"),$(".satlist_close",t).addClass("satlist_inactive").removeClass("satlist_active"),$(".satlist_open",t).addClass("satlist_active").removeClass("satlist_inactive"),$(".sp_target .satlist_group_"+i).addClass("satlist_inactive").removeClass("satlist_active"))}),t._worker_i+=1,t._lock=0}},nt.prototype._satAutocompleteInit=function(){var i=this;i._satAutocompleteList=[],$(".searchbox").autocomplete({source:function(t,e){e($.ui.autocomplete.filter(i._satAutocompleteList,t.term).slice(0,10))},select:function(t,e){return $(t.target).val(e.item.value),$(".onesat",i._context).prop("checked",!0),i._gotoSelectedTime(),!1}}),i._satAutocompleteUpdate()},nt.prototype._satAutocompleteUpdate=function(){var i=[],t=this._calc_sp;jQuery.each(t._names,function(t,e){i.push({label:e[1],value:e[1]})}),this._satAutocompleteList=i},nt.prototype._searchForSat=function(){for(var t,e=this,i=$(".searchbox").val(),s=i.toUpperCase(),a=0;a<e._calc_sp._names.length;a++)if(s===(t=e._calc_sp._names[a])[1].toUpperCase()||s===t[0])return e._calc_sp._calcPos(t[0])?t[0]:(alert("Spacecraft '"+i+"' is not in Earth orbit at the selected time."),0);for(a=0;a<e._calc_sp._names.length;a++)if(-1<(t=e._calc_sp._names[a])[1].toUpperCase().indexOf(s))return e._calc_sp._calcPos(t[0])?t[0]:(alert("Spacecraft '"+i+"' is not in Earth orbit at the selected time."),0);return alert("Could not find a spacecraft with name '"+i+"'."),0},$(function(){$(".sat_passes").each(function(t,e){var i=$(e),e=new nt(i.data("meta"),i);i.data("handler",e)})}),ht.prototype._pageRefresh=function(){if(this._refresh){if(!("planetarium"in this)){var t=this._planetarium_el.data("handler");if(void 0===t)return;this._planetarium=t}this._planetarium.ready&&(this._planetarium.setTrack([this._track]),this._planetarium.gotoUtcTime(this._utc_midpoint),this._refresh=!1)}},$(function(){$(".sat_passes_chart").each(function(t,e){var i=$(e),e=new ht(i.data("meta"),i);i.data("handler",e)})}),rt.prototype._findBestEphemeris=function(t,e){var i=e.length-1,s=0,a=i;if(t>=e[-1])return i;if(t<=e[0])return 0;for(;s<=a;){var o=Math.floor((s+a)/2);if(e[o]>t)a=o-1;else{if(!(e[o]<t))return o;s=o+1}}return a<0?0:i<s?i:Math.abs(e[s]-t)>Math.abs(e[a]-t)?a:s},rt.prototype._gotoUtc_mode1=function(t,e){var i=this;i._mode2_noradId&&e&&(i._mode2_noradId=0,i._epoch=0),e&&172800<=Math.abs(t-this._epoch)&&($.ajax({async:!1,type:"GET",dataType:"json",url:window.server+"json/satlist.php?list_at_epoch=1&epoch="+t+(i._inc_non_groups?"&inc_non_groups=1":"")+(i._inc_faint?"&inc_faint=1":"")+(i._filter_group?"&group="+i._filter_group:"")+(i._filter_noradId?"&id="+i._filter_noradId:""),success:function(t){i._elements=t.elements,i._elements_fetched=parseFloat(t.epoch)}}),this._epoch=t,this._epochUpdateHook()),this._setCalcTime(t)},rt.prototype._mode1_add_spacecraft=function(t){var e=this,i=this._epoch;$.ajax({async:!1,type:"GET",dataType:"json",url:window.server+"json/satlist.php?list_at_epoch=1&inc_faint=1&inc_non_groups=1&epoch="+i+"&id="+t,success:function(t){e._elements=$.extend(e._elements,t.elements)}})},rt.prototype._gotoUtc_mode2_init=function(t,e,i){var s=this;s._mode2_noradId=t,$.ajax({async:!1,type:"GET",dataType:"json",url:window.server+"json/satlist.php?span_for_id="+t+"&tmin="+e+"&tmax="+i,success:function(t){s._mode2_epochs=t.epochs,s._mode2_elements=t.elements}})},rt.prototype._gotoUtc_mode2=function(t){var e=this._findBestEphemeris(t,this._mode2_epochs);this._elements={},$.inArray(e,this._mode2_elements)&&(this._elements[this._mode2_noradId]=this._mode2_elements[e]),this._epoch=this._mode2_epochs[e],this._elements_fetched=this._epoch,this._epochUpdateHook(),this._setCalcTime(t)},rt.prototype._setCalcTime=function(t){var e=(t-946684800)/31557600,i=e/100,s=.0002236174+1.35263017e-7*i,a=971719333e-13+4.14515697e-8*i,o=Math.PI/180,n=t/86400+2440587.5,h=(n-2451545)/36525,r=(280.46061837+360.98564736629*(n-2451545)+387933e-9*h*h+h*h*h/3871e4)*o,i=357.52911+35999.05029*h+1537e-7*h*h,n=280.46646+36000.76983*h+3032e-7*h*h+((1.914602-.004817*h-14e-6*h*h)*Math.sin(i*o)+(.019993-101e-6*h)*Math.sin(2*i*o)+289e-6*Math.sin(3*i*o)),i=23.43929111111111+46.815/3600*h,h=Math.atan2(Math.cos(i*o)*Math.sin(n*o),Math.cos(n*o)),o=Math.sin(i*o)*Math.sin(n*o);h+=(s+a*Math.sin(h)*Math.tan(o))*e,o+=a*Math.cos(h)*e,this._utc_calc=t,this._zen_RA=r,this._sun_ra=h,this._sun_dec=o},rt.prototype._calcPos=function(t){if(!(t in this._elements))return!1;var e=this._utc_calc,i=this._elements[t];if(null===i)return!1;for(var s=6371e3,a=i[6],o=Math.pow(3986004418e5/Math.pow(a,2),.3333333333333),n=i[2],h=i[3],r=i[1],_=i[4],l=i[5]+(e-i[0])*a,c=.5,p=l%=2*Math.PI,d=0;d<12&&1e-14<c;d++){var u=p+(l+n*Math.sin(p)-p)/(1-n*Math.cos(p));(c=Math.abs(u/p))<1&&(c=1/c),--c,p=u}var f=o*(Math.cos(p)-n),g=o*(Math.sqrt(1-n*n)*Math.sin(p)),m=Math.sqrt(f*f+g*g),v=(e-i[0])/86400;_+=Math.PI/180*v*4.97*Math.pow(6378.135/(o/1e3),3.5)*(5*Math.cos(r)*Math.cos(r)-1)/((1-n*n)*(1-n*n)),h-=Math.PI/180*v*9.95*Math.pow(6378.135/(o/1e3),3.5)*Math.cos(r)/((1-n*n)*(1-n*n));var x=Math.cos(_)*Math.cos(h)-Math.sin(_)*Math.sin(h)*Math.cos(r),y=Math.cos(_)*Math.sin(h)+Math.sin(_)*Math.cos(h)*Math.cos(r),w=Math.sin(_)*Math.sin(r),M=x*f+(-Math.sin(_)*Math.cos(h)-Math.cos(_)*Math.sin(h)*Math.cos(r))*g,k=y*f+(-Math.sin(_)*Math.sin(h)+Math.cos(_)*Math.cos(h)*Math.cos(r))*g,b=w*f+Math.cos(_)*Math.sin(r)*g,t=this._userlong*Math.PI/180,a=this._userlat*Math.PI/180,e=s*Math.cos(this._zen_RA+t)*Math.cos(a),v=s*Math.sin(this._zen_RA+t)*Math.cos(a),o=s*Math.sin(a),x=149597871e3,y=x*Math.cos(this._sun_ra)*Math.cos(this._sun_dec),h=x*Math.sin(this._sun_ra)*Math.cos(this._sun_dec),w=x*Math.sin(this._sun_dec),f=(M-e)*(M-e)+(k-v)*(k-v)+(b-o)*(b-o),_=(M-y)*(M-y)+(k-h)*(k-h)+(b-w)*(b-w),r=(e-y)*(e-y)+(v-h)*(v-h)+(o-w)*(o-w),g=Math.acos((f+_-r)/(2*Math.sqrt(f)*Math.sqrt(_))),x=Math.cos(this._zen_RA)*M+Math.sin(this._zen_RA)*k,y=-Math.sin(this._zen_RA)*M+Math.cos(this._zen_RA)*k,h=b,w=this._sun_ra,r=Math.PI/2-this._sun_dec,f=Math.cos(w)*M+Math.sin(w)*k,_=-Math.sin(w)*M+Math.cos(w)*k,w=Math.cos(r)*f-Math.sin(r)*h,r=Math.sin(r)*f+Math.cos(r)*h;this.objIllum=0<r||6381e3<Math.sqrt(w*w+_*_);w=Math.PI/2-a,_=Math.cos(t)*x+Math.sin(t)*y,a=-Math.sin(t)*x+Math.cos(t)*y,t=Math.cos(w)*_-Math.sin(w)*h,w=Math.sin(w)*_+Math.cos(w)*h;this.alt=Math.PI/2-Math.atan2(Math.sqrt(t*t+a*a),w-s),this.azi=Math.atan2(a,-t),this.ra=Math.atan2(k-v,M-e),this.dec=Math.atan2(b-o,Math.sqrt((M-e)*(M-e)+(k-v)*(k-v))),this.distance=Math.sqrt(t*t+a*a+(w-s)*(w-s))/1e3,this.altitude=(m-s)/1e3,this.ia=g;return this.mag=(null===i[8]?6:i[8])-15+5*Math.log(this.distance)/Math.LN10-2.5*Math.log(Math.sin(g)+(Math.PI-g)*Math.cos(g))/Math.LN10,this.abs_mag=i[8],[180*Math.asin(h/m)/Math.PI,180*Math.atan2(y,x)/Math.PI]},rt.prototype._gotoNow=function(){this._utc_real_time_offset=0,this._timeAutoincrement()},rt.prototype._gotoUtc=function(t){this._utc_real_time_offset=t-be._utc_now(),this._timeAutoincrement()},rt.prototype._timeAutoincrement=function(){var t=be._utc_now()+this._utc_real_time_offset;this._gotoUtc_mode1(t,1)},_t.prototype._setup2=function(){var s=this;s._itemsStillToLoad--,s._itemsStillToLoad||(s._calc._epochUpdateHook=function(){s._updateSatelliteSelector();var t=be._unix_to_calendar(parseFloat(s._calc._elements_fetched)+s._tzOffset.offset(s._calc._elements_fetched)),e=Math.abs(s._calc._elements_fetched-s._utc_centre),i=$(".warning_canvas",s._context),t="Estimating satellite positions on the basis of orbital elements NORAD / Celestrak orbital elements downloaded on "+Pe(t[2])+" "+s._monthNames[t[1]]+" "+t[0]+". ";259200<e?(t+="<br />Note that this is "+Math.floor(e/86400)+" days "+(s._calc._elements_fetched<s._utc_centre?"before":"after")+" the displayed epoch. Some low-earth objects may be shown incorrectly.",i.removeClass("alert-info").addClass("alert-danger")):i.removeClass("alert-danger").addClass("alert-info"),i.html(t)},s._lock=0,s._refresh=2,s._refreshSelections=0,s._noradIds=[],s._initSatelliteSelections(),s._itemsStillToLoad=-1,s._settings.gotoUtc?s._gotoUtcTime(s._settings.gotoUtc):s._settings.dispNow?s._gotoNow():s._gotoSelectedTime(),"gotoSat"in s._settings&&$(".searchbox",s._context).val(s._settings.gotoSat),$(".sl, .st, .sp",s._context).click(function(){s.fullRefresh()}),$(".day, .month, .year, .hour, .min",s._context).change(function(){s._gotoSelectedTime()}),$(".colsatby1, .colsatby2, .colsatby3",s._context).click(function(){s._changeColSatBy()}),$(".goto_now",s._context).click(function(){s._gotoNow()}),s._sliderLabel(),$(".link-passes",s._context).click(function(){window.location=window.server+"satpasses.php?year="+$(".year",s._context).val()+"&month="+$(".month",s._context).val()+"&day="+$(".day",s._context).val()}),$(".link-worldmap",s._context).click(function(){window.location=window.server+"satmap_worldmap.php?year="+$(".year",s._context).val()+"&month="+$(".month",s._context).val()+"&day="+$(".day",s._context).val()}),$(".link-radar",s._context).click(function(){window.location=window.server+"satmap_radar.php?year="+$(".year",s._context).val()+"&month="+$(".month",s._context).val()+"&day="+$(".day",s._context).val()}),$(".link-globe",s._context).click(function(){window.location=window.server+"satmap_globe.php?year="+$(".year",s._context).val()+"&month="+$(".month",s._context).val()+"&day="+$(".day",s._context).val()}),$(".link-planetarium",s._context).click(function(){window.location=window.server+"satmap_planetarium.php?year="+$(".year",s._context).val()+"&month="+$(".month",s._context).val()+"&day="+$(".day",s._context).val()}))},_t.prototype._updateDateSelect=function(){var t=this,e=be._unix_to_calendar(t._utc_centre+t._tzOffset.offset(t._utc_centre));$(".day",t._context).val(e[2]),$(".month",t._context).val(e[1]),$(".year",t._context).val(e[0]),$(".hour",t._context).val(e[3]),$(".min",t._context).val(2*Math.floor(e[4]/2))},_t.prototype._updateClockDisplay=function(){var t=this._calc._utc_calc,e=be._unix_to_calendar(t+this._tzOffset.offset(t));$(".clock",this._context).html(Pe(e[3])+":"+Pe(e[4])+":"+Pe(Math.floor(e[5]))+" ("+this._tzOffset._tzName(t)+")<br />"+e[2]+" "+["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e[1]]+" "+Pe(e[0]))},_t.prototype._updateSliderPosition=function(){var t=Math.floor(this._utc_offset_time/this._sliderTimeSpan*this._sliderTimeSteps);t<-this._sliderTimeSteps||t>this._sliderTimeSteps?this._gotoUtcTime(this._utc_centre+this._utc_offset_time):$(".Tslider",this._context).slider("value",t)},_t.prototype._gotoNow=function(){this._gotoUtcTime(be._utc_now())},_t.prototype._gotoUtcTime=function(t){t=parseFloat(t),this._utc_offset_time=0,this._utc_centre=t,this._updateSliderPosition(),this._updateDateSelect(),this._calc._utc_real_time_offset=t-be._utc_now(),this._calc._gotoUtc(t),this.fullRefresh()},_t.prototype._gotoSelectedTime=function(){var t=this,e=parseInt($(".day",t._context).val()),i=parseInt($(".month",t._context).val()),s=parseInt($(".year",t._context).val()),a=parseInt($(".hour",t._context).val()),o=parseInt($(".min",t._context).val()),o=be._calendar_to_unix(s,i,e,a,o,0);o-=t._tzOffset.offset(o),t._gotoUtcTime(o)},_t.prototype._updateAlarm=function(){var t=this;t._refreshSelections&&t._updateSatelliteSelections(),!t._refresh&&$(".fr",t._context).prop("checked")||!t._refresh&&(t.updateAlarmCount--,0<t.updateAlarmCount)||(t.updateAlarmCount=10,t._client._updateView())},_t.prototype._selectIconFrame=function(t){var e,i,s=0,a=this._calc;return 1===this._colsatby?(e=a.mag,s=a.objIllum?12<e?1:10<e?2:8<e?3:6<e?4:5<e?5:4<e?6:3<e?7:2<e?8:1<e?9:0<e?10:-1<e?11:12:0):2===this._colsatby?(i=a.altitude,(s=Math.floor(i/3e3))<1&&(s=1),12<s&&(s=12)):3===this._colsatby&&(i=0,t in a._spacecraft_lookup&&a._spacecraft[a._spacecraft_lookup[t]][2]&&(i=be._unix_to_calendar(a._spacecraft[a._spacecraft_lookup[t]][2])[0]),0<i&&(s=Math.floor((i-2014)/4+12))<1&&(s=1)),s<0&&(s=0),12<s&&(s=12),s},_t.prototype._frameColors=function(t){return["#808080","#ff0000","#ff1600","#ff2d00","#ff4400","#ff5a00","#ff710b","#ff8817","#ff9f22","#ffb52e","#ffcc3a","#ffe345","#fffa51","#ff00ff"][t]},_t.prototype._updateSatelliteSelector=function(){for(var t=this,e="",i=t._calc._groups,s=i.length,a=0,o=0;o<s;o++){e+="<p class='formlabel' style='margin-left: 0;'>"+i[o]+"</p>\n";for(var n=t._calc._subgroups[i[o]],h=n.length,r=0;r<h;r++){var _=!1;n[r]in t._satSelection&&t._satSelection[n[r]]&&(_=!0);var l=n[r];21<l.length&&(l=l.substr(0,19)+"..."),e+='<div style="min-width: 180px; float:left; display:inline-block;">',e+='<label><input class="chk s'+a+'" type="checkbox" name="show" value="s'+a+'" '+(_?'checked="checked"':"")+" /> ",e+=l+"</label></div>\n",a++}e+='<div style="clear:both"></div><hr style="margin: 8px 0;" />\n'}$(".satselect",t._context).html(e),$(".satselect input").click(function(){t._refreshSelections=1}).change(function(){t._refreshSelections=1}),$(document).on("click",".dropdown-menu",function(t){t.stopPropagation()}),t._updateSatelliteSelections(),t._satAutocompleteUpdate()},_t.prototype._updateSatelliteSelections=function(){for(var s=this,t=s._calc._groups,e=t.length,i=0,a=0;a<e;a++)for(var o=s._calc._subgroups[t[a]],n=o.length,h=0;h<n;h++)s._satSelection[o[h]]=$(".s"+i).prop("checked"),i++;var r=s._calc._groupMembers;s._noradIds=[],$.each(r,function(t,e){$.each(e,function(t,e){if(t in s._satSelection&&s._satSelection[t])for(a=0;a<e.length;a++){var i=Ie(e[a]);-1===$.inArray(i,s._noradIds)&&s._noradIds.push(i)}})}),$(".spacecraft_count",s._context).text(s._noradIds.length),s._cpu_time_warning=!1,s._refreshSelections=0,s.fullRefresh()},_t.prototype._initSatelliteSelections=function(){var t=this;t._satSelection={};for(var e=t._calc._groups,i=e.length,s=0;s<i;s++)for(var a=t._calc._subgroups[e[s]],o=a.length,n=0;n<o;n++){var h=a[n],r=!0;0===t._settings.varShow?r="Space stations"===h||"CubeSats"===h||"Starlink"===h:1===t._settings.varShow?r="GPS Operational"===h||"Glonass Operational"===h||"Galileo"===h:2===t._settings.varShow?r="Space stations"===h||"Hubble ST"===h||"GPS Operational"===h:3===t._settings.varShow&&(r="GPS Operational"===h||"Assorted bright"===h||"Space stations"===h||"Starlink"===h),t._satSelection[h]=r}t._updateSatelliteSelector()},_t.prototype.fullRefresh=function(){-1<this._itemsStillToLoad||(this._refresh=2,this._sliderLabel(),this._client._updateView())},_t.prototype._changeColSatBy=function(){var t,e=this,i=1;switch($(".colsatby1",e._context).prop("checked")&&(i=1),$(".colsatby2",e._context).prop("checked")&&(i=2),$(".colsatby3",e._context).prop("checked")&&(i=3),1===(e._colsatby=i)?$(".colsat0").text("Unilluminated"):$(".colsat0").text("Unknown"),i){case 1:for(t=2;t<=12;t+=2)$(".colsat"+t,e._context).html("&nbsp;Mag "+["","","12&ndash;8","","8&ndash;5","","5&ndash;3","","3&ndash;1","","1&ndash; -1","","-1&ndash;"][t]);break;case 2:for(t=2;t<=12;t+=2)$(".colsat"+t,e._context).html("&nbsp;"+3*(t-1)+",000 km &ndash; "+3*(t+1)+",000 km");break;case 3:for(t=2;t<=12;t+=2)$(".colsat"+t,e._context).html("&nbsp;"+(2014+4*(t-1-12))+"&ndash;"+(2014+4*(t+1-12)))}e._client._updateView()},_t.prototype._satAutocompleteInit=function(){var i=this;i._satAutocompleteList=[],$(".searchbox",i._context).autocomplete({source:function(t,e){e($.ui.autocomplete.filter(i._satAutocompleteList,t.term).slice(0,10))},select:function(t,e){return $(t.target).val(e.item.value),i._client._do_search(),!1}}),$(".searchbox",i._context).change(function(){i._client._do_search()}),$(".searchclick",i._context).click(function(){i._client._do_search()})},_t.prototype._satAutocompleteUpdate=function(){var i=[],t=this._calc;jQuery.each(t._names,function(t,e){i.push({label:e[1],value:e[1]})}),this._satAutocompleteList=i},_t.prototype._reportComputeTime=function(t,e){200<t||e?(this._cpu_time_warning=!0,$(".cpu_time_holder",this._context).show()):this._cpu_time_warning||$(".cpu_time_holder",this._context).hide(),e?($(".cpu_time_truncation_holder",this._context).show(),$(".cpu_time_truncation_count",this._context).text(e)):$(".cpu_time_truncation_holder",this._context).hide(),this._cpu_time_warning&&$(".cpu_time_canvas",this._context).text((t/1e3).toFixed(2))},_t.prototype._sliderChange=function(){var t=this,e=$(".Tslider",t._context).slider("value");this._utc_offset_time=e*this._sliderTimeSpan/this._sliderTimeSteps;e=this._utc_centre+this._utc_offset_time-be._utc_now();t._calc._utc_calc+=e-t._calc._utc_real_time_offset,t._calc._utc_real_time_offset=e,t._refresh=2},_t.prototype._sliderLabel=function(){for(var t,e=this._utc_centre+this._tzOffset.offset(this._utc_centre),i=[],s=-2;s<=2;s++){var a=be._unix_to_calendar(e+s*this._sliderTimeSpan/3),o=a[4],a=a[3];i.push([(s+3)/6,Pe(a)+":"+Pe(o)])}var n=$(".Tslidescale",this._context);n[0].width=n.width();var h=n[0].getContext("2d");for(h.beginPath(),s=0;s<i.length;s++)t=12+324*i[s][0],h.moveTo(t,19),h.lineTo(t,25);for(h.strokeStyle="#777",h.lineWidth=1.9,h.stroke(),h.fillStyle="#777",h.font="bold 11px Arial,Helvetica,sans-serif",h.textBaseline="middle",h.textAlign="center",s=0;s<i.length;s++)t=12+324*i[s][0],h.fillText(i[s][1],t,10)},lt.prototype.updateView_globe=function(){var t,l=this;if("earth_day_width"in l&&"earth_night_width"in l){for(var e=Date.now().valueOf(),c=$(".sl",l._context).prop("checked"),p=$(".sp",l._context).prop("checked"),d=[],i=0;i<7;i++){var s=$(".globuf"+i,l._context),a=s[0];a.width=s.width(),a.height=s.height(),d.push(a.getContext("2d"))}l._hoverman.reset();for(var u=a.width,f=a.height,o=Math.floor(u/2),n=Math.floor(f/2),g=6378135,h=40*Math.PI/180,r=14076270/Math.tan(h/2),_=71572e3/Math.tan(h/2),m=r+l.scale/200*(_-r),v=a.height,x=2*v*Math.tan(g/m)/Math.tan(h/2),y=Math.floor(x/2),w=l._core._calc,M=w._utc_calc,_=w._sun_ra,r=w._sun_dec,M=st(M)/12*Math.PI,k=Math.sin(_-M)*Math.cos(r),b=Math.cos(_-M)*Math.cos(r),P=-Math.sin(r),I=l.earth_day,S=l.earth_night,T=l.earth_day_width,A=l._earth_day_height,z=Math.PI+M+l._rotate1,C=Math.PI/2+l._rotate2,M=d[3].getImageData(0,0,u,f),R=M.data,j=-y;j<y;j++)for(var D=-y;D<y;D++){var N=(L=D/y)*L+(t=-j/y)*t;if(!(1<=N)){F=Math.sqrt(1-N);var O=4*((n+j)*u+(o+D)),N=L,L=t*Math.cos(C)+F*Math.sin(C),F=-t*Math.sin(C)+F*Math.cos(C),E=N*Math.cos(z)-L*Math.sin(z),W=N*Math.sin(z)+L*Math.cos(z),U=F,N=Math.atan2(E,W),L=Math.asin(U);E-=k,W-=b,U-=P;for(var F=Math.acos(1-(E*E+W*W+U*U)/2),H=Math.floor(N/Math.PI/2*T+T/2);T<=H;)H-=T;for(var G=Math.floor(L/Math.PI*A-A/2);G<0;)G+=A;L=4*(T*G+H),F=F>Math.PI/2?S:I;R[O++]=F[L],R[O++]=F[1+L],R[O++]=F[2+L],R[O]=255}}d[3].putImageData(M,0,0);function B(t,e,i){var s=t*Math.cos(z)+e*Math.sin(z),t=-t*Math.sin(z)+e*Math.cos(z),e=i,i=s,s=t*Math.cos(C)-e*Math.sin(C),t=t*Math.sin(C)+e*Math.cos(C),t=m-t,e=Math.sqrt(i*i+s*s+t*t),e=Math.PI/2-Math.asin(t/e),i=Math.atan2(s,i),e=Math.tan(e)/Math.tan(h/2)*v;return{x:o+e*Math.cos(i),y:n-e*Math.sin(i),zn:t,radius:e}}if(p){for(var J,q=Math.ceil(u/x),Y=5<q?.5:.25,x=z,z=0,j=-q;j<q+.01;j+=Y){var V=0;Math.abs(j)<1&&(V=Math.sqrt(1-j*j));var X=d[j<0?1:5];X.strokeStyle="#404040",X.lineWidth=1.25,X.beginPath(),J=B(-q*g,j*g,0),X.moveTo(J.x,J.y),J=B(-V*g,j*g,0),X.lineTo(J.x,J.y),J=B(V*g,j*g,0),X.moveTo(J.x,J.y),J=B(q*g,j*g,0),X.lineTo(J.x,J.y),X.stroke()}for(D=-q;D<q+.01;D+=Y){var Z=0;Math.abs(D)<1&&(Z=Math.sqrt(1-D*D)),d[1].strokeStyle="#404040",d[1].lineWidth=1.25,d[1].beginPath(),J=B(D*g,-q*g,0),d[1].moveTo(J.x,J.y),J=B(D*g,-Z*g,0),d[1].lineTo(J.x,J.y),d[1].stroke(),d[5].strokeStyle="#404040",d[5].lineWidth=1.25,d[5].beginPath(),J=B(D*g,Z*g,0),d[5].moveTo(J.x,J.y),J=B(D*g,q*g,0),d[5].lineTo(J.x,J.y),d[5].stroke()}z=x}function Q(t,e){var i,s,a,o,n,h,r,_=e._calcPos(t);_&&(i=1e3*e.altitude+g,E=Math.sin(_[1]*Math.PI/180)*Math.cos(_[0]*Math.PI/180)*i,W=Math.cos(_[1]*Math.PI/180)*Math.cos(_[0]*Math.PI/180)*i,U=-Math.sin(_[0]*Math.PI/180)*i,(s=B(E,W,U)).zn>m&&s.radius<=y||s.zn<.45*m||s.zn>1.55*m||s.x<0||s.x>u||s.y<0||s.y>f||(o=0,s.zn<m&&(o+=4),Math.sign(U)===Math.sign(C)&&(o+=2),a=d[o],r=l._core._selectIconFrame(t),t===l._highlightItem&&(K=[s.x,s.y],o=e.mag,o=null===e.abs_mag?"Unknown":e.objIllum?Math.floor(10*o)/10:"Unilluminated",e.azi<0&&(e.azi+=2*Math.PI),n=e._spacecraft[e._spacecraft_lookup[t]][1],h="<p style='font-weight: bold; font-size:15px;'>"+n+"</p>",1<l._highlightItemNames.length&&(h+="<p><b>Also known as:</b><br/>",$.each(l._highlightItemNames,function(t,e){e!==n&&(h+=e+"<br />")}),h+="</p>"),h+="<p>",h+="<b>Position:</b><br/>",h+="Altitude: "+Math.floor(e.altitude)+" km<br />",h+="Lat: "+Math.floor(10*Math.abs(_[0]))/10+"&deg;"+(_[0]<0?"S":"N")+"<br/>",h+="Long: "+Math.floor(10*Math.abs(_[1]))/10+"&deg;"+(_[0]<0?"W":"E")+"<br/>",h+="</p><p>",h+="<b>From "+l._settings.placename+":</b><br />",h+="Mag: "+o+"<br />",h+="Dist: "+Math.floor(e.distance)+" km<br />",h+="Alt: "+Math.floor(180*e.alt/Math.PI)+"&deg;<br />",h+="Az: "+Math.floor(180*e.azi/Math.PI)+"&deg;<br />",h+="</p>",h+="<p style='text-align:center;'>",h+="<form method='get' action='"+window.server+"spacecraft.php'>",h+="<input type='hidden' name='id' value='"+t+"' />",h+="<input type='submit' class='btn btn-sm btn-success' value='More info...' />",h+="</form><br />",h+="<form method='get' action='"+window.server+"satpasses.php'>",h+="<input type='hidden' name='gotosat' value='"+t+"' />",h+="<button type='submit' class='btn btn-sm btn-success'>Passes over<br />"+l._settings.placename+"...</button>",h+="</form>",h+="</p>",$(".information_contents").html(h)),r=l._core._frameColors(r),a.fillStyle=r,a.strokeStyle=r,a.lineWidth=.42,a.beginPath(),a.arc(s.x,s.y,4,0,360,0),a.fill(),p&&(r=Math.hypot(E,W)>=.999*g?0:Math.sqrt(g*g-E*E-W*W)*Math.sign(U),r=B(E,W,r),a.beginPath(),a.moveTo(s.x,s.y),a.lineTo(r.x,r.y),a.stroke(),a.beginPath(),a.arc(r.x,r.y,1.2,0,360,0),a.fill()),c&&.08*m<i&&(e=e._spacecraft[e._spacecraft_lookup[t]][1],a.fillStyle="#e0e0e0",a.font="bold 12px Arial,Helvetica,sans-serif",t===l._highlightItem&&(a.fillStyle="#ffff40"),a.fillText(e,s.x+6,s.y)),l._hoverman.hoverBox(t,s.x-15,s.y-12,30,24)))}var K=null,tt=l._core._noradIds.length;for(i=0;i<tt;i++){var et=l._core._noradIds[i];if(et!==l._highlightItem&&Q(et,w),1500<i)break}l._highlightItem&&Q(l._highlightItem,w),null===K?$(".crosshair",l._context).css("display","none"):(it=K,$(".crosshair",l._context).css("display","block").css("left",it[0]-18).css("top",it[1]-18));var it=Date.now().valueOf();l._core._reportComputeTime(it-e,1500<i&&1500)}},lt.prototype._updateView=function(){var t=this;void 0!==t._core&&(-1<t._core._itemsStillToLoad||t._lock||(t._lock=1,$(".fr",t._context).prop("checked")||t._core._calc._timeAutoincrement(),t._core._updateClockDisplay(),t.updateView_globe(),t._lock=0,t._core._refresh=0))},lt.prototype.initGlobeView=function(){var s=this,t=$(".globuff",s._context);s._hoverman=new I(t,!1,!1,function(t){s._globe_mouseClk(t)},!1),s._hoverman._hH=function(t,e,i){s._globe_mousePos(t,e,i)},s._rotate1=0,s._rotate2=0,s._highlightItem=null,s.scale=30,$(".gloslider",s._context).slider({min:0,max:200,value:s.scale,change:function(){s.scale=$(".gloslider",s._context).slider("value"),s._core._refresh=2,s._updateView()},slide:function(){s.scale=$(".gloslider",s._context).slider("value"),s._core._refresh=2,s._updateView()}}),t.mousedown(function(t){s.glo_mouseDown(t)}),t.mouseup(function(t){s.glo_mouseUp(t)}),t.mousemove(function(t){s.glo_mouseDrag(t)}),t.mouseleave(function(){s.glo_mouseUp(0)}),s._is_pinching=!1,s._pinch_distance=0,t.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(s._is_pinching=!1,s.glo_mouseDown(t.touches[0])):2===t.touches.length&&(s._is_pinching=!0,s._pinch_distance=s.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),s._is_pinching||s.glo_mouseUp(0),s._is_pinching=!1,s.mousedown=0},touchmove:function(t){t.preventDefault();var e=t.originalEvent;s._is_pinching?(t=s.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),25<Math.abs(t-s._pinch_distance)&&(s.glo_displaywheel(e.touches[0],s._pinch_distance-t),s._pinch_distance=t)):s.glo_mouseDrag(e.touches[0])},touchcancel:function(t){t.preventDefault(),s._is_pinching||s.glo_mouseUp(0),s._is_pinching=!1,s.mousedown=0}});var e="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";t.bind(e,function(t){s.glo_displaywheel(t.originalEvent)}),s.imCount=2,s.dayIm=new Image,s.dayIm.onload=function(){s.dayC=$(".canvas_edc",s._context)[0],s.dayC.width=s.dayIm.width,s.dayC.height=s.dayIm.height;var t=s.dayC.getContext("2d");t.drawImage(s.dayIm,0,0),s.earth_day_width=s.dayIm.width,s._earth_day_height=s.dayIm.height,s.earth_day=t.getImageData(0,0,s.earth_day_width,s._earth_day_height).data,s.imCount--,0===s.imCount&&(s._core._refresh=2,s._updateView())},s.dayIm.src=window.server+"images/earth_day.jpg",s.nightIm=new Image,s.nightIm.onload=function(){s.nightC=$(".canvas_enc",s._context)[0],s.nightC.width=s.nightIm.width,s.nightC.height=s.nightIm.height;var t=s.nightC.getContext("2d");t.drawImage(s.nightIm,0,0),s.earth_night_width=s.nightIm.width,s._earth_night_height=s.nightIm.height,s.earth_night=t.getImageData(0,0,s.earth_night_width,s._earth_night_height).data,s.imCount--,0===s.imCount&&(s._core._refresh=2,s._updateView())},s.nightIm.src=window.server+"images/earth_night.jpg"},lt.prototype._updateView_globeHoverLabel=function(t,e,i,s){s=$("."+s,this._context),0!==t?(s.css("width","150px"),s.css("left",e-75+"px"),s.css("top",i+12+"px"),s.css("display","block"),t="<b>"+(i=this._core._calc)._spacecraft[i._spacecraft_lookup[t]][1]+"</b>",s.html(t)):s.css("display","none")},lt.prototype._globeSelectItem=function(i){var s=this;(this._highlightItem=i)&&450<this._width?($(".information_contents").html(""),$(".information_holder").show()):$(".information_holder").hide(),this._highlightItemNames=[],$.each(this._core._calc._names,function(t,e){e[0]===i&&s._highlightItemNames.push(e[1])}),this._core._refresh=2},lt.prototype._globe_mousePos=function(t,e,i){this._updateView_globeHoverLabel(t,e,i,"glohover")},lt.prototype._globe_mouseClk=function(t){t&&this._globeSelectItem(t)},lt.prototype.glo_mouseDown=function(t){var e=this;e.pos_=At(t,$(".globuff",e._context)),e.rotate1_=e._rotate1,e.rotate2_=e._rotate2,e.mousedown=1},lt.prototype.glo_mouseDrag=function(t){var e,i=this;i._hoverman.hoverHandle(t),0===t?e=[i._mousex,i._mousey]:(e=At(t,$(".globuff",i._context)),i._mousex=e[0],i._mousey=e[1]),i.mousedown&&(t=e[0]-i.pos_[0],e=e[1]-i.pos_[1],i._rotate1=i.rotate1_+t/120,i._rotate2=i.rotate2_+e/120,i._rotate1<-Math.PI&&(i._rotate1+=2*Math.PI),i._rotate1<-Math.PI&&(i._rotate1+=2*Math.PI),i._rotate2<-Math.PI/2&&(i._rotate2=-Math.PI/2),i._rotate2>Math.PI/2&&(i._rotate2=Math.PI/2),i._core._refresh=1)},lt.prototype.glo_mouseUp=function(t){this.glo_mouseDrag(t),this.mousedown=0},lt.prototype.glo_displaywheel=function(t,e){var i=this;t.preventDefault&&t.preventDefault(),t.returnValue=!1;var s=Date.now();void 0!==this._lastZoomEventTime&&s<this._lastZoomEventTime+100||(this._lastZoomEventTime=s,(void 0!==e?e:t.deltaY||t.wheelDelta)<0?(i.scale-=6,i.scale<=0&&(i.scale=0)):(i.scale+=6,200<=i.scale&&(i.scale=200)),$(".gloslider",i._context).slider("value",i.scale),i._core._refresh=2,i._updateView())},lt.prototype._do_search=function(){for(var t,e,i=this,s=$(".mapsearchbox",i._context).val(),a=s.toUpperCase(),o=i._core._calc,n=st(o._utc_calc)/12*Math.PI,h=0;h<o._names.length;h++)if(a===(t=o._names[h])[1].toUpperCase()||a===t[0])return t[0]in i._core._calc._elements||i._core._calc._mode1_add_spacecraft(t[0]),(e=o._calcPos(t[0]))?(i._rotate1=Math.PI-e[1]*Math.PI/180-n,i._rotate2=e[0]*Math.PI/180,i._globeSelectItem(t[0]),-1===$.inArray(t[0],i._core._noradIds)&&i._core._noradIds.push(t[0]),void i._updateView()):(alert("Spacecraft '"+s+"' is not in Earth orbit at the selected time."),0);for(h=0;h<o._names.length;h++)if(-1<(t=o._names[h])[1].toUpperCase().indexOf(a))return t[0]in i._core._calc._elements||i._core._calc._mode1_add_spacecraft(t[0]),(e=o._calcPos(t[0]))?(i._rotate1=e[1]*Math.PI/180-n,i._rotate2=e[0]*Math.PI/180,i._globeSelectItem(t[0]),-1===$.inArray(t[0],i._core._noradIds)&&i._core._noradIds.push(t[0]),void i._updateView()):(alert("Spacecraft '"+s+"' is not in Earth orbit at the selected time."),0);return alert("Could not find a spacecraft with name '"+s+"'."),0},lt.prototype._resize=function(){var t,e,i=this._context.width();this._height=Math.min(i,Math.max($(window).height()-180,500)),this._width=i,$(".globuff, .globuf",this._context).width(this._width).height(this._height),$(".gloslidescale",this._context).width(this._width),$(".gloslider",this._context).width(this._width-16);var s=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],i=$(".gloslidescale",self._context)[0],a=$(".globe_scale_holder",self._context).width();i.width=a;var o=i.getContext("2d");for(o.beginPath(),t=0;t<s.length;t+=1)e=15+(a-30)*s[t],o.moveTo(e,40),o.lineTo(e,47);for(o.strokeStyle="#777",o.lineWidth=1.9,o.stroke(),o.fillStyle="#777",o.font="bold 14px Arial,Helvetica,sans-serif",o.textBaseline="middle",o.textAlign="center",t=0;t<s.length;t+=1){e=15+(a-30)*s[t];var n="";if(.1===s[t])n="Zoom in";else{if(.9!==s[t])continue;n="Zoom out"}o.fillText(n,e,21)}},lt.prototype.hypot=function(t,e){return Math.sqrt(t*t+e*e)},$(function(){$(".sat_map_globe").each(function(t,e){var i=$(e),e=new lt(i.data("meta"),i);i.data("handler",e)})}),ct.prototype.updateView_planetarium=function(){var t=this;if("planetarium"in t&&t.planetarium.ready){var e=t._core._calc,i=e._utc_calc;t.planetarium.gotoUtcTime(parseFloat(i)),t.planetarium._extraIcons=[];for(var s=$(".sl",t._context).prop("checked"),a=t._core._noradIds.length,o=Date.now().valueOf(),n=0;n<a;n++){var h,r,_,l,c=t._core._noradIds[n];e._calcPos(c)&&0<e.alt&&(l=e.mag,l=e.objIllum?Math.floor(10*l)/10:"Unilluminated",h=t._core._selectIconFrame(c),r=t._core._image2size/2,l=(_=t._core._image2.height)/2,t.planetarium._extraIcons.push([t._core._image2,t._core._image2gap*h,0,t._core._image2size,_,e.azi,e.alt,r,l,s?e._spacecraft[e._spacecraft_lookup[c]][1]:""]))}i=Date.now().valueOf();t._core._reportComputeTime(i-o,!1)}},ct.prototype._updateView=function(){var t=this;if(void 0!==t._core&&!(-1<t._core._itemsStillToLoad||t._lock)){if(!("planetarium"in t)){var e=this._planetarium_el.data("handler");if(void 0===e)return;this.planetarium=e}this.planetarium.ready&&(t._calc_is_setup||0<t._core._calc._utc_calc&&(t._calc_is_setup=!0,"gotoSat"in t._settings&&($(".mapsearchbox",t._context).val(t._settings.gotoSat),t._do_search()),$(".mapsearch",t._context).submit(function(){t._do_search()})),t._lock=1,$(".fr",t._context).prop("checked")||t._core._calc._timeAutoincrement(),t._core._updateClockDisplay(),t.updateView_planetarium(),t._lock=0,t._core._refresh=0)}},ct.prototype.fullRefresh=function(){var t=this;void 0!==t._core&&(-1<t._core._itemsStillToLoad||(t._core._refresh=2,t._sliderLabel(),t._updateView()))},ct.prototype._do_search=function(){var t=this;if("planetarium"in t&&t.planetarium.ready){for(var e,i=$(".mapsearchbox",t._context).val(),s=i.toUpperCase(),a=0;a<t._core._calc._names.length;a++)if(s===(e=t._core._calc._names[a])[1].toUpperCase()||s===e[0])return e[0]in t._core._calc._elements||t._core._calc._mode1_add_spacecraft(e[0]),t._core._calc._calcPos(e[0])?(t.planetarium._settings.gotoAlt=180*t._core._calc.alt/Math.PI,t.planetarium._settings.gotoAzi=180*t._core._calc.azi/Math.PI,t.planetarium.gotoCoordinates(t.planetarium._settings),void(-1===$.inArray(e[0],t._core._noradIds)&&t._core._noradIds.push(e[0]))):(alert("Spacecraft '"+i+"' is not in Earth orbit at the selected time."),0);for(a=0;a<t._core._calc._names.length;a++)if(-1<(e=t._core._calc._names[a])[1].toUpperCase().indexOf(s))return e[0]in t._core._calc._elements||t._core._calc._mode1_add_spacecraft(e[0]),t._core._calc._calcPos(e[0])?(t.planetarium._settings.gotoAlt=180*t._core._calc.alt/Math.PI,t.planetarium._settings.gotoAzi=180*t._core._calc.azi/Math.PI,t.planetarium.gotoCoordinates(t.planetarium._settings),void(-1===$.inArray(e[0],t._core._noradIds)&&t._core._noradIds.push(e[0]))):(alert("Spacecraft '"+i+"' is not in Earth orbit at the selected time."),0);return alert("Could not find a spacecraft with name '"+i+"'."),0}},$(function(){$(".sat_map_planetarium").each(function(t,e){var i=$(e),e=new ct(i.data("meta"),i);i.data("handler",e)})}),pt.prototype._updateView_radar=function(){var t=this,e=$(".radbuf0",t._context),i=e[0];i.width=e.width(),i.height=e.height();var s=i.getContext("2d");s.textAlign="left",s.textBaseline="middle",s.beginPath(),s.arc(t._imgCentreX,t._imgCentreY,t._skyRad,0,2*Math.PI,!1),s.clip();var a=0,o=1;$(".face-south",t._context).prop("checked")&&(a=Math.PI),$(".face-west",t._context).prop("checked")&&(a=Math.PI/2),$(".face-east",t._context).prop("checked")&&(a=-Math.PI/2),$(".face-down",t._context).prop("checked")&&(o=-1),$(".face-up",t._context).prop("checked")&&(o=1),t._hoverman.reset(),t._collision_map._reset();for(var n=null,h=$(".sl",t._context).prop("checked"),r=parseFloat($(".mag",t._context).val()),_=t._core._noradIds.length,l=t._core._calc,i=Date.now().valueOf(),c=0;c<_;c++){var p,d,u,f,g,m,v=t._core._noradIds[c],x=l._calcPos(v);x&&0<l.alt&&(v!==t._highlightItem&&l.mag>r||(u=Math.tan((Math.PI/2-l.alt)/2)*t._skyRad,m=t._core._selectIconFrame(v),p=t._imgCentreX-o*u*Math.sin(l.azi+Math.PI+a),d=t._imgCentreY-u*Math.cos(l.azi+Math.PI+a),v===t._highlightItem&&(n=[p,d],u=l.mag,u=null===l.abs_mag?"Unknown":l.objIllum?Math.floor(10*u)/10:"Unilluminated",l.azi<0&&(l.azi+=2*Math.PI),f=l._spacecraft[l._spacecraft_lookup[v]][1],g="<p style='font-weight: bold; font-size:15px;'>"+f+"</p>",1<t._highlightItemNames.length&&(g+="<p><b>Also known as:</b><br/>",$.each(t._highlightItemNames,function(t,e){e!==f&&(g+=e+"<br />")}),g+="</p>"),g+="<p>",g+="<b>Position:</b><br/>",g+="Altitude: "+Math.floor(l.altitude)+" km<br />",g+="Lat: "+Math.floor(10*Math.abs(x[0]))/10+"&deg;"+(x[0]<0?"S":"N")+"<br/>",g+="Long: "+Math.floor(10*Math.abs(x[1]))/10+"&deg;"+(x[0]<0?"W":"E")+"<br/>",g+="</p><p>",g+="<b>From "+t._settings.placename+":</b><br />",g+="Mag: "+u+"<br />",g+="Dist: "+Math.floor(l.distance)+" km<br />",g+="Alt: "+Math.floor(180*l.alt/Math.PI)+"&deg;<br />",g+="Az: "+Math.floor(180*l.azi/Math.PI)+"&deg;<br />",g+="</p>",g+="<p style='text-align:center;'>",g+="<form method='get' action='"+window.server+"spacecraft.php'>",g+="<input type='hidden' name='id' value='"+v+"' />",g+="<input type='submit' class='btn btn-sm btn-success' value='More info...' />",g+="</form><br />",g+="<form method='get' action='"+window.server+"satpasses.php'>",g+="<input type='hidden' name='gotosat' value='"+v+"' />",g+="<button type='submit' class='btn btn-sm btn-success'>Passes over<br />"+t._settings.placename+"...</button>",g+="</form>",g+="</p>",$(".information_contents").html(g)),s.fillStyle=t._core._frameColors(m),s.beginPath(),s.arc(p,d,4,0,360,0),s.fill(),h&&!t._collision_map._addBox(p,60+p,d,16+d,!0,!0)&&(m=l._spacecraft[l._spacecraft_lookup[v]][1],s.fillStyle="#e0e0e0",s.lineWidth=1,s.font="bold 11px Arial,Helvetica,sans-serif",s.fillText(m,6+p,d)),t._hoverman.hoverBox(v,p-15,d-12,30,24)))}null===n?$(".crosshair",t._context).css("display","none"):(y=n,$(".crosshair",t._context).css("display","block").css("left",y[0]-18).css("top",y[1]-18));var y=Date.now().valueOf();t._core._reportComputeTime(y-i,!1)},pt.prototype._updateView_radarHoverLabel=function(t,e,i,s){s=$("."+s,this._context),0!==t?(s.css("width","150px"),s.css("left",e-75+"px"),s.css("top",i+12+"px"),s.css("display","block"),(i=this._core._calc)._calcPos(t),i="<b>"+i._spacecraft[i._spacecraft_lookup[t]][1]+"</b><br />Mag "+i.mag.toFixed(1),s.html(i)):s.css("display","none")},pt.prototype._radarSelectItem=function(i){var s=this;(this._highlightItem=i)&&450<this._width?($(".information_contents").html(""),$(".information_holder").show()):$(".information_holder").hide(),this._highlightItemNames=[],$.each(this._core._calc._names,function(t,e){e[0]===i&&s._highlightItemNames.push(e[1])}),this._core._refresh=2},pt.prototype._updateView=function(){var t=this;void 0!==t._core&&(-1<t._core._itemsStillToLoad||t._lock||(t._lock=1,$(".fr",t._context).prop("checked")||t._core._calc._timeAutoincrement(),t._core._updateClockDisplay(),t._updateView_radar(),t._lock=0,t._core._refresh=0))},pt.prototype._initRadarView=function(){var t,s=this;s._hoverman=new I($(".radbuff",s._context),!1,function(t,e,i){s._radar_mousePos(t,e,i)},function(t,e,i){s._radar_mouseClk(t)},!1),s._collision_map=new Ct;var e=$(".radback",s._context),i=e[0];i.width=e.width(),i.height=e.height();var a=i.getContext("2d");a.fillStyle="#000028",a.strokeStyle="#707070",a.lineWidth=3,a.beginPath(),a.arc(s._imgCentreX,s._imgCentreY,s._skyRad,0,2*Math.PI,!1),a.fill(),a.stroke(),a.lineWidth=1,a.fillStyle="#808080",a.textAlign="center",a.textBaseline="middle",a.font="11px Arial,Helvetica,sans-serif";var o=1;for(this._width<520&&(o=2),t=1;t<9;t+=o){var n=Math.tan((Math.PI/2-10*t*Math.PI/180)/2),h=n*s._skyRad,r=1.9/n;8===t?r=0:a.fillText(10*t+"º",s._imgCentreX-h*Math.sin(82*Math.PI/180),s._imgCentreY-h*Math.cos(82*Math.PI/180)),a.beginPath(),a.arc(s._imgCentreX,s._imgCentreY,h,(-172+r)*Math.PI/180,(188-r)*Math.PI/180,!1),a.stroke()}a.fillStyle="#888888";var _=0,l=1;for($(".face-south",s._context).prop("checked")&&(_=Math.PI),$(".face-west",s._context).prop("checked")&&(_=Math.PI/2),$(".face-east",s._context).prop("checked")&&(_=-Math.PI/2),$(".face-down",s._context).prop("checked")&&(l=-1),$(".face-up",s._context).prop("checked")&&(l=1),t=0;t<16;t+=o){h=s._skyRad;var c=(t-4)/16*2*Math.PI+_;a.beginPath(),a.moveTo(s._imgCentreX,s._imgCentreY),a.lineTo(s._imgCentreX-l*h*Math.sin(c),s._imgCentreY-h*Math.cos(c)),a.stroke(),r=(a.font=t%4==0?"bold 24px Arial,Helvetica,sans-serif":"bold 12px Arial,Helvetica,sans-serif",1.07),a.fillText(["E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW","N","NNE","NE","ENE"][t],s._imgCentreX-l*h*Math.sin(c)*r,s._imgCentreY-h*Math.cos(c)*r)}e=14,i=90;this._width<600&&(e=13,i=75),this._width<575&&(e=12,i=60),this._width<480||(a.fillStyle="#888888",a.font="bold "+e+"px Arial,Helvetica,sans-serif",a.fillText("Satellites",i,10),a.fillText("visible from",i,30),a.fillText(s._settings.placename,i,50),a.fillText("Click on",s._imgSizeX-i,10),a.fillText("satellites for more",s._imgSizeX-i,30),a.fillText("information.",s._imgSizeX-i,50))},pt.prototype._radar_mousePos=function(t,e,i){this._updateView_radarHoverLabel(t,e,i,"radhover")},pt.prototype._radar_mouseClk=function(t){this._radarSelectItem(t)},pt.prototype._do_search=function(){},pt.prototype._resize=function(){this._width=$(".radar_canvas",this._context).width();var t=Math.min(this._width-30,Math.max($(window).height()-80,500));this._height=t,this._imgSizeX=t+30,this._imgSizeY=t,$(".radbuff",this._context).width(this._imgSizeX).height(this._imgSizeY),$(".radback, .radbuf0",this._context).width(this._imgSizeX).height(this._imgSizeY),this._imgCentreX=this._imgSizeX/2,this._imgCentreY=this._imgSizeY/2,this._skyRad=this._imgSizeX/2*.9-20,this._initRadarView(),this._core._refresh=2},$(function(){$(".sat_map_radar").each(function(t,e){var i=$(e),e=new pt(i.data("meta"),i);i.data("handler",e)})}),dt.prototype.updateView_worldMap=function(){var t=this;if(null!==t._map){var e=t._core._noradIds.length,i=t._core._calc,s=Date.now().valueOf();t._highlightPosition=null;for(var a=0;a<e;a++){var o=t._core._noradIds[a],n=i._calcPos(o);if(n){var h,r,_=t._core._selectIconFrame(o);if(o===t._highlightItem&&(t._highlightPosition=n),t._map._setMarkerPosition(t._mapIcons[a][0],n[1],n[0]),t._map._setMarkerIcon(t._mapIcons[a][0],t._satelliteIcons[_]),t._highlightItem===o&&(t._map._setMarkerZIndex(t._mapIcons[a][0],1e8),_=i.mag,_=null===i.abs_mag?"Unknown":i.objIllum?Math.floor(10*_)/10:"Unilluminated",i.azi<0&&(i.azi+=2*Math.PI),h=i._spacecraft[i._spacecraft_lookup[o]][1],r="<p style='font-weight: bold; font-size:15px;'>"+h+"</p>",1<t._highlightItemNames.length&&(r+="<p><b>Also known as:</b><br/>",$.each(t._highlightItemNames,function(t,e){e!==h&&(r+=e+"<br />")}),r+="</p>"),r+="<p>",r+="<b>Position:</b><br/>",r+="Altitude: "+Math.floor(i.altitude)+" km<br />",r+="Lat: "+Math.floor(10*Math.abs(n[0]))/10+"&deg;"+(n[0]<0?"S":"N")+"<br/>",r+="Long: "+Math.floor(10*Math.abs(n[1]))/10+"&deg;"+(n[1]<0?"W":"E")+"<br/>",r+="</p><p>",r+="<b>From "+t._settings.placename+":</b><br />",r+="Mag: "+_+"<br />",r+="Dist: "+Math.floor(i.distance)+" km<br />",r+="Alt: "+Math.floor(180*i.alt/Math.PI)+"&deg;<br />",r+="Az: "+Math.floor(180*i.azi/Math.PI)+"&deg;<br />",r+="</p>",r+="<div style='text-align:center;'>",r+="<form method='get' action='"+window.server+"spacecraft.php'>",r+="<input type='hidden' name='id' value='"+o+"' />",r+="<input type='submit' class='btn btn-sm btn-success' value='More info...' />",r+="</form><br />",r+="<form method='get' action='"+window.server+"satpasses.php'>",r+="<input type='hidden' name='gotosat' value='"+o+"' />",r+="<button type='submit' class='btn btn-sm btn-success'>Passes over<br />"+t._settings.placename+"...</button>",r+="</form>",r+="</div>",$(".information_contents").html(r)),t._map._setMarkerHoverText(t._mapIcons[a][0],i._spacecraft[i._spacecraft_lookup[o]][1]),400<a)break}}var l=Date.now().valueOf();t._core._reportComputeTime(l-s,400<a&&400),t._updateCrosshair()}},dt.prototype._updateView=function(){var t=this;void 0!==t._core&&(-1<t._core._itemsStillToLoad||t._lock||null!==t._map&&((t._lock=1)<t._core._refresh&&t.worldMapIcons(),$(".fr",t._context).prop("checked")||t._core._calc._timeAutoincrement(),t._core._updateClockDisplay(),t.updateView_worldMap(),t.updateWorldMapTracks(1<t._core._refresh),t._lock=0,t._core._refresh=0))},dt.prototype.updateWorldMapTracks=function(t){var e=this;if(null!==e._map){var i=e._core._calc,s=i._utc_calc;if($(".st",e._context).prop("checked")){var a=e._core._noradIds.length;e.uwmpCount++;for(var o=0;o<a;o++){var n=[],h=e._core._noradIds[o];if((t||!((e.uwmpCount+o)%10))&&!1!==e._mapIcons[o][1]){for(var r,_=-3;_<=3;_++){i._elements.hasOwnProperty(h)&&(r=s+i._elements[h][7]*_/3,i._setCalcTime(r,0),(r=i._calcPos(h))&&n.push([r[1],r[0]]))}e._map._setMarkerPath(e._mapIcons[o][1],n)}}i._setCalcTime(s,0)}}},dt.prototype._do_search=function(){for(var t,e,i=this,s=$(".mapsearchbox",i._context).val(),a=s.toUpperCase(),o=0;o<i._core._calc._names.length;o++)if(a===(t=i._core._calc._names[o])[1].toUpperCase()||a===t[0])return t[0]in i._core._calc._elements||i._core._calc._mode1_add_spacecraft(t[0]),(e=i._core._calc._calcPos(t[0]))?(i._map._parent._update_coordinates(e[0],e[1],i._map._parent._fov),i._worldMapSelectItem(t[0]),void(-1===$.inArray(t[0],i._core._noradIds)&&(i._core._noradIds.push(t[0]),i._core._refresh=2))):(alert("Spacecraft '"+s+"' is not in Earth orbit at the selected time."),0);for(o=0;o<i._core._calc._names.length;o++)if(-1<(t=i._core._calc._names[o])[1].toUpperCase().indexOf(a))return t[0]in i._core._calc._elements||i._core._calc._mode1_add_spacecraft(t[0]),(e=i._core._calc._calcPos(t[0]))?(i._map._parent._update_coordinates(e[0],e[1],i._map._parent._fov),i._worldMapSelectItem(t[0]),void(-1===$.inArray(t[0],i._core._noradIds)&&(i._core._noradIds.push(t[0]),i._core._refresh=2))):(alert("Spacecraft '"+s+"' is not in Earth orbit at the selected time."),0);return alert("Could not find a spacecraft with name '"+s+"'."),0},dt.prototype.initWorldMap=function(){var t=this,e=$("#htv_map",t._context).data("handler");return!!e&&(this._map=e._annotation,t.uwmpCount=0,t._highlightItem=null,t._highlightPosition=null,t._mapIcons=[],e._labeller._add_hook("redraw",function(){t._updateCrosshair()}),!0)},dt.prototype._updateCrosshair=function(){var t;null!==this._highlightPosition&&(t=this._map._parent._topographicData._projector._project_xy_from_lat_lng(this._highlightPosition[1]*Math.PI/180,this._highlightPosition[0]*Math.PI/180))?($(".crosshair",this._context).css("display","block"),$(".crosshair",this._context).css("left",t[0]-18).css("top",t[1]-18)):$(".crosshair",this._context).css("display","none")},dt.prototype._worldMapSelectItem=function(i){var s=this;(this._highlightItem=i)&&450<this._map._parent._width?($(".information_contents").html(""),$(".information_holder").show()):$(".information_holder").hide(),this._highlightItemNames=[],$.each(this._core._calc._names,function(t,e){e[0]===i&&s._highlightItemNames.push(e[1])}),this.updateView_worldMap()},dt.prototype.worldMapIcons=function(){var e=this;if(e._map._removeAll(),null===e._satelliteIcons){var t=e._core._image1.height;e._satelliteIcons=[];for(var i=0;i<13;i++)e._satelliteIcons.push(this._map._iconFromImageURL(window.server+"images/satellite.png",e._core._image1gap*i,0,e._core._image1size,t))}e._mapIcons=[];for(var s=e._core._calc,a=e._core._noradIds.length,o=$(".sl",e._context).prop("checked"),n=$(".st",e._context).prop("checked"),h=0;h<a;h++){var r,_=e._core._noradIds[h],l=!1,c="";s._spacecraft_lookup.hasOwnProperty(_)&&(c=this._truncateName(s._spacecraft[s._spacecraft_lookup[_]][1])),r=this._map._addImageWithLabel(0,0,1e8-_,o?c:"",!1,e._satelliteIcons[0],e._core._image1size/2,e._core._image1size/2),n&&(l=this._map._addArrow(0,0,-_,[],"#404040"));_=function(t){return function(){e._worldMapSelectItem(t)}}(_);this._map._addListener(r,"click",_),e._mapIcons.push([r,l])}},dt.prototype._truncateName=function(t){return t.length<12?t:t.substring(0,11)+"..."},$(function(){$(".sat_map_worldmap").each(function(t,e){var i=$(e),e=new dt(i.data("meta"),i);i.data("handler",e)})}),ut.prototype._refresh=function(){var a=this;$("td",a._context).css("min-width","inherit").css("max-width","inherit"),a.column_widths=[],a.body_cols.each(function(t,e){var i=$(e).outerWidth()+12,s=$(e).data("min-width"),e=$(e).data("max-width");s&&i<s&&(i=s),e&&e<i&&(i=e),a.column_widths.push(i)});var i=$("tr",a._context).not(".no_setwidth");$.each(a.column_widths,function(t,e){$("td:nth-child("+(t+1)+")",i).css("overflow","hidden").css("min-width",e).css("max-width",e)}),a.table_top=a._context.offset().top,a.table_bottom=a.table_top+a._context.height()-a.header.height(),a.top_margin=$("#navbar-header").height()+16,a.fixed=!1,a.hidden=!1,a.scroll(),a.scroll_table()},ut.prototype.scroll=function(){var t=$(window).scrollTop()+this.top_margin;t>this.table_top&&!this.fixed&&(this.header.css("display","block").css("z-index",100),this.header.css("position","fixed").css("top",this.top_margin),this.fixed=!0),t<this.table_top&&this.fixed&&(this.header.css("display","none"),this.fixed=!1),t>this.table_bottom&&!this.hidden&&(this.header.fadeOut(),this.hidden=!0),t<this.table_bottom&&this.hidden&&(this.header.fadeIn(),this.hidden=!1)},ut.prototype.scroll_table=function(){this.header.css("left",this._context.offset().left).css("width",this._context.width()).css("overflow","hidden"),$("table",this.header).css("position","relative").css("left",-this._context.scrollLeft())},$(ft),gt.prototype._gotoPane=function(t,e){return function(){t._selectPane(e)}},gt.prototype._selectPane=function(e){for(var i=this,t=0;t<this.len;t++)t===e?$(i.buttons[t],i._context).addClass("tabactive"):$(i.buttons[t],i._context).removeClass("tabactive");$(this.activeCanvas).stop().animate({opacity:0},400,function(){for(var t=0;t<i.len;t++)$(i.panes[t],i._context).css("display",t===e?"block":"none");$(i.host,i._context).css("height",$(i.panes[e],i.target).css("height")),i.activeCanvas=i.panes[e],$(i.activeCanvas,i._context).stop().animate({opacity:1},400),i.paneChangeHook()})},mt.prototype.prev=function(){this.auto=!1,this.selectPane((this.current+this.number-1)%this.number)},mt.prototype.next=function(){this.auto=!1,this.selectPane((this.current+1)%this.number)},mt.prototype._alarm=function(){this.auto&&this.selectPane((this.current+1)%this.number)},mt.prototype.selectPane=function(i){var s=this,t=this.children[this.current],e=this.children[i];this.children.each(function(t,e){$(e).stop(),t!==i&&t!==s.current&&$(e).css("visibility","hidden")}),$(t).css("z-index","1"),$(e).css("z-index","2"),$(e).css("opacity","0"),$(e).css("visibility","visible"),$(e).stop().animate({opacity:1},600,function(){s.children.each(function(t,e){t!==i&&$(e).css("visibility","hidden")}),s.current=i})},$(vt),xt.prototype._update=function(){var t,e,i,s,a,o,n=be._utc_now(),h=be._unix_to_jd(n),r=be._unix_to_jd(this._settings.midpoint);function _(t){t=t.toString().split(".");return t[1]=t[1].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")}7<Math.abs(h-r)?$(this._context).hide():($(this._context).show(),s=this.ra_a+(h-r)*this.ra_c+Math.pow(h-r,2)*this.ra_d,o=this.dec_a+(h-r)*this.dec_c+Math.pow(h-r,2)*this.dec_d,s<0&&(s+=2*Math.PI),t=Math.floor(12*s/Math.PI),e=Math.floor(12*s*60/Math.PI)%60,i=12*s*3600/Math.PI%60,a=0<=o?"N":"S",n=Math.abs(o),s=Math.floor(180*n/Math.PI),o=Math.floor(180*n*60/Math.PI)%60,n=180*n*3600/Math.PI%60,$(".ra_h",this._context).text(t),$(".ra_m",this._context).text(e),$(".ra_s",this._context).text(_(i.toFixed(6))),$(".dec_d",this._context).text(s),$(".dec_m",this._context).text(o),$(".dec_s",this._context).text(_(n.toFixed(6))),$(".dec_sign",this._context).text(a),o=h-r,n=Math.abs(o),a=o<0?" is ":" was",h=o<0?" away ":" ago",r="",1===(o=Math.floor(24*n))?r+=" 1 hour ":1<o&&(r+=o+" hours "),1==(o=Math.floor(24*n*60)%60)?r+=" 1 minute ":1<o&&(r+=o+" minutes "),1==(n=Math.floor(24*n*3600)%60)?r+=" 1 second ":1<n&&(r+=n+" seconds "),""===r?r="now":r+=h,$(".delay_prefix",this._context).text(a),$(".delay",this._context).text(r))},$(function(){$(".solstice_tracker").each(function(t,e){var i=$(e),e=new xt(i.data("meta"),i);i.data("handler",e)})}),$(function(){$(".spacecraft_info").each(function(t,e){var i=$(e),e=new yt(i.data("meta"),i);i.data("handler",e)})}),wt.prototype._new_in_system=function(){var t=this;t._in_system=$(".in-system select",t._context).val(),"1"===t._in_system||"2"===t._in_system||"6"===t._in_system||"7"===t._in_system?$(".in-timestamp",t._context).stop().fadeOut(function(){$(".in-date",t._context).stop().fadeIn()}):$(".in-date",t._context).stop().fadeOut(function(){$(".in-timestamp",t._context).stop().fadeIn()}),"2"===t._in_system||"7"===t._in_system?$(".in-place",t._context).stop().fadeIn():$(".in-place",t._context).stop().fadeOut(),"6"===t._in_system||"7"===t._in_system?$(".day, .month, .year",t._context).stop().fadeOut():$(".day, .month, .year",t._context).stop().fadeIn(),t._populate_boxes()},wt.prototype._new_out_system=function(){this._out_system=$(".out-system select",this._context).val(),"2"===this._out_system||"7"===this._out_system?$(".out-place",this._context).stop().fadeIn():$(".out-place",this._context).stop().fadeOut(),this._populate_boxes()},wt.prototype._new_in_location=function(e,i){var s=this,t=$(".in-town-id",this._context).val();s._awaiting_input_tz=!0,jQuery.getJSON(window.server+"json/locationtzdata.php",{town:t,year:e},function(t){s._tzOffset_in=new l(t.tzOffset),s._longitude_in=parseFloat(t.longitude),s._year_selected_in=e,s._awaiting_input_tz=!1,i?s._new_time():s._populate_boxes()})},wt.prototype._new_out_location=function(e){var i=this,t=$(".out-town-id",this._context).val();i._awaiting_output_tz=!0,jQuery.getJSON(window.server+"json/locationtzdata.php",{town:t,year:e},function(t){i._tzOffset_out=new l(t.tzOffset),i._longitude_out=parseFloat(t.longitude),i._year_selected_out=e,i._awaiting_output_tz=!1,i._populate_boxes()})},wt.prototype._new_time=function(){if(!this._awaiting_input_tz){switch(this._in_system){case"1":case"2":var t=parseInt($(".day",this._context).val()),e=parseInt($(".month",this._context).val()),i=parseInt($(".year",this._context).val()),s=parseInt($(".hour",this._context).val()),a=parseInt($(".min",this._context).val()),o=be._calendar_to_unix(i,e,t,s,a,0)+.001;if("2"===this._in_system){if(i!==this._year_selected_in)return void this._new_in_location(i,!0);o-=this._tzOffset_in.offset(o)}this._unixtime=o;break;case"3":this._unixtime=parseFloat($(".timestamp",self._context).val())+.001;break;case"4":this._unixtime=86400*(parseFloat($(".timestamp",self._context).val())-2440587.5)+.001;break;case"5":this._unixtime=86400*(parseFloat($(".timestamp",self._context).val())-40587)+.001;break;case"6":case"7":s=parseInt($(".hour",this._context).val()),a=parseInt($(".min",this._context).val()),o=this._settings.now;for(var n=s+a/60+30/3600,h=0;h<100;h++){var r=st(o);"7"===this._in_system&&(r+=this._longitude_in/180*12);for(var _=(n-r)%24;_<-12;)_+=24;for(;12<_;)_-=24;o+=3600*_}this._unixtime=o}this._unixtime<this._settings.tmin&&(this._unixtime=parseFloat(this._settings.tmin)),this._unixtime>this._settings.tmax&&(this._unixtime=parseFloat(this._settings.tmax)),this._populate_boxes()}},wt.prototype._populate_boxes=function(){var t,e,i;if(!this._awaiting_input_tz&&!this._awaiting_output_tz){switch(this._in_system){case"1":case"2":if("2"===this._in_system){if(t=this._tzOffset_in.offset(this._unixtime),e=this._tzOffset_in._tzName(this._unixtime),isFinite(t)||(t=0),(i=be._unix_to_calendar(this._unixtime+t))[0]!==this._year_selected_in)return void this._new_in_location(i[0],!1);$(".input-timezone",this._context).text(e)}else i=be._unix_to_calendar(this._unixtime),$(".input-timezone",this._context).text("UTC");$(".day",this._context).val(i[2]),$(".month",this._context).val(i[1]),$(".year",this._context).val(i[0]),$(".hour",this._context).val(i[3]),$(".min",this._context).val(i[4]);break;case"3":$(".timestamp",this._context).val(this._unixtime.toFixed(4));break;case"4":$(".timestamp",this._context).val((this._unixtime/86400+2440587.5).toFixed(4));break;case"5":$(".timestamp",this._context).val((this._unixtime/86400+40587).toFixed(4));break;case"6":case"7":var s=st(this._unixtime);for("7"===this._in_system&&(s+=this._longitude_in/180*12);s<0;)s+=24;for(;24<s;)s-=24;$(".hour",this._context).val(Math.floor(s)),$(".min",this._context).val(Math.floor(60*s)%60)}function a(t,e,i){for(var s="",a=r(t,e,i?"0":"X"),o=0;o<a.length;o++){s+='<div class="its-img its-clk'+a.slice(o,o+1)+'"></div>'}return s}var o="<div style='margin:20px; border:1px solid #888; border-radius: 8px; padding: 12px; background: rgba(0,0,0,0.87);'>";switch(o+="<table style='margin:0 auto; color: #e00; text-align: center; white-space: nowrap'>",this._out_system){case"1":case"2":if(e="UTC","2"===this._out_system){if(t=this._tzOffset_out.offset(this._unixtime),e=this._tzOffset_out._tzName(this._unixtime),isFinite(t)||(t=0),(i=be._unix_to_calendar(this._unixtime+t))[0]!==this._year_selected_out)return void this._new_out_location(i[0])}else i=be._unix_to_calendar(this._unixtime);o+="<tr style='font-weight:bold;'>",o+="<td>Day</td>",o+="<td>Month</td>",o+="<td>Year</td>",o+="</tr><tr>",o+="<td style='padding:0 12px;'>"+a(i[2],2,!1)+"</td>",o+="<td style='padding:0 12px;'>"+a(i[1],2,!1)+"</td>",o+="<td style='padding:0 12px;'>"+a(i[0],4,!1)+"</td>",o+="</tr><tr style='font-weight:bold;'>",o+="<td colspan='2' style='padding-top:18px;'>Time</td>",o+="<td></td>",o+="</tr><tr>",o+="<td colspan='2'>"+a(i[3],2,!1)+'<div class="its-img its-clkC"></div>'+a(i[4],2,!0)+"</td>",o+="<td style='font-weight: bold; font-size:20px;'>"+e+"</td>",o+="</tr></tbody>";break;case"3":o+="<tr><td style='font-size:24px; font-weight: bold;'>",o+=this._unixtime.toFixed(2),o+="</td></tr>";break;case"4":o+="<tr><td style='font-size:24px; font-weight: bold;'>",o+=(this._unixtime/86400+2440587.5).toFixed(4),o+="</td></tr>";break;case"5":o+="<tr><td style='font-size:24px; font-weight: bold;'>",o+=(this._unixtime/86400+40587).toFixed(4),o+="</td></tr>";break;case"6":case"7":for(s=st(this._unixtime),"7"===this._out_system&&(s+=this._longitude_out/180*12);s<0;)s+=24;for(;24<s;)s-=24;o+="<tr>",o+="<td style='padding:0 12px;'>",o+=a(Math.floor(s),2,!1),o+='<div class="its-img its-clkC"></div>',o+=a(Math.floor(60*s)%60,2,!0),o+="</td>",o+="</tr>"}o+="</table></div>",$(".result",this._context).html(o)}},$(function(){$(".time_convert").each(function(t,e){var i=$(e),e=new wt(i.data("meta"),i);i.data("handler",e)})}),Mt.prototype._labelDateSlide=function(){var t,e,i=parseInt($(".day",this._context).val()),s=parseInt($(".month",this._context).val()),a=parseInt($(".year",this._context).val()),o=be._calendar_to_unix(a,s,i,0,0,0);this._utc_centre=o,$(".slider",this._context).slider("value",0);for(var n=[],h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=a-1;r<=a+1;r++)for(var _=0;_<12;_++){var l,c=(be._calendar_to_unix(r,_+1,1,0,0,0)-o)/86400/120+.5;c<0||1<c||(l=h[_],0===_&&(l+=" "+r),n.push([c,l]))}s=$(".slidescale",this._context);if(s.length){i=s[0];i.width=s.width(),i.height=s.height();var p=i.getContext("2d");for(p.beginPath(),t=0;t<n.length;t++)e=this._date_margin+4+this._date_width2*n[t][0],p.moveTo(e,19),p.lineTo(e,25);for(p.strokeStyle="#777",p.lineWidth=1.9,p.stroke(),p.fillStyle="#777",p.font="bold 11px Arial,Helvetica,sans-serif",p.textBaseline="middle",p.textAlign="center",t=0;t<n.length;t++)e=this._date_margin+4+this._date_width2*n[t][0],p.fillText(n[t][1],e,10)}},Mt.prototype._updateDateSelect=function(){var t=be._unix_to_calendar(this._utc_centre);$(".day",this._context).val(t[2]+""),$(".month",this._context).val(t[1]+""),$(".year",this._context).val(t[0]+"")},Mt.prototype._gotoNow=function(){this._gotoUtcTime(be._utc_now())},Mt.prototype._gotoUtcTime=function(t){t=86400*(Math.floor((t+1)/86400)+.5),this._utc_centre=t,this._updateDateSelect(),this._labelDateSlide(),this._refresh=1},Mt.prototype._gotoSelectedTime=function(){var t=parseInt($(".day",this._context).val()),e=parseInt($(".month",this._context).val()),i=parseInt($(".year",this._context).val()),t=be._calendar_to_unix(i,e,t,12,0,0);this._gotoUtcTime(t)},Mt.prototype._updateAlarm=function(){if(null===this._map){var t=$("#htv_map",self._context).data("handler");if(!t)return;this._map=t._annotation,this._initMarkers()}this._animate&&(this._animateCounter--,this._animateCounter<=0&&(this._animateCounter=1,this._gotoUtcTime(this._utc_centre+432e3))),this._refresh&&this._updateView()},Mt.prototype._updateView=function(){this._setMarkers(),this._updateDateSelect(),this._refresh=0},Mt.prototype._title=function(t){var e="UTC";return e+=t+1<0?"-":"+",e+=Pe(Math.floor(Math.abs(t)+.001)),e+=":",e+=Pe(Math.floor(60*(Math.abs(t)+.001))%60)},Mt.prototype._initMarkers=function(){var s,a=this;null!==a._map&&(s=this._initMarkerImages(),a._map._removeAll(),this._markers={},$.each(this._cities,function(t,e){var i=a._map._addImageWithLabel(e[1],e[0],1,"",!1,s[0],a._markerWidth/2,a._markerWidth/2);a._map._addListener(i,"dclick",function(){window.open(window.server+"timezone.php?loc="+e[3],"_blank")}),a._markers[t]=i}))},Mt.prototype._setMarkers=function(){var s,i,a,o=this,n=this._initMarkerImages(),h=this._utc_centre+86400*this._dayoffset,r={};$.each(this._timezones,function(t,e){var i;for(s=e[0][1],i=0;i<e.length&&!(e[i][0]>h);i++)s=e[i][1];r[t]=s}),$.each(this._cities,function(t,e){a=r[e[2]],i=Math.floor(2*a+48.01)%(2*o._colors.length),a=e[4]+": "+o._title(a)+"<br />Double click for more information.",o._markers.hasOwnProperty(t)&&(t=o._markers[t],o._map._setMarkerHoverText(t,a),o._map._setMarkerIcon(t,n[i]))})},Mt.prototype._initMarkerImages=function(){for(var t,e,i=[],s=0;s<this._colors.length;s++)(t=document.createElement("canvas")).width=this._markerWidth,t.height=+this._markerWidth,(e=t.getContext("2d")).clearRect(0,0,this._markerWidth,this._markerWidth),e.fillStyle=this._colors[s],e.strokeStyle="black",e.lineWidth=1,e.beginPath(),e.arc(this._markerWidth/2,this._markerWidth/2,this._markerWidth/2-1,0,2*Math.PI),e.fill(),e.stroke(),i.push(t),(t=document.createElement("canvas")).width=this._markerWidth,t.height=+this._markerWidth,(e=t.getContext("2d")).clearRect(0,0,this._markerWidth,this._markerWidth),e.fillStyle=this._colors[s],e.strokeStyle="black",e.beginPath(),e.arc(this._markerWidth/2,this._markerWidth/2,this._markerWidth/2-1,.5*Math.PI,1.5*Math.PI),e.fill(),e.fillStyle=this._colors[(s+1)%this._colors.length],e.beginPath(),e.arc(this._markerWidth/2,this._markerWidth/2,this._markerWidth/2-1,1.5*Math.PI,2.5*Math.PI),e.fill(),e.beginPath(),e.arc(this._markerWidth/2,this._markerWidth/2,this._markerWidth/2-1,0,2*Math.PI),e.stroke(),i.push(t);return i},Mt.prototype._doKey=function(){var t,e,i,s,a,o=this,n=this._initMarkerImages();$(".key_canvas",this._context).each(function(){for((s=this).width=100,s.height=500,(a=s.getContext("2d")).fillStyle=0===o._settings.skin?"#202020":"#a0a0a0",a.font="bold 13px Arial,Helvetica,sans-serif",a.textBaseline="middle",a.textAlign="left",t=-12;t<=12;t++)e=Math.floor(t+48.01)%o._colors.length*2,i=o._title(t),a.fillText(i,20,20*(t+12.5)),a.drawImage(n[e],5,20*(t+12.5)-o._markerWidth/2)})},$(function(){$(".timezone_map").each(function(t,e){var i=$(e),e=new Mt(i.data("meta"),i);i.data("handler",e)})}),kt.prototype._setCalcTime=function(t){var e=Math.PI/180,i=w(t),s=i[0],a=i[1],i=M(t);for(this._utc_drawn=t,this._zen_RA=i/e%360,this._sun_ra=s/e%360,this._sun_dec=a/e,this._sun_long=this._sun_ra-this._zen_RA;this._sun_long<-180;)this._sun_long+=360;for(;180<this._sun_long;)this._sun_long-=360},kt.prototype._updateDateSelect=function(){var t=be._unix_to_calendar(this._utc_centre+this._tzOffset.offset(this._utc_centre));$(".day",this._context).val(t[2]+""),$(".month",this._context).val(t[1]+""),$(".year",this._context).val(t[0]+""),$(".hour",this._context).val(t[3]+""),$(".min",this._context).val(2*Math.floor(t[4]/2)+"")},kt.prototype._timeAutoincrement=function(){var t=this._utc_real_time_offset,e=be._utc_now()+this._utc_real_time_offset;this._utc_offset_time=e-(this._utc_centre+this._utc_offset_date),this._sliderUpdateCountdown--,this._sliderUpdateCountdown<=0&&(this._updateSliderPosition(),this._sliderUpdateCountdown=100),this._utc_real_time_offset=t,this._setCalcTime(e)},kt.prototype._gotoNow=function(){this._gotoUtcTime(be._utc_now())},kt.prototype._gotoUtcTime=function(t){this._utc_offset_date=0,this._utc_offset_time=0,this._utc_centre=t,this._updateSliderPosition(),this._utc_real_time_offset=t-be._utc_now(),this._sliderLabel(),this._timeAutoincrement(),this._refresh=!0},kt.prototype._gotoSelectedTime=function(){var t=parseInt($(".day",this._context).val()),e=parseInt($(".month",this._context).val()),i=parseInt($(".year",this._context).val()),s=parseInt($(".hour",this._context).val()),a=parseInt($(".min",this._context).val()),a=be._calendar_to_unix(i,e,t,s,a,0);a-=this._tzOffset.offset(a),this._gotoUtcTime(a)},kt.prototype._updateSliderPosition=function(){var t=Math.floor(this._utc_offset_time/this._sliderTimeSpan*this._sliderTimeSteps+.5),e=Math.floor(this._utc_offset_date/this._sliderDateSpan*this._sliderDateSteps+.5);t<-this._sliderTimeSteps||t>this._sliderTimeSteps||e<-this._sliderDateSteps||e>this._sliderDateSteps?this._gotoUtcTime(this._utc_centre+this._utc_offset_time+this._utc_offset_date):($(".Tslider",self._context).slider("value",t),$(".Tslider2",self._context).slider("value",e))},kt.prototype._updateAlarm=function(){var i=this;if(null===this._map){var t=$("#htv_map",i._context).data("handler");if(!t)return;this._map=t._annotation,this._initMarkers(),this._map._custom_hover_handler=function(t,e){i._hoverHandle(t,e)}}--this._alarmCounter,!this._refresh&&0<this._alarmCounter||(this._alarmCounter=100,$(".fr",this._context).prop("checked")||this._timeAutoincrement(),this._updateView())},kt.prototype._updateView=function(){var t=this._utc_drawn,e=be._unix_to_calendar(t+this._tzOffset.offset(t)),t=Pe(e[2])+" "+["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e[1]]+" "+Pe(e[0])+" "+Pe(e[3])+":"+Pe(e[4])+":"+Pe(Math.floor(e[5]))+" ("+this._tzOffset._tzName(t)+")";$(".clock",this._context).html(t);var i,t=this._sunAltitude(this._settings.longitude,this._settings.latitude);for($(".altitude",this._context).html(Math.abs(t)+"&deg; "+(0<t?"above":"below")+" horizon"),this._map._setMarkerPosition(this.sunPos,this._sun_long,this._sun_dec),i=0;i<this._zones.length;i++)this._map._setMarkerPosition(this._zones[i][5],180+this._sun_long,-this._sun_dec);this._updateDateSelect(),this._refresh=!1},kt.prototype._hoverHandle=function(t,e){var i,s,a,o=$(".annotation-hover",this._map._context);t||e?(i=this._map._parent._topographicData._projector._project_lat_lng_from_xy(t,e),s=this._sunAltitude(i[0],i[1]),a=Math.abs(i[0]).toFixed(1)+"&deg;"+(0<=i[0]?"E":"W")+"; ",a+=Math.abs(i[1]).toFixed(1)+"&deg;"+(0<=i[1]?"N":"S")+"<br />",a+=s<-18?"Astronomical darkness<br />":s<-12?"Astronomical twilight<br />":s<-6?"Nautical twilight<br />":s<-1?"Civil twilight<br />":"Daylight<br />",a+="Sun "+Math.abs(s)+"&deg; "+(0<s?"above":"below")+" horizon",o.css("width","190px"),o.css("left",t-80+"px"),o.css("top",e+12+"px"),o.css("display","block"),o.html(a)):o.css("display","none")},kt.prototype._sunAltitude=function(t,e){var i=Math.PI/180,s=t,a=e,o=Math.cos(this._sun_dec*i)*Math.sin(this._sun_long*i),n=Math.cos(this._sun_dec*i)*Math.cos(this._sun_long*i),t=Math.sin(this._sun_dec*i),e=Math.cos(a*i)*Math.sin(s*i),s=Math.cos(a*i)*Math.cos(s*i),a=Math.sin(a*i),i=Math.acos((2-((o-e)*(o-e)+(n-s)*(n-s)+(t-a)*(t-a)))/2)/i;return Math.floor(90-i)},kt.prototype._initMarkers=function(){var t,e=this._map._iconFromImageURL(window.server+"images/icon_sun.png",0,0,24,24),i=this._map._iconFromImageURL(window.server+"images/icon_pin.png",0,0,20,27);for(this._myPos=this._map._addImageWithLabel(this._settings.longitude,this._settings.latitude,2,"",!1,i,10,27),this.sunPos=this._map._addImageWithLabel(this._sun_long,this._sun_dec,1,"The Sun",!1,e,12,12),t=0;t<this._zones.length;t++)this._zones[t][5]=this._map._addCircle(180+this._sun_long,-this._sun_dec,t,90-this._zones[t][0],"",this._zones[t][3],0===t?2.5:1,this._zones[t][2])},kt.prototype._sliderLabel=function(){for(var t,e=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=this._utc_centre+this._tzOffset.offset(this._utc_centre),s=[[null,this._sliderTimeSpan,this._sliderTimeSteps,".Tslidescale",3,1],[null,this._sliderDateSpan,this._sliderDateSteps,".Tslidescale2",3,0]],a=0;a<s.length;a++){for(var o=s[a][1],n=s[a][3],h=s[a][4],r=s[a][5],_=[],l=-(h-1);l<=h-1;l++){var c,p,d=be._unix_to_calendar(i+l*o/h);r?(p=d[4],c=d[3],_.push([(l+h)/(2*h),Pe(c)+":"+Pe(p)])):(p=d[2],d=d[1],_.push([(l+h)/(2*h),Pe(p)+" "+e[d]]))}var u=$(n,this._context),n=u[0];n.width=u.width(),n.height=u.height();var f=n.getContext("2d");for(f.beginPath(),l=0;l<_.length;l++)t=12+324*_[l][0],f.moveTo(t,19),f.lineTo(t,25);for(f.strokeStyle="#777",f.lineWidth=1.9,f.stroke(),f.fillStyle="#777",f.font="bold 11px Arial,Helvetica,sans-serif",f.textBaseline="middle",f.textAlign="center",l=0;l<_.length;l++)t=12+324*_[l][0],f.fillText(_[l][1],t,10)}},kt.prototype._sliderChange=function(){var t=$(".Tslider",self._context).slider("value"),e=$(".Tslider2",self._context).slider("value");this._utc_offset_time=t*this._sliderTimeSpan/this._sliderTimeSteps,this._utc_offset_date=e*this._sliderDateSpan/this._sliderDateSteps,this._utc_real_time_offset=this._utc_centre+this._utc_offset_time+this._utc_offset_date-be._utc_now(),this._refresh=!0},$(function(){$(".twilight_map").each(function(t,e){var i=$(e),e=new kt(i.data("meta"),i);i.data("handler",e)})}),$(function(){$(".weather_forecast").each(function(t,e){var i=$(e),e=new bt(i.data("meta"),i);i.data("handler",e)})}),Pt.prototype._setup2=function(){var i=this;i.tabs=[1,1,1,1,1,1],$("select",i._context).on("change",function(){i._pageRefresh(!0)}),i._doColorScale(),i._pageRefresh(!1),$(".at-png",i._context).click(function(){var t=Ie($(this).data("item"));t<0&&(t=0),t>=i._panel_contents.length&&(t=i._panel_contents.length-1);var e=new zt(document.createElement("canvas"),1,1);i._doPanel(e,i._panel_contents[t],i._last_ut,i._last_utm),e._renderPNG("altitude_time.png")}),$(".at-svg",i._context).click(function(){var t=Ie($(this).data("item"));t<0&&(t=0),t>=i._panel_contents.length&&(t=i._panel_contents.length-1);var e=new Rt(1,1);i._doPanel(e,i._panel_contents[t],i._last_ut,i._last_utm),St("altitude_time.svg",e._render())})},Pt.prototype._altitude=function(t,e,i,s,a){t*=Math.PI/12,e*=Math.PI/180;t=i+a-t;return Math.asin(Math.sin(s)*Math.sin(e)+Math.cos(s)*Math.cos(e)*Math.cos(t))},Pt.prototype._altitude_colour=function(t){return 90<t?"#00ff00":t<0?"#ffffff":t<20?"rgb("+Math.floor(t/20*192)+",0,0)":t<45?"rgb(192,"+Math.floor((t-20)/25*192)+",0)":"rgb("+(192-Math.floor((t-45)/45*192))+","+(192+Math.floor((t-45)/45*64))+",0)"},Pt.prototype._doColorScale=function(){var t,e=$(".colorScale",self._context)[0];e.width=256,e.height=46;var i=e.getContext("2d");i.font="12px Arial,Helvetica,sans-serif",i.textAlign="center",i.textBaseline="top";for(var s=0;s<=90;s+=1)t=8+240*s/90,i.fillStyle=this._altitude_colour(s),i.beginPath(),i.rect(t-(240/90*1+3)/2,0,240/90*1+3,10),i.fill();for(i.fillStyle="#777",i.strokeStyle="#777",s=0;s<=90;s+=10)t=8+240*s/90,i.fillText(s,t,16),i.beginPath(),i.moveTo(t,10),i.lineTo(t,14),i.stroke();i.fillText("Altitude / °",128,30)},Pt.prototype._doPanel=function(t,e,i,s){for(var a=this,o=[],n=e.length,h=st(i)*Math.PI/12,r=3*Math.PI/12,_=$(".mag",a._context).val(),l=$(".alt",a._context).val()*Math.PI/180,c=0;c<n;c++){var p=this._altitude(e[c].RA,e[c].Decl,h,a._settings.lat,a._settings.lng),d=this._altitude(e[c].RA,e[c].Decl,h+r,a._settings.lat,a._settings.lng);("Sun"===e[c].name||(l<=p||l<=d)&&parseFloat(e[c].mag)<=parseFloat(_))&&o.push(c)}var u=16*o.length,f=30+u+30;for(t._resize(800,f),t._textStyle("Arial,Helvetica,sans-serif",11,"",""),t._fillStyle("#777777"),c=2;c<24;c+=2){var g=c+12;23<g&&(g-=24);var g=Pe(g)+":00",m=100+600*c/24;t._text(m,23,0,-1,!0,g,!1,!1),t._text(m,37+u,0,1,!0,g,!1,!1),t._strokeStyle("#aaaaaa"),t._beginPath(),t._moveTo(m,30),t._lineTo(m,30+u),t._stroke()}for(c=0;c<o.length;c++)t._textStyle("Arial,Helvetica,sans-serif",12,"bold",""),t._text(95,30+16*(c+.5),1,0,!0,e[o[c]].name,!1,!1),t._textStyle("Arial,Helvetica,sans-serif",12,"",""),t._text(705,30+16*(c+.5),-1,0,!0,"mag "+e[o[c]].mag,!1,!1);for(c=0;c<o.length;c++)for(var v=30+16*(c+.5),x=.05;x<24;x+=.1)m=100+600*x/24,h=st(s+3600*(x-12))*Math.PI/12,l=a._altitude(e[o[c]].RA,e[o[c]].Decl,h,a._settings.lat,a._settings.lng),t._fillStyle(a._altitude_colour(180*l/Math.PI)),t._beginPath(),t._rect(m-2.75,v-5.6,5.5,11.2),t._fill();for(var y=(i-s)/3600+12;24<y;)y-=24;for(;y<-24;)y+=24;m=100+600*y/24,t._strokeStyle("#000000",3),t._beginPath(),t._moveTo(m,30),t._lineTo(m,30+u),t._stroke(),t._strokeStyle("#ee00ee",3),t._fillStyle("#ee00ee"),t._beginPath(),t._moveTo(m,20),t._lineTo(m,-5),t._stroke(),t._beginPath(),t._moveTo(m,20),t._lineTo(m-7.5,10),t._lineTo(m+7.5,10),t._fill(),t._beginPath(),t._moveTo(m,30+u+10),t._lineTo(m,30+u+10+25),t._stroke(),t._beginPath(),t._moveTo(m,30+u+10),t._lineTo(m-7.5,30+u+10+10),t._lineTo(m+7.5,30+u+10+10),t._fill(),t._strokeStyle("#222222",3),t._beginPath(),t._rect(100,27,600,6+u),t._stroke()},Pt.prototype._pageRefresh=function(t){var e,i,s,a,o=this,n=o._settings.gotoTime;t&&(e=parseInt($(".day",o._context).val()),i=parseInt($(".month",o._context).val()),s=parseInt($(".year",o._context).val()),t=parseInt($(".hour",o._context).val()),a=parseInt($(".min",o._context).val()),n=be._calendar_to_unix(s,i,e,t,a,0),n-=o._tzOffset.offset(n)),e=(a=be._unix_to_calendar(n))[2],i=a[1],s=a[0];var h=86400*Math.floor(n/86400);h-=o._tzOffset.offset(h),this._panel_contents=[[],o.nebData.OC,o.nebData.Gb,o.nebData.Gx,o.nebData.Ot],$.getJSON(window.server+"json/planetPositions.php?year="+s+"&month="+i+"&day="+e,function(t){o._panel_contents[0]=[{name:"Sun",RA:t.SunRA,Decl:t.SunDec,mag:t.SunMag},{name:"Mercury",RA:t.MercuryRA,Decl:t.MercuryDec,mag:t.MercuryMag},{name:"Venus",RA:t.VenusRA,Decl:t.VenusDec,mag:t.VenusMag},{name:"Moon",RA:t.MoonRA,Decl:t.MoonDec,mag:t.MoonMag},{name:"Mars",RA:t.MarsRA,Decl:t.MarsDec,mag:t.MarsMag},{name:"Jupiter",RA:t.JupiterRA,Decl:t.JupiterDec,mag:t.JupiterMag},{name:"Saturn",RA:t.SaturnRA,Decl:t.SaturnDec,mag:t.SaturnMag},{name:"Uranus",RA:t.UranusRA,Decl:t.UranusDec,mag:t.UranusMag},{name:"Neptune",RA:t.NeptuneRA,Decl:t.NeptuneDec,mag:t.NeptuneMag},{name:"Pluto",RA:t.PlutoRA,Decl:t.PlutoDec,mag:t.PlutoMag}],o._doPanel(o._graphics_context_0,o._panel_contents[0],n,h)}),o._doPanel(this._graphics_context_1,this._panel_contents[1],n,h),o._doPanel(this._graphics_context_2,this._panel_contents[2],n,h),o._doPanel(this._graphics_context_3,this._panel_contents[3],n,h),o._doPanel(this._graphics_context_4,this._panel_contents[4],n,h),this._last_ut=n,this._last_utm=h},$(function(){$(".whatsup_colourchart").each(function(t,e){var i=$(e),e=new Pt(i.data("meta"),i);i.data("handler",e)})}),It.prototype._setup2=function(){var t=this;t._refresh=!0,$("input, select",t._context).on("change",function(){t._refresh=!0}),t._pageRefresh(!1),setInterval(function(){t._pageRefresh(!0)},300)},It.prototype._pageRefresh=function(t){var e=this;if(this._refresh){if(!("planetarium"in this)){var i=this._planetarium_el.data("handler");if(void 0===i)return;this.planetarium=i}var s,a,o,n,h=this._settings.gotoTime;t&&(s=parseInt($(".day",this._context).val()),a=parseInt($(".month",this._context).val()),o=parseInt($(".year",this._context).val()),t=parseInt($(".hour",this._context).val()),n=parseInt($(".min",this._context).val()),h=be._calendar_to_unix(o,a,s,t,n,0),h-=this._tzOffset.offset(h)),s=(n=be._unix_to_calendar(h))[2],a=n[1],o=n[0],$.getJSON(window.server+"embeds/whatsup_body.php?year="+o+"&month="+a+"&day="+s+"&mode=objects",function(t){$(".overview_txt",e._context).html(t.objects),e.planetarium._settings.newsmap_objects=t.object_list,e.planetarium.gotoUtcTime(h),e.planetarium.resize()}),this._refresh=!1}},$(function(){$(".whatsup_starwheel").each(function(t,e){var i=$(e),e=new It(i.data("meta"),i);i.data("handler",e)})}),$t.prototype._setup2=function(){var t=this;t.tabs=[1,1,1,1,1,1],$("input, select",t._context).on("change",function(){t._pageRefresh(!0)}),t._pageRefresh(!1)},$t.prototype._pageRefresh=function(t){var e=this,i=parseInt($(".day",e._context).val()),s=parseInt($(".month",e._context).val()),a=parseInt($(".year",e._context).val()),o=be._calendar_to_unix(a,s,i,12,0,0);o-=e._tzOffset.offset(o);var n=be._unix_to_calendar(o),i=n[2],s=n[1],a=n[0],o=n[3],n=n[4];$(".times_div",e._context).addClass("out-of-date"),$.getJSON(window.server+"embeds/whatsup_body.php?year="+a+"&month="+s+"&day="+i+"&hour="+o+"&min="+n+"&mode=times",function(t){$(".times_div",e._context).html(t),$(".times_div",e._context).removeClass("out-of-date")})},$(function(){$(".whatsup_times").each(function(t,e){var i=$(e),e=new $t(i.data("meta"),i);i.data("handler",e)})}),zt.prototype._resize=function(t,e){this._width=t,this._height=e,this._ca.width=t,this._ca.height=e,this._co=this._ca.getContext("2d"),this._textStyle("Arial,Helvetica,sans-serif",13,"",""),this._strokeStyle("#000000",1),this._fillStyle("#000000"),this._text_queue=[],this._collision_map._reset()},zt.prototype._clear=function(){this._resize(this._width,this._height)},zt.prototype._translate=function(t,e,i){this._co.save(),this._co.translate(t,e),this._co.rotate(i)},zt.prototype._unsetTranslate=function(){this._co.restore()},zt.prototype._strokeStyle=function(t,e){this._co.strokeStyle=t,this._co.lineWidth=e,this._stroke_style=t,this._line_width=e},zt.prototype._fillStyle=function(t){this._co.fillStyle=t,this._fill_style=t},zt.prototype._textStyle=function(t,e,i,s){this._text_style=[t,e,i,s],this._co.font=s+" "+i+" "+e+"px "+t},zt.prototype._beginPath=function(){this._co.beginPath()},zt.prototype._moveTo=function(t,e){this._co.moveTo(t,e)},zt.prototype._lineTo=function(t,e){this._co.lineTo(t,e)},zt.prototype._closePath=function(){this._co.closePath()},zt.prototype._rect=function(t,e,i,s){this._co.rect(t,e,i,s)},zt.prototype._arc=function(t,e,i,s,a,o){this._co.arc(t,e,i,s,a,o)},zt.prototype._bezierCurveTo=function(t,e,i,s,a,o){this._co.bezierCurveTo(t,e,i,s,a,o)},zt.prototype._stroke=function(){this._co.stroke()},zt.prototype._fill=function(){this._co.closePath(),this._co.fill()},zt.prototype._setClip=function(){this._co.save(),this._co.clip()},zt.prototype._unsetClip=function(){this._co.restore()},zt.prototype._text=function(t,e,i,s,a,o,n,h){if(n||h){var r,_,l=this._co.measureText(o).width+4,c=this._text_style[1]+4,l=i<0?(r=t)+l:0<i?(r=t-l,t):(r=t-l/2,t+l/2),c=s<0?(_=e-c,e):0<s?(_=e)+c:(_=e-c/2,e+c/2);if(this._collision_map._addBox(r,l,_,c,n,h))return 1}return this._co.textBaseline=s<0?"bottom":0<s?"top":"middle",this._co.textAlign=i<0?"left":0<i?"right":"center",a?this._co.fillText(o,t,e):this._co.strokeText(o,t,e),0},zt.prototype._textWidth=function(t){return this._co.measureText(t).width},zt.prototype._queueText=function(t,e,i,s,a,o,n){this._text_queue.push([n,t,e,i,s,a,o,this._text_style,this._stroke_style,this._line_width,this._fill_style])},zt.prototype._unqueueText=function(){var i=this;this._text_queue.sort(function(t,e){return t[0]>e[0]}),$.each(this._text_queue,function(t,e){i._strokeStyle(e[8],e[9]),i._fillStyle(e[10]),i._textStyle(e[7][0],e[7][1],e[7][2],e[7][3]),i._text(e[1],e[2],e[3],e[4],e[5],e[6],!0,!0)}),this._text_queue=[]},zt.prototype._drawImage=function(t,e,i,s,a,o,n,h,r){this._co.drawImage(t,e,i,s,a,o,n,h,r)},zt.prototype._render=function(){},zt.prototype._composite=function(t){this._co.drawImage(t._ca,0,0)},zt.prototype._renderPNG=function(t){var e;Tt()?(e=this._ca.msToBlob(),window.navigator.msSaveBlob(e,t)):(t=this._ca.toDataURL("image/png"),window.open(t,"_blank"))},Ct.prototype._reset=function(){this._items=[]},Ct.prototype._addBox=function(i,s,a,o,t,e){var n=!1;return t&&$.each(this._items,function(t,e){i<e[1]&&s>e[0]&&a<e[3]&&o>e[2]&&(n=!0)}),n?1:(e&&this._items.push([i,s,a,o]),0)},Rt.prototype._resize=function(t,e){this._width=t,this._height=e,this._ca.width=t,this._ca.height=e,this._co=this._ca.getContext("2d"),this._clear()},Rt.prototype._clear=function(){this._textStyle("Arial,Helvetica,sans-serif",13,"",""),this._strokeStyle("#000000",1),this._fillStyle("#000000"),this._text_queue=[],this._collision_map._reset();var t={open:"<defs>",close:"</defs>",children:[{open:'<clipPath id="page">',close:"</clipPath>",children:[{open:'<rect x="0" y="0" width="'+this._width+'" height="'+this._height+'" />',close:"",children:[]}]}]},e={open:'<g clip-path="url(#page)">',close:"</g>",children:[]};this._document={open:'<svg version="1.1" width="'+this._width+'" height="'+this._height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">',close:"</svg>",children:[t,e]},this._defs=t,this._contextStack=[e],this._clip_path_counter=0,this._beginPath()},Rt.prototype._translate=function(t,e,i){e={open:'<g transform="translate('+t+","+e+") rotate("+(i/Math.PI*180).toFixed(3)+')">',close:"</g>",children:[]},i=this._contextStack.length-1;this._contextStack[i].children.push(e),this._contextStack.push(e)},Rt.prototype._unsetTranslate=function(){this._contextStack.pop()},Rt.prototype._strokeStyle=function(t,e){this._stroke_style=t,this._line_width=e},Rt.prototype._fillStyle=function(t){this._fill_style=t},Rt.prototype._textStyle=function(t,e,i,s){this._text_style=[t,e,i,s],this._co.font=s+" "+i+" "+e+"px "+t},Rt.prototype._beginPath=function(){this._path=[],this._path_polygon=null,this._path_first_point=null},Rt.prototype._moveTo=function(t,e){null===this._path_polygon&&(this._path_polygon=[],this._path.push({type:"polygon",path:this._path_polygon})),this._path_polygon.push(["M",t.toFixed(2),e.toFixed(2)].join(" ")),this._path_first_point=[t,e]},Rt.prototype._lineTo=function(t,e){null!==this._path_polygon?this._path_polygon.push(["L",t.toFixed(2),e.toFixed(2)].join(" ")):this._moveTo(t,e)},Rt.prototype._closePath=function(){this._path_first_point&&this._lineTo(this._path_first_point[0],this._path_first_point[1])},Rt.prototype._rect=function(t,e,i,s){this._path_polygon=null,this._path.push({type:"rect",path:[t.toFixed(2),e.toFixed(2),i.toFixed(2),s.toFixed(2)]})},Rt.prototype._arc=function(t,e,i,s,a,o){var n,h;0===s&&a===2*Math.PI?(this._path_polygon=null,this._path.push({type:"circle",path:[t.toFixed(2),e.toFixed(2),i.toFixed(2)]})):(n=function(t,e,i,s){return{x:t+i*Math.cos(s),y:e+i*Math.sin(s)}},s%=2*Math.PI,(h=(a%=2*Math.PI)-s)<0&&(h+=2*Math.PI),s=n(t,e,i,s),a=n(t,e,i,a),h=o?h>Math.PI?0:1:h>Math.PI?1:0,o=Ie(!o),this._lineTo(s.x,s.y),this._path_polygon.push(["A",i.toFixed(2),i.toFixed(2),0,h,o,a.x.toFixed(2),a.y.toFixed(2)].join(" ")))},Rt.prototype._bezierCurveTo=function(t,e,i,s,a,o){null!==this._path_polygon&&this._path_polygon.push(["C",t.toFixed(2),e.toFixed(2),",",i.toFixed(2),s.toFixed(2),",",a.toFixed(2),o.toFixed(2)].join(" "))},Rt.prototype.__realisePath=function(i){var s="";return $.each(this._path,function(t,e){"rect"===e.type?s+='<rect x="'+e.path[0]+'" y="'+e.path[1]+'" width="'+e.path[2]+'" height="'+e.path[3]+'" '+i+" />":"circle"===e.type?s+='<circle cx="'+e.path[0]+'" cy="'+e.path[1]+'" r="'+e.path[2]+'" '+i+" />":"polygon"===e.type&&(s+='<path d="',s+=e.path.join(" "),s+='" '+i+" />")}),s},Rt.prototype._stroke=function(){var t='fill="none" stroke="'+this._stroke_style+'" stroke-width="'+this._line_width+'"',e=this._contextStack.length-1;this._contextStack[e].children.push({open:this.__realisePath(t),close:"",children:[]})},Rt.prototype._fill=function(){var t='stroke="none" fill="'+this._fill_style+'"',e=this._contextStack.length-1;this._contextStack[e].children.push({open:this.__realisePath(t),close:"",children:[]})},Rt.prototype._setClip=function(){this._defs.children.push({open:'<clipPath id="clip'+this._clip_path_counter+'">',close:"</clipPath>",children:[{open:this.__realisePath(""),close:"",children:[]}]});var t={open:'<g clip-path="url(#clip'+this._clip_path_counter+')">',close:"</g>",children:[]},e=this._contextStack.length-1;this._contextStack[e].children.push(t),this._contextStack.push(t),this._clip_path_counter++},Rt.prototype._unsetClip=function(){this._contextStack.pop()},Rt.prototype._text=function(t,e,i,s,a,o,n,h){var r=this._co.measureText(o).width,_=this._text_style[1];if(n||h){var l,c,p=i<0?(l=t)+r:0<i?(l=t-r,t):(l=t-r/2,t+r/2),r=s<0?(c=e-_,e):0<s?(c=e)+_:(c=e-_/2,e+_/2);if(this._collision_map._addBox(l,p,c,r,n,h))return 1}s<0||(e+=0<s?_:_/2),i=i<0?"start":0<i?"end":"middle";e='<text x="'+t.toFixed(2)+'" y="'+e.toFixed(2)+'" ';this._text_style[0]&&(e+='font-family="'+this._text_style[0]+'" '),this._text_style[1]&&(e+='font-size="'+this._text_style[1]+'" '),this._text_style[2]&&(e+='font-weight="'+this._text_style[2]+'" '),this._text_style[3]&&(e+='font-style="'+this._text_style[3]+'" '),e+='text-anchor="'+i+'" ',e+=a?'stroke="none" fill="'+this._fill_style+'" ':'fill="none" stroke="'+this._stroke_style+'" stroke-width="'+this._line_width+'" ',e+=">"+o+"</text>";o=this._contextStack.length-1;return this._contextStack[o].children.push({open:e,close:"",children:[]}),0},Rt.prototype._textWidth=function(t){return this._co.measureText(t).width},Rt.prototype._queueText=function(t,e,i,s,a,o,n){this._text_queue.push([n,t,e,i,s,a,o,this._text_style,this._stroke_style,this._line_width,this._fill_style])},Rt.prototype._unqueueText=function(){var i=this;this._text_queue.sort(function(t,e){return t[0]>e[0]}),$.each(this._text_queue,function(t,e){i._strokeStyle(e[8],e[9]),i._fillStyle(e[10]),i._textStyle(e[7][0],e[7][1],e[7][2],e[7][3]),i._text(e[1],e[2],e[3],e[4],e[5],e[6],1,1)}),this._text_queue=[]},Rt.prototype._drawImage=function(t,e,i,s,a,o,n,h,r){},Rt.prototype._render=function(){var e="",i=function(t){e+=t.open+"\n",$.each(t.children,function(t,e){i(e)}),t.close&&(e+=t.close+"\n")};return i(this._document),e},Rt.prototype._composite=function(t){var e=this._document.children[0],i=this._document.children[1],s=t._document.children[0],t=t._document.children[1];e.children=e.children.concat(s.children),i.children=i.children.concat(t.children)},jt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"arrowType":i.arrowType=e;break;case"color":i.color=e;break;case"strokeLineWidth":i.strokeLineWidth=e;break;case"origin":i.origin=e;break;case"target":i.target=e;break;case"z_index":i.z_index=e;break;default:throw"Unrecognised arrow setting "+t}})},jt.prototype.cleanWorkspace=function(){this.workspace=[]},jt.prototype.calculateDataRanges=function(t){this.page=t,this.cleanWorkspace()},jt.prototype.calculateBoundingBox=function(){var t=new JSPlot_BoundingBox;return t.includePoint(this.origin[0],this.origin[1]),t.includePoint(this.target[0],this.target[1]),t},jt.prototype.render=function(){null!==this.color&&(new Wt).primitive_arrow(this.page,this.arrowType,this.origin[0],this.origin[1],0,this.target[0],this.target[1],0,this.color,this.strokeLineWidth,1)},jt.prototype.interactive_scroll=function(t,e){},jt.prototype.interactive_zoom=function(t){return!1},Dt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"arrowType":i.arrowType=e;break;case"atZero":i.atZero=e;break;case"dataType":i.data_type=e;break;case"enabled":i.enabled=e;break;case"linkTo":i.linkTo=e;break;case"log":i.logarithmic=e;break;case"min":i.min=e;break;case"max":i.max=e;break;case"mirror":i.mirror=e;break;case"label":i.label=e;break;case"labelRotate":i.labelRotate=e;break;case"rangeReversed":i.rangeReversed=e;break;case"scrollEnabled":i.scrollEnabled=e;break;case"scrollMin":i.scrollMin=e;break;case"scrollMax":i.scrollMax=e;break;case"scrollSpan":i.scrollSpan=e;break;case"showLabels":i.showLabels=e;break;case"tickLabelRotation":i.tickLabelRotation=e;break;case"ticksMinor":i.ticksMinor.configure(e);break;case"ticks":i.ticks.configure(e);break;case"visible":i.visible=e;break;case"zoomEnabled":i.zoomEnabled=e;break;default:throw"Unrecognised axis setting "+t}})},Dt.prototype.cleanWorkspace=function(){this.workspace=[],this.workspace.crossedAtZero=null,this.workspace.minUsed=null,this.workspace.maxUsed=null,this.workspace.minFinal=null,this.workspace.maxFinal=null,this.workspace.minHard=this.min,this.workspace.maxHard=this.max,this.workspace.logFinal=this.logarithmic,this.workspace.rangeFinalised=!1,this.workspace.target_number_major_ticks=null,this.workspace.target_number_minor_ticks=null,this.workspace.axisName=null,this.workspace.canvasId=null,this.workspace.labelFinal=this.label,this.workspace.mode0BackPropagated=!1,this.workspace.tickListFinal=null,this.workspace.max_tick_label_width=0,this.ticking_allocator=null},Dt.prototype.allocate_axis_ticks=function(){var i=this;"timestamp"===this.data_type?this.ticking_allocator=new ee(this):this.logarithmic?this.ticking_allocator=new te(this):this.ticking_allocator=new Kt(this),this.ticking_allocator.process();var s=document.createElement("canvas").getContext("2d");s.font="15px Arial,Helvetica,sans-serif";var t={x:this.workspace.max_tick_label_width=0,y:1,z:2}[this.axis_name.substr(0,1)],e=-this.tickLabelRotation*Math.PI/180,t=this.graph.workspace.axis_bearing[t],a=e+Math.PI/2+t,t=this.workspace.tickListFinal.major;$.each(t,function(t,e){""!==e[1]&&(e=s.measureText(e[1]).width,e=Math.abs(e*Math.sin(a))+Math.abs(15*Math.cos(a)),i.workspace.max_tick_label_width=Math.max(i.workspace.max_tick_label_width,e))})},Dt.prototype.includePoint=function(t){isFinite(t)&&((null===this.workspace.minUsed||this.workspace.minUsed>t&&(!this.workspace.logFinal||0<t))&&(this.workspace.minUsed=t),(null===this.workspace.maxUsed||this.workspace.maxUsed<t&&(!this.workspace.logFinal||0<t))&&(this.workspace.maxUsed=t))},Dt.prototype.getPosition=function(t,e){if(!e)if(this.workspace.maxFinal>this.workspace.minFinal){if(t<this.workspace.minFinal||t>this.workspace.maxFinal)return NaN}else if(t>this.workspace.minFinal||t<this.workspace.maxFinal)return NaN;return this.workspace.logFinal&&t<=0?NaN:this.workspace.logFinal?(Math.log(t)-Math.log(this.workspace.minFinal))/(Math.log(this.workspace.maxFinal)-Math.log(this.workspace.minFinal)):(t-this.workspace.minFinal)/(this.workspace.maxFinal-this.workspace.minFinal)},Dt.prototype.invGetPosition=function(t){return this.workspace.logFinal?this.workspace.minFinal+t*(this.workspace.maxFinal-this.workspace.minFinal):this.workspace.minFinal*Math.pow(this.workspace.maxFinal/this.workspace.minFinal,t)},Dt.prototype.inRange=function(t){var e,i=null,s=null;return null!==this.workspace.minHard&&(i=this.workspace.minHard),null!==this.workspace.maxHard&&(s=this.workspace.maxHard),null===this.min&&(i=null),null===this.max&&(s=null),this.scrollEnabled&&((i=s=null)!==this.scrollMin&&(i=this.scrollMin),null!==this.scrollMax&&(s=this.scrollMax)),this.rangeReversed&&(e=i,i=s,s=e),null!==i&&null!==s?i<=t&&t<=s||t<=i&&s<=t:null!==i?i<t:null===s||t<s},Dt.prototype.linkedAxisBackPropagate=function(t){for(var e=this,i=0;i<100&&(null!==e.linkTo&&(null!==e.workspace.minUsed||null!==e.workspace.maxUsed));i++){if(!t.itemList.hasOwnProperty(e.linkTo[0])){t.workspace.errorLog+="Axis linked to plot <"+e.linkTo[0]+"> which doesn't exist.\n";break}if("graph"!==!t.itemList[e.linkTo[0]].itemType){t.workspace.errorLog+="Axis linked to plot <"+e.linkTo[0]+"> which is not a graph.\n";break}if(!t.itemList[e.linkTo[0]].axes.hasOwnProperty(e.linkTo[1])){t.workspace.errorLog+="Axis linked to axis <"+e.linkTo[1]+"> which doesn't exist.\n";break}var s=t.itemList[e.linkTo[0]].axes[e.linkTo[1]];null!==e.workspace.minUsed&&(null===s.workspace.minUsed||s.workspace.minUsed>e.workspace.minUsed)&&(s.workspace.minUsed=e.workspace.minUsed),null!==e.workspace.maxUsed&&(null===s.workspace.minUsed||s.workspace.maxUsed<e.workspace.maxUsed)&&(s.workspace.maxUsed=e.workspace.maxUsed),e=s}},Dt.prototype.linkedAxisForwardPropagate=function(t,e){for(var i=e,s=this,a=[this],o=0;o<100&&null!==s.linkTo;o++){if(!t.itemList.hasOwnProperty(s.linkTo[0])){t.workspace.errorLog+="Axis linked to plot <"+s.linkTo[0]+"> which doesn't exist.\n";break}if("graph"!==t.itemList[s.linkTo[0]].itemType){t.workspace.errorLog+="Axis linked to plot <"+s.linkTo[0]+"> which is not a graph.\n";break}if(!t.itemList[s.linkTo[0]].axes.hasOwnProperty(s.linkTo[1])){t.workspace.errorLog+="Axis linked to axis <"+s.linkTo[1]+"> which doesn't exist.\n";break}s=t.itemList[s.linkTo[0]].axes[s.linkTo[1]],a.push(s)}1!==e||s.workspace.rangeFinalised||s.allocate_axis_ticks();for(var n=a.length-2;0<=n;n--){var h=a[n];if(h.workspace.rangeFinalised)break;if(null===h.linkTo)break;0===i&&h.workspace.mode0BackPropagated||(h.workspace.mode0BackPropagated=!0,0===e?(h.workspace.hardMin=s.workspace.hardMin,h.workspace.hardMax=s.workspace.hardMax,h.workspace.hardAutoMinSet=s.workspace.hardAutoMinSet,h.workspace.hardAutoMaxSet=s.workspace.hardAutoMaxSet):1===e&&(h.workspace.logFinal=s.workspace.logFinal,h.workspace.minFinal=s.workspace.minFinal,h.workspace.maxFinal=s.workspace.maxFinal,h.workspace.rangeFinalised=!0,h.allocate_axis_ticks()))}},Dt.prototype.axis_tick_text_alignment=function(t){for(t%=2*Math.PI;t<0;)t+=2*Math.PI;return t<+Math.PI/8?[0,1]:t<3*Math.PI/8?[-1,1]:t<5*Math.PI/8?[-1,0]:t<7*Math.PI/8?[-1,-1]:t<9*Math.PI/8?[0,-1]:t<11*Math.PI/8?[1,-1]:t<13*Math.PI/8?[1,0]:t<15*Math.PI/8?[1,1]:[0,-1]},Dt.prototype.render=function(_,t,i,l,e,c,p,s,d,u){var f,g,m=this,v=!t;this.visible&&(u=u&&this.showLabels,(new Wt).primitive_arrow(_,this.arrowType,i,l,e,c,p,s,this.graph.axesColor,_.constants.AXES_LINEWIDTH,0),t={x:0,y:1,z:2}[this.axis_name.substr(0,1)],e=-this.tickLabelRotation*Math.PI/180,f=this.graph.workspace.axis_bearing[t],s=e+Math.PI/2+f+Math.PI*v,g=this.axis_tick_text_alignment(s),$.each(["major","minor"],function(t,h){var r="major"===h?_.constants.AXES_MAJTICKLEN:_.constants.AXES_MINTICKLEN,e=m.workspace.tickListFinal[h];$.each(e,function(t,s){var a=m.getPosition(s[0],!0),o=i+(c-i)*a,n=l+(p-l)*a;$.each(d,function(t,e){var i=o+Math.sin(e)*r,e=n+Math.cos(e)*r;a<.001&&("back"===m.arrowType||"double"===m.arrowType)||.999<a&&("single"===m.arrowType||"double"===m.arrowType)||(.001<a&&a<.999&&(_.canvas._strokeStyle(m.graph.axesColor.toHTML(),_.constants.AXES_LINEWIDTH),_.canvas._beginPath(),_.canvas._moveTo(o,n),_.canvas._lineTo(i,e),_.canvas._stroke()),u&&"major"===h&&""!==s[1]&&(i=o+(v?-1:1)*Math.sin(f+Math.PI/2)*_.constants.AXES_TEXTGAP+0,e=n+(v?-1:1)*Math.cos(f+Math.PI/2)*_.constants.AXES_TEXTGAP,_.canvas._translate(i,e,m.tickLabelRotation),_.canvas._textStyle("Arial,Helvetica,sans-serif",15,"",""),_.canvas._fillStyle(m.graph.axesColor.toHTML()),_.canvas._text(0,0,g[0],g[1],!0,s[1],!1,!0),_.canvas._unsetTranslate()))})})}),u&&null!==m.workspace.labelFinal&&(s=(e=-m.labelRotate)+Math.PI*v,g=this.axis_tick_text_alignment(s),t=(i+c)/2+(v?-1:1)*(this.workspace.max_tick_label_width+_.constants.AXES_LABELGAP)*Math.sin(f+Math.PI/2),s=(l+p)/2+(v?-1:1)*(this.workspace.max_tick_label_width+_.constants.AXES_LABELGAP)*Math.cos(f+Math.PI/2),e=e+Math.PI/2-f,(e%=2*Math.PI)<-Math.PI&&(e+=2*Math.PI),e>Math.PI&&(e-=2*Math.PI),e>Math.PI/2&&(e-=Math.PI),e<-Math.PI/2&&(e+=Math.PI),_.canvas._translate(t,s,e),_.canvas._textStyle("Arial,Helvetica,sans-serif",15,"",""),_.canvas._fillStyle(m.graph.axesColor.toHTML()),_.canvas._text(0,0,g[0],g[1],!0,m.workspace.labelFinal,!1,!0),_.canvas._unsetTranslate()))},Dt.prototype.interactive_scroll=function(t,e,i){(i||this.scrollEnabled)&&null!==this.workspace.minFinal&&null!==this.workspace.maxFinal&&(null===this.scrollSpan&&(this.workspace.logFinal?(this.scrollSpan=this.workspace.maxFinal/this.workspace.minFinal,this.scrollSpan<1&&(this.scrollSpan=1/this.scrollSpan)):this.scrollSpan=Math.abs(this.workspace.maxFinal-this.workspace.minFinal)),null===this.min&&(this.min=this.workspace.minFinal),this.workspace.logFinal?(this.min/=Math.pow(this.scrollSpan,e),null!==this.scrollMin&&this.min<this.scrollMin&&(this.min=this.scrollMin),null!==this.scrollMax&&this.min>this.scrollMax/this.scrollSpan&&(this.min=this.scrollMax/this.scrollSpan),this.max=this.min*this.scrollSpan):(this.min-=e*this.scrollSpan,null!==this.scrollMin&&this.min<this.scrollMin&&(this.min=this.scrollMin),null!==this.scrollMax&&this.min>this.scrollMax-this.scrollSpan&&(this.min=this.scrollMax-this.scrollSpan),this.max=this.min+this.scrollSpan),t.needs_refresh=!0)},Dt.prototype.interactive_zoom=function(t,e){var i=this.scrollSpan;return this.interactive_scroll(t,0,this.zoomEnabled),this.zoomEnabled&&null!==this.scrollSpan&&(0<e?(this.scrollSpan*=.9,this.interactive_scroll(t,-(1-.9)/2,!0)):(this.scrollSpan/=.9,null!==this.scrollMin&&null!==this.scrollMax&&(this.workspace.logFinal?this.scrollSpan>this.scrollMax/this.scrollMin&&(this.scrollSpan=this.scrollMax/this.scrollMin):this.scrollSpan>this.scrollMax-this.scrollMin&&(this.scrollSpan=this.scrollMax-this.scrollMin)),this.interactive_scroll(t,(1-.9)/2,!0)),t.needs_refresh=!0),this.zoomEnabled&&this.scrollSpan!==i},Nt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"ticDir":i.ticDir=e;break;case"tickList":i.tickList=e;break;case"tickMin":i.tickMin=e;break;case"tickMax":i.tickMax=e;break;case"tickStep":i.tickStep=e;break;default:throw"Unrecognised axis tick setting "+t}})},JSPlot_BoundingBox=function(){this.left=null,this.right=null,this.top=null,this.bottom=null},JSPlot_BoundingBox.prototype.includePoint=function(t,e){(null===this.left||this.left>t)&&(this.left=t),(null===this.right||this.right<t)&&(this.right=t),(null===this.top||this.top>e)&&(this.top=e),(null===this.bottom||this.bottom<e)&&(this.bottom=e)},JSPlot_BoundingBox.prototype.includeBox=function(t){(null===this.left||this.left>t.left)&&(this.left=t.left),(null===this.right||this.right<t.right)&&(this.right=t.right),(null===this.top||this.top>t.top)&&(this.top=t.top),(null===this.bottom||this.bottom<t.bottom)&&(this.bottom=t.bottom)},JSPlot_BoundingBox.prototype.query=function(){return{left:this.left,right:this.right,top:this.top,bottom:this.bottom}},Ot.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"allow_export_png":i.settings.allow_export_png=e;break;case"allow_export_svg":i.settings.allow_export_svg=e;break;case"allow_export_csv":i.settings.allow_export_csv=e;break;default:throw"Unrecognised canvas setting "+t}})},Ot.prototype._render=function(t){var i=this,s=new JSPlot_BoundingBox,a=[];$.each(this.itemList,function(t,e){a.push(e)}),a.sort(function(t,e){return t.z_index>e.z_index?1:-1}),$.each(a,function(t,e){e.calculateDataRanges(i)}),$.each(a,function(t,e){s.includeBox(e.calculateBoundingBox())}),this.canvas=t(s.right-s.left,s.bottom-s.top),this.canvas._translate(-s.left,-s.top,0),this.threeDimensionalBuffer=new Qt,$.each(a,function(t,e){e.render()}),this.canvas._unsetTranslate()},Ot.prototype.renderToPNG=function(t){void 0!==t&&(this.page_width=t);var i=document.createElement("canvas");return this._render(function(t,e){return new zt(i,t,e)}),this.canvas._renderPNG("plot.png")},Ot.prototype.renderToCSV=function(){var i="";return $.each(this.itemList,function(t,e){"graph"===e.itemType&&(e.title&&(i+=e.title+"\n"),$.each(e.dataSets,function(t,e){e.title&&(i+=e.title+"\n"),$.each(e.data,function(t,e){$.each(e,function(t,e){i+=e+","}),i+="\n"}),i+="\n"})),i+="\n"}),i},Ot.prototype.renderToSVG=function(t){void 0!==t&&(this.page_width=t);return this._render(function(t,e){return new Rt(t,e)}),this.canvas._render()},Ot.prototype.renderToCanvas=function(s){var a=this;!function(){var t,e;s=$(s),a.page_width=s.width(),a.html_initialised||(e="<div><canvas width='1' height='1'></canvas></div>",a.settings.allow_export_png&&(e+="<input class='btn btn-success jsplot_export_png' type='button' value='Export PNG' />"),a.settings.allow_export_svg&&(e+="<input class='btn btn-success jsplot_export_svg' type='button' value='Export SVG' />"),a.settings.allow_export_csv&&(e+="<input class='btn btn-success jsplot_export_csv' type='button' value='Export CSV' />"),s.css("overflow","hidden"),s.html(e),$(".jsplot_export_png").click(function(){a.renderToPNG()}),$(".jsplot_export_svg").click(function(){St("plot.svg",a.renderToSVG())}),$(".jsplot_export_csv").click(function(){St("plot_data.csv",a.renderToCSV())}),t=$("canvas",s),a.interactive_holder_element=s,(a.interactive_canvas_element=t).mousedown(function(t){a.mouseDown(t)}),t.mouseup(function(t){a.mouseUp(t)}),t.mousemove(function(t){a.mouseDrag(t)}),t.mouseleave(function(){a.mouseUp(0)}),e="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t.bind(e,function(t){a.displayWheel(t.originalEvent)}),t.on({touchstart:function(t){t.preventDefault();t=t.originalEvent;1===t.touches.length?(a.is_pinching=!1,a.mouseDown(t.touches[0])):2===t.touches.length&&(a.is_pinching=!0,a.pinch_distance=a.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY))},touchend:function(t){t.preventDefault(),a.is_pinching||a.mouseUp(0),a.is_pinching=!1,a.mousedown=!1},touchmove:function(t){t.preventDefault();var e=t.originalEvent;a.is_pinching?(t=a.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),25<Math.abs(t-a.pinch_distance)&&(a.displayWheel(e.touches[0],a.pinch_distance-t),a.pinch_distance=t)):a.mouseDrag(e.touches[0])},touchcancel:function(t){t.preventDefault(),a.is_pinching||a.mouseUp(0),a.is_pinching=!1,a.mousedown=!1}}),$(window).resize(function(){a.renderToCanvas(a.interactive_holder_element)}),a.html_initialised=!0);var i=$("canvas",s)[0];a._render(function(t,e){return new zt(i,t,e)})}()},Ot.prototype.addItem=function(t,e){this.itemList[t]=e},Ot.prototype.removeItem=function(t){delete this.itemList[t]},Ot.prototype.hypot=function(t,e){return Math.sqrt(t*t+e*e)},Ot.prototype.mouseDown=function(t){this.pos_start=At(t,this.interactive_canvas_element),this.mousedown=!0},Ot.prototype.mouseDrag=function(t){var e,i,s;0===t?e=this.pos_latest:(e=At(t,this.interactive_canvas_element),this.pos_latest=e),this.mousedown&&(i=e[0]-this.pos_start[0],s=e[1]-this.pos_start[1],$.each(this.itemList,function(t,e){e.interactive_scroll(i,s)}),this.pos_start=e)},Ot.prototype.mouseUp=function(t){this.mouseDrag(t),this.mousedown=!1},Ot.prototype.displayWheel=function(t,e){var i,s=Date.now();if(void 0!==this._lastZoomEventTime&&s<this._lastZoomEventTime+120)return t.preventDefault&&t.preventDefault(),void(t.returnValue=!1);i=void 0!==e?e:t.deltaY||t.wheelDelta;var a=!1;$.each(this.itemList,function(t,e){a|=e.interactive_zoom(i<0)}),a&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1,this._lastZoomEventTime=s)},Lt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"strokeColor":i.strokeColor=e;break;case"fillColor":i.fillColor=e;break;case"strokeLineWidth":i.strokeLineWidth=e;break;case"origin":i.origin=e;break;case"radius":i.radius=e;break;case"z_index":i.z_index=e;break;default:throw"Unrecognised circle setting "+t}})},Lt.prototype.cleanWorkspace=function(){this.workspace=[]},Lt.prototype.calculateDataRanges=function(t){this.page=t,this.cleanWorkspace()},Lt.prototype.calculateBoundingBox=function(){var t=new JSPlot_BoundingBox;return t.includePoint(this.origin[0]-this.radius,this.origin[1]),t.includePoint(this.origin[0]+this.radius,this.origin[1]),t.includePoint(this.origin[0],this.origin[1]-this.radius),t.includePoint(this.origin[0],this.origin[1]+this.radius),t},Lt.prototype.render=function(){null!==this.fillColor&&(this.page.canvas._fillStyle(this.fillColor.toHTML()),this.page.canvas._beginPath(),this.page.canvas._arc(this.origin[0],this.origin[1],this.radius,0,360,!1),this.page.canvas._fill()),null!==this.strokeColor&&(this.page.canvas._strokeStyle(this.strokeColor.toHTML(),this.strokeLineWidth),this.page.canvas._beginPath(),this.page.canvas._arc(this.origin[0],this.origin[1],this.radius,0,360,!1),this.page.canvas._stroke())},Lt.prototype.interactive_scroll=function(t,e){},Lt.prototype.interactive_zoom=function(t){return!1},Ft.prototype.isVisible=function(){return 0<this.alpha},Ft.prototype.toHTML=function(){function t(t){return(t=Math.floor(255*t))<0&&(t=0),255<t&&(t=255),t}return this.alpha<.999?"rgba("+t(this.red)+","+t(this.green)+","+t(this.blue)+","+t(this.alpha)/255+")":"rgb("+t(this.red)+","+t(this.green)+","+t(this.blue)+")"},Et.prototype.cleanWorkspace=function(){this.workspace={},this.workspace.styleFinal=null,this.workspace.requiredColumns=null},Et.prototype.axisRangeUpdated=function(t,e){"function"==typeof this.update_callback&&this.update_callback(this,t,e)},Wt.prototype.primitive_arrow=function(e,t,i,s,a,o,n,h,r,_,l){var c,p,d,u,f,g,m,v,x=e.threeDimensionalBuffer.active&&null!==a&&null!==h;if(r.isVisible()){e.canvas._strokeStyle(r.toHTML(),_);var y=e.constants.DEFAULT_LINEWIDTH*_,w=Math.hypot(o-i,n-s)<1e-200?0:Math.atan2(o-i,n-s),M="double"===t||"back"===t?(c=i-e.constants.ARROW_HEADSIZE*_*Math.sin(w+Math.PI-e.constants.ARROW_ANGLE/2),p=s-e.constants.ARROW_HEADSIZE*_*Math.cos(w+Math.PI-e.constants.ARROW_ANGLE/2),f=i-e.constants.ARROW_HEADSIZE*_*Math.sin(w+Math.PI+e.constants.ARROW_ANGLE/2),g=s-e.constants.ARROW_HEADSIZE*_*Math.cos(w+Math.PI+e.constants.ARROW_ANGLE/2),d=i-e.constants.ARROW_HEADSIZE*_*Math.sin(w+Math.PI)*(1-e.constants.ARROW_CONSTRICT)*Math.cos(e.constants.ARROW_ANGLE/2),u=s-e.constants.ARROW_HEADSIZE*_*Math.cos(w+Math.PI)*(1-e.constants.ARROW_CONSTRICT)*Math.cos(e.constants.ARROW_ANGLE/2),e.threeDimensionalBuffer.addItem(a,function(){e.canvas._fillStyle(r.toHTML()),e.canvas._beginPath(),e.canvas._moveTo(d,u),e.canvas._lineTo(c,p),e.canvas._lineTo(i,s),e.canvas._lineTo(f,g),e.canvas._fill()}),m=d,u):(m=i,s),k="single"===t||"double"===t?(c=o-e.constants.ARROW_HEADSIZE*_*Math.sin(w-e.constants.ARROW_ANGLE/2),p=n-e.constants.ARROW_HEADSIZE*_*Math.cos(w-e.constants.ARROW_ANGLE/2),f=o-e.constants.ARROW_HEADSIZE*_*Math.sin(w+e.constants.ARROW_ANGLE/2),g=n-e.constants.ARROW_HEADSIZE*_*Math.cos(w+e.constants.ARROW_ANGLE/2),d=o-e.constants.ARROW_HEADSIZE*_*Math.sin(w)*(1-e.constants.ARROW_CONSTRICT)*Math.cos(e.constants.ARROW_ANGLE/2),u=n-e.constants.ARROW_HEADSIZE*_*Math.cos(w)*(1-e.constants.ARROW_CONSTRICT)*Math.cos(e.constants.ARROW_ANGLE/2),e.threeDimensionalBuffer.addItem(a,function(){e.canvas._fillStyle(r.toHTML()),e.canvas._beginPath(),e.canvas._moveTo(d,u),e.canvas._lineTo(c,p),e.canvas._lineTo(o,n),e.canvas._lineTo(f,g),e.canvas._fill()}),v=d,u):(v=o,n);if(x)for(var b=0;b<100;b++)e.threeDimensionalBuffer.addItem(a+(h-a)/100*b,function(t){return function(){e.canvas._strokeStyle(r.toHTML(),y),e.canvas._beginPath(),e.canvas._moveTo(m+(v-m)/100*t,M+(k-M)/100*t),e.canvas._lineTo(m+(v-m)/100*(t+1),M+(k-M)/100*(t+1)),e.canvas._stroke()}}(b));else e.threeDimensionalBuffer.addItem(a,function(){e.canvas._strokeStyle(r.toHTML(),y),e.canvas._beginPath(),e.canvas._moveTo(m,M),e.canvas._lineTo(v,k),e.canvas._stroke()})}},Ut.prototype.evaluate_linear_raster=function(t,e,h,s){function a(t,e){for(var i=[],s=0;s<h;s++){for(var a=t+(e-t)/(h-1)*s,o=[a],n=0;n<r.functions.length;n++)o.push(r.functions[n](a));i.push(o)}return i}var r=this;return new Et(this.title,this.styling,a(t,e),function(t,e,i){s&&(t.data=a(e,i))})},Ut.prototype.evaluate_log_raster=function(t,e,h,s){function a(t,e){for(var i=[],s=0;s<h;s++){for(var a=t*Math.pow(e/t,s/(h-1)),o=[a],n=0;n<r.functions.length;n++)o.push(r.functions[n](a));i.push(o)}return i}var r=this;return new Et(this.title,this.styling,a(t,e),function(t,e,i){s&&(t.data=a(e,i))})},Ht.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"annotations":i.annotations=e;break;case"aspect":i.aspect=e;break;case"aspectZ":i.aspectZ=e;break;case"axesColor":i.axesColor=e;break;case"clip":i.clip=e;break;case"gridMajorColor":i.gridMajorColor=e;break;case"gridMinorColor":i.gridMinorColor=e;break;case"key":i.key=e;break;case"keyColumns":i.keyColumns=e;break;case"keyPosition":i.keyPosition=e;break;case"textColor":i.textColor=e;break;case"bar":i.bar=e;break;case"fontSize":i.fontSize=e;break;case"gridAxes":i.gridAxes=e;break;case"interactiveMode":i.interactiveMode=e;break;case"keyOffset":i.keyOffset=e;break;case"origin":i.origin=e;break;case"threeDimensional":i.threeDimensional=e;break;case"title":i.title=e;break;case"titleOffset":i.titleOffset=e;break;case"width":i.width=e;break;case"viewAngleXY":i.viewAngleXY=e;break;case"viewAngleYZ":i.viewAngleYZ=e;break;case"x1_axis":case"x2_axis":case"y1_axis":case"y2_axis":case"z1_axis":case"z2_axis":i.axes[t.substring(0,2)].configure(e);break;case"z_index":i.z_index=e;break;default:throw"Unrecognised graph setting "+t}})},Ht.prototype.cleanWorkspace=function(){this.workspace=[],this.workspace.aspect=this.aspect,this.workspace.aspectZ=this.aspectZ,null===this.aspect&&(this.threeDimensional?this.workspace.aspect=1:this.workspace.aspect=2/(1+Math.sqrt(5))),this.workspace.aspect*=-1,this.workspace.defaultColorCounter=0,this.workspace.defaultLineTypeCounter=0,this.workspace.defaultPointTypeCounter=0,this.workspace.plotter=null,this.workspace.axis_length=null,this.workspace.axis_bearing=null,this.workspace.width_pixels=1024,null!==this.page&&(null===this.width?this.threeDimensional?this.workspace.width_pixels=Math.min(.5*this.page.page_width,this.page.page_width-160):this.workspace.width_pixels=Math.min(.85*this.page.page_width,this.page.page_width-120):isNaN(this.width)?"%"!==this.width.charAt(this.width.length-1)||null===this.page||isNaN(this.width.substring(0,this.width.length-1))?this.page.workspace.errorLog+="Graph width of <"+this.width+"> could not be parsed.\n":this.workspace.width_pixels=.01*parseFloat(this.width.substring(0,this.width.length-1))*this.page.page_width:this.workspace.width_pixels=parseFloat(this.width))},Ht.prototype.insertDefaultStyles=function(t){null===t.color&&(t.color=this.page.styling.defaultColors[this.workspace.defaultColorCounter],this.workspace.defaultColorCounter++,this.workspace.defaultColorCounter>=this.page.styling.defaultColors.length-1&&(this.workspace.defaultColorCounter=0)),null===t.lineType&&(t.lineType=this.workspace.defaultLineTypeCounter,this.workspace.defaultLineTypeCounter++),null===t.pointType&&(t.pointType=this.workspace.defaultPointTypeCounter,this.workspace.defaultPointTypeCounter++,this.workspace.defaultPointTypeCounter>=this.page.styling.pointTypes.length-1&&(this.workspace.defaultPointTypeCounter=0))},Ht.prototype.project3d=function(t,e,i){var s=this.workspace.width_pixels*(t-.5),t=this.workspace.width_pixels*this.workspace.aspect*(e-.5),e=this.workspace.width_pixels*this.workspace.aspectZ*(i-.5),i=s*Math.cos(this.viewAngleXY*Math.PI/180)+t*Math.sin(this.viewAngleXY*Math.PI/180),s=-s*Math.sin(this.viewAngleXY*Math.PI/180)+t*Math.cos(this.viewAngleXY*Math.PI/180),t=e,e=i,i=s*Math.cos(this.viewAngleYZ*Math.PI/180)-t*Math.sin(this.viewAngleYZ*Math.PI/180),t=s*Math.sin(this.viewAngleYZ*Math.PI/180)+t*Math.cos(this.viewAngleYZ*Math.PI/180);return{xpos:this.origin[0]+e,ypos:this.origin[1]+t,depth:i}},Ht.prototype.projectPoint=function(t,e,i,s,a,o,n){var h=this.workspace.width_pixels,r=this.workspace.width_pixels*this.workspace.aspect,s=s.getPosition(t,!0),t=a.getPosition(e,!0),a=.5,e={xap:s,yap:t,zap:a};return this.threeDimensional&&(a=o.getPosition(i,!0)),!(isFinite(s)&&isFinite(t)&&isFinite(a))||!n&&(s<0||1<s||t<0||1<t||a<0||1<a)?{xpos:NaN,ypos:NaN,xap:NaN,yap:NaN,zap:NaN}:(this.threeDimensional?(i=this.project3d(s,t,a),e.xpos=i.xpos,e.ypos=i.ypos,e.depth=i.depth,n=Math.atan2(Math.cos(this.viewAngleXY*Math.PI/180),-Math.sin(this.viewAngleXY*Math.PI/180)*Math.sin(this.viewAngleYZ*Math.PI/180)),a=Math.atan2(Math.sin(this.viewAngleXY*Math.PI/180),Math.cos(this.viewAngleXY*Math.PI/180)*Math.sin(this.viewAngleYZ*Math.PI/180)),i=Math.atan2(0,Math.cos(this.viewAngleYZ*Math.PI/180)),isFinite(n)||(n=0),isFinite(a)||(a=0),isFinite(i)||(i=0),e.theta_x=n,e.theta_y=a,e.theta_z=i):(e.xpos=this.origin[0]+h*s,e.ypos=this.origin[1]+r*t,e.depth=0,e.theta_x=Math.PI/2,e.theta_y=0,e.theta_z=0),e)},Ht.prototype.calculateDataRanges=function(t){var e,i,s=this;if(this.page=t,this.cleanWorkspace(),this.workspace.plotter=new Yt(t,this),this.workspace.axis_length=[this.workspace.width_pixels,Math.abs(this.workspace.width_pixels*this.workspace.aspect),Math.abs(this.workspace.width_pixels*this.workspace.aspectZ)],this.workspace.axis_bearing=[0<this.workspace.width_pixels?Math.PI/2:3*Math.PI/2,0<this.workspace.width_pixels*this.workspace.aspect?0:Math.PI,0],this.threeDimensional)for(e=0;e<3;e++){var a=this.project3d(0===e?0:.5,1===e?0:.5,2===e?0:.5),o=this.project3d(0===e?1:.5,1===e?1:.5,2===e?1:.5);this.workspace.axis_length[e]=Math.hypot(o.xpos-a.xpos,o.ypos-a.ypos),this.workspace.axis_bearing[e]=Math.atan2(o.xpos-a.xpos,o.ypos-a.ypos),isFinite(this.workspace.axis_length[e])||(this.workspace.axis_length[e]=0),isFinite(this.workspace.axis_bearing[e])||(this.workspace.axis_bearing[e]=0)}for(e=0;e<3;e++)for(var n=this.workspace.axis_length[e]/(50+50*Math.abs(Math.sin(this.workspace.axis_bearing[e]))),h=this.workspace.axis_length[e]/20,r=0;r<2;r++){var _=["x","y","z"][e]+(r+1);this.axes[_].cleanWorkspace(),this.axes[_].workspace.target_number_major_ticks=n,this.axes[_].workspace.target_number_minor_ticks=h}for(e=0;e<3;e++)for(r=0;r<2;r++)i=["x","y","z"][e]+(r+1),this.axes[i].linkedAxisForwardPropagate(s.page,0);$.each(this.dataSets,function(t,e){e.cleanWorkspace(),e.workspace.styleFinal=e.style.clone(),s.insertDefaultStyles(e.workspace.styleFinal),e.workspace.requiredColumns=s.workspace.plotter.data_columns_required(e.workspace.styleFinal.plotStyle),$.each(e.axes,function(t,e){s.axes[e].workspace.activeFinal=!0}),s.workspace.plotter.update_axis_usage(e,e.workspace.styleFinal.plotStyle,s.axes[e.axes[1]],s.axes[e.axes[2]],s.axes[e.axes[3]]),s.axes[e.axes[1]].linkedAxisBackPropagate(s.page),s.axes[e.axes[2]].linkedAxisBackPropagate(s.page),s.axes[e.axes[3]].linkedAxisBackPropagate(s.page)}),$.each(this.axes,function(t,e){e.workspace.rangeFinalised||e.linkedAxisForwardPropagate(s.page,1),null===e.workspace.tickListFinal&&e.ticking_allocator.process()})},Ht.prototype.calculateBoundingBox=function(){for(var t,e=new JSPlot_BoundingBox,i=Math.max(60,this.axes.y1.workspace.max_tick_label_width+20+(null!==this.axes.y1.label?20:0)),s=Math.max(20,this.axes.y2.workspace.max_tick_label_width+20+(null!==this.axes.y2.label?20:0)),a=Math.max(60,this.axes.x1.workspace.max_tick_label_width+20+(null!==this.axes.x1.label?20:0)),o=Math.max(20,this.axes.x2.workspace.max_tick_label_width+20+(null!==this.axes.x2.label?20:0)),n=null,h=0;h<=1;h+=1)for(var r=0;r<=1;r+=1)for(var _=0;_<=1;_+=1)n=this.threeDimensional?this.project3d(h,r,_):{xpos:this.origin[0]+h*this.workspace.width_pixels,ypos:this.origin[1]+r*this.workspace.width_pixels*this.workspace.aspect},e.includePoint(n.xpos-i,n.ypos-o),e.includePoint(n.xpos+s,n.ypos+a);return this.threeDimensional&&"rotate"===this.interactiveMode&&(t=Math.max(this.workspace.width_pixels,Math.abs(this.workspace.width_pixels*this.workspace.aspect),Math.abs(this.workspace.width_pixels*this.workspace.aspectZ))*Math.sqrt(3)/2,e.includePoint(this.origin[0]-t-i,this.origin[1]-t-o),e.includePoint(this.origin[0]+t+s,this.origin[1]+t+a)),e},Ht.prototype.render=function(){var i=this,t=[this.workspace.width_pixels,this.workspace.width_pixels*this.workspace.aspect,this.workspace.width_pixels*this.workspace.aspectZ],e=new JSPlot_BoundingBox;if(this.grid_lines_paint(),this.axes_paint(!1,e),this.clip)if(this.threeDimensional){for(var s=[],a=0;a<8;a++){var o=Ie(0!=(1&a)),n=Ie(0!=(2&a)),h=Ie(0!=(4&a)),h=this.project3d(o,n,h);s.push([h.xpos-this.origin[0],h.ypos-this.origin[1]])}for(s.sort(function(t,e){return Math.hypot(t[0],t[1])-Math.hypot(e[0],e[1])}),s.shift(),s.shift(),s.sort(function(t,e){return Math.atan2(t[0],t[1])-Math.atan2(e[0],e[1])}),i.page.canvas._beginPath(),i.page.canvas._moveTo(s[0][0]+i.origin[0],s[0][1]+i.origin[1]),a=1;a<s.length;a++)i.page.canvas._lineTo(s[a][0]+i.origin[0],s[a][1]+i.origin[1]);i.page.canvas._setClip()}else i.page.canvas._beginPath(),i.page.canvas._moveTo(i.origin[0],i.origin[1]),i.page.canvas._lineTo(i.origin[0]+t[0],i.origin[1]),i.page.canvas._lineTo(i.origin[0]+t[0],i.origin[1]+t[1]),i.page.canvas._lineTo(i.origin[0],i.origin[1]+t[1]),i.page.canvas._setClip();i.threeDimensional&&i.page.threeDimensionalBuffer.activate(),$.each(this.dataSets,function(t,e){i.workspace.plotter.renderDataSet(i,e,e.workspace.styleFinal.plotStyle,e.axes[1],e.axes[2],e.axes[3])}),i.render_annotations(),i.page.threeDimensionalBuffer.deactivate(),i.clip&&i.page.canvas._unsetClip(),this.axes_paint(!0,e),null!==i.title&&""!==i.title&&i.textColor.isVisible()&&(i.page.canvas._fillStyle(i.textColor.toHTML()),i.page.canvas._text(i.origin[0]+t[0]/2,e.top,0,1,1,i.title,0,0))},Ht.prototype.render_annotations=function(){var i=this,s=[];$.each(this.annotations,function(t,e){s.push([e.fetch_z_index(i),e])}),s.sort(function(t,e){return t[0]>e[0]?-1:1}),$.each(s,function(t,e){e[1].render(i)})},Ht.prototype.axes_paint=function(l,c){var p,d,t,u,f,g=this;function m(t,n,h,r,e,_){$.each(t,function(t,e){var i=n[e][0],s=n[e][1],e=(i.depth+s.depth)/2;if(!g.threeDimensional||l===0<e){for(var e=Math.atan2((i.xpos+s.xpos)/2-u,(i.ypos+s.ypos)/2-f)-g.workspace.axis_bearing[h],e=0<Math.sin(e),a=[],o=0;o<3;o++)2===o&&!g.threeDimensional||h===o||a.push(g.workspace.axis_bearing[o]+(0<i.axis_pos[o]?Math.PI:0));r.render(g.page,e,i.xpos,i.ypos,i.depth,s.xpos,s.ypos,s.depth,a,_&&0===t)}})}(this.threeDimensional||l)&&(p=(f=u=0)<this.workspace.width_pixels?1:-1,d=0<this.workspace.width_pixels*this.workspace.aspect?1:-1,f=this.threeDimensional?(t=this.project3d(.5,.5,.5),u=t.xpos,t.ypos):(u=this.origin[0]+this.workspace.axis_length[0]/2*p,this.origin[1]+this.workspace.axis_length[1]/2*d),$.each(this.axes,function(t,e){e.workspace.crossedAtZero=!1,"1"===t[1]&&("x"!==t[0]&&g.axes.x1.atZero&&(e.workspace.crossedAtZero=!0),"y"!==t[0]&&g.axes.y1.atZero&&(e.workspace.crossedAtZero=!0),"z"!==t[0]&&g.axes.z1.atZero&&(e.workspace.crossedAtZero=!0))}),$.each(["x","y","z"],function(i,s){if("z"!==s||g.threeDimensional){for(var t,e,a={},o=0;o<=1;o+=1)for(var n=0;n<=1;n+=1)for(var h=0;h<=1;h+=1){var r=g.threeDimensional?g.project3d(o,n,h):{xpos:g.origin[0]+o*g.workspace.axis_length[0]*p,ypos:g.origin[1]+n*g.workspace.axis_length[1]*d,depth:0};r.axis_pos=[o,n,h];var _="";"x"!==s&&(_+=o.toString()),"y"!==s&&(_+=n.toString()),"z"!==s&&(_+=h.toString()),a.hasOwnProperty(_)||(a[_]=[]),a[_].push(r),c.includePoint(r.xpos,r.ypos)}$.each(g.axes,function(t,e){t[0]===s&&e.enabled&&e.visible&&(e.workspace.atZero||m("1"===t[1]?g.threeDimensional?["00","01"]:["00"]:g.threeDimensional?["10","11"]:["10"],a,i,e,0,!0))}),g.axes[s+"1"].mirror||g.axes[s+"2"].enabled||(t=g.threeDimensional?["10","11"]:["10"],e=g.axes[s+"1"],m(t,a,i,e,0,!1))}}))},Ht.prototype.grid_lines_paint=function(){var t,e,i,s,r=this,_=[0,0,0];this.threeDimensional&&(t=r.project3d(.5,.5,.5),e=r.project3d(1,.5,.5),i=r.project3d(.5,1,.5),s=r.project3d(.5,.5,1),_[0]=Ie(t.depth>e.depth),_[1]=Ie(t.depth>i.depth),_[2]=Ie(t.depth>s.depth)),$.each(r.gridAxes,function(t,n){var h=r.axes[n];("z"!==n.charAt(0)||r.threeDimensional)&&h.workspace.activeFinal&&null!==h.workspace.tickListFinal&&$.each(["major","minor"],function(t,e){"major"===e?r.page.canvas._strokeStyle(r.gridMajorColor.toHTML(),r.page.constants.GRID_MAJLINEWIDTH):r.page.canvas._strokeStyle(r.gridMinorColor.toHTML(),r.page.constants.GRID_MINLINEWIDTH);e=h.workspace.tickListFinal[e];$.each(e,function(t,e){var i,s,a,o=h.getPosition(e[0],!0);o<.001||.999<o||(r.page.canvas._beginPath(),r.threeDimensional?(s=[[1,2],[0,2],[0,1]][i={x:0,y:1,z:2}[n.substr(0,1)]],a=null,(e=[0,0,0])[i]=o,e[s[0]]=_[s[0]],e[s[1]]=0,a=r.project3d(e[0],e[1],e[2]),r.page.canvas._moveTo(a.xpos,a.ypos),e[s[1]]=1,a=r.project3d(e[0],e[1],e[2]),r.page.canvas._lineTo(a.xpos,a.ypos),e[s[1]]=_[s[1]],e[s[0]]=0,a=r.project3d(e[0],e[1],e[2]),r.page.canvas._moveTo(a.xpos,a.ypos),e[s[0]]=1,a=r.project3d(e[0],e[1],e[2]),r.page.canvas._lineTo(a.xpos,a.ypos)):"x"===n.charAt(0)?(r.page.canvas._moveTo(r.origin[0]+o*r.workspace.width_pixels,r.origin[1]),r.page.canvas._lineTo(r.origin[0]+o*r.workspace.width_pixels,r.origin[1]+r.workspace.width_pixels*r.workspace.aspect)):(r.page.canvas._moveTo(r.origin[0],r.origin[1]+o*r.workspace.width_pixels*r.workspace.aspect),r.page.canvas._lineTo(r.origin[0]+r.workspace.width_pixels,r.origin[1]+o*r.workspace.width_pixels*r.workspace.aspect)),r.page.canvas._stroke())})})})},Ht.prototype.interactive_scroll=function(i,s){var a=this;"pan"===this.interactiveMode?($.each(this.axes,function(t,e){t=t.substring(0,1);"x"===t&&e.interactive_scroll(a.page,i/a.workspace.axis_length[0],!1),"y"===t&&e.interactive_scroll(a.page,s/a.workspace.axis_length[1],!1)}),$.each(this.dataSets,function(t,e){var i=e.axes[1],s=a.axes[i],i=s.min,s=s.max;null!==i&&null!==s&&e.axisRangeUpdated(i,s)}),this.page.needs_refresh=!0):"rotate"===this.interactiveMode&&(this.viewAngleXY+=180*i/this.workspace.width_pixels,this.viewAngleYZ+=180*s/this.workspace.width_pixels,90<this.viewAngleYZ&&(this.viewAngleYZ=90),this.viewAngleYZ<-90&&(this.viewAngleYZ=-90),this.viewAngleXY<0&&(this.viewAngleXY+=360),360<this.viewAngleXY&&(this.viewAngleXY-=360),this.page.needs_refresh=!0)},Ht.prototype.interactive_zoom=function(i){var a=this,s=!1;return $.each(this.axes,function(t,e){s|=e.interactive_zoom(a.page,i)}),$.each(this.dataSets,function(t,e){var i=e.axes[1],s=a.axes[i],i=s.min,s=s.max;null!==i&&null!==s&&e.axisRangeUpdated(i,s)}),s},Gt.prototype.findCrossingPoints=function(c,p,d,t,e,i,u,f,g,s,a,o){var n=0<=t&&t<=1&&0<=e&&e<=1&&0<=i&&i<=1,h=0<=s&&s<=1&&0<=a&&a<=1&&0<=o&&o<=1,m={cx1:c,cy1:p,cz1:d,cx2:u,cy2:f,cz2:g,inside1_initial:n,inside2_initial:h,inside1_final:n,inside2_final:h};if(m.inside1&&m.inside2)return m;function r(t,e,i,s){if(e[i]!==t[i]){var a=(s-t[i])/(e[i]-t[i]);if(0<=a&&a<=1){for(var o=[0,0,0],n=!0,h=0;h<3;h++){var r=t[h]+(e[h]-t[h])*a,_=[c,p,d][h],l=[u,f,g][h];o[h]=_+(l-_)*a,h!==i&&(r<0||1<r)&&(n=!1)}n&&((s<.5&&t[i]<0||.5<s&&1<t[i])&&(m.cx1=o[0],m.cy1=o[1],m.cz1=o[2],m.inside1_final=!0),(s<.5&&e[i]<0||.5<s&&1<e[i])&&(m.cx2=o[0],m.cy2=o[1],m.cz2=o[2],m.inside2_final=!0))}}}for(var _=0;_<3;_++)r([t,e,i],[s,a,o],_,0),r([t,e,i],[s,a,o],_,1);return m},Gt.prototype.point=function(t,e,i,s,a,o,n,h,r){var _=this,l=this.graph.projectPoint(t,e,i,this.axis_x,this.axis_y,this.axis_z,!0);isFinite(l.xpos)&&isFinite(l.ypos)&&isFinite(l.depth)?(n={position:l,x_offset:s,y_offset:a,z_offset:o,x_perp_offset:n,y_perp_offset:h,z_perp_offset:r},null!==this.pt_old&&(h=function(t,e,i,s){e+=t.x_offset*Math.cos(l.theta_x)+t.y_offset*Math.cos(l.theta_y)+t.z_offset*Math.cos(l.theta_z)+t.x_perp_offset*Math.cos(l.theta_x+Math.PI/2)+t.y_perp_offset*Math.cos(l.theta_y+Math.PI/2)+t.z_perp_offset*Math.cos(l.theta_z+Math.PI/2),t=i+(t.x_offset*Math.sin(l.theta_x)+t.y_offset*Math.sin(l.theta_y)+t.z_offset*Math.sin(l.theta_z)+t.x_perp_offset*Math.sin(l.theta_x+Math.PI/2)+t.y_perp_offset*Math.sin(l.theta_y+Math.PI/2)+t.z_perp_offset*Math.sin(l.theta_z+Math.PI/2));_.point_list_in_progress.push([e,t,s])},(r=this.findCrossingPoints(this.pt_old.position.xpos,this.pt_old.position.ypos,this.pt_old.position.depth,this.pt_old.position.xap,this.pt_old.position.yap,this.pt_old.position.zap,l.xpos,l.ypos,l.depth,l.xap,l.yap,l.zap)).inside1_final&&r.inside2_final&&(0===this.point_list_in_progress.length&&h(this.pt_old,r.cx1,r.cy1,r.cz1),h(n,r.cx2,r.cy2,r.cz2))),this.pt_old=n):this.penUp()},Gt.prototype.penUp=function(){this.pt_old=null,1<this.point_list_in_progress.length&&this.line_list.push(this.point_list_in_progress),this.point_list_in_progress=[]},Gt.prototype.renderLine=function(){var t,e,i=this;if(this.page.threeDimensionalBuffer.active)for(t=0;t<this.line_list.length;t++)for(e=1;e<this.line_list[t].length;e++){var s=i.line_list[t][e][2],a=function(t,e){return function(){i.page.canvas._strokeStyle(i.color,i.line_width),i.page.canvas._beginPath(),i.page.canvas._moveTo(i.line_list[t][e-1][0],i.line_list[t][e-1][1]),i.page.canvas._lineTo(i.line_list[t][e][0],i.line_list[t][e][1]),i.page.canvas._stroke()}}(t,e);this.page.threeDimensionalBuffer.addItem(s,a)}else{for(i.page.canvas._strokeStyle(this.color,this.line_width),i.page.canvas._beginPath(),t=0;t<this.line_list.length;t++)for(i.page.canvas._moveTo(this.line_list[t][0][0],this.line_list[t][0][1]),e=1;e<this.line_list[t].length;e++)i.page.canvas._lineTo(this.line_list[t][e][0],this.line_list[t][e][1]);i.page.canvas._stroke()}},Bt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"axis_x":i.axis_x=e;break;case"axis_y":i.axis_y=e;break;case"axis_z":i.axis_z=e;break;case"color":i.color=e;break;case"fontSize":i.fontSize=e;break;case"fontFamily":i.fontFamily=e;break;case"fontStyle":i.fontStyle=e;break;case"fontWeight":i.fontWeight=e;break;case"h_align":i.h_align=e;break;case"position":i.position=e;break;case"text":i.text=e;break;case"v_align":i.v_align=e;break;case"z_index":i.z_index=e;break;default:throw"Unrecognised text item setting "+t}})},Bt.prototype.render=function(t){var e,i,s=t.page;null!==this.color&&(e=0,"left"===this.h_align&&(e=-1),"right"===this.h_align&&(e=1),i=0,"top"===this.v_align&&(i=1),"bottom"===this.v_align&&(i=-1),t=t.projectPoint(this.position[0],this.position[1],t.threeDimensional?this.position[2]:0,this.axis_x,this.axis_y,this.axis_z,!0),s.canvas._textStyle(this.fontFamily,this.fontSize,this.fontWeight,this.fontStyle),s.canvas._fillStyle(this.color.toHTML()),s.canvas._text(t.xpos,t.ypos,e,i,!0,this.text,!1,!1))},Bt.prototype.fetch_z_index=function(t){t.page;return t.threeDimensional?-t.projectPoint(this.position[0],this.position[1],this.position[2],this.axis_x,this.axis_y,this.axis_z,!0)[2]:this.z_index},Jt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"axis_x":i.axis_x=e;break;case"axis_y":i.axis_y=e;break;case"axis_z":i.axis_z=e;break;case"arrowType":i.arrowType=e;break;case"color":i.color=e;break;case"strokeLineWidth":i.strokeLineWidth=e;break;case"origin":i.origin=e;break;case"target":i.target=e;break;case"z_index":i.z_index=e;break;default:throw"Unrecognised arrow setting "+t}})},Jt.prototype.render=function(t){var e,i=t.page;null!==this.color&&(e=t.projectPoint(this.origin[0],this.origin[1],t.threeDimensional?this.origin[2]:0,this.axis_x,this.axis_y,this.axis_z,!0),t=t.projectPoint(this.target[0],this.target[1],t.threeDimensional?this.target[2]:0,this.axis_x,this.axis_y,this.axis_z,!0),(new Wt).primitive_arrow(i,this.arrowType,e.xpos,e.ypos,e.zpos,t.xpos,t.ypos,t.zpos,this.color,this.strokeLineWidth,1))},Jt.prototype.fetch_z_index=function(t){if(t.threeDimensional){var e=t.projectPoint(this.origin[0],this.origin[1],this.origin[2],this.axis_x,this.axis_y,this.axis_z,!0),t=t.projectPoint(this.target[0],this.target[1],this.target[2],this.axis_x,this.axis_y,this.axis_z,!0);return-(e[2]+t[2])/2}return this.z_index},qt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"color":i.color=e;break;case"fillColor":i.fillColor=e;break;case"plotStyle":i.plotStyle=e;break;case"lineType":i.lineType=e;break;case"pointType":i.pointType=e;break;case"lineWidth":i.lineWidth=e;break;case"pointLineWidth":i.pointLineWidth=e;break;case"pointSize":i.pointSize=e;break;default:throw"Unrecognised plot style setting "+t}})},qt.prototype.clone=function(){var t=new qt({});return null===this.color?t.color=this.color:t.color=new Ft(this.color.red,this.color.green,this.color.blue,this.color.alpha),null===this.fillColor?t.fillColor=this.fillColor:t.fillColor=new Ft(this.fillColor.red,this.fillColor.green,this.fillColor.blue,this.fillColor.alpha),t.plotStyle=this.plotStyle,t.lineType=this.lineType,t.pointType=this.pointType,t.lineWidth=this.lineWidth,t.pointLineWidth=this.pointLineWidth,t.pointSize=this.pointSize,t},Yt.prototype.data_columns_required=function(t){var e=this.graph.threeDimensional;return"points"===t||"lines"===t||"linespoints"===t?2+(e?1:0):"xerrorbars"===t||"yerrorbars"===t?3+(e?1:0):"zerrorbars"===t?4:"xyerrorbars"===t?4+(e?1:0):"xzerrorbars"===t||"yzerrorbars"===t?5:"xyzerrorbars"===t?6:"xerrorrange"===t||"yerrorrange"===t?4+(e?1:0):"zerrorrange"===t?5:"xyerrorrange"===t?6+(e?1:0):"xzerrorrange"===t||"yzerrorrange"===t?7:"xyzerrorrange"===t?9:"upperlimits"===t||"lowerlimits"===t||"dots"===t||"impulses"===t?2+(e?1:0):"boxes"===t?2:"wboxes"===t?3:"steps"===t||"fsteps"===t||"histeps"===t?2:"arrows_head"===t||"arrows_nohead"===t||"arrows_twohead"===t?4+2*(e?1:0):"surface"===t?3:(this.page.workspace.errorLog+="Unrecognised style type passed to <data_columns_required>\n",-1)},Yt.prototype.update_axis_usage=function(t,i,s,a,o){var n=this,h=this.graph.threeDimensional;if("boxes"!==i&&"impulses"!==i||null===this.graph.boxFrom||a.includePoint(this.graph.boxFrom),"boxes"===i||"steps"===i||"fsteps"===i||"histeps"===i)if("boxes"===i&&null!==this.graph.boxWidth)$.each(t.data,function(t,e){s.inRange(e[0])&&a.inRange(e[1])&&(s.logarithmic?(s.includePoint(e[0]/Math.sqrt(n.graph.boxWidth)),s.includePoint(e[0]*Math.sqrt(n.graph.boxWidth))):(s.includePoint(e[0]-n.graph.boxWidth/2),s.includePoint(e[0]+n.graph.boxWidth/2)),a.includePoint(e[1]))});else for(var e=0;e<t.data.length;e++){var r=null,_=null;0<e&&(r="boxes"===i||"histeps"===i?s.logarithmic?Math.sqrt(t.data[e][0]/t.data[e-1][0]):(t.data[e][0]-t.data[e-1][0])/2:"steps"===i?s.logarithmic?t.data[e][0]/t.data[e-1][0]:t.data[e][0]-t.data[e-1][0]:s.logarithmic?1:0),e<t.data.length-1&&(_="boxes"===i||"histeps"===i?s.logarithmic?Math.sqrt(t.data[e+1][0]/t.data[e][0]):(t.data[e+1][0]-t.data[e][0])/2:"steps"===i?s.logarithmic?1:0:s.logarithmic?t.data[e+1][0]/t.data[e][0]:t.data[e+1][0]-t.data[e][0]),null===r&&null===_?r=_=.5:null===r?r=_:null===_&&(_=r),s.logarithmic?(s.includePoint(t.data[e][0]/r),s.includePoint(t.data[e][0]*_)):(s.includePoint(t.data[e][0]-r),s.includePoint(t.data[e][0]+_)),a.includePoint(t.data[e][1])}return $.each(t.data,function(t,e){"points"===i||"lines"===i||"linespoints"===i||"lowerlimits"===i||"upperlimits"===i||"dots"===i?s.inRange(e[0])&&a.inRange(e[1])&&(!h||o.inRange(e[2]))&&(s.includePoint(e[0]),a.includePoint(e[1]),h&&o.includePoint(e[2])):"xerrorbars"===i?a.inRange(e[1])&&!h&&o.inRange(e[2])&&(s.inRange(e[0]-e[2+h])||s.inRange(e[0])||s.inRange(e[0]+e[2+h]))&&(s.includePoint(e[0]),s.includePoint(e[0]-e[2+h]),s.includePoint(e[0]+e[2+h]),a.includePoint(e[1]),h&&o.includePoint(e[2])):"yerrorbars"===i?s.inRange(e[0])&&!h&&o.inRange(e[2])&&(a.inRange(e[1]-e[2+h])||a.inRange(e[1])||a.inRange(e[1]+e[2+h]))&&(s.includePoint(e[0]),a.includePoint(e[1]),a.includePoint(e[1]-e[2+h]),a.includePoint(e[1]+e[2+h]),h&&o.includePoint(e[2])):"zerrorbars"===i?s.inRange(e[0])&&a.inRange(e[1])&&(o.inRange(e[2])||o.inRange(e[2]-e[3])||o.inRange(e[2]+e[3]))&&(s.includePoint(e[0]),a.includePoint(e[1]),o.includePoint(e[2]),o.includePoint(e[2]-e[3]),o.includePoint(e[2]+e[3])):"xyerrorbars"===i?h&&!o.inRange(e[2])||!(s.inRange(e[0])&&a.inRange(e[1]-e[3+h])||s.inRange(e[0])&&a.inRange(e[1])||s.inRange(e[0])&&a.inRange(e[1]+e[3+h])||s.inRange(e[0]-e[2+h])&&a.inRange(e[1])||s.inRange(e[0]+e[2+h])&&a.inRange(e[1]))||(s.includePoint(e[0]),s.includePoint(e[0]-e[2+h]),s.includePoint(e[0]+e[2+h]),a.includePoint(e[1]),a.includePoint(e[1]-e[3+h]),a.includePoint(e[1]+e[3+h]),h&&o.includePoint(e[2])):"xzerrorbars"===i?a.inRange(e[1])&&(s.inRange(e[0])&&o.inRange(e[2]-e[4])||s.inRange(e[0])&&o.inRange(e[2])||s.inRange(e[0])&&o.inRange(e[2]+e[4])||s.inRange(e[0]-e[3])&&o.inRange(e[2])||s.inRange(e[0]+e[3])&&o.inRange(e[2]))&&(s.includePoint(e[0]),s.includePoint(e[0]-e[3]),s.includePoint(e[0]+e[3]),a.includePoint(e[1]),o.includePoint(e[2]),o.includePoint(e[2]-e[4]),o.includePoint(e[2]+e[4])):"yzerrorbars"===i?s.inRange(e[0])&&(a.inRange(e[1])&&o.inRange(e[2]-e[4])||a.inRange(e[1])&&o.inRange(e[2])||a.inRange(e[1])&&o.inRange(e[2]+e[4])||a.inRange(e[1]-e[3])&&o.inRange(e[2])||a.inRange(e[1]+e[3])&&o.inRange(e[2]))&&(s.includePoint(e[0]),a.includePoint(e[1]),a.includePoint(e[1]-e[3]),a.includePoint(e[1]+e[3]),o.includePoint(e[2]),o.includePoint(e[2]-e[4]),o.includePoint(e[2]+e[4])):"xyzerrorbars"===i?(s.inRange(e[0])&&a.inRange(e[1])&&o.inRange(e[2]-e[5])||s.inRange(e[0])&&a.inRange(e[1])&&o.inRange(e[2])||s.inRange(e[0])&&a.inRange(e[1])&&o.inRange(e[2]+e[5])||s.inRange(e[0])&&a.inRange(e[1]-e[4])&&o.inRange(e[2])||s.inRange(e[0])&&a.inRange(e[1]+e[4])&&o.inRange(e[2])||s.inRange(e[0]-e[3])&&a.inRange(e[1])&&o.inRange(e[2])||s.inRange(e[0]+e[3])&&a.inRange(e[1])&&o.inRange(e[2]))&&(s.includePoint(e[0]),s.includePoint(e[0]-e[3]),s.includePoint(e[0]+e[3]),a.includePoint(e[1]),a.includePoint(e[1]-e[4]),a.includePoint(e[1]+e[4]),o.includePoint(e[2]),o.includePoint(e[2]-e[5]),o.includePoint(e[2]+e[5])):"xerrorrange"===i?a.inRange(e[1])&&(!h||o.inRange(e[2]))&&(s.inRange(e[2+h])||s.inRange(e[0])||s.inRange(e[3+h]))&&(s.includePoint(e[0]),a.includePoint(e[1]),s.includePoint(e[2+h]),s.includePoint(e[3+h]),h&&o.includePoint(e[2])):"yerrorrange"===i?s.inRange(e[0])&&(!h||o.inRange(e[2]))&&(a.inRange(e[2+h])||a.inRange(e[1])||a.inRange(e[3+h]))&&(s.includePoint(e[0]),a.includePoint(e[1]),a.includePoint(e[2+h]),a.includePoint(e[3+h]),h&&o.includePoint(e[2])):"zerrorrange"===i?s.inRange(e[0])&&a.inRange(e[1])&&(o.inRange(e[2])||o.inRange(e[3])||o.inRange(e[4]))&&(s.includePoint(e[0]),a.includePoint(e[1]),o.includePoint(e[2]),o.includePoint(e[3]),o.includePoint(e[4])):"xyerrorrange"===i?h&&!o.inRange(e[2])||!(s.inRange(e[0])&&a.inRange(e[4+h])||s.inRange(e[0])&&a.inRange(e[1])||s.inRange(e[0])&&a.inRange(e[5+h])||s.inRange(e[2+h])&&a.inRange(e[1])||s.inRange(e[3+h])&&a.inRange(e[1]))||(s.includePoint(e[0]),a.includePoint(e[1]),s.includePoint(e[2+h]),s.includePoint(e[3+h]),a.includePoint(e[4+h]),a.includePoint(e[5+h]),h&&o.includePoint(e[2])):"xzerrorrange"===i?a.inRange(e[1])&&(s.inRange(e[0])&&o.inRange(e[5])||s.inRange(e[0])&&o.inRange(e[2])||s.inRange(e[0])&&o.inRange(e[6])||s.inRange(e[3])&&o.inRange(e[2])||s.inRange(e[4])&&o.inRange(e[2]))&&(a.includePoint(e[1]),s.includePoint(e[0]),s.includePoint(e[3]),s.includePoint(e[4]),o.includePoint(e[2]),o.includePoint(e[5]),o.includePoint(e[6])):"yzerrorrange"===i?s.inRange(e[0])&&(a.inRange(e[1])&&o.inRange(e[5])||a.inRange(e[1])&&o.inRange(e[2])||a.inRange(e[1])&&o.inRange(e[6])||a.inRange(e[3])&&o.inRange(e[2])||a.inRange(e[4])&&o.inRange(e[2]))&&(s.includePoint(e[0]),s.includePoint(e[3]),s.includePoint(e[4]),a.includePoint(e[1]),a.includePoint(e[5]),a.includePoint(e[6]),o.includePoint(e[2]),o.includePoint(e[7]),o.includePoint(e[8])):"xyzerrorrange"===i?(s.inRange(e[0])&&a.inRange(e[1])&&o.inRange(e[7])||s.inRange(e[0])&&a.inRange(e[1])&&o.inRange(e[2])||s.inRange(e[0])&&a.inRange(e[1])&&o.inRange(e[8])||s.inRange(e[0])&&a.inRange(e[5])&&o.inRange(e[2])||s.inRange(e[0])&&a.inRange(e[6])&&o.inRange(e[2])||s.inRange(e[3])&&a.inRange(e[1])&&o.inRange(e[2])||s.inRange(e[4])&&a.inRange(e[1])&&o.inRange(e[2]))&&(s.includePoint(e[0]),s.includePoint(e[0]-e[3]),s.includePoint(e[0]+e[3]),a.includePoint(e[1]),a.includePoint(e[1]-e[4]),a.includePoint(e[1]+e[4]),o.includePoint(e[2]),o.includePoint(e[2]-e[5]),o.includePoint(e[2]+e[5])):"impulses"===i?s.inRange(e[0])&&a.inRange(e[1])&&(!h||o.inRange(e[2]))&&(s.includePoint(e[0]),a.includePoint(e[1]),h&&o.includePoint(e[2]),a.includePoint(n.graph.boxFrom)):"wboxes"===i?a.inRange(e[1])&&(s.inRange(e[0])||s.inRange(e[0]-e[2])||s.inRange(e[0]+e[2]))&&(a.includePoint(e[1]),s.includePoint(e[0]),s.includePoint(e[0]-e[2]),s.includePoint(e[0]+e[2]),a.includePoint(n.graph.boxFrom)):"arrows_head"!==i&&"arrows_nohead"!==i&&"arrows_twohead"!==i||(s.inRange(e[0])&&a.inRange(e[1])&&(!h||o.inRange(e[2]))||s.inRange(e[2+h])&&a.inRange(e[3+h])&&(!h||o.inRange(e[5])))&&(s.includePoint(e[0]),a.includePoint(e[1]),s.includePoint(e[2+h]),a.includePoint(e[3+h]),h&&(o.includePoint(e[2]),o.includePoint(e[5])))}),0},Yt.prototype.renderDataSet=function(o,n,t,e,i,s){var a,h=this,r=o.axes[e],_=o.axes[i],l=o.axes[s];if("lines"!==t&&"linespoints"!==t||(a=new Gt(o.page,o,r,_,l,n.workspace.styleFinal.color.toHTML(),n.workspace.styleFinal.lineType,n.workspace.styleFinal.lineWidth),$.each(n.data,function(t,e){a.point(e[0],e[1],o.threeDimensional?e[2]:0,0,0,0,0,0,0)}),a.penUp(),a.renderLine()),"points"===t||"linespoints"===t){var s=n.workspace.styleFinal.pointType%this.page.styling.pointTypes.length,c=h.page.styling.pointTypes[s];$.each(n.data,function(t,e){e=o.projectPoint(e[0],e[1],o.threeDimensional?e[2]:0,r,_,l,!1);isNaN(e.xpos)||isNaN(e.ypos)||c(e.xpos,e.ypos,n.workspace.styleFinal.pointSize,n.workspace.styleFinal.pointLineWidth,n.workspace.styleFinal.color.toHTML())})}else if("boxes"===t||"steps"===t||"fsteps"===t||"histeps"===t)if("boxes"===t&&null!==this.graph.boxWidth)$.each(n.data,function(t,e){var i=r.logarithmic?(a=e[0]/Math.sqrt(h.graph.boxWidth),e[0]*Math.sqrt(h.graph.boxWidth)):(a=e[0]-h.graph.boxWidth/2,e[0]+h.graph.boxWidth/2),s=o.projectPoint(a,e[1],0,r,_,l,!0),e=o.projectPoint(i,e[1],0,r,_,l,!0),i=o.projectPoint(i,h.graph.boxFrom,0,r,_,l,!0),a=o.projectPoint(a,h.graph.boxFrom,0,r,_,l,!0);h.page.canvas._fillStyle(n.workspace.styleFinal.fillColor.toHTML()),h.page.canvas._strokeStyle(n.workspace.styleFinal.color.toHTML()),h.page.canvas._beginPath(),h.page.canvas._moveTo(s.xpos,s.ypos),h.page.canvas._lineTo(e.xpos,e.ypos),h.page.canvas._lineTo(i.xpos,i.ypos),h.page.canvas._lineTo(a.xpos,a.ypos),h.page.canvas._fill(),h.page.canvas._stroke()});else for(var p=0;p<n.data.length;p++){var d,u,f,g=null,m=null;0<p&&(g="boxes"===t||"histeps"===t?r.logarithmic?Math.sqrt(n.data[p][0]/n.data[p-1][0]):(n.data[p][0]-n.data[p-1][0])/2:"steps"===t?r.logarithmic?n.data[p][0]/n.data[p-1][0]:n.data[p][0]-n.data[p-1][0]:r.logarithmic?1:0),p<n.data.length-1&&(m="boxes"===t||"histeps"===t?r.logarithmic?Math.sqrt(n.data[p+1][0]/n.data[p][0]):(n.data[p+1][0]-n.data[p][0])/2:"steps"===t?r.logarithmic?1:0:r.logarithmic?n.data[p+1][0]/n.data[p][0]:n.data[p+1][0]-n.data[p][0]),null===g&&null===m?g=m=.5:null===g?g=m:null===m&&(m=g),f=r.logarithmic?(d=n.data[p][0]/g,n.data[p][0]*m):(d=n.data[p][0]-g,n.data[p][0]+m),u=o.projectPoint(d,n.data[p][1],0,r,_,l,!0),g=o.projectPoint(f,n.data[p][1],0,r,_,l,!0),m=o.projectPoint(f,h.graph.boxFrom,0,r,_,l,!0),f=o.projectPoint(d,h.graph.boxFrom,0,r,_,l,!0),h.page.canvas._fillStyle(n.workspace.styleFinal.fillColor.toHTML()),h.page.canvas._strokeStyle(n.workspace.styleFinal.color.toHTML()),h.page.canvas._beginPath(),h.page.canvas._moveTo(u.xpos,u.ypos),h.page.canvas._lineTo(g.xpos,g.ypos),h.page.canvas._lineTo(m.xpos,m.ypos),h.page.canvas._lineTo(f.xpos,f.ypos),h.page.canvas._fill(),h.page.canvas._stroke()}},Vt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"fillColor":i.fillColor=e;break;case"height":i.height=e;break;case"origin":i.origin=e;break;case"strokeColor":i.strokeColor=e;break;case"strokeLineWidth":i.strokeLineWidth=e;break;case"width":i.width=e;break;case"z_index":i.z_index=e;break;default:throw"Unrecognised rectangle setting "+t}})},Vt.prototype.cleanWorkspace=function(){this.workspace=[]},Vt.prototype.calculateDataRanges=function(t){this.page=t,this.cleanWorkspace()},Vt.prototype.calculateBoundingBox=function(t){var e=new JSPlot_BoundingBox;return e.includePoint(this.origin[0],this.origin[1]),e.includePoint(this.origin[0]+this.width,this.origin[1]+this.height),e},Vt.prototype.render=function(){null!==this.fillColor&&(this.page.canvas._fillStyle(this.fillColor.toHTML()),this.page.canvas._beginPath(),this.page.canvas._rect(this.origin[0],this.origin[1],this.width,this.height),this.page.canvas._fill()),null!==this.strokeColor&&(this.page.canvas._strokeStyle(this.strokeColor.toHTML(),this.strokeLineWidth),this.page.canvas._beginPath(),this.page.canvas._rect(this.origin[0],this.origin[1],this.width,this.height),this.page.canvas._stroke())},Vt.prototype.interactive_scroll=function(t,e){},Vt.prototype.interactive_zoom=function(t){return!1},Xt.prototype.setLineType=function(t,e,i,s){for(e=(e-1)%9;e<0;)e+=9;switch(e){case 0:0;break;case 1:case 2:0;break;case 3:0;break;case 4:0;break;case 5:0;break;case 6:0;break;case 7:0;break;case 8:0}this.page.canvas._strokeStyle(t,i)},Xt.prototype.getDefaultColors=function(){return[new Ft(1,0,0,1),new Ft(0,0,1,1),new Ft(0,.75,0,1),new Ft(1,0,1,1),new Ft(0,.75,.75,1),new Ft(0,0,0,1)]},Xt.prototype.getPointTypes=function(){var h=this;return[function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._arc(t,e,i,0,2*Math.PI,0),h.page.canvas._fill()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t-i,e-i),h.page.canvas._lineTo(t-i,e+i),h.page.canvas._lineTo(t+i,e+i),h.page.canvas._lineTo(t+i,e-i),h.page.canvas._fill()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t+i,e+i),h.page.canvas._lineTo(t,e-i),h.page.canvas._lineTo(t-i,e+i),h.page.canvas._fill()},function(t,e,i,s,a){var o=i*h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t,e-o);for(var n=1;n<4;n++)h.page.canvas._lineTo(t+o*Math.sin(2*Math.PI*n/4),e-o*Math.cos(2*Math.PI*n/4));h.page.canvas._fill()},function(t,e,i,s,a){var o=i*h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t,e-o);for(var n=1;n<6;n++)h.page.canvas._lineTo(t+o*Math.sin(2*Math.PI*n/6),e-o*Math.cos(2*Math.PI*n/6));h.page.canvas._fill()},function(t,e,i,s,a){var o=i*h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t,e-o);for(var n=1;n<5;n++)h.page.canvas._lineTo(t+o*Math.sin(2*Math.PI*n/5),e-o*Math.cos(2*Math.PI*n/5));h.page.canvas._fill()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t+i,e-i),h.page.canvas._lineTo(t,e+i),h.page.canvas._lineTo(t-i,e-i),h.page.canvas._fill()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t-i,e-i),h.page.canvas._lineTo(t+i,e),h.page.canvas._lineTo(t-i,e+i),h.page.canvas._fill()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._fillStyle(a),h.page.canvas._beginPath(),h.page.canvas._moveTo(t+i,e-i),h.page.canvas._lineTo(t-i,e),h.page.canvas._lineTo(t+i,e+i),h.page.canvas._fill()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t-i,e-i),h.page.canvas._lineTo(t+i,e+i),h.page.canvas._moveTo(t-i,e+i),h.page.canvas._lineTo(t+i,e-i),h.page.canvas._stroke()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t-i,e-i),h.page.canvas._lineTo(t-i,e+i),h.page.canvas._lineTo(t+i,e+i),h.page.canvas._lineTo(t+i,e-i),h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._arc(t,e,i,0,2*Math.PI,0),h.page.canvas._stroke()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t+i,e+i),h.page.canvas._lineTo(t,e-i),h.page.canvas._lineTo(t-i,e+i),h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){var o=i*h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t,e-o);for(var n=1;n<4;n++)h.page.canvas._lineTo(t+o*Math.sin(2*Math.PI*n/4),e-o*Math.cos(2*Math.PI*n/4));h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){var o=i*h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t,e-o);for(var n=1;n<6;n++)h.page.canvas._lineTo(t+o*Math.sin(2*Math.PI*n/6),e-o*Math.cos(2*Math.PI*n/6));h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){var o=i*h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t,e-o);for(var n=1;n<5;n++)h.page.canvas._lineTo(t+o*Math.sin(2*Math.PI*n/5),e-o*Math.cos(2*Math.PI*n/5));h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t+i,e-i),h.page.canvas._lineTo(t,e+i),h.page.canvas._lineTo(t-i,e-i),h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t-i,e-i),h.page.canvas._lineTo(t+i,e),h.page.canvas._lineTo(t-i,e+i),h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){i*=h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t+i,e-i),h.page.canvas._lineTo(t-i,e),h.page.canvas._lineTo(t+i,e+i),h.page.canvas._closePath(),h.page.canvas._stroke()},function(t,e,i,s,a){var o=i*h.page.constants.DEFAULT_PS;h.page.canvas._strokeStyle(a,s),h.page.canvas._beginPath(),h.page.canvas._moveTo(t,e-o);for(var n=1;n<5;n++)h.page.canvas._lineTo(t+o*Math.sin(4*Math.PI*n/5),e-o*Math.cos(4*Math.PI*n/5));h.page.canvas._closePath(),h.page.canvas._stroke()}]},Zt.prototype.configure=function(t){var i=this;$.each(t,function(t,e){switch(t){case"color":i.color=e;break;case"fontSize":i.fontSize=e;break;case"fontFamily":i.fontFamily=e;break;case"fontStyle":i.fontStyle=e;break;case"fontWeight":i.fontWeight=e;break;case"h_align":i.h_align=e;break;case"origin":i.origin=e;break;case"text":i.text=e;break;case"v_align":i.v_align=e;break;case"z_index":i.z_index=e;break;default:throw"Unrecognised text item setting "+t}})},Zt.prototype.cleanWorkspace=function(){this.workspace=[]},Zt.prototype.calculateDataRanges=function(t){this.page=t,this.cleanWorkspace()},Zt.prototype.calculateBoundingBox=function(){var t=new JSPlot_BoundingBox;return t.includePoint(this.origin[0],this.origin[1]),t},Zt.prototype.render=function(){var t,e;null!==this.color&&(t=0,"left"===this.h_align&&(t=-1),"right"===this.h_align&&(t=1),e=0,"top"===this.v_align&&(e=1),"bottom"===this.v_align&&(e=-1),this.page.canvas._textStyle(this.fontFamily,this.fontSize,this.fontWeight,this.fontStyle),this.page.canvas._fillStyle(this.color.toHTML()),this.page.canvas._text(this.origin[0],this.origin[1],t,e,!0,this.text,!1,!1))},Zt.prototype.interactive_scroll=function(t,e){},Zt.prototype.interactive_zoom=function(t){return!1},Qt.prototype.reset=function(){this.active=!1,this.buffer=[]},Qt.prototype.activate=function(){this.deactivate(),this.reset(),this.active=!0},Qt.prototype.deactivate=function(){this.buffer.sort(function(t,e){return t[0]>e[0]}),$.each(this.buffer,function(t,e){e[1]()}),this.reset()},Qt.prototype.addItem=function(t,e){this.active?this.buffer.push([t,e]):e()},Kt.prototype.process=function(){var t,e,i,s,a,h=this;this.axis.workspace.rangeFinalised||(t=null!==this.axis.workspace.minHard,e=null!==this.axis.workspace.maxHard,a=s=null,t?s=this.axis.workspace.minHard:null!==this.axis.workspace.minUsed&&(s=this.axis.workspace.minUsed),a=e?this.axis.workspace.maxHard:null!==this.axis.workspace.maxUsed?this.axis.workspace.maxUsed:null!==s?s+20:(s=0,10),Math.abs(a-s)<=1e-14*Math.max(s,a)&&(t&&e&&(this.axis.graph.page.workspace.errorLog+="Axis range set to zero. Ignoring manually set range.\n"),s-=i=Math.max(1,.001*Math.abs(s)),a+=i),i=Math.pow(10,Math.floor(Math.log10(Math.abs(a-s)/5))),s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i,this.axis.workspace.minFinal=t?this.axis.workspace.minHard:s,this.axis.workspace.maxFinal=e?this.axis.workspace.maxHard:a,this.axis.rangeReversed&&(a=this.axis.workspace.minFinal,this.axis.workspace.maxFinal=this.axis.workspace.minFinal,this.axis.workspace.minFinal=a),this.axis.workspace.rangeFinalised=!0),null===this.axis.workspace.tickListFinal&&(this.axis.workspace.tickListFinal={major:[],minor:[]},$.each(["major","minor"],function(t,i){var e=t?h.axis.ticksMinor:h.axis.ticks;if(null===e.tickList)if(null===e.tickStep)h.automatic_ticking(i);else{var t=Math.min(h.axis.workspace.minFinal,h.axis.workspace.maxFinal),s=Math.max(h.axis.workspace.minFinal,h.axis.workspace.maxFinal),a=e.tickMin;a<t&&(a+=Math.ceil((t-a)/e.tickStep)*e.tickStep);for(var o=0;o<100;o++){var n=a+o*e.tickStep;if(s<n)break;Math.abs(n)<1e-12*e.tickStep&&(n=0),h.axis.workspace.tickListFinal[i].push([n,h.numeric_display(n)])}}else $.each(e.tickList,function(t,e){h.axis.workspace.tickListFinal[i].push([parseFloat(e[0]),""+e[1]])})}))},Kt.prototype.ticking_schemes=function(t,e){for(var i=0,s=[],a=[1,2,4,5,10,20,25,50,100],o=a.length;Math.pow(10,i)<2560;){var n=t/Math.pow(10,i);if(e&&n<.9){var h=new te(this.axis),s=s.concat(h.ticking_schemes());break}for(var r=o-1;0<=r;r--){var _=a[r]*n/Math.pow(10,2);e&&1e-6<Math.abs(Math.round(_)-_)||s.push({multipliers:[1],tick_separation:_,offset:0})}i++}return s},Kt.prototype.automatic_ticking=function(i){var h=this,r=Math.min(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),_=Math.max(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),t=Math.pow(10,Math.ceil(Math.log10(_-r))),l=Math.floor(r/t)*t,c=Math.ceil(_/t)*t,p="major"===i?this.axis.workspace.target_number_major_ticks:this.axis.workspace.target_number_minor_ticks,p=Math.max(p,2);p=Math.min(p,this.max_allowed_ticks);var t=this.ticking_schemes(t,!1),d=[],u=!1;$.each(t,function(t,s){if(!u){for(var a=[],o=l+s.offset,n=0;n<(c-l)/s.tick_separation+2&&!(a.length>h.max_allowed_ticks);n++)$.each(s.multipliers,function(t,e){var i=o+n*s.tick_separation;Math.abs(i)<1e-8*s.tick_separation&&(i=0),(i*=e)<r||_<i||a.push(i)});var e=!0;"major"!==i&&$.each(h.axis.workspace.tickListFinal.major,function(t,i){var s;e&&(s=!1,$.each(a,function(t,e){s||Math.abs(i[0]-e)/(_-r)<1e-6&&(s=!0)}),s||(e=!1))}),e&&(a.length>p?u=!0:d=a)}});var s=[];$.each(d,function(t,e){s.push([e,h.numeric_display(e)])}),this.axis.workspace.tickListFinal[i]=s},Kt.prototype.numeric_display=function(t){var e,i,s,a;if(0===t)return"0";if(Math.abs(t)<1e5&&.001<Math.abs(t)){e=Math.abs(t),i=Math.pow(10,-8),s=8-Math.log10(e);for(var o=0;o<s;o++){var n=Math.round(e*Math.pow(10,o))/Math.pow(10,o);if(Math.abs(n-e)/e<i)break}return a=(a=t.toFixed(o)).replace("-","–")}for(e=Math.abs(t),e/=Math.pow(10,Math.floor(Math.log10(e))),accuracy=e*(1+Math.pow(10,-8)),o=0;o<8&&!(e-(Math.floor(e*Math.pow(10,o))/Math.pow(10,o)-e)<accuracy);o++);a=t.toExponential(o);for(var h=0;h<a.length&&"."!==a.charAt(h)&&"e"!==a.charAt(h);)h++;if("."!==a.charAt(h)&&"e"!==a.charAt(h))return a;var r=h;for("."===a.charAt(h)&&r++;!isNaN(a.charAt(r));)r++;var _=a.substr(0,r);"+"===a.charAt(r+1)&&r++;for(var t=a.substr(r+1,a.length-r-1),t="×10"+this.superscript(t),_=_.replace("-","–"),l=r-1;h<l&&"0"===_.charAt(l);)l--;return"."===(_=_.substr(0,l+1)).charAt(_.length-1)&&(_=_.substr(0,_.length-1)),"1×"===(a=_+t).substr(0,2)&&(a=a.substr(2,a.length-2)),a},Kt.prototype.superscript=function(t){var e={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻",a:"ᵃ",b:"ᵇ",c:"ᶜ",d:"ᵈ",e:"ᵉ",f:"ᶠ",g:"ᵍ",h:"ʰ",i:"ⁱ",j:"ʲ",k:"ᵏ",l:"ˡ",m:"ᵐ",n:"ⁿ",o:"ᵒ",p:"ᵖ",r:"ʳ",s:"ˢ",t:"ᵗ",u:"ᵘ",v:"ᵛ",w:"ʷ",x:"ˣ",y:"ʸ",z:"ᶻ"};return t.split("").map(function(t){t=e[t];return t||""}).join("")},te.prototype.process=function(){var t,e,i,s,a,r=this;this.axis.workspace.rangeFinalised||(t=null!==this.axis.workspace.minHard,e=null!==this.axis.workspace.maxHard,a=s=null,t?s=this.axis.workspace.minHard:null!==this.axis.workspace.minUsed&&(s=this.axis.workspace.minUsed),a=e?this.axis.workspace.maxHard:null!==this.axis.workspace.maxUsed?this.axis.workspace.maxUsed:null!==s?100*s:(s=1,10),s<=1e-200&&(this.axis.graph.page.workspace.errorLog+="Logarithmic axis range with range set below zero.\n",s=1e-10),a<=1e-200&&(this.axis.graph.page.workspace.errorLog+="Logarithmic axis range with range set below zero.\n",a=1e-10),Math.abs(a-s)<=1e-14*Math.max(s,a)&&(t&&e&&(this.axis.graph.page.workspace.errorLog+="Axis range set to zero. Ignoring manually set range.\n"),1e-300<s&&(s/=10),a<1e300&&(a*=10)),s=Math.log10(s),a=Math.log10(a),i=Math.pow(10,Math.floor(Math.log10(Math.abs(a-s)/5))),s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i,s=Math.pow(10,s),a=Math.pow(10,a),this.axis.workspace.minFinal=t?this.axis.workspace.minHard:s,this.axis.workspace.maxFinal=e?this.axis.workspace.maxHard:a,this.axis.rangeReversed&&(a=this.axis.workspace.minFinal,this.axis.workspace.maxFinal=this.axis.workspace.minFinal,this.axis.workspace.minFinal=a),this.axis.workspace.rangeFinalised=!0),null===this.axis.workspace.tickListFinal&&(this.axis.workspace.tickListFinal={major:[],minor:[]},$.each(["major","minor"],function(t,i){var e=t?r.axis.ticksMinor:r.axis.ticks;if(null===e.tickList)if(null===e.tickStep)r.automatic_ticking(i);else{var s=new Kt(r.axis),t=Math.min(r.axis.workspace.minFinal,r.axis.workspace.maxFinal),a=Math.max(r.axis.workspace.minFinal,r.axis.workspace.maxFinal),o=e.tickMin;o<t&&(o*=Math.exp(Math.ceil(Math.log(t/o)/Math.log(e.tickStep))*Math.log(e.tickStep)));for(var n=0;n<100;n++){var h=o*Math.pow(e.tickStep,n);if(a<h)break;r.axis.workspace.tickListFinal[i].push([h,s.numeric_display(h)])}}else $.each(e.tickList,function(t,e){r.axis.workspace.tickListFinal[i].push([parseFloat(e[0]),""+e[1]])})}))},te.prototype.ticking_schemes=function(){for(var t=[],e=1;;){for(var i=!1,s=[],a=null,o=0;o<e;o++){var n=Math.round(Math.pow(10,o/e));if(n===a){i=!0;break}s.push(n),a=n}if(i)break;t.push({multipliers:s,tick_separation:1,offset:0}),e++}return t.push({multipliers:[1,2,3,4,5,6,7,8,9],tick_separation:1,offset:0}),t},te.prototype.automatic_ticking=function(i){var h,r,_,l,c,p,d,s,u=this,f=Math.min(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),g=Math.max(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),t=this.axis.workspace.logFinal&&3<g/f,m=new Kt(this.axis);t?(h=Math.log10(f),r=Math.log10(g),t=Math.pow(10,Math.ceil(Math.log10(r-h))),_=Math.floor(h/t)*t,l=Math.ceil(r/t)*t,c="major"===i?this.axis.workspace.target_number_major_ticks:this.axis.workspace.target_number_minor_ticks,c=Math.max(c,2),c=Math.min(c,m.max_allowed_ticks),t=m.ticking_schemes(t,!0),d=!(p=[]),$.each(t,function(t,s){if(!d){for(var a=[],o=_+s.offset,n=0;n<(l-_)/s.tick_separation+2&&!(a.length>m.max_allowed_ticks);n++)$.each(s.multipliers,function(t,e){var i=o+n*s.tick_separation;Math.abs(i)<1e-8*s.tick_separation&&(i=0),i=Math.pow(10,i),(i*=e)<f||g<i||a.push(i)});var e=!0;if("major"!==i&&$.each(u.axis.workspace.tickListFinal.major,function(t,i){var s;e&&(s=!1,$.each(a,function(t,e){s||Math.abs(Math.log10(i[0]/e))/(r-h)<1e-6&&(s=!0)}),s||(e=!1))}),e)return"major"!==i&&10===s.multipliers.length?a.length>3*c?void(d=!0):void(p=a):1<s.multipliers.length?a.length>c?void 0:void(p=a):void(a.length>c?d=!0:p=a)}}),s=[],$.each(p,function(t,e){s.push([e,m.numeric_display(e)])}),this.axis.workspace.tickListFinal[i]=s):m.automatic_ticking(i)},ee.prototype.process=function(){var h=this;if(!this.axis.workspace.rangeFinalised){var t=null!==this.axis.workspace.minHard,e=null!==this.axis.workspace.maxHard,i=null,s=null;t?i=this.axis.workspace.minHard:null!==this.axis.workspace.minUsed&&(i=this.axis.workspace.minUsed),s=e?this.axis.workspace.maxHard:null!==this.axis.workspace.maxUsed?this.axis.workspace.maxUsed:null!==i?i+60:(i=946684800,978307200),Math.abs(s-i)<=1e-14*Math.max(i,s)&&(t&&e&&(this.axis.graph.page.workspace.errorLog+="Axis range set to zero. Ignoring manually set range.\n"),i-=30,s+=30);var a=Math.abs(s-i);if(94608e3<a)var o=this.timestamp_to_calendar(i),n=this.timestamp_to_calendar(s),i=this.calendar_to_timestamp(o[0],1,1,0,0,0),s=this.calendar_to_timestamp(n[0],1,1,0,0,0);else if(7776e3<a)o=this.timestamp_to_calendar(i),12<(n=this.timestamp_to_calendar(s))[1]++&&(n[1]=1,o[0]++),i=this.calendar_to_timestamp(o[0],o[1],1,0,0,0),s=this.calendar_to_timestamp(n[0],n[1],1,0,0,0);else{for(var r=0;r<this.acceptable_intervals.length&&!(this.acceptable_intervals[r]>Math.abs(s-i));r++);r=Math.min(0,r-2),i=Math.floor(i/this.acceptable_intervals[r])*this.acceptable_intervals[r],s=Math.ceil(s/this.acceptable_intervals[r])*this.acceptable_intervals[r]}this.axis.workspace.minFinal=t?this.axis.workspace.minHard:i,this.axis.workspace.maxFinal=e?this.axis.workspace.maxHard:s,this.axis.rangeReversed&&(e=this.axis.workspace.minFinal,this.axis.workspace.maxFinal=this.axis.workspace.minFinal,this.axis.workspace.minFinal=e),this.axis.workspace.rangeFinalised=!0}null===this.axis.workspace.tickListFinal&&(this.axis.workspace.tickListFinal={major:[],minor:[]},$.each(["major","minor"],function(t,i){var e=t?h.axis.ticksMinor:h.axis.ticks;if(null===e.tickList)if(null===e.tickStep)h.automatic_ticking(i);else{var t=Math.min(h.axis.workspace.minFinal,h.axis.workspace.maxFinal),s=Math.min(h.axis.workspace.minFinal,h.axis.workspace.maxFinal),a=e.tickMin;a<t&&(a+=Math.ceil((t-a)/e.tickStep)*e.tickStep);for(var o=0;o<100;o++){var n=a+o*e.tickStep;if(s<n)break;h.axis.workspace.tickListFinal[i].push([n,h.date_display(n,!0,!0,!0,!0)])}}else $.each(e.tickList,function(t,e){h.axis.workspace.tickListFinal[i].push([parseFloat(e[0]),""+e[1]])})}))},ee.prototype.automatic_ticking=function(u){var f=this,g=Math.min(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),m=Math.max(this.axis.workspace.minFinal,this.axis.workspace.maxFinal),v="major"===u?this.axis.workspace.target_number_major_ticks:this.axis.workspace.target_number_minor_ticks,v=Math.max(v,2);v=Math.min(v,this.max_allowed_ticks);for(var t=[{year_step:1e3},{year_step:500},{year_step:250},{year_step:200},{year_step:100},{year_step:50},{year_step:25},{year_step:20},{year_step:10},{year_step:5},{year_step:2},{year_step:1},{month_step:6},{month_step:4},{month_step:3},{month_step:2},{month_step:1}],e=this.acceptable_intervals.length-1;0<=e;e--)t.push({tick_interval:this.acceptable_intervals[e]});var i,x=[[],null],y=!1;$.each(t,function(t,e){if(!y){var a=[[],null];if(e.hasOwnProperty("year_step"))for(var i=f.timestamp_to_calendar(g)[0],s=f.timestamp_to_calendar(m)[0],o=i=Math.floor(i/e.year_step)*e.year_step;o<=s&&!(a[0].length>f.max_allowed_ticks);o+=e.year_step){var n=f.calendar_to_timestamp(o,1,1,0,0,0);n<g||m<n||a[0].push([n,f.date_display(n,!0,!1,!1,!1,!1)])}else if(e.hasOwnProperty("month_step")){for(var h=f.timestamp_to_calendar(g),i=f.timestamp_to_calendar(m),h=12*h[0]+h[1]-1,r=12*i[0]+i[1]-1,_=h=Math.floor(h/e.month_step)*e.month_step;_<=r&&!(a[0].length>f.max_allowed_ticks);_+=e.month_step)(n=f.calendar_to_timestamp(Math.floor(_/12),_%12+1,1,0,0,0))<g||m<n||a[0].push([n,f.date_display(n,_%12==0,!0,!0,!1,!1)]);a[1]=function(){var t=f.date_display(g,!0,!1,!1,!1,!1),e=f.date_display(m,!0,!1,!1,!1,!1);return e!==t?t+" – "+e:t}}else{for(var l=e.tick_interval,c=2419200<l,p=7200<l,n=Math.floor(g/l)*l;n<=m&&!(a[0].length>f.max_allowed_ticks);n+=l)n<g||m<n||a[0].push([n,f.date_display(n,c,p,p,l<86400,l<60)]);a[1]=function(){var t=f.date_display(g,!0,!1,!1,!1,!1),e=f.date_display(m,!0,!1,!1,!1,!1),i=f.date_display(g,!1,!0,!0,!1,!1),s=f.date_display(m,!1,!0,!0,!1,!1);return p?c?null:e!==t?t+" – "+e:t:e!==t?i+" "+t+" – "+s+" "+e:s!==i?i+" – "+s+e:i+t}}var d=!0;"major"!==u&&$.each(f.axis.workspace.tickListFinal.major,function(t,i){var s;d&&(s=!1,$.each(a[0],function(t,e){s||Math.abs(i[0]-e[0])<.01&&(s=!0)}),s||(d=!1))}),d&&(a[0].length>v?y=!0:x=a)}}),this.axis.workspace.tickListFinal[u]=x[0],"major"!==u||null===x[1]||null!==(i=x[1]())&&(null===this.axis.workspace.labelFinal||0===this.axis.workspace.labelFinal.length?this.axis.workspace.labelFinal=i:this.axis.workspace.labelFinal+=", within "+i)},ee.prototype.date_display=function(t,e,i,s,a,o){var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=this.timestamp_to_calendar(t+.001),t="";return s?t+=h[2]+" "+n[h[1]-1]+" ":i&&(t+=n[h[1]-1]+" "),e&&(t+=h[0]+" "),a&&(t+=Pe(h[3])+":"+Pe(h[4])),o&&(t+=":"+Pe(h[5].toFixed(0))),t},ee.prototype.timestamp_to_calendar=function(t){var e=t/86400+2440587.5,i=.5+e-Math.floor(.5+e),s=Math.floor(24*i),a=Math.floor(1440*i%60),o=86400*i%60,t=Math.floor(.5+e),i=t<2361222?Math.floor(t+1524):(n=Math.floor((t-1867216.25)/36524.25),Math.floor(t+n-Math.floor(n/4)+1525)),e=Math.floor((i-122.1)/365.25),t=Math.floor(365*e+Math.floor(e/4)),n=Math.floor((i-t)/30.6001),t=Math.floor(i-t-Math.floor(30.6001*n)),n=Math.floor(n-1-12*(14<=n?1:0));return[Math.floor(e-4715-(3<=n?1:0)),n,t,s,a,o]},ee.prototype.calendar_to_timestamp=function(t,e,i,s,a,o){var n,h=1e4*t+100*e+i;if(e<=2&&(e+=12,--t),h<=17520902)n=Math.floor(t+4716)/4-2-1179;else{if(!(17520914<=h))return 0;n=Math.floor(t/400)-Math.floor(t/100)+Math.floor(t/4)}return 86400*(365*Math.floor(t)-679004+2400000.5+n+Math.floor(30.6001*(e+1))+i+(Math.abs(s)+Math.abs(a)/60+Math.abs(o)/3600)/24-2440587.5)};